module.exports={404300:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>s,getRandomValues:()=>o,randomUUID:()=>i,subtle:()=>t});var r=e.i(591032);let t=r.default.webcrypto?.subtle||{},i=()=>r.default.randomUUID(),o=e=>r.default.webcrypto.getRandomValues(e),s={randomUUID:i,getRandomValues:o,subtle:t}}},737209:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({addRoute:()=>n,createRouter:()=>r,findAllRoutes:()=>c,findRoute:()=>a,removeRoute:()=>d});let t=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function r(){return{root:{key:""},static:new t}}function o(e){return e.split("/").filter(Boolean)}function s(e,i){let r=new t;for(let[t,o]of i){let i=t<0?e.slice(-1*t).join("/"):e[t];if("string"==typeof o)r[o]=i;else{let e=i.match(o);if(e)for(let t in e.groups)r[t]=e.groups[t]}}return r}function n(e,i="",r,s){let a=o(r),d=e.root,l=0,c=[];for(let e=0;e<a.length;e++){let i=a[e];if(i.startsWith("**")){d.wildcard||(d.wildcard={key:"**"}),d=d.wildcard,c.push([-e,i.split(":")[1]||"_",2===i.length]);break}if("*"===i||i.includes(":")){d.param||(d.param={key:"*"}),d=d.param;let t="*"===i;c.push([e,t?`_${l++}`:function(e){if(!e.includes(":",1))return e.slice(1);let t=e.replace(/:(\w+)/g,(e,t)=>`(?<${t}>\\w+)`);return RegExp(`^${t}$`)}(i),t]);continue}let r=d.static?.[i];if(r)d=r;else{let e={key:i};d.static||(d.static=new t),d.static[i]=e,d=e}}let u=c.length>0;d.methods||(d.methods=new t),d.methods[i]||(d.methods[i]=[]),d.methods[i].push({data:s||null,paramsMap:u?c:void 0}),u||(e.static[r]=d)}function a(e,t="",i,r){"/"===i[i.length-1]&&(i=i.slice(0,-1));let n=e.static[i];if(n&&n.methods){let e=n.methods[t]||n.methods[""];if(void 0!==e)return e[0]}let d=o(i),l=function e(t,i,r,o,s){if(s===o.length){if(i.methods){let e=i.methods[r]||i.methods[""];if(e)return e}if(i.param&&i.param.methods){let e=i.param.methods[r]||i.param.methods[""];if(e){let t=e[0].paramsMap;if(t?.[t?.length-1]?.[2])return e}}if(i.wildcard&&i.wildcard.methods){let e=i.wildcard.methods[r]||i.wildcard.methods[""];if(e){let t=e[0].paramsMap;if(t?.[t?.length-1]?.[2])return e}}return}let n=o[s];if(i.static){let a=i.static[n];if(a){let i=e(t,a,r,o,s+1);if(i)return i}}if(i.param){let n=e(t,i.param,r,o,s+1);if(n)return n}if(i.wildcard&&i.wildcard.methods)return i.wildcard.methods[r]||i.wildcard.methods[""]}(e,e.root,t,d,0)?.[0];if(void 0!==l)return r?.params===!1?l:{data:l.data,params:l.paramsMap?s(d,l.paramsMap):void 0}}function d(e,t,i){let r=o(i);return function e(t,i,r,o){if(o===r.length){t.methods&&i in t.methods&&(delete t.methods[i],0===Object.keys(t.methods).length&&(t.methods=void 0));return}let s=r[o];if("*"===s){t.param&&(e(t.param,i,r,o+1),l(t.param)&&(t.param=void 0));return}if("**"===s){t.wildcard&&(e(t.wildcard,i,r,o+1),l(t.wildcard)&&(t.wildcard=void 0));return}let n=t.static?.[s];n&&(e(n,i,r,o+1),l(n)&&(delete t.static[s],0===Object.keys(t.static).length&&(t.static=void 0)))}(e.root,t||"",r,0)}function l(e){return void 0===e.methods&&void 0===e.static&&void 0===e.param&&void 0===e.wildcard}function c(e,t="",i,r){"/"===i[i.length-1]&&(i=i.slice(0,-1));let n=o(i),a=function e(t,i,r,o,s,n=[]){let a=o[s];if(i.wildcard&&i.wildcard.methods){let e=i.wildcard.methods[r]||i.wildcard.methods[""];e&&n.push(...e)}if(i.param&&(e(t,i.param,r,o,s+1,n),s===o.length&&i.param.methods)){let e=i.param.methods[r]||i.param.methods[""];e&&n.push(...e)}let d=i.static?.[a];if(d&&e(t,d,r,o,s+1,n),s===o.length&&i.methods){let e=i.methods[r]||i.methods[""];e&&n.push(...e)}return n}(e,e.root,t,n,0);return r?.params===!1?a:a.map(e=>({data:e.data,params:e.paramsMap?s(n,e.paramsMap):void 0}))}}},311556:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({APIError:()=>h,_statusCode:()=>p,createEndpoint:()=>S,createInternalContext:()=>x,createMiddleware:()=>O,createRouter:()=>e6,generator:()=>e4,getCookieKey:()=>N,getHTML:()=>e3,parseCookies:()=>I,serializeCookie:()=>T,serializeSignedCookie:()=>C,toResponse:()=>A});var r,o,s,n,a,d,l,c=e.i(404300),u=e.i(737209),p={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},h=class extends Error{constructor(e="INTERNAL_SERVER_ERROR",t,i={},r="number"==typeof e?e:p[e]){super(t?.message),this.status=e,this.body=t,this.headers=i,this.statusCode=r,this.name="APIError",this.status=e,this.headers=i,this.statusCode=r,this.body=t?{code:t?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...t}:void 0,this.stack=""}};async function m(e){let t=e.headers.get("content-type")||"";if(e.body){if(t.includes("application/json"))return await e.json();if(t.includes("application/x-www-form-urlencoded")){let t=await e.formData(),i={};return t.forEach((e,t)=>{i[t]=e.toString()}),i}if(t.includes("multipart/form-data")){let t=await e.formData(),i={};return t.forEach((e,t)=>{i[t]=e}),i}return t.includes("text/plain")?await e.text():t.includes("application/octet-stream")?await e.arrayBuffer():t.includes("application/pdf")||t.includes("image/")||t.includes("video/")?await e.blob():t.includes("application/stream")||e.body instanceof ReadableStream?e.body:await e.text()}}function f(e){return e instanceof h||e?.name==="APIError"}function A(e,t){if(e instanceof Response)return t?.headers instanceof Headers&&t.headers.forEach((t,i)=>{e.headers.set(i,t)}),e;if(e?._flag==="json"){let t=e.routerResponse;return t instanceof Response?t:A(e.body,{headers:e.headers,status:e.status})}if(f(e))return A(e.body,{status:e.statusCode,statusText:e.status.toString(),headers:t?.headers||e.headers});let i=e,r=new Headers(t?.headers);return e?"string"==typeof e?(i=e,r.set("Content-Type","text/plain")):e instanceof ArrayBuffer||ArrayBuffer.isView(e)?(i=e,r.set("Content-Type","application/octet-stream")):e instanceof Blob?(i=e,r.set("Content-Type",e.type||"application/octet-stream")):e instanceof FormData?i=e:e instanceof URLSearchParams?(i=e,r.set("Content-Type","application/x-www-form-urlencoded")):e instanceof ReadableStream?(i=e,r.set("Content-Type","application/octet-stream")):function(e){if(void 0===e)return!1;let t=typeof e;return"string"===t||"number"===t||"boolean"===t||null===t||"object"===t&&(!!Array.isArray(e)||!e.buffer&&(e.constructor&&"Object"===e.constructor.name||"function"==typeof e.toJSON))}(e)&&(i=JSON.stringify(e),r.set("Content-Type","application/json")):(null===e&&(i=JSON.stringify(null)),r.set("content-type","application/json")),new Response(i,{...t,headers:r})}async function g(e,t={}){let i={body:t.body,query:t.query};if(e.body){let r=await e.body["~standard"].validate(t.body);if(r.issues)return{data:null,error:y(r.issues,"body")};i.body=r.value}if(e.query){let r=await e.query["~standard"].validate(t.query);if(r.issues)return{data:null,error:y(r.issues,"query")};i.query=r.value}return e.requireHeaders&&!t.headers?{data:null,error:{message:"Headers is required"}}:e.requireRequest&&!t.request?{data:null,error:{message:"Request is required"}}:{data:i,error:null}}function y(e,t){let i=[];for(let t of e){let e=t.message;i.push(e)}return{message:`Invalid ${t} parameters`}}var K={name:"HMAC",hash:"SHA-256"},w=async e=>{let t="string"==typeof e?new TextEncoder().encode(e):e;return await c.subtle.importKey("raw",t,K,!1,["sign","verify"])},v=async(e,t,i)=>{try{let r=atob(e),o=new Uint8Array(r.length);for(let e=0,t=r.length;e<t;e++)o[e]=r.charCodeAt(e);return await c.subtle.verify(K,i,o,new TextEncoder().encode(t))}catch(e){return!1}},b=async(e,t)=>{let i=await w(t);return btoa(String.fromCharCode(...new Uint8Array(await c.subtle.sign(K.name,i,new TextEncoder().encode(e)))))},_=async(e,t)=>{let i=await b(e,t);return e=encodeURIComponent(e=`${e}.${i}`)},N=(e,t)=>{let i=e;if(t)if("secure"===t)i="__Secure-"+e;else{if("host"!==t)return;i="__Host-"+e}return i};function I(e){if("string"!=typeof e)throw TypeError("argument str must be a string");let t=new Map,i=0;for(;i<e.length;){let r=e.indexOf("=",i);if(-1===r)break;let o=e.indexOf(";",i);if(-1===o)o=e.length;else if(o<r){i=e.lastIndexOf(";",r-1)+1;continue}let s=e.slice(i,r).trim();if(!t.has(s)){let i=e.slice(r+1,o).trim();34===i.codePointAt(0)&&(i=i.slice(1,-1)),t.set(s,function(e){try{return e.includes("%")?decodeURIComponent(e):e}catch{return e}}(i))}i=o+1}return t}var E=(e,t,i={})=>{let r;if(r=i?.prefix==="secure"?`__Secure-${e}=${t}`:i?.prefix==="host"?`__Host-${e}=${t}`:`${e}=${t}`,e.startsWith("__Secure-")&&!i.secure&&(i.secure=!0),e.startsWith("__Host-")&&(i.secure||(i.secure=!0),"/"!==i.path&&(i.path="/"),i.domain&&(i.domain=void 0)),i&&"number"==typeof i.maxAge&&i.maxAge>=0){if(i.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");r+=`; Max-Age=${Math.floor(i.maxAge)}`}if(i.domain&&"host"!==i.prefix&&(r+=`; Domain=${i.domain}`),i.path&&(r+=`; Path=${i.path}`),i.expires){if(i.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");r+=`; Expires=${i.expires.toUTCString()}`}return i.httpOnly&&(r+="; HttpOnly"),i.secure&&(r+="; Secure"),i.sameSite&&(r+=`; SameSite=${i.sameSite.charAt(0).toUpperCase()+i.sameSite.slice(1)}`),i.partitioned&&(i.secure||(i.secure=!0),r+="; Partitioned"),r},T=(e,t,i)=>E(e,t=encodeURIComponent(t),i),C=async(e,t,i,r)=>E(e,t=await _(t,i),r),x=async(e,{options:t,path:i})=>{let r=new Headers,{data:o,error:s}=await g(t,e);if(s)throw new h(400,{message:s.message,code:"VALIDATION_ERROR"});let n="headers"in e?e.headers instanceof Headers?e.headers:new Headers(e.headers):"request"in e&&e.request instanceof Request?e.request.headers:null,a=n?.get("cookie"),d=a?I(a):void 0,l={...e,body:o.body,query:o.query,path:e.path||i,context:"context"in e&&e.context?e.context:{},returned:void 0,headers:e?.headers,request:e?.request,params:"params"in e?e.params:void 0,method:e.method,setHeader:(e,t)=>{r.set(e,t)},getHeader:e=>n?n.get(e):null,getCookie:(e,t)=>{let i=N(e,t);return i&&d?.get(i)||null},getSignedCookie:async(e,t,i)=>{let r=N(e,i);if(!r)return null;let o=d?.get(r);if(!o)return null;let s=o.lastIndexOf(".");if(s<1)return null;let n=o.substring(0,s),a=o.substring(s+1);if(44!==a.length||!a.endsWith("="))return null;let l=await w(t);return!!await v(a,n,l)&&n},setCookie:(e,t,i)=>{let o=T(e,t,i);return r.append("set-cookie",o),o},setSignedCookie:async(e,t,i,o)=>{let s=await C(e,t,i,o);return r.append("set-cookie",s),s},redirect:e=>(r.set("location",e),new h("FOUND",void 0,r)),error:(e,t,i)=>new h(e,t,i),json:(t,i)=>e.asResponse?{body:i?.body||t,routerResponse:i,_flag:"json"}:t,responseHeaders:r};for(let e of t.use||[]){let t=await e({...l,returnHeaders:!0,asResponse:!1});t.response&&Object.assign(l.context,t.response),t.headers&&t.headers.forEach((e,t)=>{l.responseHeaders.set(t,e)})}return l};function O(e,t){let i=async i=>{let r="function"==typeof e?e:t,o=await x(i,{options:"function"==typeof e?{}:e,path:"/"});if(!r)throw Error("handler must be defined");let s=await r(o),n=o.responseHeaders;return i.returnHeaders?{headers:n,response:s}:s};return i.options="function"==typeof e?{}:e,i}O.create=e=>function(t,i){if("function"==typeof t)return O({use:e?.use},t);if(!i)throw Error("Middleware handler is required");return O({...t,method:"*",use:[...e?.use||[],...t.use||[]]},i)};var S=(e,t,i)=>{let r=async(...r)=>{let o=r[0]||{},s=await x(o,{options:t,path:e}),n=await i(s).catch(async e=>{if(f(e)){let i=t.onAPIError;if(i&&await i(e),o.asResponse)return e}throw e}),a=s.responseHeaders;return o.asResponse?A(n,{headers:a}):o.returnHeaders?{headers:a,response:n}:n};return r.options=t,r.path=e,r};S.create=e=>(t,i,r)=>S(t,{...i,use:[...i?.use||[],...e?.use||[]]},r),function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let i of e)t[i]=i;return t},e.getValidEnumValues=t=>{let i=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(let e of i)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t},e.find=(e,t)=>{for(let i of e)if(t(i))return i},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(r||(r={})),(o||(o={})).mergeShapes=(e,t)=>({...e,...t});var k=r.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),R=e=>{switch(typeof e){case"undefined":return k.undefined;case"string":return k.string;case"number":return isNaN(e)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":if(Array.isArray(e))return k.array;if(null===e)return k.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return k.promise;if("undefined"!=typeof Map&&e instanceof Map)return k.map;if("undefined"!=typeof Set&&e instanceof Set)return k.set;if("undefined"!=typeof Date&&e instanceof Date)return k.date;return k.object;default:return k.unknown}},P=r.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),U=class e extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},i={_errors:[]},r=e=>{for(let o of e.issues)if("invalid_union"===o.code)o.unionErrors.map(r);else if("invalid_return_type"===o.code)r(o.returnTypeError);else if("invalid_arguments"===o.code)r(o.argumentsError);else if(0===o.path.length)i._errors.push(t(o));else{let e=i,r=0;for(;r<o.path.length;){let i=o.path[r];r===o.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(t(o))):e[i]=e[i]||{_errors:[]},e=e[i],r++}}};return r(this),i}static assert(t){if(!(t instanceof e))throw Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,r.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},i=[];for(let r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):i.push(e(r));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}};U.create=e=>new U(e);var D=(e,t)=>{let i;switch(e.code){case P.invalid_type:i=e.received===k.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case P.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,r.jsonStringifyReplacer)}`;break;case P.unrecognized_keys:i=`Unrecognized key(s) in object: ${r.joinValues(e.keys,", ")}`;break;case P.invalid_union:i="Invalid input";break;case P.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${r.joinValues(e.options)}`;break;case P.invalid_enum_value:i=`Invalid enum value. Expected ${r.joinValues(e.options)}, received '${e.received}'`;break;case P.invalid_arguments:i="Invalid function arguments";break;case P.invalid_return_type:i="Invalid function return type";break;case P.invalid_date:i="Invalid date";break;case P.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:r.assertNever(e.validation):i="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case P.too_small:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case P.too_big:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case P.custom:i="Invalid input";break;case P.invalid_intersection_types:i="Intersection results could not be merged";break;case P.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case P.not_finite:i="Number must be finite";break;default:i=t.defaultError,r.assertNever(e)}return{message:i}},L=e=>{let{data:t,path:i,errorMaps:r,issueData:o}=e,s=[...i,...o.path||[]],n={...o,path:s};if(void 0!==o.message)return{...o,path:s,message:o.message};let a="";for(let e of r.filter(e=>!!e).slice().reverse())a=e(n,{data:t,defaultError:a}).message;return{...o,path:s,message:a}};function z(e,t){let i=L({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,D,D==D?void 0:D].filter(e=>!!e)});e.common.issues.push(i)}var B=class e{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let i=[];for(let r of t){if("aborted"===r.status)return j;"dirty"===r.status&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(t,i){let r=[];for(let e of i){let t=await e.key,i=await e.value;r.push({key:t,value:i})}return e.mergeObjectSync(t,r)}static mergeObjectSync(e,t){let i={};for(let r of t){let{key:t,value:o}=r;if("aborted"===t.status||"aborted"===o.status)return j;"dirty"===t.status&&e.dirty(),"dirty"===o.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==o.value||r.alwaysSet)&&(i[t.value]=o.value)}return{status:e.value,value:i}}},j=Object.freeze({status:"aborted"}),q=e=>({status:"dirty",value:e}),Z=e=>({status:"valid",value:e}),M=e=>"aborted"===e.status,V=e=>"dirty"===e.status,W=e=>"valid"===e.status,F=e=>"undefined"!=typeof Promise&&e instanceof Promise;function $(e,t,i,r){if("a"===i&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)}function H(e,t,i,r,o){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,i):o?o.value=i:t.set(e,i),i}!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(s||(s={}));var Q=class{constructor(e,t,i,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},J=(e,t)=>{if(W(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new U(e.common.issues);return this._error=t,this._error}}};function G(e){if(!e)return{};let{errorMap:t,invalid_type_error:i,required_error:r,description:o}=e;if(t&&(i||r))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:o}:{errorMap:(t,o)=>{var s,n;let{message:a}=e;return"invalid_enum_value"===t.code?{message:null!=a?a:o.defaultError}:void 0===o.data?{message:null!=(s=null!=a?a:r)?s:o.defaultError}:"invalid_type"!==t.code?{message:o.defaultError}:{message:null!=(n=null!=a?a:i)?n:o.defaultError}},description:o}}var Y=class{get description(){return this._def.description}_getType(e){return R(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:R(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new B,ctx:{common:e.parent.common,data:e.data,parsedType:R(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(F(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){var i;let r={common:{issues:[],async:null!=(i=null==t?void 0:t.async)&&i,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:R(e)},o=this._parseSync({data:e,path:r.path,parent:r});return J(r,o)}"~validate"(e){var t,i;let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:R(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:r});return W(t)?{value:t.value}:{issues:r.common.issues}}catch(e){(null==(i=null==(t=null==e?void 0:e.message)?void 0:t.toLowerCase())?void 0:i.includes("encountered"))&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(e=>W(e)?{value:e.value}:{issues:r.common.issues})}async parseAsync(e,t){let i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){let i={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:R(e)},r=this._parse({data:e,path:i.path,parent:i});return J(i,await (F(r)?r:Promise.resolve(r)))}refine(e,t){let i=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{let o=e(t),s=()=>r.addIssue({code:P.custom,...i(t)});return"undefined"!=typeof Promise&&o instanceof Promise?o.then(e=>!!e||(s(),!1)):!!o||(s(),!1)})}refinement(e,t){return this._refinement((i,r)=>!!e(i)||(r.addIssue("function"==typeof t?t(i,r):t),!1))}_refinement(e){return new eW({schema:this,typeName:l.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return eF.create(this,this._def)}nullable(){return e$.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return eC.create(this)}promise(){return eV.create(this,this._def)}or(e){return eO.create([this,e],this._def)}and(e){return eR.create(this,e,this._def)}transform(e){return new eW({...G(this._def),schema:this,typeName:l.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eH({...G(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:l.ZodDefault})}brand(){return new eG({typeName:l.ZodBranded,type:this,...G(this._def)})}catch(e){return new eQ({...G(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:l.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eY.create(this,e)}readonly(){return eX.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},X=/^c[^\s-]{8,}$/i,ee=/^[0-9a-z]+$/,et=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ei=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,er=/^[a-z0-9_-]{21}$/i,eo=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,es=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,en=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ea=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ed=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,el=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ec=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,eu=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,ep=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,eh="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",em=RegExp(`^${eh}$`);function ef(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}var eA=class e extends Y{_parse(e){var t,i,o,s;let n;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.string,received:t.parsedType}),j}let a=new B;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(z(n=this._getOrReturnCtx(e,n),{code:P.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),a.dirty());else if("max"===l.kind)e.data.length>l.value&&(z(n=this._getOrReturnCtx(e,n),{code:P.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),a.dirty());else if("length"===l.kind){let t=e.data.length>l.value,i=e.data.length<l.value;(t||i)&&(n=this._getOrReturnCtx(e,n),t?z(n,{code:P.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&z(n,{code:P.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),a.dirty())}else if("email"===l.kind)en.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"email",code:P.invalid_string,message:l.message}),a.dirty());else if("emoji"===l.kind)d||(d=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),d.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"emoji",code:P.invalid_string,message:l.message}),a.dirty());else if("uuid"===l.kind)ei.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"uuid",code:P.invalid_string,message:l.message}),a.dirty());else if("nanoid"===l.kind)er.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"nanoid",code:P.invalid_string,message:l.message}),a.dirty());else if("cuid"===l.kind)X.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"cuid",code:P.invalid_string,message:l.message}),a.dirty());else if("cuid2"===l.kind)ee.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"cuid2",code:P.invalid_string,message:l.message}),a.dirty());else if("ulid"===l.kind)et.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"ulid",code:P.invalid_string,message:l.message}),a.dirty());else if("url"===l.kind)try{new URL(e.data)}catch(t){z(n=this._getOrReturnCtx(e,n),{validation:"url",code:P.invalid_string,message:l.message}),a.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"regex",code:P.invalid_string,message:l.message}),a.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(z(n=this._getOrReturnCtx(e,n),{code:P.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),a.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(z(n=this._getOrReturnCtx(e,n),{code:P.invalid_string,validation:{startsWith:l.value},message:l.message}),a.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(z(n=this._getOrReturnCtx(e,n),{code:P.invalid_string,validation:{endsWith:l.value},message:l.message}),a.dirty()):"datetime"===l.kind?(function(e){let t=`${eh}T${ef(e)}`,i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,RegExp(`^${t}$`)})(l).test(e.data)||(z(n=this._getOrReturnCtx(e,n),{code:P.invalid_string,validation:"datetime",message:l.message}),a.dirty()):"date"===l.kind?em.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{code:P.invalid_string,validation:"date",message:l.message}),a.dirty()):"time"===l.kind?RegExp(`^${ef(l)}$`).test(e.data)||(z(n=this._getOrReturnCtx(e,n),{code:P.invalid_string,validation:"time",message:l.message}),a.dirty()):"duration"===l.kind?es.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"duration",code:P.invalid_string,message:l.message}),a.dirty()):"ip"===l.kind?(t=e.data,!(("v4"===(i=l.version)||!i)&&ea.test(t)||("v6"===i||!i)&&el.test(t))&&1&&(z(n=this._getOrReturnCtx(e,n),{validation:"ip",code:P.invalid_string,message:l.message}),a.dirty())):"jwt"===l.kind?!function(e,t){if(!eo.test(e))return!1;try{let[i]=e.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),o=JSON.parse(atob(r));if("object"!=typeof o||null===o||!o.typ||!o.alg||t&&o.alg!==t)return!1;return!0}catch(e){return!1}}(e.data,l.alg)&&(z(n=this._getOrReturnCtx(e,n),{validation:"jwt",code:P.invalid_string,message:l.message}),a.dirty()):"cidr"===l.kind?(o=e.data,!(("v4"===(s=l.version)||!s)&&ed.test(o)||("v6"===s||!s)&&ec.test(o))&&1&&(z(n=this._getOrReturnCtx(e,n),{validation:"cidr",code:P.invalid_string,message:l.message}),a.dirty())):"base64"===l.kind?eu.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"base64",code:P.invalid_string,message:l.message}),a.dirty()):"base64url"===l.kind?ep.test(e.data)||(z(n=this._getOrReturnCtx(e,n),{validation:"base64url",code:P.invalid_string,message:l.message}),a.dirty()):r.assertNever(l);return{status:a.value,value:e.data}}_regex(e,t,i){return this.refinement(t=>e.test(t),{validation:t,code:P.invalid_string,...s.errToObj(i)})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}email(e){return this._addCheck({kind:"email",...s.errToObj(e)})}url(e){return this._addCheck({kind:"url",...s.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...s.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...s.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...s.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...s.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...s.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...s.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...s.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...s.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...s.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...s.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...s.errToObj(e)})}datetime(e){var t,i;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!=(t=null==e?void 0:e.offset)&&t,local:null!=(i=null==e?void 0:e.local)&&i,...s.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...s.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...s.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...s.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...s.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...s.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...s.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...s.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...s.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...s.errToObj(t)})}nonempty(e){return this.min(1,s.errToObj(e))}trim(){return new e({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new e({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new e({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};eA.create=e=>{var t;return new eA({checks:[],typeName:l.ZodString,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...G(e)})};var eg=class e extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.number,received:t.parsedType}),j}let i=new B;for(let o of this._def.checks)"int"===o.kind?r.isInteger(e.data)||(z(t=this._getOrReturnCtx(e,t),{code:P.invalid_type,expected:"integer",received:"float",message:o.message}),i.dirty()):"min"===o.kind?(o.inclusive?e.data<o.value:e.data<=o.value)&&(z(t=this._getOrReturnCtx(e,t),{code:P.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):"max"===o.kind?(o.inclusive?e.data>o.value:e.data>=o.value)&&(z(t=this._getOrReturnCtx(e,t),{code:P.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),i.dirty()):"multipleOf"===o.kind?0!==function(e,t){let i=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=i>r?i:r;return parseInt(e.toFixed(o).replace(".",""))%parseInt(t.toFixed(o).replace(".",""))/Math.pow(10,o)}(e.data,o.value)&&(z(t=this._getOrReturnCtx(e,t),{code:P.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):"finite"===o.kind?Number.isFinite(e.data)||(z(t=this._getOrReturnCtx(e,t),{code:P.not_finite,message:o.message}),i.dirty()):r.assertNever(o);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,s.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.toString(t))}setLimit(t,i,r,o){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:r,message:s.toString(o)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}int(e){return this._addCheck({kind:"int",message:s.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:s.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:s.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:s.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:s.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:s.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:s.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:s.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&r.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let i of this._def.checks)if("finite"===i.kind||"int"===i.kind||"multipleOf"===i.kind)return!0;else"min"===i.kind?(null===t||i.value>t)&&(t=i.value):"max"===i.kind&&(null===e||i.value<e)&&(e=i.value);return Number.isFinite(t)&&Number.isFinite(e)}};eg.create=e=>new eg({checks:[],typeName:l.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...G(e)});var ey=class e extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let i=new B;for(let o of this._def.checks)"min"===o.kind?(o.inclusive?e.data<o.value:e.data<=o.value)&&(z(t=this._getOrReturnCtx(e,t),{code:P.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):"max"===o.kind?(o.inclusive?e.data>o.value:e.data>=o.value)&&(z(t=this._getOrReturnCtx(e,t),{code:P.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),i.dirty()):"multipleOf"===o.kind?e.data%o.value!==BigInt(0)&&(z(t=this._getOrReturnCtx(e,t),{code:P.not_multiple_of,multipleOf:o.value,message:o.message}),i.dirty()):r.assertNever(o);return{status:i.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.bigint,received:t.parsedType}),j}gte(e,t){return this.setLimit("min",e,!0,s.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.toString(t))}setLimit(t,i,r,o){return new e({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:r,message:s.toString(o)}]})}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:s.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:s.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:s.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:s.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};ey.create=e=>{var t;return new ey({checks:[],typeName:l.ZodBigInt,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...G(e)})};var eK=class extends Y{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==k.boolean){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.boolean,received:t.parsedType}),j}return Z(e.data)}};eK.create=e=>new eK({typeName:l.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...G(e)});var ew=class e extends Y{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.date,received:t.parsedType}),j}if(isNaN(e.data.getTime()))return z(this._getOrReturnCtx(e),{code:P.invalid_date}),j;let i=new B;for(let o of this._def.checks)"min"===o.kind?e.data.getTime()<o.value&&(z(t=this._getOrReturnCtx(e,t),{code:P.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),i.dirty()):"max"===o.kind?e.data.getTime()>o.value&&(z(t=this._getOrReturnCtx(e,t),{code:P.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),i.dirty()):r.assertNever(o);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(t){return new e({...this._def,checks:[...this._def.checks,t]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:s.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:s.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}};ew.create=e=>new ew({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:l.ZodDate,...G(e)});var ev=class extends Y{_parse(e){if(this._getType(e)!==k.symbol){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.symbol,received:t.parsedType}),j}return Z(e.data)}};ev.create=e=>new ev({typeName:l.ZodSymbol,...G(e)});var eb=class extends Y{_parse(e){if(this._getType(e)!==k.undefined){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.undefined,received:t.parsedType}),j}return Z(e.data)}};eb.create=e=>new eb({typeName:l.ZodUndefined,...G(e)});var e_=class extends Y{_parse(e){if(this._getType(e)!==k.null){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.null,received:t.parsedType}),j}return Z(e.data)}};e_.create=e=>new e_({typeName:l.ZodNull,...G(e)});var eN=class extends Y{constructor(){super(...arguments),this._any=!0}_parse(e){return Z(e.data)}};eN.create=e=>new eN({typeName:l.ZodAny,...G(e)});var eI=class extends Y{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Z(e.data)}};eI.create=e=>new eI({typeName:l.ZodUnknown,...G(e)});var eE=class extends Y{_parse(e){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.never,received:t.parsedType}),j}};eE.create=e=>new eE({typeName:l.ZodNever,...G(e)});var eT=class extends Y{_parse(e){if(this._getType(e)!==k.undefined){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.void,received:t.parsedType}),j}return Z(e.data)}};eT.create=e=>new eT({typeName:l.ZodVoid,...G(e)});var eC=class e extends Y{_parse(e){let{ctx:t,status:i}=this._processInputParams(e),r=this._def;if(t.parsedType!==k.array)return z(t,{code:P.invalid_type,expected:k.array,received:t.parsedType}),j;if(null!==r.exactLength){let e=t.data.length>r.exactLength.value,o=t.data.length<r.exactLength.value;(e||o)&&(z(t,{code:e?P.too_big:P.too_small,minimum:o?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(z(t,{code:P.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(z(t,{code:P.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),t.common.async)return Promise.all([...t.data].map((e,i)=>r.type._parseAsync(new Q(t,e,t.path,i)))).then(e=>B.mergeArray(i,e));let o=[...t.data].map((e,i)=>r.type._parseSync(new Q(t,e,t.path,i)));return B.mergeArray(i,o)}get element(){return this._def.type}min(t,i){return new e({...this._def,minLength:{value:t,message:s.toString(i)}})}max(t,i){return new e({...this._def,maxLength:{value:t,message:s.toString(i)}})}length(t,i){return new e({...this._def,exactLength:{value:t,message:s.toString(i)}})}nonempty(e){return this.min(1,e)}};eC.create=(e,t)=>new eC({type:e,minLength:null,maxLength:null,exactLength:null,typeName:l.ZodArray,...G(t)});var ex=class e extends Y{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=r.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==k.object){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.object,received:t.parsedType}),j}let{status:t,ctx:i}=this._processInputParams(e),{shape:r,keys:o}=this._getCached(),s=[];if(!(this._def.catchall instanceof eE&&"strip"===this._def.unknownKeys))for(let e in i.data)o.includes(e)||s.push(e);let n=[];for(let e of o){let t=r[e],o=i.data[e];n.push({key:{status:"valid",value:e},value:t._parse(new Q(i,o,i.path,e)),alwaysSet:e in i.data})}if(this._def.catchall instanceof eE){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)n.push({key:{status:"valid",value:e},value:{status:"valid",value:i.data[e]}});else if("strict"===e)s.length>0&&(z(i,{code:P.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let r=i.data[t];n.push({key:{status:"valid",value:t},value:e._parse(new Q(i,r,i.path,t)),alwaysSet:t in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of n){let i=await t.key,r=await t.value;e.push({key:i,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>B.mergeObjectSync(t,e)):B.mergeObjectSync(t,n)}get shape(){return this._def.shape()}strict(t){return s.errToObj,new e({...this._def,unknownKeys:"strict",...void 0!==t?{errorMap:(e,i)=>{var r,o,n,a;let d=null!=(n=null==(o=(r=this._def).errorMap)?void 0:o.call(r,e,i).message)?n:i.defaultError;return"unrecognized_keys"===e.code?{message:null!=(a=s.errToObj(t).message)?a:d}:{message:d}}}:{}})}strip(){return new e({...this._def,unknownKeys:"strip"})}passthrough(){return new e({...this._def,unknownKeys:"passthrough"})}extend(t){return new e({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new e({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:l.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(t){return new e({...this._def,catchall:t})}pick(t){let i={};return r.objectKeys(t).forEach(e=>{t[e]&&this.shape[e]&&(i[e]=this.shape[e])}),new e({...this._def,shape:()=>i})}omit(t){let i={};return r.objectKeys(this.shape).forEach(e=>{t[e]||(i[e]=this.shape[e])}),new e({...this._def,shape:()=>i})}deepPartial(){return function e(t){if(t instanceof ex){let i={};for(let r in t.shape){let o=t.shape[r];i[r]=eF.create(e(o))}return new ex({...t._def,shape:()=>i})}if(t instanceof eC)return new eC({...t._def,type:e(t.element)});if(t instanceof eF)return eF.create(e(t.unwrap()));if(t instanceof e$)return e$.create(e(t.unwrap()));if(t instanceof eP)return eP.create(t.items.map(t=>e(t)));else return t}(this)}partial(t){let i={};return r.objectKeys(this.shape).forEach(e=>{let r=this.shape[e];t&&!t[e]?i[e]=r:i[e]=r.optional()}),new e({...this._def,shape:()=>i})}required(t){let i={};return r.objectKeys(this.shape).forEach(e=>{if(t&&!t[e])i[e]=this.shape[e];else{let t=this.shape[e];for(;t instanceof eF;)t=t._def.innerType;i[e]=t}}),new e({...this._def,shape:()=>i})}keyof(){return eq(r.objectKeys(this.shape))}};ex.create=(e,t)=>new ex({shape:()=>e,unknownKeys:"strip",catchall:eE.create(),typeName:l.ZodObject,...G(t)}),ex.strictCreate=(e,t)=>new ex({shape:()=>e,unknownKeys:"strict",catchall:eE.create(),typeName:l.ZodObject,...G(t)}),ex.lazycreate=(e,t)=>new ex({shape:e,unknownKeys:"strip",catchall:eE.create(),typeName:l.ZodObject,...G(t)});var eO=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),i=this._def.options;if(t.common.async)return Promise.all(i.map(async e=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let i of e)if("dirty"===i.result.status)return t.common.issues.push(...i.ctx.common.issues),i.result;let i=e.map(e=>new U(e.ctx.common.issues));return z(t,{code:P.invalid_union,unionErrors:i}),j});{let e,r=[];for(let o of i){let i={...t,common:{...t.common,issues:[]},parent:null},s=o._parseSync({data:t.data,path:t.path,parent:i});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:i}),i.common.issues.length&&r.push(i.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let o=r.map(e=>new U(e));return z(t,{code:P.invalid_union,unionErrors:o}),j}}get options(){return this._def.options}};eO.create=(e,t)=>new eO({options:e,typeName:l.ZodUnion,...G(t)});var eS=e=>{if(e instanceof eB)return eS(e.schema);if(e instanceof eW)return eS(e.innerType());if(e instanceof ej)return[e.value];if(e instanceof eZ)return e.options;if(e instanceof eM)return r.objectValues(e.enum);else if(e instanceof eH)return eS(e._def.innerType);else if(e instanceof eb)return[void 0];else if(e instanceof e_)return[null];else if(e instanceof eF)return[void 0,...eS(e.unwrap())];else if(e instanceof e$)return[null,...eS(e.unwrap())];else if(e instanceof eG)return eS(e.unwrap());else if(e instanceof eX)return eS(e.unwrap());else if(e instanceof eQ)return eS(e._def.innerType);else return[]},ek=class e extends Y{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.object)return z(t,{code:P.invalid_type,expected:k.object,received:t.parsedType}),j;let i=this.discriminator,r=t.data[i],o=this.optionsMap.get(r);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):(z(t,{code:P.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),j)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,i,r){let o=new Map;for(let e of i){let i=eS(e.shape[t]);if(!i.length)throw Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let r of i){if(o.has(r))throw Error(`Discriminator property ${String(t)} has duplicate value ${String(r)}`);o.set(r,e)}}return new e({typeName:l.ZodDiscriminatedUnion,discriminator:t,options:i,optionsMap:o,...G(r)})}},eR=class extends Y{_parse(e){let{status:t,ctx:i}=this._processInputParams(e),o=(e,o)=>{if(M(e)||M(o))return j;let s=function e(t,i){let o=R(t),s=R(i);if(t===i)return{valid:!0,data:t};if(o===k.object&&s===k.object){let o=r.objectKeys(i),s=r.objectKeys(t).filter(e=>-1!==o.indexOf(e)),n={...t,...i};for(let r of s){let o=e(t[r],i[r]);if(!o.valid)return{valid:!1};n[r]=o.data}return{valid:!0,data:n}}if(o===k.array&&s===k.array){if(t.length!==i.length)return{valid:!1};let r=[];for(let o=0;o<t.length;o++){let s=e(t[o],i[o]);if(!s.valid)return{valid:!1};r.push(s.data)}return{valid:!0,data:r}}if(o===k.date&&s===k.date&&+t==+i)return{valid:!0,data:t};return{valid:!1}}(e.value,o.value);return s.valid?((V(e)||V(o))&&t.dirty(),{status:t.value,value:s.data}):(z(i,{code:P.invalid_intersection_types}),j)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([e,t])=>o(e,t)):o(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}};eR.create=(e,t,i)=>new eR({left:e,right:t,typeName:l.ZodIntersection,...G(i)});var eP=class e extends Y{_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==k.array)return z(i,{code:P.invalid_type,expected:k.array,received:i.parsedType}),j;if(i.data.length<this._def.items.length)return z(i,{code:P.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),j;!this._def.rest&&i.data.length>this._def.items.length&&(z(i,{code:P.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let r=[...i.data].map((e,t)=>{let r=this._def.items[t]||this._def.rest;return r?r._parse(new Q(i,e,i.path,t)):null}).filter(e=>!!e);return i.common.async?Promise.all(r).then(e=>B.mergeArray(t,e)):B.mergeArray(t,r)}get items(){return this._def.items}rest(t){return new e({...this._def,rest:t})}};eP.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new eP({items:e,typeName:l.ZodTuple,rest:null,...G(t)})};var eU=class e extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==k.object)return z(i,{code:P.invalid_type,expected:k.object,received:i.parsedType}),j;let r=[],o=this._def.keyType,s=this._def.valueType;for(let e in i.data)r.push({key:o._parse(new Q(i,e,i.path,e)),value:s._parse(new Q(i,i.data[e],i.path,e)),alwaysSet:e in i.data});return i.common.async?B.mergeObjectAsync(t,r):B.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(t,i,r){return new e(i instanceof Y?{keyType:t,valueType:i,typeName:l.ZodRecord,...G(r)}:{keyType:eA.create(),valueType:t,typeName:l.ZodRecord,...G(i)})}},eD=class extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==k.map)return z(i,{code:P.invalid_type,expected:k.map,received:i.parsedType}),j;let r=this._def.keyType,o=this._def.valueType,s=[...i.data.entries()].map(([e,t],s)=>({key:r._parse(new Q(i,e,i.path,[s,"key"])),value:o._parse(new Q(i,t,i.path,[s,"value"]))}));if(i.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let i of s){let r=await i.key,o=await i.value;if("aborted"===r.status||"aborted"===o.status)return j;("dirty"===r.status||"dirty"===o.status)&&t.dirty(),e.set(r.value,o.value)}return{status:t.value,value:e}})}{let e=new Map;for(let i of s){let r=i.key,o=i.value;if("aborted"===r.status||"aborted"===o.status)return j;("dirty"===r.status||"dirty"===o.status)&&t.dirty(),e.set(r.value,o.value)}return{status:t.value,value:e}}}};eD.create=(e,t,i)=>new eD({valueType:t,keyType:e,typeName:l.ZodMap,...G(i)});var eL=class e extends Y{_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==k.set)return z(i,{code:P.invalid_type,expected:k.set,received:i.parsedType}),j;let r=this._def;null!==r.minSize&&i.data.size<r.minSize.value&&(z(i,{code:P.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&i.data.size>r.maxSize.value&&(z(i,{code:P.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());let o=this._def.valueType;function s(e){let i=new Set;for(let r of e){if("aborted"===r.status)return j;"dirty"===r.status&&t.dirty(),i.add(r.value)}return{status:t.value,value:i}}let n=[...i.data.values()].map((e,t)=>o._parse(new Q(i,e,i.path,t)));return i.common.async?Promise.all(n).then(e=>s(e)):s(n)}min(t,i){return new e({...this._def,minSize:{value:t,message:s.toString(i)}})}max(t,i){return new e({...this._def,maxSize:{value:t,message:s.toString(i)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};eL.create=(e,t)=>new eL({valueType:e,minSize:null,maxSize:null,typeName:l.ZodSet,...G(t)});var ez=class e extends Y{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.function)return z(t,{code:P.invalid_type,expected:k.function,received:t.parsedType}),j;function i(e,i){return L({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,D,D].filter(e=>!!e),issueData:{code:P.invalid_arguments,argumentsError:i}})}function r(e,i){return L({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,D,D].filter(e=>!!e),issueData:{code:P.invalid_return_type,returnTypeError:i}})}let o={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof eV){let e=this;return Z(async function(...t){let n=new U([]),a=await e._def.args.parseAsync(t,o).catch(e=>{throw n.addIssue(i(t,e)),n}),d=await Reflect.apply(s,this,a);return await e._def.returns._def.type.parseAsync(d,o).catch(e=>{throw n.addIssue(r(d,e)),n})})}{let e=this;return Z(function(...t){let n=e._def.args.safeParse(t,o);if(!n.success)throw new U([i(t,n.error)]);let a=Reflect.apply(s,this,n.data),d=e._def.returns.safeParse(a,o);if(!d.success)throw new U([r(a,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new e({...this._def,args:eP.create(t).rest(eI.create())})}returns(t){return new e({...this._def,returns:t})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(t,i,r){return new e({args:t||eP.create([]).rest(eI.create()),returns:i||eI.create(),typeName:l.ZodFunction,...G(r)})}},eB=class extends Y{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};eB.create=(e,t)=>new eB({getter:e,typeName:l.ZodLazy,...G(t)});var ej=class extends Y{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return z(t,{received:t.data,code:P.invalid_literal,expected:this._def.value}),j}return{status:"valid",value:e.data}}get value(){return this._def.value}};function eq(e,t){return new eZ({values:e,typeName:l.ZodEnum,...G(t)})}ej.create=(e,t)=>new ej({value:e,typeName:l.ZodLiteral,...G(t)});var eZ=class e extends Y{constructor(){super(...arguments),n.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),i=this._def.values;return z(t,{expected:r.joinValues(i),received:t.parsedType,code:P.invalid_type}),j}if($(this,n,"f")||H(this,n,new Set(this._def.values),"f"),!$(this,n,"f").has(e.data)){let t=this._getOrReturnCtx(e),i=this._def.values;return z(t,{received:t.data,code:P.invalid_enum_value,options:i}),j}return Z(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(t,i=this._def){return e.create(t,{...this._def,...i})}exclude(t,i=this._def){return e.create(this.options.filter(e=>!t.includes(e)),{...this._def,...i})}};n=new WeakMap,eZ.create=eq;var eM=class extends Y{constructor(){super(...arguments),a.set(this,void 0)}_parse(e){let t=r.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==k.string&&i.parsedType!==k.number){let e=r.objectValues(t);return z(i,{expected:r.joinValues(e),received:i.parsedType,code:P.invalid_type}),j}if($(this,a,"f")||H(this,a,new Set(r.getValidEnumValues(this._def.values)),"f"),!$(this,a,"f").has(e.data)){let e=r.objectValues(t);return z(i,{received:i.data,code:P.invalid_enum_value,options:e}),j}return Z(e.data)}get enum(){return this._def.values}};a=new WeakMap,eM.create=(e,t)=>new eM({values:e,typeName:l.ZodNativeEnum,...G(t)});var eV=class extends Y{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==k.promise&&!1===t.common.async?(z(t,{code:P.invalid_type,expected:k.promise,received:t.parsedType}),j):Z((t.parsedType===k.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}};eV.create=(e,t)=>new eV({type:e,typeName:l.ZodPromise,...G(t)});var eW=class extends Y{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===l.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:i}=this._processInputParams(e),o=this._def.effect||null,s={addIssue:e=>{z(i,e),e.fatal?t.abort():t.dirty()},get path(){return i.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===o.type){let e=o.transform(i.data,s);if(i.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return j;let r=await this._def.schema._parseAsync({data:e,path:i.path,parent:i});return"aborted"===r.status?j:"dirty"===r.status||"dirty"===t.value?q(r.value):r});{if("aborted"===t.value)return j;let r=this._def.schema._parseSync({data:e,path:i.path,parent:i});return"aborted"===r.status?j:"dirty"===r.status||"dirty"===t.value?q(r.value):r}}if("refinement"===o.type){let e=e=>{let t=o.refinement(e,s);if(i.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==i.common.async)return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(i=>"aborted"===i.status?j:("dirty"===i.status&&t.dirty(),e(i.value).then(()=>({status:t.value,value:i.value}))));{let r=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===r.status?j:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}}if("transform"===o.type)if(!1!==i.common.async)return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(e=>W(e)?Promise.resolve(o.transform(e.value,s)).then(e=>({status:t.value,value:e})):e);else{let e=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!W(e))return e;let r=o.transform(e.value,s);if(r instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:r}}r.assertNever(o)}};eW.create=(e,t,i)=>new eW({schema:e,typeName:l.ZodEffects,effect:t,...G(i)}),eW.createWithPreprocess=(e,t,i)=>new eW({schema:t,effect:{type:"preprocess",transform:e},typeName:l.ZodEffects,...G(i)});var eF=class extends Y{_parse(e){return this._getType(e)===k.undefined?Z(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};eF.create=(e,t)=>new eF({innerType:e,typeName:l.ZodOptional,...G(t)});var e$=class extends Y{_parse(e){return this._getType(e)===k.null?Z(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};e$.create=(e,t)=>new e$({innerType:e,typeName:l.ZodNullable,...G(t)});var eH=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),i=t.data;return t.parsedType===k.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};eH.create=(e,t)=>new eH({innerType:e,typeName:l.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...G(t)});var eQ=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),i={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return F(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new U(i.common.issues)},input:i.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new U(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}};eQ.create=(e,t)=>new eQ({innerType:e,typeName:l.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...G(t)});var eJ=class extends Y{_parse(e){if(this._getType(e)!==k.nan){let t=this._getOrReturnCtx(e);return z(t,{code:P.invalid_type,expected:k.nan,received:t.parsedType}),j}return{status:"valid",value:e.data}}};eJ.create=e=>new eJ({typeName:l.ZodNaN,...G(e)}),Symbol("zod_brand");var eG=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}},eY=class e extends Y{_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?j:"dirty"===e.status?(t.dirty(),q(e.value)):this._def.out._parseAsync({data:e.value,path:i.path,parent:i})})();{let e=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?j:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:i.path,parent:i})}}static create(t,i){return new e({in:t,out:i,typeName:l.ZodPipeline})}},eX=class extends Y{_parse(e){let t=this._def.innerType._parse(e),i=e=>(W(e)&&(e.value=Object.freeze(e.value)),e);return F(t)?t.then(e=>i(e)):i(t)}unwrap(){return this._def.innerType}};eX.create=(e,t)=>new eX({innerType:e,typeName:l.ZodReadonly,...G(t)}),ex.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(l||(l={})),eA.create,eg.create,eJ.create,ey.create,eK.create,ew.create,ev.create,eb.create,e_.create,eN.create,eI.create,eE.create,eT.create,eC.create,ex.create,ex.strictCreate,eO.create,ek.create,eR.create,eP.create,eU.create,eD.create,eL.create,ez.create,eB.create,ej.create,eZ.create,eM.create,eV.create,eW.create,eF.create,e$.create,eW.createWithPreprocess,eY.create;var e0={};function e1(e){switch(e.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function e2(e){let t=[];return e.metadata?.openapi?.parameters?t.push(...e.metadata.openapi.parameters):e.query instanceof ex&&Object.entries(e.query.shape).forEach(([e,i])=>{i instanceof Y&&t.push({name:e,in:"query",schema:{type:e1(i),..."minLength"in i&&i.minLength?{minLength:i.minLength}:{},description:i.description}})}),t}function e5(e){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...e}}async function e4(e,t){return Object.entries(e).forEach(([e,t])=>{let i=t.options;if(!i.metadata?.SERVER_ONLY&&("GET"===i.method&&(e0[t.path]={get:{tags:["Default",...i.metadata?.openapi?.tags||[]],description:i.metadata?.openapi?.description,operationId:i.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:e2(i),responses:e5(i.metadata?.openapi?.responses)}}),"POST"===i.method)){let e=function(e){if(e.metadata?.openapi?.requestBody)return e.metadata.openapi.requestBody;if(e.body&&(e.body instanceof ex||e.body instanceof eF)){let t=e.body.shape;if(!t)return;let i={},r=[];return Object.entries(t).forEach(([e,t])=>{t instanceof Y&&(i[e]={type:e1(t),description:t.description},t instanceof eF||r.push(e))}),{required:!(e.body instanceof eF)&&!!e.body,content:{"application/json":{schema:{type:"object",properties:i,required:r}}}}}}(i);e0[t.path]={post:{tags:["Default",...i.metadata?.openapi?.tags||[]],description:i.metadata?.openapi?.description,operationId:i.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:e2(i),...e?{requestBody:e}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:e5(i.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:t?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:e0}}var e3=(e,t)=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(e)}
    </script>
	 <script>
      var configuration = {
	  	favicon: ${t?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(t.logo)}`:void 0} ,
	   	theme: ${t?.theme||"saturn"},
        metaData: {
			title: ${t?.title||"Open API Reference"},
			description: ${t?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`,e6=(e,t)=>{if(!t?.openapi?.disabled){let i={path:"/api/reference",...t?.openapi};e.openapi=S(i.path,{method:"GET"},async t=>new Response(e3(await e4(e),i.scalar),{headers:{"Content-Type":"text/html"}}))}let i=(0,u.createRouter)(),r=(0,u.createRouter)();for(let t of Object.values(e))if(!(!t.options||t.options?.metadata?.SERVER_ONLY))for(let e of Array.isArray(t.options?.method)?t.options.method:[t.options?.method])(0,u.addRoute)(i,e,t.path,t);if(t?.routerMiddleware?.length)for(let{path:e,middleware:i}of t.routerMiddleware)(0,u.addRoute)(r,"*",e,i);let o=async e=>{let o=new URL(e.url),s=t?.basePath?o.pathname.split(t.basePath)[1]:o.pathname;if(!s?.length)return t?.onError?.(Error("NOT_FOUND")),new Response(null,{status:404,statusText:"Not Found"});let n=(0,u.findRoute)(i,e.method,s);if(!n?.data)return new Response(null,{status:404,statusText:"Not Found"});let a={};o.searchParams.forEach((e,t)=>{t in a?Array.isArray(a[t])?a[t].push(e):a[t]=[a[t],e]:a[t]=e});let d=n.data,l={path:s,method:e.method,headers:e.headers,params:n.params?JSON.parse(JSON.stringify(n.params)):{},request:e,body:await m(d.options.cloneRequest?e.clone():e),query:a,_flag:"router",asResponse:!0,context:t?.routerContext};try{let e=(0,u.findAllRoutes)(r,"*",s);if(e?.length)for(let{data:t,params:i}of e){let e=await t({...l,params:i,asResponse:!1});if(e instanceof Response)return e}return await d(l)}catch(e){if(f(e))return A(e);return console.error("# SERVER_ERROR: ",e),new Response(null,{status:500,statusText:"Internal Server Error"})}};return{handler:async e=>{let i=await t?.onRequest?.(e);if(i instanceof Response)return i;let r=i instanceof Request?i:e,s=await o(r),n=await t?.onResponse?.(s);return n instanceof Response?n:s},endpoints:e}}},244540:e=>{"use strict";var t,i,{g:r,__dirname:o}=e;{e.s({ZodParsedType:()=>r,getParsedType:()=>o,objectUtil:()=>i,util:()=>t}),function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let i of e)t[i]=i;return t},e.getValidEnumValues=t=>{let i=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(let e of i)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t},e.find=(e,t)=>{for(let i of e)if(t(i))return i},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(t||(t={})),(i||(i={})).mergeShapes=(e,t)=>({...e,...t});let r=t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),o=e=>{switch(typeof e){case"undefined":return r.undefined;case"string":return r.string;case"number":return Number.isNaN(e)?r.nan:r.number;case"boolean":return r.boolean;case"function":return r.function;case"bigint":return r.bigint;case"symbol":return r.symbol;case"object":if(Array.isArray(e))return r.array;if(null===e)return r.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return r.promise;if("undefined"!=typeof Map&&e instanceof Map)return r.map;if("undefined"!=typeof Set&&e instanceof Set)return r.set;if("undefined"!=typeof Date&&e instanceof Date)return r.date;return r.object;default:return r.unknown}}}},764823:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ZodError:()=>o,ZodIssueCode:()=>t,quotelessJson:()=>i});var r=e.i(244540);let t=r.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),i=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class o extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},i={_errors:[]},r=e=>{for(let o of e.issues)if("invalid_union"===o.code)o.unionErrors.map(r);else if("invalid_return_type"===o.code)r(o.returnTypeError);else if("invalid_arguments"===o.code)r(o.argumentsError);else if(0===o.path.length)i._errors.push(t(o));else{let e=i,r=0;for(;r<o.path.length;){let i=o.path[r];r===o.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(t(o))):e[i]=e[i]||{_errors:[]},e=e[i],r++}}};return r(this),i}static assert(e){if(!(e instanceof o))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,r.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},i=[];for(let r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):i.push(e(r));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}o.create=e=>new o(e)}},220368:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(764823),o=e.i(244540);let t=(e,t)=>{let i;switch(e.code){case r.ZodIssueCode.invalid_type:i=e.received===o.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case r.ZodIssueCode.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,o.util.jsonStringifyReplacer)}`;break;case r.ZodIssueCode.unrecognized_keys:i=`Unrecognized key(s) in object: ${o.util.joinValues(e.keys,", ")}`;break;case r.ZodIssueCode.invalid_union:i="Invalid input";break;case r.ZodIssueCode.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${o.util.joinValues(e.options)}`;break;case r.ZodIssueCode.invalid_enum_value:i=`Invalid enum value. Expected ${o.util.joinValues(e.options)}, received '${e.received}'`;break;case r.ZodIssueCode.invalid_arguments:i="Invalid function arguments";break;case r.ZodIssueCode.invalid_return_type:i="Invalid function return type";break;case r.ZodIssueCode.invalid_date:i="Invalid date";break;case r.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:o.util.assertNever(e.validation):i="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case r.ZodIssueCode.too_small:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case r.ZodIssueCode.too_big:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case r.ZodIssueCode.custom:i="Invalid input";break;case r.ZodIssueCode.invalid_intersection_types:i="Intersection results could not be merged";break;case r.ZodIssueCode.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case r.ZodIssueCode.not_finite:i="Number must be finite";break;default:i=t.defaultError,o.util.assertNever(e)}return{message:i}}}},898227:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({getErrorMap:()=>o,setErrorMap:()=>r});let t=e.i(220368).default;function r(e){t=e}function o(){return t}}},879245:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(220368),e.i(898227)},664332:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DIRTY:()=>d,EMPTY_PATH:()=>i,INVALID:()=>a,OK:()=>l,ParseStatus:()=>n,addIssueToContext:()=>s,isAborted:()=>c,isAsync:()=>h,isDirty:()=>u,isValid:()=>p,makeIssue:()=>t}),e.i(879245);var r=e.i(898227),o=e.i(220368);let t=e=>{let{data:t,path:i,errorMaps:r,issueData:o}=e,s=[...i,...o.path||[]],n={...o,path:s};if(void 0!==o.message)return{...o,path:s,message:o.message};let a="";for(let e of r.filter(e=>!!e).slice().reverse())a=e(n,{data:t,defaultError:a}).message;return{...o,path:s,message:a}},i=[];function s(e,i){let s=(0,r.getErrorMap)(),n=t({issueData:i,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===o.default?void 0:o.default].filter(e=>!!e)});e.common.issues.push(n)}class n{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let i=[];for(let r of t){if("aborted"===r.status)return a;"dirty"===r.status&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){let i=[];for(let e of t){let t=await e.key,r=await e.value;i.push({key:t,value:r})}return n.mergeObjectSync(e,i)}static mergeObjectSync(e,t){let i={};for(let r of t){let{key:t,value:o}=r;if("aborted"===t.status||"aborted"===o.status)return a;"dirty"===t.status&&e.dirty(),"dirty"===o.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==o.value||r.alwaysSet)&&(i[t.value]=o.value)}return{status:e.value,value:i}}}let a=Object.freeze({status:"aborted"}),d=e=>({status:"dirty",value:e}),l=e=>({status:"valid",value:e}),c=e=>"aborted"===e.status,u=e=>"dirty"===e.status,p=e=>"valid"===e.status,h=e=>"undefined"!=typeof Promise&&e instanceof Promise}},592504:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({})},383048:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({defaultErrorMap:()=>r.default});var r=e.i(220368)},60223:e=>{"use strict";var t,{g:i,__dirname:r}=e;e.s({errorUtil:()=>t}),function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(t||(t={}))},208348:e=>{"use strict";var{g:t,__dirname:i}=e;{let t;e.s({BRAND:()=>ey,NEVER:()=>e8,Schema:()=>v,ZodAny:()=>F,ZodArray:()=>J,ZodBigInt:()=>j,ZodBoolean:()=>q,ZodBranded:()=>eK,ZodCatch:()=>eA,ZodDate:()=>Z,ZodDefault:()=>ef,ZodDiscriminatedUnion:()=>ee,ZodEffects:()=>ep,ZodEnum:()=>el,ZodFirstPartyTypeKind:()=>s,ZodFunction:()=>en,ZodIntersection:()=>et,ZodLazy:()=>ea,ZodLiteral:()=>ed,ZodMap:()=>eo,ZodNaN:()=>eg,ZodNativeEnum:()=>ec,ZodNever:()=>H,ZodNull:()=>W,ZodNullable:()=>em,ZodNumber:()=>B,ZodObject:()=>G,ZodOptional:()=>eh,ZodPipeline:()=>ew,ZodPromise:()=>eu,ZodReadonly:()=>ev,ZodRecord:()=>er,ZodSchema:()=>v,ZodSet:()=>es,ZodString:()=>z,ZodSymbol:()=>M,ZodTransformer:()=>ep,ZodTuple:()=>ei,ZodType:()=>v,ZodUndefined:()=>V,ZodUnion:()=>Y,ZodUnknown:()=>$,ZodVoid:()=>Q,any:()=>eR,array:()=>eL,bigint:()=>eT,boolean:()=>eC,coerce:()=>e9,custom:()=>K,date:()=>ex,datetimeRegex:()=>A,discriminatedUnion:()=>eq,effect:()=>eX,enum:()=>eJ,function:()=>e$,instanceof:()=>e_,intersection:()=>eZ,late:()=>eb,lazy:()=>eH,literal:()=>eQ,map:()=>eW,nan:()=>eE,nativeEnum:()=>eG,never:()=>eU,null:()=>ek,nullable:()=>e1,number:()=>eI,object:()=>ez,oboolean:()=>e6,onumber:()=>e3,optional:()=>e0,ostring:()=>e4,pipeline:()=>e5,preprocess:()=>e2,promise:()=>eY,record:()=>eV,set:()=>eF,strictObject:()=>eB,string:()=>eN,symbol:()=>eO,transformer:()=>eX,tuple:()=>eM,undefined:()=>eS,union:()=>ej,unknown:()=>eP,void:()=>eD});var r,o,s,n=e.i(764823);e.i(879245);var a=e.i(383048),d=e.i(898227),l=e.i(60223),c=e.i(664332),u=e.i(244540),p=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},h=this&&this.__classPrivateFieldSet||function(e,t,i,r,o){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,i):o?o.value=i:t.set(e,i),i};class i{constructor(e,t,i,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let w=(e,t)=>{if((0,c.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new n.ZodError(e.common.issues);return this._error=t,this._error}}};function m(e){if(!e)return{};let{errorMap:t,invalid_type_error:i,required_error:r,description:o}=e;if(t&&(i||r))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:o}:{errorMap:(t,o)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??o.defaultError}:void 0===o.data?{message:s??r??o.defaultError}:"invalid_type"!==t.code?{message:o.defaultError}:{message:s??i??o.defaultError}},description:o}}class v{get description(){return this._def.description}_getType(e){return(0,u.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,u.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new c.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,u.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if((0,c.isAsync)(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){let i={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)},r=this._parseSync({data:e,path:i.path,parent:i});return w(i,r)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:t});return(0,c.isValid)(i)?{value:i.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>(0,c.isValid)(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){let i={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)},r=this._parse({data:e,path:i.path,parent:i});return w(i,await ((0,c.isAsync)(r)?r:Promise.resolve(r)))}refine(e,t){let i=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{let o=e(t),s=()=>r.addIssue({code:n.ZodIssueCode.custom,...i(t)});return"undefined"!=typeof Promise&&o instanceof Promise?o.then(e=>!!e||(s(),!1)):!!o||(s(),!1)})}refinement(e,t){return this._refinement((i,r)=>!!e(i)||(r.addIssue("function"==typeof t?t(i,r):t),!1))}_refinement(e){return new ep({schema:this,typeName:s.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return eh.create(this,this._def)}nullable(){return em.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return J.create(this)}promise(){return eu.create(this,this._def)}or(e){return Y.create([this,e],this._def)}and(e){return et.create(this,e,this._def)}transform(e){return new ep({...m(this._def),schema:this,typeName:s.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ef({...m(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:s.ZodDefault})}brand(){return new eK({typeName:s.ZodBranded,type:this,...m(this._def)})}catch(e){return new eA({...m(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:s.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ew.create(this,e)}readonly(){return ev.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let b=/^c[^\s-]{8,}$/i,_=/^[0-9a-z]+$/,N=/^[0-9A-HJKMNP-TV-Z]{26}$/i,I=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,E=/^[a-z0-9_-]{21}$/i,T=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,C=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,x=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,O=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,S=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,k=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,R=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,P=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,U=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,D="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",L=RegExp(`^${D}$`);function f(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let i=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${i}`}function A(e){let t=`${D}T${f(e)}`,i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,RegExp(`^${t}$`)}class z extends v{_parse(e){var i,r,o,s;let a;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==u.ZodParsedType.string){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.string,received:t.parsedType}),c.INVALID}let d=new c.ParseStatus;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),d.dirty());else if("max"===l.kind)e.data.length>l.value&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),d.dirty());else if("length"===l.kind){let t=e.data.length>l.value,i=e.data.length<l.value;(t||i)&&(a=this._getOrReturnCtx(e,a),t?(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),d.dirty())}else if("email"===l.kind)x.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"email",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("emoji"===l.kind)t||(t=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),t.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"emoji",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("uuid"===l.kind)I.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"uuid",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("nanoid"===l.kind)E.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"nanoid",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("cuid"===l.kind)b.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"cuid",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("cuid2"===l.kind)_.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"cuid2",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("ulid"===l.kind)N.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"ulid",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"url",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"regex",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),d.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:{startsWith:l.value},message:l.message}),d.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:{endsWith:l.value},message:l.message}),d.dirty()):"datetime"===l.kind?A(l).test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:"datetime",message:l.message}),d.dirty()):"date"===l.kind?L.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:"date",message:l.message}),d.dirty()):"time"===l.kind?RegExp(`^${f(l)}$`).test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:"time",message:l.message}),d.dirty()):"duration"===l.kind?C.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"duration",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()):"ip"===l.kind?(i=e.data,!(("v4"===(r=l.version)||!r)&&O.test(i)||("v6"===r||!r)&&k.test(i))&&1&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"ip",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty())):"jwt"===l.kind?!function(e,t){if(!T.test(e))return!1;try{let[i]=e.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),o=JSON.parse(atob(r));if("object"!=typeof o||null===o||"typ"in o&&o?.typ!=="JWT"||!o.alg||t&&o.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"jwt",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()):"cidr"===l.kind?(o=e.data,!(("v4"===(s=l.version)||!s)&&S.test(o)||("v6"===s||!s)&&R.test(o))&&1&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"cidr",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty())):"base64"===l.kind?P.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"base64",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()):"base64url"===l.kind?U.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"base64url",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()):u.util.assertNever(l);return{status:d.value,value:e.data}}_regex(e,t,i){return this.refinement(t=>e.test(t),{validation:t,code:n.ZodIssueCode.invalid_string,...l.errorUtil.errToObj(i)})}_addCheck(e){return new z({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...l.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...l.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...l.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...l.errorUtil.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...l.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...l.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...l.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...l.errorUtil.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...l.errorUtil.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...l.errorUtil.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...l.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...l.errorUtil.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...l.errorUtil.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...l.errorUtil.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...l.errorUtil.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...l.errorUtil.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...l.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...l.errorUtil.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...l.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...l.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...l.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...l.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...l.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,l.errorUtil.errToObj(e))}trim(){return new z({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new z({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new z({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}z.create=e=>new z({checks:[],typeName:s.ZodString,coerce:e?.coerce??!1,...m(e)});class B extends v{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==u.ZodParsedType.number){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.number,received:t.parsedType}),c.INVALID}let i=new c.ParseStatus;for(let r of this._def.checks)"int"===r.kind?u.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:r.message}),i.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):"multipleOf"===r.kind?0!==function(e,t){let i=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=i>r?i:r;return Number.parseInt(e.toFixed(o).replace(".",""))%Number.parseInt(t.toFixed(o).replace(".",""))/10**o}(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.not_finite,message:r.message}),i.dirty()):u.util.assertNever(r);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,l.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,l.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,l.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,l.errorUtil.toString(t))}setLimit(e,t,i,r){return new B({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:l.errorUtil.toString(r)}]})}_addCheck(e){return new B({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:l.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:l.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:l.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:l.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:l.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:l.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:l.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:l.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:l.errorUtil.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&u.util.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let i of this._def.checks)if("finite"===i.kind||"int"===i.kind||"multipleOf"===i.kind)return!0;else"min"===i.kind?(null===t||i.value>t)&&(t=i.value):"max"===i.kind&&(null===e||i.value<e)&&(e=i.value);return Number.isFinite(t)&&Number.isFinite(e)}}B.create=e=>new B({checks:[],typeName:s.ZodNumber,coerce:e?.coerce||!1,...m(e)});class j extends v{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==u.ZodParsedType.bigint)return this._getInvalidInput(e);let i=new c.ParseStatus;for(let r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):u.util.assertNever(r);return{status:i.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.bigint,received:t.parsedType}),c.INVALID}gte(e,t){return this.setLimit("min",e,!0,l.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,l.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,l.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,l.errorUtil.toString(t))}setLimit(e,t,i,r){return new j({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:l.errorUtil.toString(r)}]})}_addCheck(e){return new j({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:l.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:l.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:l.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:l.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:l.errorUtil.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}j.create=e=>new j({checks:[],typeName:s.ZodBigInt,coerce:e?.coerce??!1,...m(e)});class q extends v{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==u.ZodParsedType.boolean){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.boolean,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}q.create=e=>new q({typeName:s.ZodBoolean,coerce:e?.coerce||!1,...m(e)});class Z extends v{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==u.ZodParsedType.date){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.date,received:t.parsedType}),c.INVALID}if(Number.isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_date}),c.INVALID}let i=new c.ParseStatus;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),i.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),i.dirty()):u.util.assertNever(r);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Z({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:l.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:l.errorUtil.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Z.create=e=>new Z({checks:[],coerce:e?.coerce||!1,typeName:s.ZodDate,...m(e)});class M extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.symbol){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.symbol,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}M.create=e=>new M({typeName:s.ZodSymbol,...m(e)});class V extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.undefined,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}V.create=e=>new V({typeName:s.ZodUndefined,...m(e)});class W extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.null){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.null,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}W.create=e=>new W({typeName:s.ZodNull,...m(e)});class F extends v{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,c.OK)(e.data)}}F.create=e=>new F({typeName:s.ZodAny,...m(e)});class $ extends v{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,c.OK)(e.data)}}$.create=e=>new $({typeName:s.ZodUnknown,...m(e)});class H extends v{_parse(e){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.never,received:t.parsedType}),c.INVALID}}H.create=e=>new H({typeName:s.ZodNever,...m(e)});class Q extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.void,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}Q.create=e=>new Q({typeName:s.ZodVoid,...m(e)});class J extends v{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),o=this._def;if(t.parsedType!==u.ZodParsedType.array)return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.array,received:t.parsedType}),c.INVALID;if(null!==o.exactLength){let e=t.data.length>o.exactLength.value,i=t.data.length<o.exactLength.value;(e||i)&&((0,c.addIssueToContext)(t,{code:e?n.ZodIssueCode.too_big:n.ZodIssueCode.too_small,minimum:i?o.exactLength.value:void 0,maximum:e?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),r.dirty())}if(null!==o.minLength&&t.data.length<o.minLength.value&&((0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),r.dirty()),null!==o.maxLength&&t.data.length>o.maxLength.value&&((0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>o.type._parseAsync(new i(t,e,t.path,r)))).then(e=>c.ParseStatus.mergeArray(r,e));let s=[...t.data].map((e,r)=>o.type._parseSync(new i(t,e,t.path,r)));return c.ParseStatus.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new J({...this._def,minLength:{value:e,message:l.errorUtil.toString(t)}})}max(e,t){return new J({...this._def,maxLength:{value:e,message:l.errorUtil.toString(t)}})}length(e,t){return new J({...this._def,exactLength:{value:e,message:l.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}J.create=(e,t)=>new J({type:e,minLength:null,maxLength:null,exactLength:null,typeName:s.ZodArray,...m(t)});class G extends v{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=u.util.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==u.ZodParsedType.object){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:t.parsedType}),c.INVALID}let{status:t,ctx:r}=this._processInputParams(e),{shape:o,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof H&&"strip"===this._def.unknownKeys))for(let e in r.data)s.includes(e)||a.push(e);let d=[];for(let e of s){let t=o[e],s=r.data[e];d.push({key:{status:"valid",value:e},value:t._parse(new i(r,s,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof H){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)d.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)a.length>0&&((0,c.addIssueToContext)(r,{code:n.ZodIssueCode.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let o=r.data[t];d.push({key:{status:"valid",value:t},value:e._parse(new i(r,o,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of d){let i=await t.key,r=await t.value;e.push({key:i,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>c.ParseStatus.mergeObjectSync(t,e)):c.ParseStatus.mergeObjectSync(t,d)}get shape(){return this._def.shape()}strict(e){return l.errorUtil.errToObj,new G({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,i)=>{let r=this._def.errorMap?.(t,i).message??i.defaultError;return"unrecognized_keys"===t.code?{message:l.errorUtil.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new G({...this._def,unknownKeys:"strip"})}passthrough(){return new G({...this._def,unknownKeys:"passthrough"})}extend(e){return new G({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new G({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:s.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new G({...this._def,catchall:e})}pick(e){let t={};for(let i of u.util.objectKeys(e))e[i]&&this.shape[i]&&(t[i]=this.shape[i]);return new G({...this._def,shape:()=>t})}omit(e){let t={};for(let i of u.util.objectKeys(this.shape))e[i]||(t[i]=this.shape[i]);return new G({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof G){let i={};for(let r in t.shape){let o=t.shape[r];i[r]=eh.create(e(o))}return new G({...t._def,shape:()=>i})}if(t instanceof J)return new J({...t._def,type:e(t.element)});if(t instanceof eh)return eh.create(e(t.unwrap()));if(t instanceof em)return em.create(e(t.unwrap()));if(t instanceof ei)return ei.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let i of u.util.objectKeys(this.shape)){let r=this.shape[i];e&&!e[i]?t[i]=r:t[i]=r.optional()}return new G({...this._def,shape:()=>t})}required(e){let t={};for(let i of u.util.objectKeys(this.shape))if(e&&!e[i])t[i]=this.shape[i];else{let e=this.shape[i];for(;e instanceof eh;)e=e._def.innerType;t[i]=e}return new G({...this._def,shape:()=>t})}keyof(){return g(u.util.objectKeys(this.shape))}}G.create=(e,t)=>new G({shape:()=>e,unknownKeys:"strip",catchall:H.create(),typeName:s.ZodObject,...m(t)}),G.strictCreate=(e,t)=>new G({shape:()=>e,unknownKeys:"strict",catchall:H.create(),typeName:s.ZodObject,...m(t)}),G.lazycreate=(e,t)=>new G({shape:e,unknownKeys:"strip",catchall:H.create(),typeName:s.ZodObject,...m(t)});class Y extends v{_parse(e){let{ctx:t}=this._processInputParams(e),i=this._def.options;if(t.common.async)return Promise.all(i.map(async e=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let i of e)if("dirty"===i.result.status)return t.common.issues.push(...i.ctx.common.issues),i.result;let i=e.map(e=>new n.ZodError(e.ctx.common.issues));return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_union,unionErrors:i}),c.INVALID});{let e,r=[];for(let o of i){let i={...t,common:{...t.common,issues:[]},parent:null},s=o._parseSync({data:t.data,path:t.path,parent:i});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:i}),i.common.issues.length&&r.push(i.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let o=r.map(e=>new n.ZodError(e));return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_union,unionErrors:o}),c.INVALID}}get options(){return this._def.options}}Y.create=(e,t)=>new Y({options:e,typeName:s.ZodUnion,...m(t)});let X=e=>{if(e instanceof ea)return X(e.schema);if(e instanceof ep)return X(e.innerType());if(e instanceof ed)return[e.value];if(e instanceof el)return e.options;if(e instanceof ec)return u.util.objectValues(e.enum);else if(e instanceof ef)return X(e._def.innerType);else if(e instanceof V)return[void 0];else if(e instanceof W)return[null];else if(e instanceof eh)return[void 0,...X(e.unwrap())];else if(e instanceof em)return[null,...X(e.unwrap())];else if(e instanceof eK)return X(e.unwrap());else if(e instanceof ev)return X(e.unwrap());else if(e instanceof eA)return X(e._def.innerType);else return[]};class ee extends v{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.object)return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:t.parsedType}),c.INVALID;let i=this.discriminator,r=t.data[i],o=this.optionsMap.get(r);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):((0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),c.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,i){let r=new Map;for(let i of t){let t=X(i.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of t){if(r.has(o))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);r.set(o,i)}}return new ee({typeName:s.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...m(i)})}}class et extends v{_parse(e){let{status:t,ctx:i}=this._processInputParams(e),r=(e,r)=>{if((0,c.isAborted)(e)||(0,c.isAborted)(r))return c.INVALID;let o=function e(t,i){let r=(0,u.getParsedType)(t),o=(0,u.getParsedType)(i);if(t===i)return{valid:!0,data:t};if(r===u.ZodParsedType.object&&o===u.ZodParsedType.object){let r=u.util.objectKeys(i),o=u.util.objectKeys(t).filter(e=>-1!==r.indexOf(e)),s={...t,...i};for(let r of o){let o=e(t[r],i[r]);if(!o.valid)return{valid:!1};s[r]=o.data}return{valid:!0,data:s}}if(r===u.ZodParsedType.array&&o===u.ZodParsedType.array){if(t.length!==i.length)return{valid:!1};let r=[];for(let o=0;o<t.length;o++){let s=e(t[o],i[o]);if(!s.valid)return{valid:!1};r.push(s.data)}return{valid:!0,data:r}}if(r===u.ZodParsedType.date&&o===u.ZodParsedType.date&&+t==+i)return{valid:!0,data:t};return{valid:!1}}(e.value,r.value);return o.valid?(((0,c.isDirty)(e)||(0,c.isDirty)(r))&&t.dirty(),{status:t.value,value:o.data}):((0,c.addIssueToContext)(i,{code:n.ZodIssueCode.invalid_intersection_types}),c.INVALID)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}et.create=(e,t,i)=>new et({left:e,right:t,typeName:s.ZodIntersection,...m(i)});class ei extends v{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.array)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.array,received:r.parsedType}),c.INVALID;if(r.data.length<this._def.items.length)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),c.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&((0,c.addIssueToContext)(r,{code:n.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let o=[...r.data].map((e,t)=>{let o=this._def.items[t]||this._def.rest;return o?o._parse(new i(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(o).then(e=>c.ParseStatus.mergeArray(t,e)):c.ParseStatus.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new ei({...this._def,rest:e})}}ei.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ei({items:e,typeName:s.ZodTuple,rest:null,...m(t)})};class er extends v{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.object)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:r.parsedType}),c.INVALID;let o=[],s=this._def.keyType,a=this._def.valueType;for(let e in r.data)o.push({key:s._parse(new i(r,e,r.path,e)),value:a._parse(new i(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?c.ParseStatus.mergeObjectAsync(t,o):c.ParseStatus.mergeObjectSync(t,o)}get element(){return this._def.valueType}static create(e,t,i){return new er(t instanceof v?{keyType:e,valueType:t,typeName:s.ZodRecord,...m(i)}:{keyType:z.create(),valueType:e,typeName:s.ZodRecord,...m(t)})}}class eo extends v{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.map)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.map,received:r.parsedType}),c.INVALID;let o=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([e,t],n)=>({key:o._parse(new i(r,e,r.path,[n,"key"])),value:s._parse(new i(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let i of a){let r=await i.key,o=await i.value;if("aborted"===r.status||"aborted"===o.status)return c.INVALID;("dirty"===r.status||"dirty"===o.status)&&t.dirty(),e.set(r.value,o.value)}return{status:t.value,value:e}})}{let e=new Map;for(let i of a){let r=i.key,o=i.value;if("aborted"===r.status||"aborted"===o.status)return c.INVALID;("dirty"===r.status||"dirty"===o.status)&&t.dirty(),e.set(r.value,o.value)}return{status:t.value,value:e}}}}eo.create=(e,t,i)=>new eo({valueType:t,keyType:e,typeName:s.ZodMap,...m(i)});class es extends v{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.set)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.set,received:r.parsedType}),c.INVALID;let o=this._def;null!==o.minSize&&r.data.size<o.minSize.value&&((0,c.addIssueToContext)(r,{code:n.ZodIssueCode.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),t.dirty()),null!==o.maxSize&&r.data.size>o.maxSize.value&&((0,c.addIssueToContext)(r,{code:n.ZodIssueCode.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),t.dirty());let s=this._def.valueType;function a(e){let i=new Set;for(let r of e){if("aborted"===r.status)return c.INVALID;"dirty"===r.status&&t.dirty(),i.add(r.value)}return{status:t.value,value:i}}let d=[...r.data.values()].map((e,t)=>s._parse(new i(r,e,r.path,t)));return r.common.async?Promise.all(d).then(e=>a(e)):a(d)}min(e,t){return new es({...this._def,minSize:{value:e,message:l.errorUtil.toString(t)}})}max(e,t){return new es({...this._def,maxSize:{value:e,message:l.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}es.create=(e,t)=>new es({valueType:e,minSize:null,maxSize:null,typeName:s.ZodSet,...m(t)});class en extends v{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.function)return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.function,received:t.parsedType}),c.INVALID;function i(e,i){return(0,c.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,d.getErrorMap)(),a.defaultErrorMap].filter(e=>!!e),issueData:{code:n.ZodIssueCode.invalid_arguments,argumentsError:i}})}function r(e,i){return(0,c.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,d.getErrorMap)(),a.defaultErrorMap].filter(e=>!!e),issueData:{code:n.ZodIssueCode.invalid_return_type,returnTypeError:i}})}let o={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof eu){let e=this;return(0,c.OK)(async function(...t){let a=new n.ZodError([]),d=await e._def.args.parseAsync(t,o).catch(e=>{throw a.addIssue(i(t,e)),a}),l=await Reflect.apply(s,this,d);return await e._def.returns._def.type.parseAsync(l,o).catch(e=>{throw a.addIssue(r(l,e)),a})})}{let e=this;return(0,c.OK)(function(...t){let a=e._def.args.safeParse(t,o);if(!a.success)throw new n.ZodError([i(t,a.error)]);let d=Reflect.apply(s,this,a.data),l=e._def.returns.safeParse(d,o);if(!l.success)throw new n.ZodError([r(d,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new en({...this._def,args:ei.create(e).rest($.create())})}returns(e){return new en({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,i){return new en({args:e||ei.create([]).rest($.create()),returns:t||$.create(),typeName:s.ZodFunction,...m(i)})}}class ea extends v{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ea.create=(e,t)=>new ea({getter:e,typeName:s.ZodLazy,...m(t)});class ed extends v{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{received:t.data,code:n.ZodIssueCode.invalid_literal,expected:this._def.value}),c.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function g(e,t){return new el({values:e,typeName:s.ZodEnum,...m(t)})}ed.create=(e,t)=>new ed({value:e,typeName:s.ZodLiteral,...m(t)});class el extends v{constructor(){super(...arguments),r.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),i=this._def.values;return(0,c.addIssueToContext)(t,{expected:u.util.joinValues(i),received:t.parsedType,code:n.ZodIssueCode.invalid_type}),c.INVALID}if(p(this,r,"f")||h(this,r,new Set(this._def.values),"f"),!p(this,r,"f").has(e.data)){let t=this._getOrReturnCtx(e),i=this._def.values;return(0,c.addIssueToContext)(t,{received:t.data,code:n.ZodIssueCode.invalid_enum_value,options:i}),c.INVALID}return(0,c.OK)(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return el.create(e,{...this._def,...t})}exclude(e,t=this._def){return el.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}r=new WeakMap,el.create=g;class ec extends v{constructor(){super(...arguments),o.set(this,void 0)}_parse(e){let t=u.util.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==u.ZodParsedType.string&&i.parsedType!==u.ZodParsedType.number){let e=u.util.objectValues(t);return(0,c.addIssueToContext)(i,{expected:u.util.joinValues(e),received:i.parsedType,code:n.ZodIssueCode.invalid_type}),c.INVALID}if(p(this,o,"f")||h(this,o,new Set(u.util.getValidEnumValues(this._def.values)),"f"),!p(this,o,"f").has(e.data)){let e=u.util.objectValues(t);return(0,c.addIssueToContext)(i,{received:i.data,code:n.ZodIssueCode.invalid_enum_value,options:e}),c.INVALID}return(0,c.OK)(e.data)}get enum(){return this._def.values}}o=new WeakMap,ec.create=(e,t)=>new ec({values:e,typeName:s.ZodNativeEnum,...m(t)});class eu extends v{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.promise&&!1===t.common.async)return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.promise,received:t.parsedType}),c.INVALID;let i=t.parsedType===u.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,c.OK)(i.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eu.create=(e,t)=>new eu({type:e,typeName:s.ZodPromise,...m(t)});class ep extends v{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===s.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:i}=this._processInputParams(e),r=this._def.effect||null,o={addIssue:e=>{(0,c.addIssueToContext)(i,e),e.fatal?t.abort():t.dirty()},get path(){return i.path}};if(o.addIssue=o.addIssue.bind(o),"preprocess"===r.type){let e=r.transform(i.data,o);if(i.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return c.INVALID;let r=await this._def.schema._parseAsync({data:e,path:i.path,parent:i});return"aborted"===r.status?c.INVALID:"dirty"===r.status||"dirty"===t.value?(0,c.DIRTY)(r.value):r});{if("aborted"===t.value)return c.INVALID;let r=this._def.schema._parseSync({data:e,path:i.path,parent:i});return"aborted"===r.status?c.INVALID:"dirty"===r.status||"dirty"===t.value?(0,c.DIRTY)(r.value):r}}if("refinement"===r.type){let e=e=>{let t=r.refinement(e,o);if(i.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==i.common.async)return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(i=>"aborted"===i.status?c.INVALID:("dirty"===i.status&&t.dirty(),e(i.value).then(()=>({status:t.value,value:i.value}))));{let r=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===r.status?c.INVALID:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}}if("transform"===r.type)if(!1!==i.common.async)return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(e=>(0,c.isValid)(e)?Promise.resolve(r.transform(e.value,o)).then(e=>({status:t.value,value:e})):e);else{let e=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!(0,c.isValid)(e))return e;let s=r.transform(e.value,o);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}u.util.assertNever(r)}}ep.create=(e,t,i)=>new ep({schema:e,typeName:s.ZodEffects,effect:t,...m(i)}),ep.createWithPreprocess=(e,t,i)=>new ep({schema:t,effect:{type:"preprocess",transform:e},typeName:s.ZodEffects,...m(i)});class eh extends v{_parse(e){return this._getType(e)===u.ZodParsedType.undefined?(0,c.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eh.create=(e,t)=>new eh({innerType:e,typeName:s.ZodOptional,...m(t)});class em extends v{_parse(e){return this._getType(e)===u.ZodParsedType.null?(0,c.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}em.create=(e,t)=>new em({innerType:e,typeName:s.ZodNullable,...m(t)});class ef extends v{_parse(e){let{ctx:t}=this._processInputParams(e),i=t.data;return t.parsedType===u.ZodParsedType.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ef.create=(e,t)=>new ef({innerType:e,typeName:s.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...m(t)});class eA extends v{_parse(e){let{ctx:t}=this._processInputParams(e),i={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return(0,c.isAsync)(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new n.ZodError(i.common.issues)},input:i.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new n.ZodError(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}eA.create=(e,t)=>new eA({innerType:e,typeName:s.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...m(t)});class eg extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.nan){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.nan,received:t.parsedType}),c.INVALID}return{status:"valid",value:e.data}}}eg.create=e=>new eg({typeName:s.ZodNaN,...m(e)});let ey=Symbol("zod_brand");class eK extends v{_parse(e){let{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class ew extends v{_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?c.INVALID:"dirty"===e.status?(t.dirty(),(0,c.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:i.path,parent:i})})();{let e=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?c.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:i.path,parent:i})}}static create(e,t){return new ew({in:e,out:t,typeName:s.ZodPipeline})}}class ev extends v{_parse(e){let t=this._def.innerType._parse(e),i=e=>((0,c.isValid)(e)&&(e.value=Object.freeze(e.value)),e);return(0,c.isAsync)(t)?t.then(e=>i(e)):i(t)}unwrap(){return this._def.innerType}}function y(e,t){let i="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof i?{message:i}:i}function K(e,t={},i){return e?F.create().superRefine((r,o)=>{let s=e(r);if(s instanceof Promise)return s.then(e=>{if(!e){let e=y(t,r),s=e.fatal??i??!0;o.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=y(t,r),s=e.fatal??i??!0;o.addIssue({code:"custom",...e,fatal:s})}}):F.create()}ev.create=(e,t)=>new ev({innerType:e,typeName:s.ZodReadonly,...m(t)});let eb={object:G.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(s||(s={}));let e_=(e,t={message:`Input not instance of ${e.name}`})=>K(t=>t instanceof e,t),eN=z.create,eI=B.create,eE=eg.create,eT=j.create,eC=q.create,ex=Z.create,eO=M.create,eS=V.create,ek=W.create,eR=F.create,eP=$.create,eU=H.create,eD=Q.create,eL=J.create,ez=G.create,eB=G.strictCreate,ej=Y.create,eq=ee.create,eZ=et.create,eM=ei.create,eV=er.create,eW=eo.create,eF=es.create,e$=en.create,eH=ea.create,eQ=ed.create,eJ=el.create,eG=ec.create,eY=eu.create,eX=ep.create,e0=eh.create,e1=em.create,e2=ep.createWithPreprocess,e5=ew.create,e4=()=>eN().optional(),e3=()=>eI().optional(),e6=()=>eC().optional(),e9={string:e=>z.create({...e,coerce:!0}),number:e=>B.create({...e,coerce:!0}),boolean:e=>q.create({...e,coerce:!0}),bigint:e=>j.create({...e,coerce:!0}),date:e=>Z.create({...e,coerce:!0})},e8=c.INVALID}},401237:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(879245),e.i(664332),e.i(592504),e.i(244540),e.i(208348),e.i(764823)},154991:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(879245),e.i(664332),e.i(592504),e.i(244540),e.i(208348),e.i(764823),e.i(401237)},281748:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({defaultErrorMap:()=>r.default,getErrorMap:()=>o.getErrorMap,setErrorMap:()=>o.setErrorMap});var r=e.i(220368),o=e.i(898227)},328333:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({defaultErrorMap:()=>r.defaultErrorMap,getErrorMap:()=>r.getErrorMap,setErrorMap:()=>r.setErrorMap}),e.i(879245);var r=e.i(281748)},450948:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({BRAND:()=>n.BRAND,DIRTY:()=>o.DIRTY,EMPTY_PATH:()=>o.EMPTY_PATH,INVALID:()=>o.INVALID,NEVER:()=>n.NEVER,OK:()=>o.OK,ParseStatus:()=>o.ParseStatus,Schema:()=>n.Schema,ZodAny:()=>n.ZodAny,ZodArray:()=>n.ZodArray,ZodBigInt:()=>n.ZodBigInt,ZodBoolean:()=>n.ZodBoolean,ZodBranded:()=>n.ZodBranded,ZodCatch:()=>n.ZodCatch,ZodDate:()=>n.ZodDate,ZodDefault:()=>n.ZodDefault,ZodDiscriminatedUnion:()=>n.ZodDiscriminatedUnion,ZodEffects:()=>n.ZodEffects,ZodEnum:()=>n.ZodEnum,ZodError:()=>a.ZodError,ZodFirstPartyTypeKind:()=>n.ZodFirstPartyTypeKind,ZodFunction:()=>n.ZodFunction,ZodIntersection:()=>n.ZodIntersection,ZodIssueCode:()=>a.ZodIssueCode,ZodLazy:()=>n.ZodLazy,ZodLiteral:()=>n.ZodLiteral,ZodMap:()=>n.ZodMap,ZodNaN:()=>n.ZodNaN,ZodNativeEnum:()=>n.ZodNativeEnum,ZodNever:()=>n.ZodNever,ZodNull:()=>n.ZodNull,ZodNullable:()=>n.ZodNullable,ZodNumber:()=>n.ZodNumber,ZodObject:()=>n.ZodObject,ZodOptional:()=>n.ZodOptional,ZodParsedType:()=>s.ZodParsedType,ZodPipeline:()=>n.ZodPipeline,ZodPromise:()=>n.ZodPromise,ZodReadonly:()=>n.ZodReadonly,ZodRecord:()=>n.ZodRecord,ZodSchema:()=>n.ZodSchema,ZodSet:()=>n.ZodSet,ZodString:()=>n.ZodString,ZodSymbol:()=>n.ZodSymbol,ZodTransformer:()=>n.ZodTransformer,ZodTuple:()=>n.ZodTuple,ZodType:()=>n.ZodType,ZodUndefined:()=>n.ZodUndefined,ZodUnion:()=>n.ZodUnion,ZodUnknown:()=>n.ZodUnknown,ZodVoid:()=>n.ZodVoid,addIssueToContext:()=>o.addIssueToContext,any:()=>n.any,array:()=>n.array,bigint:()=>n.bigint,boolean:()=>n.boolean,coerce:()=>n.coerce,custom:()=>n.custom,date:()=>n.date,datetimeRegex:()=>n.datetimeRegex,defaultErrorMap:()=>r.defaultErrorMap,discriminatedUnion:()=>n.discriminatedUnion,effect:()=>n.effect,enum:()=>n.enum,function:()=>n.function,getErrorMap:()=>r.getErrorMap,getParsedType:()=>s.getParsedType,instanceof:()=>n.instanceof,intersection:()=>n.intersection,isAborted:()=>o.isAborted,isAsync:()=>o.isAsync,isDirty:()=>o.isDirty,isValid:()=>o.isValid,late:()=>n.late,lazy:()=>n.lazy,literal:()=>n.literal,makeIssue:()=>o.makeIssue,map:()=>n.map,nan:()=>n.nan,nativeEnum:()=>n.nativeEnum,never:()=>n.never,null:()=>n.null,nullable:()=>n.nullable,number:()=>n.number,object:()=>n.object,objectUtil:()=>s.objectUtil,oboolean:()=>n.oboolean,onumber:()=>n.onumber,optional:()=>n.optional,ostring:()=>n.ostring,pipeline:()=>n.pipeline,preprocess:()=>n.preprocess,promise:()=>n.promise,quotelessJson:()=>a.quotelessJson,record:()=>n.record,set:()=>n.set,setErrorMap:()=>r.setErrorMap,strictObject:()=>n.strictObject,string:()=>n.string,symbol:()=>n.symbol,transformer:()=>n.transformer,tuple:()=>n.tuple,undefined:()=>n.undefined,union:()=>n.union,unknown:()=>n.unknown,util:()=>s.util,void:()=>n.void});var r=e.i(328333),o=e.i(664332);e.i(592504);var s=e.i(244540),n=e.i(208348),a=e.i(764823);e.i(401237)},791544:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({BRAND:()=>r.BRAND,DIRTY:()=>r.DIRTY,EMPTY_PATH:()=>r.EMPTY_PATH,INVALID:()=>r.INVALID,NEVER:()=>r.NEVER,OK:()=>r.OK,ParseStatus:()=>r.ParseStatus,Schema:()=>r.Schema,ZodAny:()=>r.ZodAny,ZodArray:()=>r.ZodArray,ZodBigInt:()=>r.ZodBigInt,ZodBoolean:()=>r.ZodBoolean,ZodBranded:()=>r.ZodBranded,ZodCatch:()=>r.ZodCatch,ZodDate:()=>r.ZodDate,ZodDefault:()=>r.ZodDefault,ZodDiscriminatedUnion:()=>r.ZodDiscriminatedUnion,ZodEffects:()=>r.ZodEffects,ZodEnum:()=>r.ZodEnum,ZodError:()=>r.ZodError,ZodFirstPartyTypeKind:()=>r.ZodFirstPartyTypeKind,ZodFunction:()=>r.ZodFunction,ZodIntersection:()=>r.ZodIntersection,ZodIssueCode:()=>r.ZodIssueCode,ZodLazy:()=>r.ZodLazy,ZodLiteral:()=>r.ZodLiteral,ZodMap:()=>r.ZodMap,ZodNaN:()=>r.ZodNaN,ZodNativeEnum:()=>r.ZodNativeEnum,ZodNever:()=>r.ZodNever,ZodNull:()=>r.ZodNull,ZodNullable:()=>r.ZodNullable,ZodNumber:()=>r.ZodNumber,ZodObject:()=>r.ZodObject,ZodOptional:()=>r.ZodOptional,ZodParsedType:()=>r.ZodParsedType,ZodPipeline:()=>r.ZodPipeline,ZodPromise:()=>r.ZodPromise,ZodReadonly:()=>r.ZodReadonly,ZodRecord:()=>r.ZodRecord,ZodSchema:()=>r.ZodSchema,ZodSet:()=>r.ZodSet,ZodString:()=>r.ZodString,ZodSymbol:()=>r.ZodSymbol,ZodTransformer:()=>r.ZodTransformer,ZodTuple:()=>r.ZodTuple,ZodType:()=>r.ZodType,ZodUndefined:()=>r.ZodUndefined,ZodUnion:()=>r.ZodUnion,ZodUnknown:()=>r.ZodUnknown,ZodVoid:()=>r.ZodVoid,addIssueToContext:()=>r.addIssueToContext,any:()=>r.any,array:()=>r.array,bigint:()=>r.bigint,boolean:()=>r.boolean,coerce:()=>r.coerce,custom:()=>r.custom,date:()=>r.date,datetimeRegex:()=>r.datetimeRegex,defaultErrorMap:()=>r.defaultErrorMap,discriminatedUnion:()=>r.discriminatedUnion,effect:()=>r.effect,enum:()=>r.enum,function:()=>r.function,getErrorMap:()=>r.getErrorMap,getParsedType:()=>r.getParsedType,instanceof:()=>r.instanceof,intersection:()=>r.intersection,isAborted:()=>r.isAborted,isAsync:()=>r.isAsync,isDirty:()=>r.isDirty,isValid:()=>r.isValid,late:()=>r.late,lazy:()=>r.lazy,literal:()=>r.literal,makeIssue:()=>r.makeIssue,map:()=>r.map,nan:()=>r.nan,nativeEnum:()=>r.nativeEnum,never:()=>r.never,null:()=>r.null,nullable:()=>r.nullable,number:()=>r.number,object:()=>r.object,objectUtil:()=>r.objectUtil,oboolean:()=>r.oboolean,onumber:()=>r.onumber,optional:()=>r.optional,ostring:()=>r.ostring,pipeline:()=>r.pipeline,preprocess:()=>r.preprocess,promise:()=>r.promise,quotelessJson:()=>r.quotelessJson,record:()=>r.record,set:()=>r.set,setErrorMap:()=>r.setErrorMap,strictObject:()=>r.strictObject,string:()=>r.string,symbol:()=>r.symbol,transformer:()=>r.transformer,tuple:()=>r.tuple,undefined:()=>r.undefined,union:()=>r.union,unknown:()=>r.unknown,util:()=>r.util,void:()=>r.void}),e.i(154991);var r=e.i(450948)},20279:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t}),e.i(154991);let t=e.i(791544)}},553224:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(154991),e.i(20279)},41790:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t}),e.i(553224);let t=e.i(20279).default}},243917:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(553224),e.i(41790)},81714:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({z:()=>r});var r=e.i(791544)},771884:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({B:()=>t,M:()=>i});class t extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}}class i extends t{constructor(e){super(`The package "${e}" is required. Make sure it is installed.`,e)}}}},692153:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({g:()=>t});let t=(e,t="ms")=>new Date(Date.now()+("sec"===t?1e3*e:e))}},105127:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({a:()=>s,b:()=>n,e:()=>r,i:()=>a});let t=Object.create(null),i=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?t:globalThis),r=new Proxy(t,{get:(e,r)=>i()[r]??t[r],has:(e,r)=>r in i()||r in t,set:(e,t,r)=>(i(!0)[t]=r,!0),deleteProperty(e,t){if(!t)return!1;let r=i(!0);return delete r[t],!0},ownKeys:()=>Object.keys(i(!0))}),o="undefined"!=typeof process&&process.env&&"production"||"",s="production"===o,n="dev"===o||"development"===o,a="test"===o||function(e){return!!e&&"false"!==e}(r.TEST)}},483013:e=>{"use strict";var{g:t,__dirname:i}=e;{function r(e){return e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function o(e,t,i){let r="",o=0,s=0;for(let i of e)for(o=o<<8|i,s+=8;s>=6;)s-=6,r+=t[o>>s&63];if(s>0&&(r+=t[o<<6-s&63]),i){let e=(4-r.length%4)%4;r+="=".repeat(e)}return r}function s(e,t){let i=new Map;for(let e=0;e<t.length;e++)i.set(t[e],e);let r=[],o=0,s=0;for(let t of e){if("="===t)break;let e=i.get(t);if(void 0===e)throw Error(`Invalid Base64 character: ${t}`);o=o<<6|e,(s+=6)>=8&&(s-=8,r.push(o>>s&255))}return Uint8Array.from(r)}e.s({base64:()=>t,base64Url:()=>i});let t={encode(e,t={}){let i=r(!1);return o("string"==typeof e?new TextEncoder().encode(e):new Uint8Array(e),i,t.padding??!0)},decode(e){"string"!=typeof e&&(e=new TextDecoder().decode(e));let t=r(e.includes("-")||e.includes("_"));return s(e,t)}},i={encode(e,t={}){let i=r(!0);return o("string"==typeof e?new TextEncoder().encode(e):new Uint8Array(e),i,t.padding??!0)},decode(e){let t=r(e.includes("-")||e.includes("_"));return s(e,t)}}}},91997:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({hex:()=>t});let t={encode:e=>{if("string"==typeof e&&(e=new TextEncoder().encode(e)),0===e.byteLength)return"";let t=new Uint8Array(e),i="";for(let e of t)i+=e.toString(16).padStart(2,"0");return i},decode:e=>{if(!e)return"";if("string"==typeof e){if(e.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(e))throw Error("Invalid hexadecimal string");let t=new Uint8Array(e.length/2);for(let i=0;i<e.length;i+=2)t[i/2]=parseInt(e.slice(i,i+2),16);return new TextDecoder().decode(t)}return new TextDecoder().decode(e)}}}},558692:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createHMAC:()=>t});var r=e.i(404300),o=e.i(91997),s=e.i(483013);let t=(e="SHA-256",t="none")=>{let i={importKey:async(t,i)=>r.subtle.importKey("raw","string"==typeof t?new TextEncoder().encode(t):t,{name:"HMAC",hash:{name:e}},!1,[i]),sign:async(e,n)=>{"string"==typeof e&&(e=await i.importKey(e,"sign"));let a=await r.subtle.sign("HMAC",e,"string"==typeof n?new TextEncoder().encode(n):n);return"hex"===t?o.hex.encode(a):"base64"===t||"base64url"===t||"base64urlnopad"===t?s.base64Url.encode(a,{padding:"base64urlnopad"!==t}):a},verify:async(e,n,a)=>("string"==typeof e&&(e=await i.importKey(e,"verify")),"hex"===t&&(a=o.hex.decode(a)),("base64"===t||"base64url"===t||"base64urlnopad"===t)&&(a=await s.base64.decode(a)),r.subtle.verify("HMAC",e,"string"==typeof a?new TextEncoder().encode(a):a,"string"==typeof n?new TextEncoder().encode(n):n))};return i}}},316944:e=>{"use strict";var{g:t,__dirname:i}=e;function r(e){try{return JSON.parse(e,function(e,t){if("string"==typeof t&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(t)){let e=new Date(t);if(!isNaN(e.getTime()))return e}return t})}catch{return null}}e.s({s:()=>r})},664764:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({a:()=>n,b:()=>l,c:()=>d,g:()=>a});var r=e.i(105127),o=e.i(771884);function s(e,t="/api/auth"){return!function(e){try{let t=new URL(e);return"/"!==t.pathname}catch(t){throw new o.B(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}(e)?(t=t.startsWith("/")?t:`/${t}`,`${e.replace(/\/+$/,"")}${t}`):e}function n(e,t,i){if(e)return s(e,t);let n=r.e.BETTER_AUTH_URL||r.e.NEXT_PUBLIC_BETTER_AUTH_URL||r.e.PUBLIC_BETTER_AUTH_URL||r.e.NUXT_PUBLIC_BETTER_AUTH_URL||r.e.NUXT_PUBLIC_AUTH_URL||("/"!==r.e.BASE_URL?r.e.BASE_URL:void 0);if(n)return s(n,t);let d=i?.headers.get("x-forwarded-host"),l=i?.headers.get("x-forwarded-proto");if(d&&l)return s(`${l}://${d}`,t);if(i){let e=a(i.url);if(!e)throw new o.B("Could not get origin from request. Please provide a valid base URL.");return s(e,t)}}function a(e){try{return new URL(e).origin}catch(e){return null}}function d(e){try{return new URL(e).protocol}catch(e){return null}}function l(e){try{return new URL(e).host}catch(t){return e}}},328902:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createCookieGetter:()=>p,deleteSessionCookie:()=>A,getCookieCache:()=>K,getCookies:()=>h,getSessionCookie:()=>y,parseCookies:()=>g,parseSetCookieHeader:()=>c,setCookieCache:()=>m,setCookieToHeader:()=>u,setSessionCookie:()=>f});var r=e.i(771884),o=e.i(692153),s=e.i(105127),n=e.i(483013),a=e.i(558692),d=e.i(316944),l=e.i(664764);let t=(e,r)=>{let o={t:`${e}${r}`,value:e,tFormat:r,toMilliseconds:()=>{switch(r){case"ms":return e;case"s":return 1e3*e;case"m":return 1e3*e*60;case"h":return 1e3*e*3600;case"d":return 1e3*e*86400;case"w":return 1e3*e*604800;case"y":return 1e3*e*31536e3}},toSeconds:()=>o.toMilliseconds()/1e3,toMinutes:()=>o.toSeconds()/60,toHours:()=>o.toMinutes()/60,toDays:()=>o.toHours()/24,toWeeks:()=>o.toDays()/7,toYears:()=>o.toDays()/365,getDate:()=>new Date(Date.now()+o.toMilliseconds()),add:e=>{let r="string"==typeof e?i(e).toMilliseconds():e.toMilliseconds();return t(o.toMilliseconds()+r,"ms")},subtract:e=>{let r="string"==typeof e?i(e).toMilliseconds():e.toMilliseconds();return t(o.toMilliseconds()-r,"ms")},multiply:e=>t(o.toMilliseconds()*e,"ms"),divide:e=>t(o.toMilliseconds()/e,"ms"),equals:e=>{let t="string"==typeof e?i(e).toMilliseconds():e.toMilliseconds();return o.toMilliseconds()===t},lessThan:e=>{let t="string"==typeof e?i(e).toMilliseconds():e.toMilliseconds();return o.toMilliseconds()<t},greaterThan:e=>{let t="string"==typeof e?i(e).toMilliseconds():e.toMilliseconds();return o.toMilliseconds()>t},format:e=>{let t=o.getDate();return e.replace(/YYYY|MM|DD|HH|mm|ss/g,e=>{switch(e){case"YYYY":return t.getFullYear().toString();case"MM":return(t.getMonth()+1).toString().padStart(2,"0");case"DD":return t.getDate().toString().padStart(2,"0");case"HH":return t.getHours().toString().padStart(2,"0");case"mm":return t.getMinutes().toString().padStart(2,"0");case"ss":return t.getSeconds().toString().padStart(2,"0");default:return e}})},fromNow:()=>{let e=o.toMilliseconds();return e<0?o.ago():e<1e3?"in a few seconds":e<6e4?`in ${Math.round(e/1e3)} seconds`:e<36e5?`in ${Math.round(e/6e4)} minutes`:e<864e5?`in ${Math.round(e/36e5)} hours`:e<6048e5?`in ${Math.round(e/864e5)} days`:e<26298e5?`in ${Math.round(e/6048e5)} weeks`:e<315576e5?`in ${Math.round(e/26298e5)} months`:`in ${Math.round(e/315576e5)} years`},ago:()=>{let e=-o.toMilliseconds();return e<0?o.fromNow():e<1e3?"a few seconds ago":e<6e4?`${Math.round(e/1e3)} seconds ago`:e<36e5?`${Math.round(e/6e4)} minutes ago`:e<864e5?`${Math.round(e/36e5)} hours ago`:e<6048e5?`${Math.round(e/864e5)} days ago`:e<26298e5?`${Math.round(e/6048e5)} weeks ago`:e<315576e5?`${Math.round(e/26298e5)} months ago`:`${Math.round(e/315576e5)} years ago`}};return o},i=e=>{let i=e.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!i)throw Error("Invalid time format");return t(parseInt(i[1]),i[2])};function c(e){let t=new Map;return e.split(", ").forEach(e=>{let[i,...r]=e.split(";").map(e=>e.trim()),[o,...s]=i.split("="),n=s.join("=");if(!o||void 0===n)return;let a={value:n};r.forEach(e=>{let[t,...i]=e.split("="),r=i.join("="),o=t.trim().toLowerCase();switch(o){case"max-age":a["max-age"]=r?parseInt(r.trim(),10):void 0;break;case"expires":a.expires=r?new Date(r.trim()):void 0;break;case"domain":a.domain=r?r.trim():void 0;break;case"path":a.path=r?r.trim():void 0;break;case"secure":a.secure=!0;break;case"httponly":a.httponly=!0;break;case"samesite":a.samesite=r?r.trim().toLowerCase():void 0;break;default:a[o]=!r||r.trim()}}),t.set(o,a)}),t}function u(e){return t=>{let i=t.response.headers.get("set-cookie");if(!i)return;let r=new Map;(e.get("cookie")||"").split(";").forEach(e=>{let[t,...i]=e.trim().split("=");t&&i.length>0&&r.set(t,i.join("="))}),i.split(",").forEach(e=>{c(e).forEach((e,t)=>{r.set(t,e.value)})});let o=Array.from(r.entries()).map(([e,t])=>`${e}=${t}`).join("; ");e.set("cookie",o)}}function p(e){let t=(e.advanced?.useSecureCookies!==void 0?e.advanced?.useSecureCookies:void 0!==e.baseURL?!!e.baseURL.startsWith("https://"):s.a)?"__Secure-":"",i=!!e.advanced?.crossSubDomainCookies?.enabled,o=i?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(i&&!o)throw new r.B("baseURL is required when crossSubdomainCookies are enabled");return function(r,s={}){let n=e.advanced?.cookiePrefix||"better-auth",a=e.advanced?.cookies?.[r]?.name||`${n}.${r}`,d=e.advanced?.cookies?.[r]?.attributes;return{name:`${t}${a}`,attributes:{secure:!!t,sameSite:"lax",path:"/",httpOnly:!0,...i?{domain:o}:{},...e.advanced?.defaultCookieAttributes,...s,...d}}}}function h(e){let i=p(e),r=i("session_token",{maxAge:e.session?.expiresIn||t(7,"d").toSeconds()}),o=i("session_data",{maxAge:e.session?.cookieCache?.maxAge||300}),s=i("dont_remember");return{sessionToken:{name:r.name,options:r.attributes},sessionData:{name:o.name,options:o.attributes},dontRememberToken:{name:s.name,options:s.attributes}}}async function m(e,t){if(e.context.options.session?.cookieCache?.enabled){let i={session:Object.entries(t.session).reduce((t,[i,r])=>{let o=e.context.options.session?.additionalFields?.[i];return o&&!1===o.returned||(t[i]=r),t},{}),user:t.user},s=n.base64Url.encode(JSON.stringify({session:i,expiresAt:(0,o.g)(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),signature:await (0,a.createHMAC)("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify({...i,expiresAt:(0,o.g)(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime()}))}),{padding:!1});if(s.length>4093)throw new r.B("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,s,e.context.authCookies.sessionData.options)}}async function f(e,t,i,r){let o=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);i=void 0!==i?i:!!o;let s=e.context.authCookies.sessionToken.options,n=i?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,t.session.token,e.context.secret,{...s,maxAge:n,...r}),i&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await m(e,t),e.context.setNewSession(t),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(t.session.token,JSON.stringify({user:t.user,session:t.session}),Math.floor((new Date(t.session.expiresAt).getTime()-Date.now())/1e3))}function A(e,t){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),t||e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}function g(e){let t=e.split("; "),i=new Map;return t.forEach(e=>{let[t,r]=e.split("=");i.set(t,r)}),i}let y=(e,t)=>{t?.cookiePrefix&&(t.cookieName?t.cookiePrefix=`${t.cookiePrefix}-`:t.cookiePrefix=`${t.cookiePrefix}.`);let i="headers"in e?e.headers:e,r=e instanceof Request?e:void 0;(0,l.a)(r?.url,t?.path,r);let o=i.get("cookie");if(!o)return null;let{cookieName:s="session_token",cookiePrefix:n="better-auth."}=t||{},a=`${n}${s}`,d=`__Secure-${a}`,c=g(o),u=c.get(a)||c.get(d);return u||null},K=(e,t)=>{let i=(e instanceof Headers?e:e.headers).get("cookie");if(!i)return null;let{cookieName:r="session_data",cookiePrefix:o="better-auth"}=t||{},n=s.a?`__Secure-${o}.${r}`:`${o}.${r}`,a=g(i).get(n);return a?(0,d.s)(a):null}}},137942:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({BetterFetchError:()=>p,ValidationError:()=>P,applySchemaPlugin:()=>z,betterFetch:()=>j,bodyParser:()=>R,createFetch:()=>B,createRetryStrategy:()=>A,createSchema:()=>L,detectContentType:()=>x,detectResponseType:()=>K,getBody:()=>O,getFetch:()=>N,getHeaders:()=>T,getMethod:()=>S,getTimeout:()=>k,getURL:()=>C,initializePlugins:()=>h,isFunction:()=>_,isJSONParsable:()=>w,isJSONSerializable:()=>v,isPayloadMethod:()=>I,isRouteMethod:()=>E,jsonParse:()=>b,methods:()=>D,parseStandardSchema:()=>U});var r=Object.defineProperty,o=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,l=(e,t,i)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,c=(e,t)=>{for(var i in t||(t={}))a.call(t,i)&&l(e,i,t[i]);if(n)for(var i of n(t))d.call(t,i)&&l(e,i,t[i]);return e},u=(e,t)=>o(e,s(t)),p=class extends Error{constructor(e,t,i){super(t||e.toString(),{cause:i}),this.status=e,this.statusText=t,this.error=i}},h=async(e,t)=>{var i,r,o,s,n,a;let d=t||{},l={onRequest:[null==t?void 0:t.onRequest],onResponse:[null==t?void 0:t.onResponse],onSuccess:[null==t?void 0:t.onSuccess],onError:[null==t?void 0:t.onError],onRetry:[null==t?void 0:t.onRetry]};if(!t||!(null==t?void 0:t.plugins))return{url:e,options:d,hooks:l};for(let c of(null==t?void 0:t.plugins)||[]){if(c.init){let r=await (null==(i=c.init)?void 0:i.call(c,e.toString(),t));d=r.options||d,e=r.url}l.onRequest.push(null==(r=c.hooks)?void 0:r.onRequest),l.onResponse.push(null==(o=c.hooks)?void 0:o.onResponse),l.onSuccess.push(null==(s=c.hooks)?void 0:s.onSuccess),l.onError.push(null==(n=c.hooks)?void 0:n.onError),l.onRetry.push(null==(a=c.hooks)?void 0:a.onRetry)}return{url:e,options:d,hooks:l}},m=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},f=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function A(e){if("number"==typeof e)return new m({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new m(e);case"exponential":return new f(e);default:throw Error("Invalid retry strategy")}}var g=async e=>{let t={},i=async e=>"function"==typeof e?await e():e;if(null==e?void 0:e.auth){if("Bearer"===e.auth.type){let r=await i(e.auth.token);if(!r)return t;t.authorization=`Bearer ${r}`}else if("Basic"===e.auth.type){let r=i(e.auth.username),o=i(e.auth.password);if(!r||!o)return t;t.authorization=`Basic ${btoa(`${r}:${o}`)}`}else if("Custom"===e.auth.type){let r=i(e.auth.value);if(!r)return t;t.authorization=`${i(e.auth.prefix)} ${r}`}}return t},y=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function K(e){let t=e.headers.get("content-type"),i=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";let r=t.split(";").shift()||"";return y.test(r)?"json":i.has(r)||r.startsWith("text/")?"text":"blob"}function w(e){try{return JSON.parse(e),!0}catch(e){return!1}}function v(e){if(void 0===e)return!1;let t=typeof e;return"string"===t||"number"===t||"boolean"===t||null===t||"object"===t&&(!!Array.isArray(e)||!e.buffer&&(e.constructor&&"Object"===e.constructor.name||"function"==typeof e.toJSON))}function b(e){try{return JSON.parse(e)}catch(t){return e}}function _(e){return"function"==typeof e}function N(e){if(null==e?void 0:e.customFetchImpl)return e.customFetchImpl;if("undefined"!=typeof globalThis&&_(globalThis.fetch))return globalThis.fetch;throw Error("No fetch implementation found")}function I(e){return!!e&&["POST","PUT","PATCH","DELETE"].includes(e.toUpperCase())}function E(e){return!!e&&["GET","POST","PUT","PATCH","DELETE"].includes(e.toUpperCase())}async function T(e){let t=new Headers(null==e?void 0:e.headers);for(let[i,r]of Object.entries(await g(e)||{}))t.set(i,r);if(!t.has("content-type")){let i=x(null==e?void 0:e.body);i&&t.set("content-type",i)}return t}function C(e,t){let i;if(e.startsWith("@")){let t=e.toString().split("@")[1].split("/")[0];D.includes(t)&&(e=e.replace(`@${t}/`,"/"))}try{if(e.startsWith("http"))i=e;else{let r=null==t?void 0:t.baseURL;!r||(null==r?void 0:r.endsWith("/"))||(r+="/"),i=e.startsWith("/")?new URL(e.substring(1),r):new URL(e,null==t?void 0:t.baseURL)}}catch(i){if(i instanceof TypeError){if(!(null==t?void 0:t.baseURL))throw TypeError(`Invalid URL ${e}. Are you passing in a relative url but not setting the baseURL?`);throw TypeError(`Invalid URL ${e}. Please validate that you are passing the correct input.`)}throw i}if(null==t?void 0:t.params)if(Array.isArray(null==t?void 0:t.params)){let e=(null==t?void 0:t.params)?Array.isArray(t.params)?`/${t.params.join("/")}`:`/${Object.values(t.params).join("/")}`:"";i=i.toString().split("/:")[0],i=`${i.toString()}${e}`}else for(let[e,r]of Object.entries(null==t?void 0:t.params))i=i.toString().replace(`:${e}`,String(r));let r=new URL(i),o=null==t?void 0:t.query;if(o)for(let[e,t]of Object.entries(o))r.searchParams.append(e,String(t));return r}function x(e){return v(e)?"application/json":null}function O(e){if(!(null==e?void 0:e.body))return null;let t=new Headers(null==e?void 0:e.headers);if(v(e.body)&&!t.has("content-type")){for(let[t,i]of Object.entries(null==e?void 0:e.body))i instanceof Date&&(e.body[t]=i.toISOString());return JSON.stringify(e.body)}return e.body}function S(e,t){var i;if(null==t?void 0:t.method)return t.method.toUpperCase();if(e.startsWith("@")){let r=null==(i=e.split("@")[1])?void 0:i.split("/")[0];return D.includes(r)?r.toUpperCase():(null==t?void 0:t.body)?"POST":"GET"}return(null==t?void 0:t.body)?"POST":"GET"}function k(e,t){let i;return!(null==e?void 0:e.signal)&&(null==e?void 0:e.timeout)&&(i=setTimeout(()=>null==t?void 0:t.abort(),null==e?void 0:e.timeout)),{abortTimeout:i,clearTimeout:()=>{i&&clearTimeout(i)}}}function R(e,t){return"json"===t?JSON.parse(e):e}var P=class e extends Error{constructor(t,i){super(i||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,e.prototype)}};async function U(e,t){let i=await e["~standard"].validate(t);if(i.issues)throw new P(i.issues);return i.value}var D=["get","post","put","patch","delete"],L=(e,t)=>({schema:e,config:t}),z=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,i){var r,o,s,n;let a=(null==(o=null==(r=e.plugins)?void 0:r.find(e=>{var i;return null!=(i=e.schema)&&!!i.config&&(t.startsWith(e.schema.config.baseURL||"")||t.startsWith(e.schema.config.prefix||""))}))?void 0:o.schema)||e.schema;if(a){let e=t;(null==(s=a.config)?void 0:s.prefix)&&e.startsWith(a.config.prefix)&&(e=e.replace(a.config.prefix,""),a.config.baseURL&&(t=t.replace(a.config.prefix,a.config.baseURL))),(null==(n=a.config)?void 0:n.baseURL)&&e.startsWith(a.config.baseURL)&&(e=e.replace(a.config.baseURL,""));let r=a.schema[e];if(r){let e=u(c({},i),{method:r.method,output:r.output});return(null==i?void 0:i.disableValidation)||(e=u(c({},e),{body:r.input?await U(r.input,null==i?void 0:i.body):null==i?void 0:i.body,params:r.params?await U(r.params,null==i?void 0:i.params):null==i?void 0:i.params,query:r.query?await U(r.query,null==i?void 0:i.query):null==i?void 0:i.query})),{url:t,options:e}}}return{url:t,options:i}}}),B=e=>async function(t,i){let r=u(c(c({},e),i),{plugins:[...(null==e?void 0:e.plugins)||[],z(e||{})]});if(null==e?void 0:e.catchAllError)try{return await j(t,r)}catch(e){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:e}}}return await j(t,r)},j=async(e,t)=>{var i,r,o,s,n,a,d,l;let{hooks:m,url:f,options:g}=await h(e,t),y=N(g),v=new AbortController,_=null!=(i=g.signal)?i:v.signal,I=function(e,t){let{baseURL:i,params:r,query:o}=t||{query:{},params:{},baseURL:""},s=e.startsWith("http")?e.split("/").slice(0,3).join("/"):i||"";if(e.startsWith("@")){let t=e.toString().split("@")[1].split("/")[0];D.includes(t)&&(e=e.replace(`@${t}/`,"/"))}s.endsWith("/")||(s+="/");let[n,a]=e.replace(s,"").split("?"),d=new URLSearchParams(a);for(let[e,t]of Object.entries(o||{}))null!=t&&d.set(e,String(t));if(r)if(Array.isArray(r))for(let[e,t]of n.split("/").filter(e=>e.startsWith(":")).entries()){let i=r[e];n=n.replace(t,i)}else for(let[e,t]of Object.entries(r))n=n.replace(`:${e}`,String(t));(n=n.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(n=n.slice(1));let l=d.toString();return(l=l.length>0?`?${l}`.replace(/\+/g,"%20"):"",s.startsWith("http"))?new URL(`${n}${l}`,s):`${s}${n}${l}`}(f,g),E=O(g),C=await T(g),x=S(f,g),R=u(c({},g),{url:I,headers:C,body:E,method:x,signal:_});for(let e of m.onRequest)if(e){let t=await e(R);t instanceof Object&&(R=t)}("pipeTo"in R&&"function"==typeof R.pipeTo||"function"==typeof(null==(r=null==t?void 0:t.body)?void 0:r.pipe))&&!("duplex"in R)&&(R.duplex="half");let{clearTimeout:P}=k(g,v),L=await y(R.url,R);P();let z={response:L,request:R};for(let e of m.onResponse)if(e){let i=await e(u(c({},z),{response:(null==(o=null==t?void 0:t.hookOptions)?void 0:o.cloneResponse)?L.clone():L}));i instanceof Response?L=i:i instanceof Object&&(L=i.response)}if(L.ok){if("HEAD"===R.method)return{data:"",error:null};let e=K(L),i={data:"",response:L,request:R};if("json"===e||"text"===e){let e=await L.text(),t=null!=(s=R.jsonParser)?s:b;i.data=await t(e)}else i.data=await L[e]();for(let e of((null==R?void 0:R.output)&&R.output&&!R.disableValidation&&(i.data=await U(R.output,i.data)),m.onSuccess))e&&await e(u(c({},i),{response:(null==(n=null==t?void 0:t.hookOptions)?void 0:n.cloneResponse)?L.clone():L}));return(null==t?void 0:t.throw)?i.data:{data:i.data,error:null}}let B=null!=(a=null==t?void 0:t.jsonParser)?a:b,q=await L.text(),Z=w(q),M=Z?await B(q):null,V={response:L,responseText:q,request:R,error:u(c({},M),{status:L.status,statusText:L.statusText})};for(let e of m.onError)e&&await e(u(c({},V),{response:(null==(d=null==t?void 0:t.hookOptions)?void 0:d.cloneResponse)?L.clone():L}));if(null==t?void 0:t.retry){let i=A(t.retry),r=null!=(l=t.retryAttempt)?l:0;if(await i.shouldAttemptRetry(r,L)){for(let e of m.onRetry)e&&await e(z);let o=i.getDelay(r);return await new Promise(e=>setTimeout(e,o)),await j(e,u(c({},t),{retryAttempt:r+1}))}}if(null==t?void 0:t.throw)throw new p(L.status,L.statusText,Z?M:q);return{data:null,error:u(c({},M),{status:L.status,statusText:L.statusText})}}},25966:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(591032);let t=(e,t)=>(0,r.createHash)(e).update(t).digest()}},969472:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({concat:()=>o,concatKdf:()=>c,decoder:()=>i,encoder:()=>t,lengthAndInput:()=>l,p2s:()=>s,uint32be:()=>d,uint64be:()=>a});var r=e.i(25966);let t=new TextEncoder,i=new TextDecoder;function o(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),i=0;for(let r of e)t.set(r,i),i+=r.length;return t}function s(e,i){return o(t.encode(e),new Uint8Array([0]),i)}function n(e,t,i){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],i)}function a(e){let t=Math.floor(e/0x100000000),i=new Uint8Array(8);return n(i,t,0),n(i,e%0x100000000,4),i}function d(e){let t=new Uint8Array(4);return n(t,e),t}function l(e){return o(d(e.length),e)}async function c(e,t,i){let o=Math.ceil((t>>3)/32),s=new Uint8Array(32*o);for(let t=0;t<o;t++){let o=new Uint8Array(4+e.length+i.length);o.set(d(t+1)),o.set(e,4),o.set(i,4+e.length),s.set(await (0,r.default)("sha256",o),32*t)}return s.slice(0,t>>3)}}},827210:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({decode:()=>n,decodeBase64:()=>i,encode:()=>t,encodeBase64:()=>s});var r=e.i(580767),o=e.i(969472);let t=e=>r.Buffer.from(e).toString("base64url"),i=e=>new Uint8Array(r.Buffer.from(e,"base64")),s=e=>r.Buffer.from(e).toString("base64"),n=e=>new Uint8Array(r.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=o.decoder.decode(t)),t}(e),"base64url"))}},271113:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({decode:()=>i,encode:()=>t});var r=e.i(827210);let t=r.encode,i=r.decode}},811140:e=>{"use strict";var{g:t,__dirname:i}=e;function r(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}e.s({default:()=>r})},83602:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({JOSEAlgNotAllowed:()=>o,JOSEError:()=>t,JOSENotSupported:()=>s,JWEDecryptionFailed:()=>n,JWEInvalid:()=>a,JWKInvalid:()=>c,JWKSInvalid:()=>u,JWKSMultipleMatchingKeys:()=>h,JWKSNoMatchingKey:()=>p,JWKSTimeout:()=>m,JWSInvalid:()=>d,JWSSignatureVerificationFailed:()=>f,JWTClaimValidationFailed:()=>i,JWTExpired:()=>r,JWTInvalid:()=>l});class t extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class i extends t{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,i="unspecified",r="unspecified"){super(e,{cause:{claim:i,reason:r,payload:t}}),this.claim=i,this.reason=r,this.payload=t}}class r extends t{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,i="unspecified",r="unspecified"){super(e,{cause:{claim:i,reason:r,payload:t}}),this.claim=i,this.reason=r,this.payload=t}}class o extends t{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class s extends t{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class n extends t{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(e="decryption operation failed",t){super(e,t)}}class a extends t{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class d extends t{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class l extends t{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class c extends t{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class u extends t{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class p extends t{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t)}}class h extends t{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class m extends t{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(e="request timed out",t){super(e,t)}}class f extends t{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}}},553871:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({decodeJwt:()=>a});var r=e.i(271113),o=e.i(969472),s=e.i(811140),n=e.i(83602);function a(e){let t,i;if("string"!=typeof e)throw new n.JWTInvalid("JWTs must use Compact JWS serialization, JWT must be a string");let{1:a,length:d}=e.split(".");if(5===d)throw new n.JWTInvalid("Only JWTs using Compact JWS serialization can be decoded");if(3!==d)throw new n.JWTInvalid("Invalid JWT");if(!a)throw new n.JWTInvalid("JWTs must contain a payload");try{t=(0,r.decode)(a)}catch{throw new n.JWTInvalid("Failed to base64url decode the payload")}try{i=JSON.parse(o.decoder.decode(t))}catch{throw new n.JWTInvalid("Failed to parse the decoded payload as JSON")}if(!(0,s.default)(i))throw new n.JWTInvalid("Invalid JWT Claims Set");return i}},384239:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({decodeProtectedHeader:()=>n});var r=e.i(271113),o=e.i(969472),s=e.i(811140);function n(e){let t;if("string"==typeof e){let i=e.split(".");(3===i.length||5===i.length)&&([t]=i)}else if("object"==typeof e&&e)if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof t||!t)throw Error();let e=JSON.parse(o.decoder.decode((0,r.decode)(t)));if(!(0,s.default)(e))throw Error();return e}catch{throw TypeError("Invalid Token or Protected Header formatting")}}},243115:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({default:()=>o});var r=e.i(83602);function o(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new r.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}},118533:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t,isCryptoKey:()=>i});var r=e.i(591032),o=e.i(936121);let t=r.webcrypto,i=e=>o.types.isCryptoKey(e)}},1148:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(936121);let t=e=>r.types.isKeyObject(e)}},143048:e=>{"use strict";var{g:t,__dirname:i}=e;{function r(e,t,...i){if((i=i.filter(Boolean)).length>2){let t=i.pop();e+=`one of type ${i.join(", ")}, or ${t}.`}else 2===i.length?e+=`one of type ${i[0]} or ${i[1]}.`:e+=`of type ${i[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}e.s({default:()=>t,withAlg:()=>o});let t=(e,...t)=>r("Key must be ",e,...t);function o(e,t,...i){return r(`Key for the ${e} algorithm must be `,t,...i)}}},23149:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t,types:()=>i});var r=e.i(118533),o=e.i(1148);let t=e=>(0,o.default)(e)||(0,r.isCryptoKey)(e),i=["KeyObject"];(globalThis.CryptoKey||r.default?.CryptoKey)&&i.push("CryptoKey")}},453666:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({isJWK:()=>o,isPrivateJWK:()=>s,isPublicJWK:()=>n,isSecretJWK:()=>a});var r=e.i(811140);function o(e){return(0,r.default)(e)&&"string"==typeof e.kty}function s(e){return"oct"!==e.kty&&"string"==typeof e.d}function n(e){return"oct"!==e.kty&&void 0===e.d}function a(e){return o(e)&&"oct"===e.kty&&"string"==typeof e.k}},198898:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>c,weakMap:()=>t});var r=e.i(591032),o=e.i(83602),s=e.i(118533),n=e.i(1148),a=e.i(143048),d=e.i(23149),l=e.i(453666);let t=new WeakMap,i=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new o.JOSENotSupported("Unsupported key curve for this operation")}},c=(e,t)=>{let o;if((0,s.isCryptoKey)(e))o=r.KeyObject.from(e);else if((0,n.default)(e))o=e;else if((0,l.isJWK)(e))return e.crv;else throw TypeError((0,a.default)(e,...d.types));if("secret"===o.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(o.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${o.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${o.asymmetricKeyType.slice(1)}`;case"ec":{let e=o.asymmetricKeyDetails.namedCurve;if(t)return e;return i(e)}default:throw TypeError("Invalid asymmetric key type for this operation")}}}},636438:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(591032);let t=(e,t)=>{let i;try{i=e instanceof r.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof i||i<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}}},811254:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>a});var r=e.i(591032),o=e.i(198898),s=e.i(83602),n=e.i(636438);let t=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function a(e,i){let a,d,l,c;if(i instanceof r.KeyObject)a=i.asymmetricKeyType,d=i.asymmetricKeyDetails;else switch(l=!0,i.kty){case"RSA":a="rsa";break;case"EC":a="ec";break;case"OKP":if("Ed25519"===i.crv){a="ed25519";break}if("Ed448"===i.crv){a="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"Ed25519":if("ed25519"!==a)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(a))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==a)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");(0,n.default)(i,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===a){let{hashAlgorithm:t,mgf1HashAlgorithm:i,saltLength:r}=d,o=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${o}`||i!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==r&&r>o>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==a)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");(0,n.default)(i,e),c={padding:r.constants.RSA_PKCS1_PSS_PADDING,saltLength:r.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==a)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let r=(0,o.default)(i),s=t.get(e);if(r!==s)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${s}, got ${r}`);c={dsaEncoding:"ieee-p1363"};break}default:throw new s.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return l?{format:"jwk",key:i,...c}:c?{...c,key:i}:i}}},250540:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({default:()=>o});var r=e.i(83602);function o(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new r.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}},357002:e=>{"use strict";var{g:t,__dirname:i}=e;function r(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function o(e,t){return e.name===t}function s(e){return parseInt(e.name.slice(4),10)}function n(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let i=t.pop();e+=`one of ${t.join(", ")}, or ${i}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}function a(e,t,...i){switch(t){case"HS256":case"HS384":case"HS512":{if(!o(e.algorithm,"HMAC"))throw r("HMAC");let i=parseInt(t.slice(2),10);if(s(e.algorithm.hash)!==i)throw r(`SHA-${i}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!o(e.algorithm,"RSASSA-PKCS1-v1_5"))throw r("RSASSA-PKCS1-v1_5");let i=parseInt(t.slice(2),10);if(s(e.algorithm.hash)!==i)throw r(`SHA-${i}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!o(e.algorithm,"RSA-PSS"))throw r("RSA-PSS");let i=parseInt(t.slice(2),10);if(s(e.algorithm.hash)!==i)throw r(`SHA-${i}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw r("Ed25519 or Ed448");break;case"Ed25519":if(!o(e.algorithm,"Ed25519"))throw r("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!o(e.algorithm,"ECDSA"))throw r("ECDSA");let i=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==i)throw r(i,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}n(e,i)}function d(e,t,...i){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!o(e.algorithm,"AES-GCM"))throw r("AES-GCM");let i=parseInt(t.slice(1,4),10);if(e.algorithm.length!==i)throw r(i,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!o(e.algorithm,"AES-KW"))throw r("AES-KW");let i=parseInt(t.slice(1,4),10);if(e.algorithm.length!==i)throw r(i,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw r("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!o(e.algorithm,"PBKDF2"))throw r("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!o(e.algorithm,"RSA-OAEP"))throw r("RSA-OAEP");let i=parseInt(t.slice(9),10)||1;if(s(e.algorithm.hash)!==i)throw r(`SHA-${i}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}n(e,i)}e.s({checkEncCryptoKey:()=>d,checkSigCryptoKey:()=>a})},78439:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({default:()=>l});var r=e.i(591032),o=e.i(118533),s=e.i(357002),n=e.i(143048),a=e.i(23149),d=e.i(453666);function l(e,t,i){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError((0,n.default)(t,...a.types));return(0,r.createSecretKey)(t)}if(t instanceof r.KeyObject)return t;if((0,o.isCryptoKey)(t))return(0,s.checkSigCryptoKey)(t,e,i),r.KeyObject.from(t);if((0,d.isJWK)(t))return e.startsWith("HS")?(0,r.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError((0,n.default)(t,...a.types,"Uint8Array","JSON Web Key"))}},946625:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>i});var r=e.i(591032),o=e.i(936121),s=e.i(243115),n=e.i(250540),a=e.i(811254),d=e.i(78439);let t=(0,o.promisify)(r.sign),i=async(e,i,o)=>{let l=(0,d.default)(e,i,"sign");if(e.startsWith("HS")){let t=(0,r.createHmac)((0,n.default)(e),l);return t.update(o),t.digest()}return t((0,s.default)(e),o,(0,a.default)(e,l))}}},68497:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>i});var r=e.i(591032),o=e.i(936121),s=e.i(243115),n=e.i(811254),a=e.i(946625),d=e.i(78439);let t=(0,o.promisify)(r.verify),i=async(e,i,o,l)=>{let c=(0,d.default)(e,i,"verify");if(e.startsWith("HS")){let t=await (0,a.default)(e,c,l);try{return(0,r.timingSafeEqual)(o,t)}catch{return!1}}let u=(0,s.default)(e),p=(0,n.default)(e,c);try{return await t(u,l,p,o)}catch{return!1}}}},160955:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});let t=(...e)=>{let t,i=e.filter(Boolean);if(0===i.length||1===i.length)return!0;for(let e of i){let i=Object.keys(e);if(!t||0===t.size){t=new Set(i);continue}for(let e of i){if(t.has(e))return!1;t.add(e)}}return!0}}},327859:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({checkKeyTypeWithJwk:()=>c,default:()=>l});var r=e.i(143048),o=e.i(23149),s=e.i(453666);let t=e=>e?.[Symbol.toStringTag],i=(e,t,i)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(i)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${i}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},a=(e,n,a,d)=>{if(!(n instanceof Uint8Array)){if(d&&(0,s.isJWK)(n)){if((0,s.isSecretJWK)(n)&&i(e,n,a))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!(0,o.default)(n))throw TypeError((0,r.withAlg)(e,n,...o.types,"Uint8Array",d?"JSON Web Key":null));if("secret"!==n.type)throw TypeError(`${t(n)} instances for symmetric algorithms must be of type "secret"`)}},d=(e,n,a,d)=>{if(d&&(0,s.isJWK)(n))switch(a){case"sign":if((0,s.isPrivateJWK)(n)&&i(e,n,a))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if((0,s.isPublicJWK)(n)&&i(e,n,a))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!(0,o.default)(n))throw TypeError((0,r.withAlg)(e,n,...o.types,d?"JSON Web Key":null));if("secret"===n.type)throw TypeError(`${t(n)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===a&&"public"===n.type)throw TypeError(`${t(n)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===a&&"public"===n.type)throw TypeError(`${t(n)} instances for asymmetric algorithm decryption must be of type "private"`);if(n.algorithm&&"verify"===a&&"private"===n.type)throw TypeError(`${t(n)} instances for asymmetric algorithm verifying must be of type "public"`);if(n.algorithm&&"encrypt"===a&&"private"===n.type)throw TypeError(`${t(n)} instances for asymmetric algorithm encryption must be of type "public"`)};function n(e,t,i,r){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?a(t,i,r,e):d(t,i,r,e)}let l=n.bind(void 0,!1),c=n.bind(void 0,!0)}},142056:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(83602);let t=function(e,t,i,o,s){let n;if(void 0!==s.crit&&o?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||void 0===o.crit)return new Set;if(!Array.isArray(o.crit)||0===o.crit.length||o.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(n=void 0!==i?new Map([...Object.entries(i),...t.entries()]):t,o.crit)){if(!n.has(a))throw new r.JOSENotSupported(`Extension Header Parameter "${a}" is not recognized`);if(void 0===s[a])throw new e(`Extension Header Parameter "${a}" is missing`);if(n.get(a)&&void 0===o[a])throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(o.crit)}}},27432:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});let t=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}}},434193:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({fromPKCS8:()=>c,fromSPKI:()=>u,fromX509:()=>p,toPKCS8:()=>l,toSPKI:()=>i});var r=e.i(591032),o=e.i(580767),s=e.i(118533),n=e.i(1148),a=e.i(143048),d=e.i(23149);let t=(e,t,i)=>{let o;if((0,s.isCryptoKey)(i)){if(!i.extractable)throw TypeError("CryptoKey is not extractable");o=r.KeyObject.from(i)}else if((0,n.default)(i))o=i;else throw TypeError((0,a.default)(i,...d.types));if(o.type!==e)throw TypeError(`key is not a ${e} key`);return o.export({format:"pem",type:t})},i=e=>t("public","spki",e),l=e=>t("private","pkcs8",e),c=e=>(0,r.createPrivateKey)({key:o.Buffer.from(e.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""),"base64"),type:"pkcs8",format:"der"}),u=e=>(0,r.createPublicKey)({key:o.Buffer.from(e.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,""),"base64"),type:"spki",format:"der"}),p=e=>(0,r.createPublicKey)({key:e,type:"spki",format:"pem"})}},684565:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(591032);let t=e=>e.d?(0,r.createPrivateKey)({format:"jwk",key:e}):(0,r.createPublicKey)({format:"jwk",key:e})}},719878:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({importJWK:()=>u,importPKCS8:()=>c,importSPKI:()=>d,importX509:()=>l});var r=e.i(827210),o=e.i(434193),s=e.i(684565),n=e.i(83602),a=e.i(811140);async function d(e,t,i){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return(0,o.fromSPKI)(e,t,i)}async function l(e,t,i){if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');return(0,o.fromX509)(e,t,i)}async function c(e,t,i){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return(0,o.fromPKCS8)(e,t,i)}async function u(e,t){if(!(0,a.default)(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return(0,r.decode)(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new n.JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return(0,s.default)({...e,alg:t});default:throw new n.JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}},757859:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({flattenedVerify:()=>m});var r=e.i(827210),o=e.i(68497),s=e.i(83602),n=e.i(969472),a=e.i(160955),d=e.i(811140),l=e.i(327859),c=e.i(142056),u=e.i(27432),p=e.i(453666),h=e.i(719878);async function m(e,t,i){let m,f;if(!(0,d.default)(e))throw new s.JWSInvalid("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new s.JWSInvalid('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new s.JWSInvalid("JWS Protected Header incorrect type");if(void 0===e.payload)throw new s.JWSInvalid("JWS Payload missing");if("string"!=typeof e.signature)throw new s.JWSInvalid("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,d.default)(e.header))throw new s.JWSInvalid("JWS Unprotected Header incorrect type");let A={};if(e.protected)try{let t=(0,r.decode)(e.protected);A=JSON.parse(n.decoder.decode(t))}catch{throw new s.JWSInvalid("JWS Protected Header is invalid")}if(!(0,a.default)(A,e.header))throw new s.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...A,...e.header},y=(0,c.default)(s.JWSInvalid,new Map([["b64",!0]]),i?.crit,A,g),K=!0;if(y.has("b64")&&"boolean"!=typeof(K=A.b64))throw new s.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:w}=g;if("string"!=typeof w||!w)throw new s.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');let v=i&&(0,u.default)("algorithms",i.algorithms);if(v&&!v.has(w))throw new s.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter value not allowed');if(K){if("string"!=typeof e.payload)throw new s.JWSInvalid("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new s.JWSInvalid("JWS Payload must be a string or an Uint8Array instance");let b=!1;"function"==typeof t?(t=await t(A,e),b=!0,(0,l.checkKeyTypeWithJwk)(w,t,"verify"),(0,p.isJWK)(t)&&(t=await (0,h.importJWK)(t,w))):(0,l.checkKeyTypeWithJwk)(w,t,"verify");let _=(0,n.concat)(n.encoder.encode(e.protected??""),n.encoder.encode("."),"string"==typeof e.payload?n.encoder.encode(e.payload):e.payload);try{m=(0,r.decode)(e.signature)}catch{throw new s.JWSInvalid("Failed to base64url decode the signature")}if(!await (0,o.default)(w,t,m,_))throw new s.JWSSignatureVerificationFailed;if(K)try{f=(0,r.decode)(e.payload)}catch{throw new s.JWSInvalid("Failed to base64url decode the payload")}else f="string"==typeof e.payload?n.encoder.encode(e.payload):e.payload;let N={payload:f};return(void 0!==e.protected&&(N.protectedHeader=A),void 0!==e.header&&(N.unprotectedHeader=e.header),b)?{...N,key:t}:N}},576182:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({compactVerify:()=>n});var r=e.i(757859),o=e.i(83602),s=e.i(969472);async function n(e,t,i){if(e instanceof Uint8Array&&(e=s.decoder.decode(e)),"string"!=typeof e)throw new o.JWSInvalid("Compact JWS must be a string or Uint8Array");let{0:n,1:a,2:d,length:l}=e.split(".");if(3!==l)throw new o.JWSInvalid("Invalid Compact JWS");let c=await (0,r.flattenedVerify)({payload:a,protected:n,signature:d},t,i),u={payload:c.payload,protectedHeader:c.protectedHeader};return"function"==typeof t?{...u,key:c.key}:u}},69277:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});let t=e=>Math.floor(e.getTime()/1e3)}},791705:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>i});let t=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,i=e=>{let i,r=t.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let o=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":i=Math.round(o);break;case"minute":case"minutes":case"min":case"mins":case"m":i=Math.round(60*o);break;case"hour":case"hours":case"hr":case"hrs":case"h":i=Math.round(3600*o);break;case"day":case"days":case"d":i=Math.round(86400*o);break;case"week":case"weeks":case"w":i=Math.round(604800*o);break;default:i=Math.round(0x1e187e0*o)}return"-"===r[1]||"ago"===r[4]?-i:i}}},474774:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>d});var r=e.i(83602),o=e.i(969472),s=e.i(69277),n=e.i(791705),a=e.i(811140);let t=e=>e.toLowerCase().replace(/^application\//,""),i=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),d=(e,d,l={})=>{let c,u;try{c=JSON.parse(o.decoder.decode(d))}catch{}if(!(0,a.default)(c))throw new r.JWTInvalid("JWT Claims Set must be a top-level JSON object");let{typ:p}=l;if(p&&("string"!=typeof e.typ||t(e.typ)!==t(p)))throw new r.JWTClaimValidationFailed('unexpected "typ" JWT header value',c,"typ","check_failed");let{requiredClaims:h=[],issuer:m,subject:f,audience:A,maxTokenAge:g}=l,y=[...h];for(let e of(void 0!==g&&y.push("iat"),void 0!==A&&y.push("aud"),void 0!==f&&y.push("sub"),void 0!==m&&y.push("iss"),new Set(y.reverse())))if(!(e in c))throw new r.JWTClaimValidationFailed(`missing required "${e}" claim`,c,e,"missing");if(m&&!(Array.isArray(m)?m:[m]).includes(c.iss))throw new r.JWTClaimValidationFailed('unexpected "iss" claim value',c,"iss","check_failed");if(f&&c.sub!==f)throw new r.JWTClaimValidationFailed('unexpected "sub" claim value',c,"sub","check_failed");if(A&&!i(c.aud,"string"==typeof A?[A]:A))throw new r.JWTClaimValidationFailed('unexpected "aud" claim value',c,"aud","check_failed");switch(typeof l.clockTolerance){case"string":u=(0,n.default)(l.clockTolerance);break;case"number":u=l.clockTolerance;break;case"undefined":u=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:K}=l,w=(0,s.default)(K||new Date);if((void 0!==c.iat||g)&&"number"!=typeof c.iat)throw new r.JWTClaimValidationFailed('"iat" claim must be a number',c,"iat","invalid");if(void 0!==c.nbf){if("number"!=typeof c.nbf)throw new r.JWTClaimValidationFailed('"nbf" claim must be a number',c,"nbf","invalid");if(c.nbf>w+u)throw new r.JWTClaimValidationFailed('"nbf" claim timestamp check failed',c,"nbf","check_failed")}if(void 0!==c.exp){if("number"!=typeof c.exp)throw new r.JWTClaimValidationFailed('"exp" claim must be a number',c,"exp","invalid");if(c.exp<=w-u)throw new r.JWTExpired('"exp" claim timestamp check failed',c,"exp","check_failed")}if(g){let e=w-c.iat;if(e-u>("number"==typeof g?g:(0,n.default)(g)))throw new r.JWTExpired('"iat" claim timestamp check failed (too far in the past)',c,"iat","check_failed");if(e<0-u)throw new r.JWTClaimValidationFailed('"iat" claim timestamp check failed (it should be in the past)',c,"iat","check_failed")}return c}}},108111:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({jwtVerify:()=>n});var r=e.i(576182),o=e.i(474774),s=e.i(83602);async function n(e,t,i){let n=await (0,r.compactVerify)(e,t,i);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new s.JWTInvalid("JWTs MUST NOT use unencoded payload");let a={payload:(0,o.default)(n.protectedHeader,n.payload,i),protectedHeader:n.protectedHeader};return"function"==typeof t?{...a,key:n.key}:a}},233188:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(681635),o=e.i(866098),s=e.i(76569),n=e.i(83602),a=e.i(969472);let t=async(e,t,i)=>{let d;switch(e.protocol){case"https:":d=o.get;break;case"http:":d=r.get;break;default:throw TypeError("Unsupported URL protocol.")}let{agent:l,headers:c}=i,u=d(e.href,{agent:l,timeout:t,headers:c}),[p]=await Promise.race([(0,s.once)(u,"response"),(0,s.once)(u,"timeout")]);if(!p)throw u.destroy(),new n.JWKSTimeout;if(200!==p.statusCode)throw new n.JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");let h=[];for await(let e of p)h.push(e);try{return JSON.parse(a.decoder.decode((0,a.concat)(...h)))}catch{throw new n.JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}}}},35952:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createLocalJWKSet:()=>l});var r=e.i(719878),o=e.i(83602),s=e.i(811140);function n(e){return(0,s.default)(e)}function a(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class t{_jwks;_cached=new WeakMap;constructor(e){if(!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(n)}(e))throw new o.JWKSInvalid("JSON Web Key Set malformed");this._jwks=a(e)}async getKey(e,t){let{alg:i,kid:r}={...e,...t?.header},s=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new o.JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(i),n=this._jwks.keys.filter(e=>{let t=s===e.kty;if(t&&"string"==typeof r&&(t=r===e.kid),t&&"string"==typeof e.alg&&(t=i===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(i){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t}),{0:a,length:l}=n;if(0===l)throw new o.JWKSNoMatchingKey;if(1!==l){let e=new o.JWKSMultipleMatchingKeys,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of n)try{yield await d(t,e,i)}catch{}},e}return d(this._cached,a,i)}}async function d(e,t,i){let s=e.get(t)||e.set(t,{}).get(t);if(void 0===s[i]){let e=await (0,r.importJWK)({...t,ext:!0},i);if(e instanceof Uint8Array||"public"!==e.type)throw new o.JWKSInvalid("JSON Web Key Set members must be public keys");s[i]=e}return s[i]}function l(e){let i=new t(e),r=async(e,t)=>i.getKey(e,t);return Object.defineProperties(r,{jwks:{value:()=>a(i._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}}},398928:e=>{"use strict";var{g:t,__dirname:i}=e;{let t;e.s({createRemoteJWKSet:()=>a,experimental_jwksCache:()=>l,jwksCache:()=>i});var r=e.i(233188),o=e.i(83602),s=e.i(35952),n=e.i(811140);"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(t="jose/v5.10.0");let i=Symbol();class d{_url;_timeoutDuration;_cooldownDuration;_cacheMaxAge;_jwksTimestamp;_pendingFetch;_options;_local;_cache;constructor(e,t){if(!(e instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,t?.[i]!==void 0&&(this._cache=t?.[i],function(e,t){return!("object"!=typeof e||null===e||!("uat"in e)||"number"!=typeof e.uat||Date.now()-e.uat>=t)&&"jwks"in e&&!!(0,n.default)(e.jwks)&&!!Array.isArray(e.jwks.keys)&&!!Array.prototype.every.call(e.jwks.keys,n.default)}(t?.[i],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=(0,s.createLocalJWKSet)(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(i){if(i instanceof o.JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw i}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);let e=new Headers(this._options.headers);t&&!e.has("User-Agent")&&(e.set("User-Agent",t),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||=(0,r.default)(this._url,this._timeoutDuration,this._options).then(e=>{this._local=(0,s.createLocalJWKSet)(e),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e}),await this._pendingFetch}}function a(e,t){let i=new d(e,t),r=async(e,t)=>i.getKey(e,t);return Object.defineProperties(r,{coolingDown:{get:()=>i.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>i.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>i.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!i._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>i._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),r}let l=i}},74222:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createHash:()=>s});var r=e.i(404300),o=e.i(483013);function s(e,t){return{digest:async i=>{let s=new TextEncoder,n="string"==typeof i?s.encode(i):i,a=await r.subtle.digest(e,n);return"hex"===t?Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join(""):"base64"===t||"base64url"===t||"base64urlnopad"===t?t.includes("url")?o.base64Url.encode(a,{padding:"base64urlnopad"!==t}):o.base64.encode(a):a}}}},561336:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({a:()=>p,b:()=>l,c:()=>c,e:()=>t,g:()=>d,r:()=>h,v:()=>u});var r=e.i(483013),o=e.i(137942),s=e.i(108111),n=e.i(692153),a=e.i(74222);async function d(e){let t=await (0,a.createHash)("SHA-256").digest(e);return r.base64Url.encode(new Uint8Array(t),{padding:!1})}function l(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?(0,n.g)(e.expires_in,"sec"):void 0,scopes:e?.scope?"string"==typeof e.scope?e.scope.split(" "):e.scope:[],idToken:e.id_token}}let t=e=>encodeURIComponent(e).replace(/%20/g,"+");async function c({id:e,options:t,authorizationEndpoint:i,state:r,codeVerifier:o,scopes:s,claims:n,redirectURI:a,duration:l,prompt:c,accessType:u,responseType:p,display:h,loginHint:m,hd:f,responseMode:A,additionalParams:g,scopeJoiner:y}){let K=new URL(i);if(K.searchParams.set("response_type",p||"code"),K.searchParams.set("client_id",t.clientId),K.searchParams.set("state",r),K.searchParams.set("scope",s.join(y||" ")),K.searchParams.set("redirect_uri",t.redirectURI||a),l&&K.searchParams.set("duration",l),h&&K.searchParams.set("display",h),m&&K.searchParams.set("login_hint",m),c&&K.searchParams.set("prompt",c),f&&K.searchParams.set("hd",f),u&&K.searchParams.set("access_type",u),A&&K.searchParams.set("response_mode",A),o){let e=await d(o);K.searchParams.set("code_challenge_method","S256"),K.searchParams.set("code_challenge",e)}if(n){let e=n.reduce((e,t)=>(e[t]=null,e),{});K.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...e}}))}return g&&Object.entries(g).forEach(([e,t])=>{K.searchParams.set(e,t)}),K}async function u({code:e,codeVerifier:t,redirectURI:i,options:s,tokenEndpoint:n,authentication:a,deviceId:d,headers:c}){let u=new URLSearchParams,p={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth",...c};if(u.set("grant_type","authorization_code"),u.set("code",e),t&&u.set("code_verifier",t),s.clientKey&&u.set("client_key",s.clientKey),d&&u.set("device_id",d),u.set("redirect_uri",s.redirectURI||i),"basic"===a){let e=r.base64Url.encode(`${s.clientId}:${s.clientSecret}`);p.authorization=`Basic ${e}`}else u.set("client_id",s.clientId),u.set("client_secret",s.clientSecret);let{data:h,error:m}=await (0,o.betterFetch)(n,{method:"POST",body:u,headers:p});if(m)throw m;return l(h)}async function p(e,t){let{data:i,error:r}=await (0,o.betterFetch)(t,{method:"GET",headers:{accept:"application/json","user-agent":"better-auth"}});if(r)throw r;let n=i.keys,a=JSON.parse(atob(e.split(".")[0])),d=n.find(e=>e.kid===a.kid);if(!d)throw Error("Key not found");return await (0,s.jwtVerify)(e,d)}async function h({refreshToken:e,options:t,tokenEndpoint:i,authentication:s,extraParams:n,grantType:a="refresh_token"}){let d=new URLSearchParams,l={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(d.set("grant_type",a),d.set("refresh_token",e),"basic"===s){let e=r.base64Url.encode(`${t.clientId}:${t.clientSecret}`);l.authorization=`Basic ${e}`}else d.set("client_id",t.clientId),d.set("client_secret",t.clientSecret);if(n)for(let[e,t]of Object.entries(n))d.set(e,t);let{data:c,error:u}=await (0,o.betterFetch)(i,{method:"POST",body:d,headers:l});if(u)throw u;let p={accessToken:c.access_token,refreshToken:c.refresh_token,tokenType:c.token_type,scopes:c.scope?.split(" "),idToken:c.id_token};return c.expires_in&&(p.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*c.expires_in)),p}}},492974:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({})},533004:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(492974)},4887:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createRandomStringGenerator:()=>s});var r=e.i(404300);function o(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${e}`)}}function s(...e){let t=e.map(o).join("");if(0===t.length)throw Error("No valid characters provided for random string generation.");let i=t.length;return(e,...s)=>{let n;if(e<=0)throw Error("Length must be a positive integer.");let a=t,d=i;s.length>0&&(d=(a=s.map(o).join("")).length);let l=Math.floor(256/d)*d,c=new Uint8Array(2*e),u=c.length,p="",h=u;for(;p.length<e;)h>=u&&((0,r.getRandomValues)(c),h=0),(n=c[h++])<l&&(p+=a[n%d]);return p}}},382320:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({g:()=>t});let t=(0,e.i(4887).createRandomStringGenerator)("a-z","0-9","A-Z","-_")}},187615:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({a:()=>t,c:()=>n,l:()=>a,s:()=>r});let t=["info","success","warn","error","debug"];function r(e,i){return t.indexOf(i)<=t.indexOf(e)}let i={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m"}},o={info:i.fg.blue,success:i.fg.green,warn:i.fg.yellow,error:i.fg.red,debug:i.fg.magenta},s=(e,t)=>{let r=new Date().toISOString();return`${i.dim}${r}${i.reset} ${o[e]}${e.toUpperCase()}${i.reset} ${i.bright}[Better Auth]:${i.reset} ${t}`},n=e=>{let i=e?.disabled!==!0,o=e?.level??"error",n=(t,n,a=[])=>{if(!i||!r(o,t))return;let d=s(t,n);if(!e||"function"!=typeof e.log)return void("error"===t?console.error(d,...a):"warn"===t?console.warn(d,...a):console.log(d,...a));e.log("success"===t?"info":t,n,...a)};return Object.fromEntries(t.map(e=>[e,(...[t,...i])=>n(e,t,i)]))},a=n()}},30483:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({LANG:()=>f,SocialProviderListEnum:()=>L,apple:()=>t,discord:()=>A,dropbox:()=>N,facebook:()=>g,getApplePublicKey:()=>i,github:()=>y,gitlab:()=>C,google:()=>K,kick:()=>R,linkedin:()=>I,microsoft:()=>w,reddit:()=>O,roblox:()=>S,socialProviderList:()=>D,socialProviders:()=>U,spotify:()=>v,tiktok:()=>x,twitch:()=>b,twitter:()=>_,vk:()=>k,zoom:()=>P});var r=e.i(137942),o=e.i(311556),s=e.i(553871),n=e.i(384239),a=e.i(108111),d=e.i(719878),l=e.i(398928),c=e.i(561336);e.i(74222);var u=e.i(483013);e.i(243917);var p=e.i(81714);e.i(533004),e.i(91997),e.i(382320);var h=e.i(771884),m=e.i(187615);e.i(4887),e.i(692153);let t=e=>({id:"apple",name:"Apple",async createAuthorizationURL({state:t,scopes:i,redirectURI:r}){let o=e.disableDefaultScope?[]:["email","name"];return e.scope&&o.push(...e.scope),i&&o.push(...i),await (0,c.c)({id:"apple",options:e,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:o,state:t,redirectURI:r,responseMode:"form_post"})},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:r})=>(0,c.v)({code:t,codeVerifier:i,redirectURI:r,options:e,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);let{kid:o,alg:s}=(0,n.decodeProtectedHeader)(t);if(!o||!s)return!1;let d=await i(o),{payload:l}=await (0,a.jwtVerify)(t,d,{algorithms:[s],issuer:"https://appleid.apple.com",audience:e.appBundleIdentifier||e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(e=>{void 0!==l[e]&&(l[e]=!!l[e])}),(!r||l.nonce===r)&&!!l},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let i=(0,s.decodeJwt)(t.idToken);if(!i)return null;let r=t.user?`${t.user.name?.firstName} ${t.user.name?.lastName}`:i.name||i.email,o=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:r,emailVerified:!1,email:i.email,...o},data:i}},options:e}),i=async e=>{let{data:t}=await (0,r.betterFetch)("https://appleid.apple.com/auth/keys");if(!t?.keys)throw new o.APIError("BAD_REQUEST",{message:"Keys not found"});let i=t.keys.find(t=>t.kid===e);if(!i)throw Error(`JWK with kid ${e} not found`);return await (0,d.importJWK)(i,i.alg)},A=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:i,redirectURI:r}){let o=e.disableDefaultScope?[]:["identify","email"];return i&&o.push(...i),e.scope&&o.push(...e.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||r)}&state=${t}&prompt=${e.prompt||"none"}`)},validateAuthorizationCode:async({code:t,redirectURI:i})=>(0,c.v)({code:t,redirectURI:i,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(o)return null;if(null===i.avatar){let e="0"===i.discriminator?Number(BigInt(i.id)>>BigInt(22))%6:parseInt(i.discriminator)%5;i.image_url=`https://cdn.discordapp.com/embed/avatars/${e}.png`}else{let e=i.avatar.startsWith("a_")?"gif":"png";i.image_url=`https://cdn.discordapp.com/avatars/${i.id}/${i.avatar}.${e}`}let s=await e.mapProfileToUser?.(i);return{user:{id:i.id,name:i.global_name||i.username||"",email:i.email,emailVerified:i.verified,image:i.image_url,...s},data:i}},options:e}),g=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:i,redirectURI:r,loginHint:o}){let s=e.disableDefaultScope?[]:["email","public_profile"];return e.scope&&s.push(...e.scope),i&&s.push(...i),await (0,c.c)({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:s,state:t,redirectURI:r,loginHint:o,additionalParams:e.configId?{config_id:e.configId}:{}})},validateAuthorizationCode:async({code:t,redirectURI:i})=>(0,c.v)({code:t,redirectURI:i,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(t,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,i);if(t.split(".").length)try{let{payload:r}=await (0,a.jwtVerify)(t,(0,l.createRemoteJWKSet)(new URL("https://www.facebook.com/.well-known/oauth/openid/jwks")),{algorithms:["RS256"],audience:e.clientId,issuer:"https://www.facebook.com"});if(i&&r.nonce!==i)return!1;return!!r}catch(e){return!1}return!0},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(t.idToken){let i=(0,s.decodeJwt)(t.idToken),r={id:i.sub,name:i.name,email:i.email,picture:{data:{url:i.picture,height:100,width:100,is_silhouette:!1}}},o=await e.mapProfileToUser?.({...r,email_verified:!0});return{user:{...r,emailVerified:!0,...o},data:i}}let i=["id","name","email","picture",...e?.fields||[]],{data:o,error:n}=await (0,r.betterFetch)("https://graph.facebook.com/me?fields="+i.join(","),{auth:{type:"Bearer",token:t.accessToken}});if(n)return null;let a=await e.mapProfileToUser?.(o);return{user:{id:o.id,name:o.name,email:o.email,image:o.picture.data.url,emailVerified:o.email_verified,...a},data:o}},options:e}),y=e=>({id:"github",name:"GitHub",createAuthorizationURL({state:t,scopes:i,loginHint:r,redirectURI:o}){let s=e.disableDefaultScope?[]:["read:user","user:email"];return e.scope&&s.push(...e.scope),i&&s.push(...i),(0,c.c)({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:s,state:t,redirectURI:o,loginHint:r})},validateAuthorizationCode:async({code:t,redirectURI:i})=>(0,c.v)({code:t,redirectURI:i,options:e,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://github.com/login/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${t.accessToken}`}});if(o)return null;let{data:s}=await (0,r.betterFetch)("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});!i.email&&s&&(i.email=(s.find(e=>e.primary)??s[0])?.email);let n=s?.find(e=>e.email===i.email)?.verified??!1,a=await e.mapProfileToUser?.(i);return{user:{id:i.id.toString(),name:i.name||i.login,email:i.email,image:i.avatar_url,emailVerified:n,...a},data:i}},options:e}),K=e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:i,codeVerifier:r,redirectURI:o,loginHint:s,display:n}){if(!e.clientId||!e.clientSecret)throw m.l.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new h.B("CLIENT_ID_AND_SECRET_REQUIRED");if(!r)throw new h.B("codeVerifier is required for Google");let a=e.disableDefaultScope?[]:["email","profile","openid"];return e.scope&&a.push(...e.scope),i&&a.push(...i),await (0,c.c)({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:a,state:t,codeVerifier:r,redirectURI:o,prompt:e.prompt,accessType:e.accessType,display:n||e.display,loginHint:s,hd:e.hd})},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:r})=>(0,c.v)({code:t,codeVerifier:i,redirectURI:r,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(t,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,i);let o=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`,{data:s}=await (0,r.betterFetch)(o);return!!s&&s.aud===e.clientId&&("https://accounts.google.com"===s.iss||"accounts.google.com"===s.iss)},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let i=(0,s.decodeJwt)(t.idToken),r=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.name,email:i.email,image:i.picture,emailVerified:i.email_verified,...r},data:i}},options:e}),w=e=>{let t=e.tenantId||"common",i=`https://login.microsoftonline.com/${t}/oauth2/v2.0/authorize`,o=`https://login.microsoftonline.com/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(t){let r=e.disableDefaultScope?[]:["openid","profile","email","User.Read"];return e.scope&&r.push(...e.scope),t.scopes&&r.push(...r),(0,c.c)({id:"microsoft",options:e,authorizationEndpoint:i,state:t.state,codeVerifier:t.codeVerifier,scopes:r,redirectURI:t.redirectURI,prompt:e.prompt})},validateAuthorizationCode:({code:t,codeVerifier:i,redirectURI:r})=>(0,c.v)({code:t,codeVerifier:i,redirectURI:r,options:e,tokenEndpoint:o}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let i=(0,s.decodeJwt)(t.idToken),o=e.profilePhotoSize||48;await (0,r.betterFetch)(`https://graph.microsoft.com/v1.0/me/photos/${o}x${o}/$value`,{headers:{Authorization:`Bearer ${t.accessToken}`},async onResponse(t){if(!e.disableProfilePhoto&&t.response.ok)try{let e=t.response.clone(),r=await e.arrayBuffer(),o=u.base64.encode(r);i.picture=`data:image/jpeg;base64, ${o}`}catch(e){m.l.error(e&&"object"==typeof e&&"name"in e?e.name:"",e)}}});let n=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.name,email:i.email,image:i.picture,emailVerified:!0,...n},data:i}},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:o}),options:e}},v=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:i,codeVerifier:r,redirectURI:o}){let s=e.disableDefaultScope?[]:["user-read-email"];return e.scope&&s.push(...e.scope),i&&s.push(...i),(0,c.c)({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:s,state:t,codeVerifier:r,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:r})=>(0,c.v)({code:t,codeVerifier:i,redirectURI:r,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(o)return null;let s=await e.mapProfileToUser?.(i);return{user:{id:i.id,name:i.display_name,email:i.email,image:i.images[0]?.url,emailVerified:!1,...s},data:i}},options:e}),b=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:i,redirectURI:r}){let o=e.disableDefaultScope?[]:["user:read:email","openid"];return e.scope&&o.push(...e.scope),i&&o.push(...i),(0,c.c)({id:"twitch",redirectURI:r,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:o,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:i})=>(0,c.v)({code:t,redirectURI:i,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let i=t.idToken;if(!i)return m.l.error("No idToken found in token"),null;let r=(0,s.decodeJwt)(i),o=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.preferred_username,email:r.email,image:r.picture,emailVerified:!1,...o},data:r}},options:e}),_=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){let i=e.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return e.scope&&i.push(...e.scope),t.scopes&&i.push(...t.scopes),(0,c.c)({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:i,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:r})=>(0,c.v)({code:t,codeVerifier:i,authentication:"basic",redirectURI:r,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.twitter.com/2/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(o)return null;let{data:s,error:n}=await (0,r.betterFetch)("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});!n&&s?.data?.confirmed_email&&(i.data.email=s.data.confirmed_email);let a=await e.mapProfileToUser?.(i);return{user:{id:i.data.id,name:i.data.name,email:i.data.email||i.data.username||null,image:i.data.profile_image_url,emailVerified:i.data.verified||!1,...a},data:i}},options:e}),N=e=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:t,scopes:i,codeVerifier:r,redirectURI:o})=>{let s=e.disableDefaultScope?[]:["account_info.read"];return e.scope&&s.push(...e.scope),i&&s.push(...i),await (0,c.c)({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:s,state:t,redirectURI:o,codeVerifier:r})},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:r})=>await (0,c.v)({code:t,codeVerifier:i,redirectURI:r,options:e,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`}});if(o)return null;let s=await e.mapProfileToUser?.(i);return{user:{id:i.account_id,name:i.name?.display_name,email:i.email,emailVerified:i.email_verified||!1,image:i.profile_photo_url,...s},data:i}},options:e}),I=e=>{let t="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:t,scopes:i,redirectURI:r,loginHint:o})=>{let s=e.disableDefaultScope?[]:["profile","email","openid"];return e.scope&&s.push(...e.scope),i&&s.push(...i),await (0,c.c)({id:"linkedin",options:e,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:s,state:t,loginHint:o,redirectURI:r})},validateAuthorizationCode:async({code:i,redirectURI:r})=>await (0,c.v)({code:i,redirectURI:r,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async i=>(0,c.r)({refreshToken:i,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(o)return null;let s=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.name,email:i.email,emailVerified:i.email_verified||!1,image:i.picture,...s},data:i}},options:e}},E=(e="")=>e.split("://").map(e=>e.replace(/\/{2,}/g,"/")).join("://"),T=e=>{let t=e||"https://gitlab.com";return{authorizationEndpoint:E(`${t}/oauth/authorize`),tokenEndpoint:E(`${t}/oauth/token`),userinfoEndpoint:E(`${t}/api/v4/user`)}},C=e=>{let{authorizationEndpoint:t,tokenEndpoint:i,userinfoEndpoint:o}=T(e.issuer),s="gitlab";return{id:s,name:"Gitlab",createAuthorizationURL:async({state:i,scopes:r,codeVerifier:o,loginHint:n,redirectURI:a})=>{let d=e.disableDefaultScope?[]:["read_user"];return e.scope&&d.push(...e.scope),r&&d.push(...r),await (0,c.c)({id:s,options:e,authorizationEndpoint:t,scopes:d,state:i,redirectURI:a,codeVerifier:o,loginHint:n})},validateAuthorizationCode:async({code:t,redirectURI:r,codeVerifier:o})=>(0,c.v)({code:t,redirectURI:r,options:e,codeVerifier:o,tokenEndpoint:i}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:s}=await (0,r.betterFetch)(o,{headers:{authorization:`Bearer ${t.accessToken}`}});if(s||"active"!==i.state||i.locked)return null;let n=await e.mapProfileToUser?.(i);return{user:{id:i.id.toString(),name:i.name??i.username,email:i.email,image:i.avatar_url,emailVerified:!0,...n},data:i}},options:e}},x=e=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:t,scopes:i,redirectURI:r}){let o=e.disableDefaultScope?[]:["user.info.profile"];return e.scope&&o.push(...e.scope),i&&o.push(...i),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${o.join(",")}&response_type=code&client_key=${e.clientKey}&client_secret=${e.clientSecret}&redirect_uri=${encodeURIComponent(e.redirectURI||r)}&state=${t}`)},validateAuthorizationCode:async({code:t,redirectURI:i})=>(0,c.v)({code:t,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${t.accessToken}`}});return o?null:{user:{email:i.data.user.email||i.data.user.username,id:i.data.user.open_id,name:i.data.user.display_name||i.data.user.username,image:i.data.user.avatar_large_url,emailVerified:!!i.data.user.email},data:i}},options:e}),O=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:i,redirectURI:r}){let o=e.disableDefaultScope?[]:["identity"];return e.scope&&o.push(...e.scope),i&&o.push(...i),(0,c.c)({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:o,state:t,redirectURI:r,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:i})=>{let o=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||i}),s={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${u.base64.encode(`${e.clientId}:${e.clientSecret}`)}`},{data:n,error:a}=await (0,r.betterFetch)("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:s,body:o.toString()});if(a)throw a;return(0,c.b)(n)},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(o)return null;let s=await e.mapProfileToUser?.(i);return{user:{id:i.id,name:i.name,email:i.oauth_client_id,emailVerified:i.has_verified_email,image:i.icon_img?.split("?")[0],...s},data:i}},options:e}),S=e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:t,scopes:i,redirectURI:r}){let o=e.disableDefaultScope?[]:["openid","profile"];return e.scope&&o.push(...e.scope),i&&o.push(...i),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||r)}&state=${t}&prompt=${e.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:t,redirectURI:i})=>(0,c.v)({code:t,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(o)return null;let s=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.nickname||i.preferred_username||"",image:i.picture,email:i.preferred_username||null,emailVerified:!0,...s},data:{...i}}},options:e});var f=(e=>(e[e.RUS=0]="RUS",e[e.UKR=1]="UKR",e[e.ENG=3]="ENG",e[e.SPA=4]="SPA",e[e.GERMAN=6]="GERMAN",e[e.POL=15]="POL",e[e.FRA=16]="FRA",e[e.TURKEY=82]="TURKEY",e))(f||{});let k=e=>({id:"vk",name:"VK",async createAuthorizationURL({state:t,scopes:i,codeVerifier:r,redirectURI:o}){let s=e.disableDefaultScope?[]:["email","phone"];return e.scope&&s.push(...e.scope),i&&s.push(...i),(0,c.c)({id:"vk",options:e,authorizationEndpoint:"https://id.vk.com/authorize",scopes:s,state:t,redirectURI:o,codeVerifier:r})},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:r,deviceId:o})=>(0,c.v)({code:t,codeVerifier:i,redirectURI:e.redirectURI||r,options:e,deviceId:o,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>(0,c.r)({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;let i=new URLSearchParams({access_token:t.accessToken,client_id:e.clientId}).toString(),{data:o,error:s}=await (0,r.betterFetch)("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(s||!o.user.email)return null;let n=await e.mapProfileToUser?.(o);return{user:{id:o.user.user_id,first_name:o.user.first_name,last_name:o.user.last_name,email:o.user.email,image:o.user.avatar,emailVerified:!!o.user.email,birthday:o.user.birthday,sex:o.user.sex,...n},data:o}},options:e}),R=e=>({id:"kick",name:"Kick",createAuthorizationURL({state:t,scopes:i,redirectURI:r,codeVerifier:o}){let s=e.disableDefaultScope?[]:["user:read"];return e.scope&&s.push(...e.scope),i&&s.push(...i),(0,c.c)({id:"kick",redirectURI:r,options:e,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:s,codeVerifier:o,state:t})},validateAuthorizationCode:async({code:t,redirectURI:i,codeVerifier:r})=>(0,c.v)({code:t,redirectURI:i,options:e,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:r}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await (0,r.betterFetch)("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(o)return null;let s=i.data[0],n=await e.mapProfileToUser?.(s);return{user:{id:s.user_id,name:s.name,email:s.email,image:s.profile_picture,emailVerified:!0,...n},data:s}},options:e}),P=e=>{let t={pkce:!0,...e};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:e,redirectURI:i,codeVerifier:r})=>{let o=new URLSearchParams({response_type:"code",redirect_uri:t.redirectURI?t.redirectURI:i,client_id:t.clientId,state:e});if(t.pkce){let e=await (0,c.g)(r);o.set("code_challenge_method","S256"),o.set("code_challenge",e)}let s=new URL("https://zoom.us/oauth/authorize");return s.search=o.toString(),s},validateAuthorizationCode:async({code:e,redirectURI:i,codeVerifier:r})=>(0,c.v)({code:e,redirectURI:t.redirectURI||i,codeVerifier:r,options:t,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(e){if(t.getUserInfo)return t.getUserInfo(e);let{data:i,error:o}=await (0,r.betterFetch)("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${e.accessToken}`}});if(o)return null;let s=await t.mapProfileToUser?.(i);return{user:{id:i.id,name:i.display_name,image:i.pic_url,email:i.email,emailVerified:!!i.verified,...s},data:{...i}}}}},U={apple:t,discord:A,facebook:g,github:y,microsoft:w,google:K,spotify:v,twitch:b,twitter:_,dropbox:N,kick:R,linkedin:I,gitlab:C,tiktok:x,reddit:O,roblox:S,vk:k,zoom:P},D=Object.keys(U),L=p.z.enum(D,{description:"OAuth2 provider to use"})}},692218:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({g:()=>n,p:()=>a}),e.i(243917);var r=e.i(81714),o=e.i(311556);e.i(74222),e.i(483013),e.i(533004),e.i(91997);var s=e.i(382320);async function n(e,t){let i=e.body?.callbackURL||e.context.options.baseURL;if(!i)throw new o.APIError("BAD_REQUEST",{message:"callbackURL is required"});let r=(0,s.g)(128),n=(0,s.g)(32),a=JSON.stringify({callbackURL:i,codeVerifier:r,errorURL:e.body?.errorCallbackURL,newUserURL:e.body?.newUserCallbackURL,link:t,expiresAt:Date.now()+6e5,requestSignUp:e.body?.requestSignUp}),d=new Date;d.setMinutes(d.getMinutes()+10);let l=await e.context.internalAdapter.createVerificationValue({value:a,identifier:n,expiresAt:d},e);if(!l)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new o.APIError("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:l.identifier,codeVerifier:r}}async function a(e){let t=e.query.state||e.body.state,i=await e.context.internalAdapter.findVerificationValue(t);if(!i)throw e.context.logger.error("State Mismatch. Verification not found",{state:t}),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);let o=r.z.object({callbackURL:r.z.string(),codeVerifier:r.z.string(),errorURL:r.z.string().optional(),newUserURL:r.z.string().optional(),expiresAt:r.z.number(),link:r.z.object({email:r.z.string(),userId:r.z.coerce.string()}).optional(),requestSignUp:r.z.boolean().optional()}).parse(JSON.parse(i.value));if(o.errorURL||(o.errorURL=`${e.context.baseURL}/error`),o.expiresAt<Date.now())throw await e.context.internalAdapter.deleteVerificationValue(i.id),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);return await e.context.internalAdapter.deleteVerificationValue(i.id),o}},628146:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({g:()=>t});var r=e.i(4887);let t=e=>(0,r.createRandomStringGenerator)("a-z","A-Z","0-9")(e||32)}},776569:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({a:()=>t,b:()=>a,c:()=>d,d:()=>l,e:()=>c,f:()=>u,g:()=>n,h:()=>p,i:()=>h,j:()=>m,m:()=>f,p:()=>s,s:()=>A,u:()=>i,v:()=>g}),e.i(243917);var r=e.i(81714),o=e.i(311556);let t=r.z.object({id:r.z.string(),providerId:r.z.string(),accountId:r.z.string(),userId:r.z.coerce.string(),accessToken:r.z.string().nullish(),refreshToken:r.z.string().nullish(),idToken:r.z.string().nullish(),accessTokenExpiresAt:r.z.date().nullish(),refreshTokenExpiresAt:r.z.date().nullish(),scope:r.z.string().nullish(),password:r.z.string().nullish(),createdAt:r.z.date().default(()=>new Date),updatedAt:r.z.date().default(()=>new Date)}),i=r.z.object({id:r.z.string(),email:r.z.string().transform(e=>e.toLowerCase()),emailVerified:r.z.boolean().default(!1),name:r.z.string(),image:r.z.string().nullish(),createdAt:r.z.date().default(()=>new Date),updatedAt:r.z.date().default(()=>new Date)}),A=r.z.object({id:r.z.string(),userId:r.z.coerce.string(),expiresAt:r.z.date(),createdAt:r.z.date().default(()=>new Date),updatedAt:r.z.date().default(()=>new Date),token:r.z.string(),ipAddress:r.z.string().nullish(),userAgent:r.z.string().nullish()}),g=r.z.object({id:r.z.string(),value:r.z.string(),createdAt:r.z.date().default(()=>new Date),updatedAt:r.z.date().default(()=>new Date),expiresAt:r.z.date(),identifier:r.z.string()});function s(e,t){let i=t.fields,r={};for(let t in e){let o=i[t];if(!o){r[t]=e[t];continue}!1!==o.returned&&(r[t]=e[t])}return r}function n(e,t){let i={..."user"===t?e.user?.additionalFields:{},..."session"===t?e.session?.additionalFields:{}};for(let r of e.plugins||[])r.schema&&r.schema[t]&&(i={...i,...r.schema[t].fields});return i}function a(e,t){return s(t,{fields:n(e,"user")})}function d(e,t){return s(t,{fields:n(e,"account")})}function l(e,t){return s(t,{fields:n(e,"session")})}function c(e,t){let i=t.action||"create",r=t.fields,s={};for(let t in r){if(t in e){if(!1===r[t].input){r[t].defaultValue&&(s[t]=r[t].defaultValue);continue}if(r[t].validator?.input&&void 0!==e[t]){s[t]=r[t].validator.input.parse(e[t]);continue}if(r[t].transform?.input&&void 0!==e[t]){s[t]=r[t].transform?.input(e[t]);continue}s[t]=e[t];continue}if(r[t].defaultValue&&"create"===i){s[t]=r[t].defaultValue;continue}if(r[t].required&&"create"===i)throw new o.APIError("BAD_REQUEST",{message:`${t} is required`})}return s}function u(e,t,i){return c(t||{},{fields:n(e,"user"),action:i})}function p(e,t){return c(t||{},{fields:n(e,"user")})}function h(e,t){return c(t,{fields:n(e,"account")})}function m(e,t){return c(t,{fields:n(e,"session")})}function f(e,t){if(!t)return e;for(let i in t){let r=t[i]?.modelName;for(let o in r&&(e[i].modelName=r),e[i].fields){let r=t[i]?.fields?.[o];r&&(e[i].fields[o].fieldName=r)}}return e}}},306192:e=>{"use strict";var{g:t,__dirname:i}=e;{function r(e){if(null===e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.iterator in e)&&(!(Symbol.toStringTag in e)||"[object Module]"===Object.prototype.toString.call(e))}function o(e){return(...t)=>t.reduce((t,i)=>(function e(t,i,o=".",s){if(!r(i))return e(t,{},o,s);let n=Object.assign({},i);for(let i in t){if("__proto__"===i||"constructor"===i)continue;let a=t[i];null!=a&&(s&&s(n,i,a,o)||(Array.isArray(a)&&Array.isArray(n[i])?n[i]=[...a,...n[i]]:r(a)&&r(n[i])?n[i]=e(a,n[i],(o?`${o}.`:"")+i.toString(),s):n[i]=a))}return n})(t,i,"",e),{})}e.s({createDefu:()=>o,default:()=>t,defu:()=>t,defuArrayFn:()=>s,defuFn:()=>i});let t=o(),i=o((e,t,i)=>{if(void 0!==e[t]&&"function"==typeof i)return e[t]=i(e[t]),!0}),s=o((e,t,i)=>{if(Array.isArray(e[t])&&"function"==typeof i)return e[t]=i(e[t]),!0})}},670407:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({FlattenedSign:()=>t});var r=e.i(827210),o=e.i(946625),s=e.i(160955),n=e.i(83602),a=e.i(969472),d=e.i(327859),l=e.i(142056);class t{_payload;_protectedHeader;_unprotectedHeader;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let i;if(!this._protectedHeader&&!this._unprotectedHeader)throw new n.JWSInvalid("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,s.default)(this._protectedHeader,this._unprotectedHeader))throw new n.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let c={...this._protectedHeader,...this._unprotectedHeader},u=(0,l.default)(n.JWSInvalid,new Map([["b64",!0]]),t?.crit,this._protectedHeader,c),p=!0;if(u.has("b64")&&"boolean"!=typeof(p=this._protectedHeader.b64))throw new n.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:h}=c;if("string"!=typeof h||!h)throw new n.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,d.checkKeyTypeWithJwk)(h,e,"sign");let m=this._payload;p&&(m=a.encoder.encode((0,r.encode)(m))),i=this._protectedHeader?a.encoder.encode((0,r.encode)(JSON.stringify(this._protectedHeader))):a.encoder.encode("");let f=(0,a.concat)(i,a.encoder.encode("."),m),A=await (0,o.default)(h,e,f),g={signature:(0,r.encode)(A),payload:""};return p&&(g.payload=a.decoder.decode(m)),this._unprotectedHeader&&(g.header=this._unprotectedHeader),this._protectedHeader&&(g.protected=a.decoder.decode(i)),g}}}},106751:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CompactSign:()=>t});var r=e.i(670407);class t{_flattened;constructor(e){this._flattened=new r.FlattenedSign(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let i=await this._flattened.sign(e,t);if(void 0===i.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${i.protected}.${i.payload}.${i.signature}`}}}},998303:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ProduceJWT:()=>t});var r=e.i(69277),o=e.i(811140),s=e.i(791705);function n(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}class t{_payload;constructor(e={}){if(!(0,o.default)(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:n("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:n("setNotBefore",(0,r.default)(e))}:this._payload={...this._payload,nbf:(0,r.default)(new Date)+(0,s.default)(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:n("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:n("setExpirationTime",(0,r.default)(e))}:this._payload={...this._payload,exp:(0,r.default)(new Date)+(0,s.default)(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:(0,r.default)(new Date)}:e instanceof Date?this._payload={...this._payload,iat:n("setIssuedAt",(0,r.default)(e))}:"string"==typeof e?this._payload={...this._payload,iat:n("setIssuedAt",(0,r.default)(new Date)+(0,s.default)(e))}:this._payload={...this._payload,iat:n("setIssuedAt",e)},this}}}},456787:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SignJWT:()=>t});var r=e.i(106751),o=e.i(83602),s=e.i(969472),n=e.i(998303);class t extends n.ProduceJWT{_protectedHeader;setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){let i=new r.CompactSign(s.encoder.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new o.JWTInvalid("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}}},968915:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({s:()=>o});var r=e.i(456787);async function o(e,t,i=3600){return await new r.SignJWT(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+i).sign(new TextEncoder().encode(t))}},504506:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({binary:()=>i});let t=new Map,i={decode:(e,i="utf-8")=>(t.has(i)||t.set(i,new TextDecoder(i)),t.get(i).decode(e)),encode:new TextEncoder().encode}}},151176:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({A:()=>ei,B:()=>R,C:()=>et,D:()=>ee,E:()=>eo,F:()=>M,G:()=>V,H:()=>k,I:()=>Y,J:()=>J,K:()=>F,L:()=>Q,M:()=>H,N:()=>W,O:()=>L,P:()=>t,a:()=>x,b:()=>P,c:()=>i,d:()=>E,e:()=>I,f:()=>z,g:()=>U,h:()=>T,i:()=>O,j:()=>en,k:()=>ea,l:()=>B,m:()=>eu,n:()=>ec,o:()=>S,p:()=>er,q:()=>ed,r:()=>ep,s:()=>D,t:()=>el,u:()=>X,v:()=>Z,w:()=>N,x:()=>q,y:()=>j,z:()=>G}),e.i(243917);var r=e.i(81714),o=e.i(328902),s=e.i(311556),n=e.i(30483);e.i(4887);var a=e.i(692218),d=e.i(187615),l=e.i(316944),c=e.i(692153),u=e.i(628146);e.i(74222);var p=e.i(483013),h=e.i(108111);e.i(533004),e.i(91997);var m=e.i(382320),f=e.i(776569),A=e.i(105127),g=e.i(558692);e.i(137942),e.i(306192);var y=e.i(968915),K=e.i(664764),w=e.i(83602),v=e.i(504506);let t=(0,s.createMiddleware)(async()=>({})),i=s.createMiddleware.create({use:[t,(0,s.createMiddleware)(async()=>({}))]}),x=s.createEndpoint.create({use:[t]});function b(e){return"-"===e||"^"===e||"$"===e||"+"===e||"."===e||"("===e||")"===e||"|"===e||"["===e||"]"===e||"{"===e||"}"===e||"*"===e||"?"===e||"\\"===e?`\\${e}`:e}function _(e,t){if("string"!=typeof t)throw TypeError(`Sample must be a string, but ${typeof t} given`);return e.test(t)}function N(e,t){if("string"!=typeof e&&!Array.isArray(e))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if(("string"==typeof t||"boolean"==typeof t)&&(t={separator:t}),2==arguments.length&&!(void 0===t||"object"==typeof t&&null!==t&&!Array.isArray(t)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);if("\\"===(t=t||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let i=function e(t,i=!0){if(Array.isArray(t)){let r=t.map(t=>`^${e(t,i)}$`);return`(?:${r.join("|")})`}let r="",o="",s=".";!0===i?(r="/",o="[/\\\\]",s="[^/\\\\]"):i&&((o=function(e){let t="";for(let i=0;i<e.length;i++)t+=b(e[i]);return t}(r=i)).length>1?(o=`(?:${o})`,s=`((?!${o}).)`):s=`[^${o}]`);let n=i?`${o}+?`:"",a=i?`${o}*?`:"",d=i?t.split(r):[t],l="";for(let e=0;e<d.length;e++){let t=d[e],r=d[e+1],o="";if(t||!(e>0)){if(i&&(o=e===d.length-1?a:"**"!==r?n:""),i&&"**"===t){o&&(l+=0===e?"":o,l+=`(?:${s}*?${o})*?`);continue}for(let e=0;e<t.length;e++){let i=t[e];"\\"===i?e<t.length-1&&(l+=b(t[e+1]),e++):"?"===i?l+=s:"*"===i?l+=`${s}*?`:l+=b(i)}l+=o}}return l}(e,t.separator),r=RegExp(`^${i}$`,t.flags),o=_.bind(null,r);return o.options=t,o.pattern=e,o.regexp=r,o}let O=i(async e=>{if(e.request?.method!=="POST"||!e.request)return;let{body:t,query:i,context:r}=e,o=e.headers?.get("origin")||e.headers?.get("referer")||"",n=t?.callbackURL||i?.callbackURL,a=t?.redirectTo,d=t?.errorCallbackURL,l=t?.newUserCallbackURL,c=Array.isArray(r.options.trustedOrigins)?r.trustedOrigins:[...r.trustedOrigins,...await r.options.trustedOrigins?.(e.request)||[]],u=e.headers?.has("cookie"),p=(e,t)=>{if(e.startsWith("/"))return!1;if(t.includes("*"))return N(t)((0,K.b)(e));let i=(0,K.c)(e);return"http:"!==i&&"https:"!==i&&i?e.startsWith(t):t===(0,K.g)(e)},h=(t,i)=>{if(t&&!c.some(e=>p(t,e)||t?.startsWith("/")&&"origin"!==i&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(t)))throw e.context.logger.error(`Invalid ${i}: ${t}`),e.context.logger.info(`If it's a valid URL, please add ${t} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${c}`),new s.APIError("FORBIDDEN",{message:`Invalid ${i}`})};u&&!e.context.options.advanced?.disableCSRFCheck&&h(o,"origin"),n&&h(n,"callbackURL"),a&&h(a,"redirectURL"),d&&h(d,"errorCallbackURL"),l&&h(l,"newUserCallbackURL")}),S=e=>i(async t=>{if(!t.request)return;let{context:i}=t,r=e(t),o=Array.isArray(i.options.trustedOrigins)?i.trustedOrigins:[...i.trustedOrigins,...await i.options.trustedOrigins?.(t.request)||[]],n=(e,t)=>!e.startsWith("/")&&(t.includes("*")?N(t)((0,K.b)(e)):e.startsWith(t)),a=(e,i)=>{if(e&&!o.some(t=>n(e,t)||e?.startsWith("/")&&"origin"!==i&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(e)))throw t.context.logger.error(`Invalid ${i}: ${e}`),t.context.logger.info(`If it's a valid URL, please add ${e} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${o}`),new s.APIError("FORBIDDEN",{message:`Invalid ${i}`})};for(let e of Array.isArray(r)?r:[r])a(e,"callbackURL")}),k={isAction:!1},R={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found"},P=()=>x("/get-session",{method:"GET",query:r.z.optional(r.z.object({disableCookieCache:r.z.optional(r.z.boolean({description:"Disable cookie cache and fetch session from database"}).or(r.z.string().transform(e=>"true"===e))).optional(),disableRefresh:r.z.boolean({description:"Disable session refresh. Useful for checking session status, without updating the session"}).or(r.z.string().transform(e=>"true"===e)).optional()})),requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async e=>{try{let t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)return null;let i=e.getCookie(e.context.authCookies.sessionData.name),r=i?(0,l.s)(v.binary.decode(p.base64.decode(i))):null;if(r&&!await (0,g.createHMAC)("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify({...r.session,expiresAt:r.expiresAt}),r.signature)){let t=e.context.authCookies.sessionData.name;return e.setCookie(t,"",{maxAge:0}),e.json(null)}let s=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(r?.session&&e.context.options.session?.cookieCache?.enabled&&!e.query?.disableCookieCache){let t=r.session;if(!(r.expiresAt<Date.now()||t.session.expiresAt<new Date))return e.json(t);{let t=e.context.authCookies.sessionData.name;e.setCookie(t,"",{maxAge:0})}}let n=await e.context.internalAdapter.findSession(t);if(e.context.session=n,!n||n.session.expiresAt<new Date)return(0,o.deleteSessionCookie)(e),n&&await e.context.internalAdapter.deleteSession(n.session.token),e.json(null);if(s||e.query?.disableRefresh)return e.json(n);let a=e.context.sessionConfig.expiresIn,d=e.context.sessionConfig.updateAge;if(n.session.expiresAt.valueOf()-1e3*a+1e3*d<=Date.now()&&(!e.query?.disableRefresh||!e.context.options.session?.disableSessionRefresh)){let t=await e.context.internalAdapter.updateSession(n.session.token,{expiresAt:(0,c.g)(e.context.sessionConfig.expiresIn,"sec")});if(!t)return(0,o.deleteSessionCookie)(e),e.json(null,{status:401});let i=(t.expiresAt.valueOf()-Date.now())/1e3;return await (0,o.setSessionCookie)(e,{session:t,user:n.user},!1,{maxAge:i}),e.json({session:t,user:n.user})}return await (0,o.setCookieCache)(e,n),e.json(n)}catch(t){throw e.context.logger.error("INTERNAL_SERVER_ERROR",t),new s.APIError("INTERNAL_SERVER_ERROR",{message:R.FAILED_TO_GET_SESSION})}}),U=async(e,t)=>{if(e.context.session)return e.context.session;let i=await P()({...e,asResponse:!1,headers:e.headers,returnHeaders:!1,query:{...t,...e.query}}).catch(e=>null);return e.context.session=i,i},D=i(async e=>{let t=await U(e);if(!t?.session)throw new s.APIError("UNAUTHORIZED");return{session:t}}),L=i(async e=>{let t=await U(e);if(!t?.session&&(e.request||e.headers))throw new s.APIError("UNAUTHORIZED");return{session:t}}),z=i(async e=>{let t=await U(e);if(!t?.session)throw new s.APIError("UNAUTHORIZED");if(0===e.context.sessionConfig.freshAge)return{session:t};let i=e.context.sessionConfig.freshAge,r=t.session.updatedAt?.valueOf()||t.session.createdAt.valueOf();if(!(Date.now()-r<1e3*i))throw new s.APIError("FORBIDDEN",{message:"Session is not fresh"});return{session:t}}),B=()=>x("/list-sessions",{method:"GET",use:[D],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async e=>{try{let t=(await e.context.internalAdapter.listSessions(e.context.session.user.id)).filter(e=>e.expiresAt>new Date);return e.json(t)}catch(t){throw e.context.logger.error(t),e.error("INTERNAL_SERVER_ERROR")}}),j=x("/revoke-session",{method:"POST",body:r.z.object({token:r.z.string({description:"The token to revoke"})}),use:[D],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async e=>{let t=e.body.token,i=await e.context.internalAdapter.findSession(t);if(!i)throw new s.APIError("BAD_REQUEST",{message:"Session not found"});if(i.session.userId!==e.context.session.user.id)throw new s.APIError("UNAUTHORIZED");try{await e.context.internalAdapter.deleteSession(t)}catch(t){throw e.context.logger.error(t&&"object"==typeof t&&"name"in t?t.name:"",t),new s.APIError("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),q=x("/revoke-sessions",{method:"POST",use:[D],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(t){throw e.context.logger.error(t&&"object"==typeof t&&"name"in t?t.name:"",t),new s.APIError("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),Z=x("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[D],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{let t=e.context.session;if(!t.user)throw new s.APIError("UNAUTHORIZED");let i=(await e.context.internalAdapter.listSessions(t.user.id)).filter(e=>e.expiresAt>new Date).filter(t=>t.token!==e.context.session.session.token);return await Promise.all(i.map(t=>e.context.internalAdapter.deleteSession(t.token))),e.json({status:!0})});async function I(e,t,i,r=3600){return await (0,y.s)({email:t.toLowerCase(),updateTo:i},e,r)}async function E(e,t){if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new s.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let i=await I(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${i}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:t,url:r,token:i},e.request)}let M=x("/send-verification-email",{method:"POST",body:r.z.object({email:r.z.string({description:"The email to send the verification email to"}).email(),callbackURL:r.z.string({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async e=>{if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new s.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:t}=e.body,i=await e.context.internalAdapter.findUserByEmail(t);if(!i)throw new s.APIError("BAD_REQUEST",{message:R.USER_NOT_FOUND});return await E(e,i.user),e.json({status:!0})}),V=x("/verify-email",{method:"GET",query:r.z.object({token:r.z.string({description:"The token to verify the email"}),callbackURL:r.z.string({description:"The URL to redirect to after email verification"}).optional()}),use:[S(e=>e.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async e=>{let t;function i(t){if(e.query.callbackURL){if(e.query.callbackURL.includes("?"))throw e.redirect(`${e.query.callbackURL}&error=${t}`);throw e.redirect(`${e.query.callbackURL}?error=${t}`)}throw new s.APIError("UNAUTHORIZED",{message:t})}let{token:n}=e.query;try{t=await (0,h.jwtVerify)(n,new TextEncoder().encode(e.context.secret),{algorithms:["HS256"]})}catch(e){if(e instanceof w.JWTExpired)return i("token_expired");return i("invalid_token")}let a=r.z.object({email:r.z.string().email(),updateTo:r.z.string().optional()}).parse(t.payload),d=await e.context.internalAdapter.findUserByEmail(a.email);if(!d)return i("user_not_found");if(a.updateTo){let t=await U(e);if(!t||t.user.email!==a.email){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return i("unauthorized")}let r=await e.context.internalAdapter.updateUserByEmail(a.email,{email:a.updateTo,emailVerified:!1},e),s=await I(e.context.secret,a.updateTo);if(await e.context.options.emailVerification?.sendVerificationEmail?.({user:r,url:`${e.context.baseURL}/verify-email?token=${s}&callbackURL=${e.query.callbackURL||"/"}`,token:s},e.request),await (0,o.setSessionCookie)(e,{session:t.session,user:{...t.user,email:a.updateTo,emailVerified:!1}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:{id:r.id,email:r.email,name:r.name,image:r.image,emailVerified:r.emailVerified,createdAt:r.createdAt,updatedAt:r.updatedAt}})}if(await e.context.options.emailVerification?.onEmailVerification?.(d.user,e.request),await e.context.internalAdapter.updateUserByEmail(a.email,{emailVerified:!0},e),e.context.options.emailVerification?.autoSignInAfterVerification){let t=await U(e);if(t&&t.user.email===a.email)await (0,o.setSessionCookie)(e,{session:t.session,user:{...t.user,emailVerified:!0}});else{let t=await e.context.internalAdapter.createSession(d.user.id,e);if(!t)throw new s.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await (0,o.setSessionCookie)(e,{session:t,user:{...d.user,emailVerified:!0}})}}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})});async function T(e,{userInfo:t,account:i,callbackURL:r,disableSignUp:o,overrideUserInfo:n}){let a=await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(),i.accountId,i.providerId).catch(t=>{throw d.l.error("Better auth was unable to query your database.\nError: ",t),e.redirect(`${e.context.baseURL}/error?error=internal_server_error`)}),l=a?.user,c=!l;if(a){let r=a.accounts.find(e=>e.providerId===i.providerId);if(r){if(e.context.options.account?.updateAccountOnSignIn!==!1){let t=Object.fromEntries(Object.entries({accessToken:i.accessToken,idToken:i.idToken,refreshToken:i.refreshToken,accessTokenExpiresAt:i.accessTokenExpiresAt,refreshTokenExpiresAt:i.refreshTokenExpiresAt,scope:i.scope}).filter(([e,t])=>void 0!==t));Object.keys(t).length>0&&await e.context.internalAdapter.updateAccount(r.id,t,e)}}else{let r=e.context.options.account?.accountLinking?.trustedProviders;if(!r?.includes(i.providerId)&&!t.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return A.b&&d.l.warn(`User already exist but account isn't linked to ${i.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:i.providerId,accountId:t.id.toString(),userId:a.user.id,accessToken:i.accessToken,idToken:i.idToken,refreshToken:i.refreshToken,accessTokenExpiresAt:i.accessTokenExpiresAt,refreshTokenExpiresAt:i.refreshTokenExpiresAt,scope:i.scope},e)}catch(e){return d.l.error("Unable to link account",e),{error:"unable to link account",data:null}}}if(n){let{id:i,...r}=t;await e.context.internalAdapter.updateUser(a.user.id,{...r,email:t.email.toLowerCase(),emailVerified:t.email.toLowerCase()===a.user.email&&a.user.emailVerified||t.emailVerified})}}else{if(o)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:o,...s}=t;if(l=await e.context.internalAdapter.createOAuthUser({...s,email:t.email.toLowerCase()},{accessToken:i.accessToken,idToken:i.idToken,refreshToken:i.refreshToken,accessTokenExpiresAt:i.accessTokenExpiresAt,refreshTokenExpiresAt:i.refreshTokenExpiresAt,scope:i.scope,providerId:i.providerId,accountId:t.id.toString()},e).then(e=>e?.user),!t.emailVerified&&l&&e.context.options.emailVerification?.sendOnSignUp){let t=await I(e.context.secret,l.email,void 0,e.context.options.emailVerification?.expiresIn),i=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${r}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:l,url:i,token:t},e.request)}}catch(e){if(d.l.error(e),e instanceof s.APIError)return{error:e.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!l)return{error:"unable to create user",data:null,isRegister:!1};let u=await e.context.internalAdapter.createSession(l.id,e);return u?{data:{session:u,user:l},error:null,isRegister:c}:{error:"unable to create session",data:null,isRegister:!1}}let W=x("/sign-in/social",{method:"POST",body:r.z.object({callbackURL:r.z.string({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:r.z.string().optional(),errorCallbackURL:r.z.string({description:"Callback URL to redirect to if an error happens"}).optional(),provider:n.SocialProviderListEnum,disableRedirect:r.z.boolean({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:r.z.optional(r.z.object({token:r.z.string({description:"ID token from the provider"}),nonce:r.z.string({description:"Nonce used to generate the token"}).optional(),accessToken:r.z.string({description:"Access token from the provider"}).optional(),refreshToken:r.z.string({description:"Refresh token from the provider"}).optional(),expiresAt:r.z.number({description:"Expiry date of the token"}).optional()}),{description:"ID token from the provider to sign in the user with id token"}),scopes:r.z.array(r.z.string(),{description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:r.z.boolean({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:r.z.string({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async e=>{let t=e.context.socialProviders.find(t=>t.id===e.body.provider);if(!t)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new s.APIError("NOT_FOUND",{message:R.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!t.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new s.APIError("NOT_FOUND",{message:R.ID_TOKEN_NOT_SUPPORTED});let{token:i,nonce:r}=e.body.idToken;if(!await t.verifyIdToken(i,r))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new s.APIError("UNAUTHORIZED",{message:R.INVALID_TOKEN});let n=await t.getUserInfo({idToken:i,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!n||!n?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new s.APIError("UNAUTHORIZED",{message:R.FAILED_TO_GET_USER_INFO});if(!n.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new s.APIError("UNAUTHORIZED",{message:R.USER_EMAIL_NOT_FOUND});let a=await T(e,{userInfo:{...n.user,email:n.user.email,id:n.user.id,name:n.user.name||"",image:n.user.image,emailVerified:n.user.emailVerified||!1},account:{providerId:t.id,accountId:n.user.id,accessToken:e.body.idToken.accessToken},disableSignUp:t.disableImplicitSignUp&&!e.body.requestSignUp||t.disableSignUp});if(a.error)throw new s.APIError("UNAUTHORIZED",{message:a.error});return await (0,o.setSessionCookie)(e,a.data),e.json({redirect:!1,token:a.data.session.token,url:void 0,user:{id:a.data.user.id,email:a.data.user.email,name:a.data.user.name,image:a.data.user.image,emailVerified:a.data.user.emailVerified,createdAt:a.data.user.createdAt,updatedAt:a.data.user.updatedAt}})}let{codeVerifier:i,state:r}=await (0,a.g)(e),n=await t.createAuthorizationURL({state:r,codeVerifier:i,redirectURI:`${e.context.baseURL}/callback/${t.id}`,scopes:e.body.scopes,loginHint:e.body.loginHint});return e.json({url:n.toString(),redirect:!e.body.disableRedirect})}),F=x("/sign-in/email",{method:"POST",body:r.z.object({email:r.z.string({description:"Email of the user"}),password:r.z.string({description:"Password of the user"}),callbackURL:r.z.string({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:r.z.boolean({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async e=>{if(!e.context.options?.emailAndPassword?.enabled)throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new s.APIError("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:t,password:i}=e.body;if(!r.z.string().email().safeParse(t).success)throw new s.APIError("BAD_REQUEST",{message:R.INVALID_EMAIL});let n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)throw await e.context.password.hash(i),e.context.logger.error("User not found",{email:t}),new s.APIError("UNAUTHORIZED",{message:R.INVALID_EMAIL_OR_PASSWORD});let a=n.accounts.find(e=>"credential"===e.providerId);if(!a)throw e.context.logger.error("Credential account not found",{email:t}),new s.APIError("UNAUTHORIZED",{message:R.INVALID_EMAIL_OR_PASSWORD});let d=a?.password;if(!d)throw e.context.logger.error("Password not found",{email:t}),new s.APIError("UNAUTHORIZED",{message:R.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:d,password:i}))throw e.context.logger.error("Invalid password"),new s.APIError("UNAUTHORIZED",{message:R.INVALID_EMAIL_OR_PASSWORD});if(e.context.options?.emailAndPassword?.requireEmailVerification&&!n.user.emailVerified){if(!e.context.options?.emailVerification?.sendVerificationEmail)throw new s.APIError("FORBIDDEN",{message:R.EMAIL_NOT_VERIFIED});let t=await I(e.context.secret,n.user.email,void 0,e.context.options.emailVerification?.expiresIn),i=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${e.body.callbackURL||"/"}`;throw await e.context.options.emailVerification.sendVerificationEmail({user:n.user,url:i,token:t},e.request),new s.APIError("FORBIDDEN",{message:R.EMAIL_NOT_VERIFIED})}let l=await e.context.internalAdapter.createSession(n.user.id,e,!1===e.body.rememberMe);if(!l)throw e.context.logger.error("Failed to create session"),new s.APIError("UNAUTHORIZED",{message:R.FAILED_TO_CREATE_SESSION});return await (0,o.setSessionCookie)(e,{session:l,user:n.user},!1===e.body.rememberMe),e.json({redirect:!!e.body.callbackURL,token:l.token,url:e.body.callbackURL,user:{id:n.user.id,email:n.user.email,name:n.user.name,image:n.user.image,emailVerified:n.user.emailVerified,createdAt:n.user.createdAt,updatedAt:n.user.updatedAt}})}),$=r.z.object({code:r.z.string().optional(),error:r.z.string().optional(),device_id:r.z.string().optional(),error_description:r.z.string().optional(),state:r.z.string().optional(),user:r.z.string().optional()}),H=x("/callback/:id",{method:["GET","POST"],body:$.optional(),query:$.optional(),metadata:k},async e=>{let t,i,r,s=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;try{if("GET"===e.method)t=$.parse(e.query);else if("POST"===e.method)t=$.parse(e.body);else throw Error("Unsupported method")}catch(t){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",t),e.redirect(`${s}?error=invalid_callback_request`)}let{code:n,error:d,state:c,error_description:u,device_id:p}=t;if(d)throw e.redirect(`${s}?error=${d}&error_description=${u}`);if(!c)throw e.context.logger.error("State not found",d),e.redirect(`${s}?error=state_not_found`);let{codeVerifier:h,callbackURL:m,link:f,errorURL:A,newUserURL:g,requestSignUp:y}=await (0,a.p)(e);function K(t){let i=A||s;throw i=i.includes("?")?`${i}&error=${t}`:`${i}?error=${t}`,e.redirect(i)}if(!n)throw e.context.logger.error("Code not found"),K("no_code");let w=e.context.socialProviders.find(t=>t.id===e.params.id);if(!w)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),K("oauth_provider_not_found");try{i=await w.validateAuthorizationCode({code:n,codeVerifier:h,deviceId:p,redirectURI:`${e.context.baseURL}/callback/${w.id}`})}catch(t){throw e.context.logger.error("",t),K("invalid_code")}let v=await w.getUserInfo({...i,user:e.body?.user?(0,l.s)(e.body.user):void 0}).then(e=>e?.user);if(!v)return e.context.logger.error("Unable to get user info"),K("unable_to_get_user_info");if(!v.email)return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),K("email_not_found");if(!m)throw e.context.logger.error("No callback URL found"),K("no_callback_url");if(f){let t,r=await e.context.internalAdapter.findAccount(v.id);if(r){if(r.userId.toString()!==f.userId.toString())return K("account_already_linked_to_different_user");let t=Object.fromEntries(Object.entries({accessToken:i.accessToken,idToken:i.idToken,refreshToken:i.refreshToken,accessTokenExpiresAt:i.accessTokenExpiresAt,refreshTokenExpiresAt:i.refreshTokenExpiresAt,scope:i.scopes?.join(",")}).filter(([e,t])=>void 0!==t));await e.context.internalAdapter.updateAccount(r.id,t)}else if(!await e.context.internalAdapter.createAccount({userId:f.userId,providerId:w.id,accountId:v.id,...i,scope:i.scopes?.join(",")},e))return K("unable_to_link_account");try{t=m.toString()}catch{t=m}throw e.redirect(t)}let b=await T(e,{userInfo:{...v,email:v.email,name:v.name||v.email},account:{providerId:w.id,accountId:v.id,...i,scope:i.scopes?.join(",")},callbackURL:m,disableSignUp:w.disableImplicitSignUp&&!y||w.options?.disableSignUp,overrideUserInfo:w.options?.overrideUserInfoOnSignIn});if(b.error)return e.context.logger.error(b.error.split(" ").join("_")),K(b.error.split(" ").join("_"));let{session:_,user:N}=b.data;await (0,o.setSessionCookie)(e,{session:_,user:N});try{r=(b.isRegister&&g||m).toString()}catch{r=b.isRegister&&g||m}throw e.redirect(r)}),Q=x("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)throw(0,o.deleteSessionCookie)(e),new s.APIError("BAD_REQUEST",{message:R.FAILED_TO_GET_SESSION});return await e.context.internalAdapter.deleteSession(t),(0,o.deleteSessionCookie)(e),e.json({success:!0})});function C(e,t,i){let r=t?new URL(t,e.baseURL):new URL(`${e.baseURL}/error`);return i&&Object.entries(i).forEach(([e,t])=>r.searchParams.set(e,t)),r.href}let J=x("/forget-password",{method:"POST",body:r.z.object({email:r.z.string({description:"The email address of the user to send a password reset email to"}).email(),redirectTo:r.z.string({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new s.APIError("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:t,redirectTo:i}=e.body,r=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!r)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0});let o=(0,c.g)(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),n=(0,u.g)(24);await e.context.internalAdapter.createVerificationValue({value:r.user.id,identifier:`reset-password:${n}`,expiresAt:o},e);let a=`${e.context.baseURL}/reset-password/${n}?callbackURL=${i}`;return await e.context.options.emailAndPassword.sendResetPassword({user:r.user,url:a,token:n},e.request),e.json({status:!0})}),G=x("/reset-password/:token",{method:"GET",query:r.z.object({callbackURL:r.z.string({description:"The URL to redirect the user to reset their password"})}),use:[S(e=>e.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async e=>{let{token:t}=e.params,{callbackURL:i}=e.query;if(!t||!i)throw e.redirect(C(e.context,i,{error:"INVALID_TOKEN"}));let r=await e.context.internalAdapter.findVerificationValue(`reset-password:${t}`);if(!r||r.expiresAt<new Date)throw e.redirect(C(e.context,i,{error:"INVALID_TOKEN"}));throw e.redirect(function(e,t,i){let r=new URL(t,e.baseURL);return i&&Object.entries(i).forEach(([e,t])=>r.searchParams.set(e,t)),r.href}(e.context,i,{token:t}))}),Y=x("/reset-password",{method:"POST",query:r.z.object({token:r.z.string().optional()}).optional(),body:r.z.object({newPassword:r.z.string({description:"The new password to set"}),token:r.z.string({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let t=e.body.token||e.query?.token;if(!t)throw new s.APIError("BAD_REQUEST",{message:R.INVALID_TOKEN});let{newPassword:i}=e.body,r=e.context.password?.config.minPasswordLength,o=e.context.password?.config.maxPasswordLength;if(i.length<r)throw new s.APIError("BAD_REQUEST",{message:R.PASSWORD_TOO_SHORT});if(i.length>o)throw new s.APIError("BAD_REQUEST",{message:R.PASSWORD_TOO_LONG});let n=`reset-password:${t}`,a=await e.context.internalAdapter.findVerificationValue(n);if(!a||a.expiresAt<new Date)throw new s.APIError("BAD_REQUEST",{message:R.INVALID_TOKEN});let d=a.value,l=await e.context.password.hash(i);return(await e.context.internalAdapter.findAccounts(d)).find(e=>"credential"===e.providerId)?(await e.context.internalAdapter.updatePassword(d,l,e),await e.context.internalAdapter.deleteVerificationValue(a.id),e.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await e.context.internalAdapter.deleteSessions(d)):(await e.context.internalAdapter.createAccount({userId:d,providerId:"credential",password:l,accountId:d},e),await e.context.internalAdapter.deleteVerificationValue(a.id)),e.json({status:!0})}),X=()=>x("/update-user",{method:"POST",body:r.z.record(r.z.string(),r.z.any()),use:[D],metadata:{$Infer:{body:{}},openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the update was successful"}}}}}}}}}},async e=>{let t=e.body;if(t.email)throw new s.APIError("BAD_REQUEST",{message:R.EMAIL_CAN_NOT_BE_UPDATED});let{name:i,image:r,...n}=t,a=e.context.session;if(void 0===r&&void 0===i&&0===Object.keys(n).length)return e.json({status:!0});let d=(0,f.f)(e.context.options,n,"update"),l=await e.context.internalAdapter.updateUser(a.user.id,{name:i,image:r,...d},e);return await (0,o.setSessionCookie)(e,{session:a.session,user:l}),e.json({status:!0})}),ee=x("/change-password",{method:"POST",body:r.z.object({newPassword:r.z.string({description:"The new password to set"}),currentPassword:r.z.string({description:"The current password"}),revokeOtherSessions:r.z.boolean({description:"Revoke all other sessions"}).optional()}),use:[D],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async e=>{let{newPassword:t,currentPassword:i,revokeOtherSessions:r}=e.body,n=e.context.session,a=e.context.password.config.minPasswordLength;if(t.length<a)throw e.context.logger.error("Password is too short"),new s.APIError("BAD_REQUEST",{message:R.PASSWORD_TOO_SHORT});let d=e.context.password.config.maxPasswordLength;if(t.length>d)throw e.context.logger.error("Password is too long"),new s.APIError("BAD_REQUEST",{message:R.PASSWORD_TOO_LONG});let l=(await e.context.internalAdapter.findAccounts(n.user.id)).find(e=>"credential"===e.providerId&&e.password);if(!l||!l.password)throw new s.APIError("BAD_REQUEST",{message:R.CREDENTIAL_ACCOUNT_NOT_FOUND});let c=await e.context.password.hash(t);if(!await e.context.password.verify({hash:l.password,password:i}))throw new s.APIError("BAD_REQUEST",{message:R.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(l.id,{password:c});let u=null;if(r){await e.context.internalAdapter.deleteSessions(n.user.id);let t=await e.context.internalAdapter.createSession(n.user.id,e);if(!t)throw new s.APIError("INTERNAL_SERVER_ERROR",{message:R.FAILED_TO_GET_SESSION});await (0,o.setSessionCookie)(e,{session:t,user:n.user}),u=t.token}return e.json({token:u,user:{id:n.user.id,email:n.user.email,name:n.user.name,image:n.user.image,emailVerified:n.user.emailVerified,createdAt:n.user.createdAt,updatedAt:n.user.updatedAt}})}),et=x("/set-password",{method:"POST",body:r.z.object({newPassword:r.z.string()}),metadata:{SERVER_ONLY:!0},use:[D]},async e=>{let{newPassword:t}=e.body,i=e.context.session,r=e.context.password.config.minPasswordLength;if(t.length<r)throw e.context.logger.error("Password is too short"),new s.APIError("BAD_REQUEST",{message:R.PASSWORD_TOO_SHORT});let o=e.context.password.config.maxPasswordLength;if(t.length>o)throw e.context.logger.error("Password is too long"),new s.APIError("BAD_REQUEST",{message:R.PASSWORD_TOO_LONG});let n=(await e.context.internalAdapter.findAccounts(i.user.id)).find(e=>"credential"===e.providerId&&e.password),a=await e.context.password.hash(t);if(!n)return await e.context.internalAdapter.linkAccount({userId:i.user.id,providerId:"credential",accountId:i.user.id,password:a},e),e.json({status:!0});throw new s.APIError("BAD_REQUEST",{message:"user already has a password"})}),ei=x("/delete-user",{method:"POST",use:[D],body:r.z.object({callbackURL:r.z.string().optional(),password:r.z.string().optional(),token:r.z.string().optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options",{session:e.context.session}),new s.APIError("NOT_FOUND");let t=e.context.session;if(e.body.password){let i=(await e.context.internalAdapter.findAccounts(t.user.id)).find(e=>"credential"===e.providerId&&e.password);if(!i||!i.password)throw new s.APIError("BAD_REQUEST",{message:R.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:i.password,password:e.body.password}))throw new s.APIError("BAD_REQUEST",{message:R.INVALID_PASSWORD})}else if(e.context.options.session?.freshAge){let i=t.session.createdAt.getTime(),r=e.context.options.session.freshAge;if(Date.now()-i>r)throw new s.APIError("BAD_REQUEST",{message:R.SESSION_EXPIRED})}if(e.body.token)return await er({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if(e.context.options.user.deleteUser?.sendDeleteAccountVerification){let i=(0,m.g)(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:t.user.id,identifier:`delete-account-${i}`,expiresAt:new Date(Date.now()+1e3*(e.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))},e);let r=`${e.context.baseURL}/delete-user/callback?token=${i}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:t.user,url:r,token:i},e.request),e.json({success:!0,message:"Verification email sent"})}let i=e.context.options.user.deleteUser?.beforeDelete;i&&await i(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),(0,o.deleteSessionCookie)(e);let r=e.context.options.user.deleteUser?.afterDelete;return r&&await r(t.user,e.request),e.json({success:!0,message:"User deleted"})}),er=x("/delete-user/callback",{method:"GET",query:r.z.object({token:r.z.string(),callbackURL:r.z.string().optional()}),use:[S(e=>e.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new s.APIError("NOT_FOUND");let t=await U(e);if(!t)throw new s.APIError("NOT_FOUND",{message:R.FAILED_TO_GET_USER_INFO});let i=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!i||i.expiresAt<new Date||i.value!==t.user.id)throw new s.APIError("NOT_FOUND",{message:R.INVALID_TOKEN});let r=e.context.options.user.deleteUser?.beforeDelete;r&&await r(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),await e.context.internalAdapter.deleteVerificationValue(i.id),(0,o.deleteSessionCookie)(e);let n=e.context.options.user.deleteUser?.afterDelete;if(n&&await n(t.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})}),eo=x("/change-email",{method:"POST",body:r.z.object({newEmail:r.z.string({description:"The new email to set"}).email(),callbackURL:r.z.string({description:"The URL to redirect to after email verification"}).optional()}),use:[D],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}}}}}},async e=>{if(!e.context.options.user?.changeEmail?.enabled)throw e.context.logger.error("Change email is disabled."),new s.APIError("BAD_REQUEST",{message:"Change email is disabled"});let t=e.body.newEmail.toLowerCase();if(t===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new s.APIError("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(t))throw e.context.logger.error("Email already exists"),new s.APIError("BAD_REQUEST",{message:"Couldn't update your email"});if(!0!==e.context.session.user.emailVerified){if(await e.context.internalAdapter.findUserByEmail(t))throw new s.APIError("UNPROCESSABLE_ENTITY",{message:R.USER_ALREADY_EXISTS});if(await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:t},e),await (0,o.setSessionCookie)(e,{session:e.context.session.session,user:{...e.context.session.user,email:t}}),e.context.options.emailVerification?.sendVerificationEmail){let i=await I(e.context.secret,t,void 0,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${i}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:r,token:i},e.request)}return e.json({status:!0})}if(!e.context.options.user.changeEmail.sendChangeEmailVerification)throw e.context.logger.error("Verification email isn't enabled."),new s.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let i=await I(e.context.secret,e.context.session.user.email,t,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${i}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.changeEmail.sendChangeEmailVerification({user:e.context.session.user,newEmail:t,url:r,token:i},e.request),e.json({status:!0})}),es=(e="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}</span></div>
    </div>
</body>
</html>`,en=x("/error",{method:"GET",metadata:{...k,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async e=>new Response(es(new URL(e.request?.url||"").searchParams.get("error")||"Unknown"),{headers:{"Content-Type":"text/html"}})),ea=x("/ok",{method:"GET",metadata:{...k,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async e=>e.json({ok:!0})),ed=x("/list-accounts",{method:"GET",use:[D],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},provider:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","provider","createdAt","updatedAt","accountId","scopes"]}}}}}}}},async e=>{let t=e.context.session,i=await e.context.internalAdapter.findAccounts(t.user.id);return e.json(i.map(e=>({id:e.id,provider:e.providerId,createdAt:e.createdAt,updatedAt:e.updatedAt,accountId:e.accountId,scopes:e.scope?.split(",")||[]})))}),el=x("/link-social",{method:"POST",requireHeaders:!0,body:r.z.object({callbackURL:r.z.string({description:"The URL to redirect to after the user has signed in"}).optional(),provider:r.z.enum(n.socialProviderList,{description:"The OAuth2 provider to use"}),scopes:r.z.array(r.z.string(),{description:"Additional scopes to request from the provider"}).optional()}),use:[D],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"}},required:["url","redirect"]}}}}}}}},async e=>{let t=e.context.session,i=e.context.socialProviders.find(t=>t.id===e.body.provider);if(!i)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new s.APIError("NOT_FOUND",{message:R.PROVIDER_NOT_FOUND});let r=await (0,a.g)(e,{userId:t.user.id,email:t.user.email}),o=await i.createAuthorizationURL({state:r.state,codeVerifier:r.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${i.id}`,scopes:e.body.scopes});return e.json({url:o.toString(),redirect:!0})}),ec=x("/unlink-account",{method:"POST",body:r.z.object({providerId:r.z.string(),accountId:r.z.string().optional()}),use:[z],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let{providerId:t,accountId:i}=e.body,r=await e.context.internalAdapter.findAccounts(e.context.session.user.id);if(1===r.length&&!e.context.options.account?.accountLinking?.allowUnlinkingAll)throw new s.APIError("BAD_REQUEST",{message:R.FAILED_TO_UNLINK_LAST_ACCOUNT});let o=r.find(e=>i?e.accountId===i&&e.providerId===t:e.providerId===t);if(!o)throw new s.APIError("BAD_REQUEST",{message:R.ACCOUNT_NOT_FOUND});return await e.context.internalAdapter.deleteAccount(o.id),e.json({status:!0})}),eu=x("/get-access-token",{method:"POST",body:r.z.object({providerId:r.z.string({description:"The provider ID for the OAuth provider"}),accountId:r.z.string({description:"The account ID associated with the refresh token"}).optional(),userId:r.z.string({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{let{providerId:t,accountId:i,userId:r}=e.body,o=e.request,a=await U(e);if(o&&!a)throw e.error("UNAUTHORIZED");let d=a?.user?.id||r;if(!d)throw new s.APIError("BAD_REQUEST",{message:"Either userId or session is required"});if(!n.socialProviderList.includes(t))throw new s.APIError("BAD_REQUEST",{message:`Provider ${t} is not supported.`});let l=(await e.context.internalAdapter.findAccounts(d)).find(e=>i?e.id===i&&e.providerId===t:e.providerId===t);if(!l)throw new s.APIError("BAD_REQUEST",{message:"Account not found"});let c=e.context.socialProviders.find(e=>e.id===t);if(!c)throw new s.APIError("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!c.refreshAccessToken)throw new s.APIError("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});try{let t=null;(!l.accessTokenExpiresAt||l.accessTokenExpiresAt.getTime()-Date.now()<5e3)&&(t=await c.refreshAccessToken(l.refreshToken),await e.context.internalAdapter.updateAccount(l.id,{accessToken:t.accessToken,accessTokenExpiresAt:t.accessTokenExpiresAt,refreshToken:t.refreshToken,refreshTokenExpiresAt:t.refreshTokenExpiresAt}));let i={accessToken:t?.accessToken??l.accessToken??void 0,accessTokenExpiresAt:t?.accessTokenExpiresAt??l.accessTokenExpiresAt??void 0,scopes:l.scope?.split(",")??[],idToken:t?.idToken??l.idToken??void 0};return e.json(i)}catch(e){throw new s.APIError("BAD_REQUEST",{message:"Failed to get a valid access token",cause:e})}}),ep=x("/refresh-token",{method:"POST",body:r.z.object({providerId:r.z.string({description:"The provider ID for the OAuth provider"}),accountId:r.z.string({description:"The account ID associated with the refresh token"}).optional(),userId:r.z.string({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{let{providerId:t,accountId:i,userId:r}=e.body,o=e.request,a=await U(e);if(o&&!a)throw e.error("UNAUTHORIZED");let d=a?.user?.id||r;if(!d)throw new s.APIError("BAD_REQUEST",{message:"Either userId or session is required"});if(!n.socialProviderList.includes(t))throw new s.APIError("BAD_REQUEST",{message:`Provider ${t} is not supported.`});let l=(await e.context.internalAdapter.findAccounts(d)).find(e=>i?e.id===i&&e.providerId===t:e.providerId===t);if(!l)throw new s.APIError("BAD_REQUEST",{message:"Account not found"});let c=e.context.socialProviders.find(e=>e.id===t);if(!c)throw new s.APIError("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!c.refreshAccessToken)throw new s.APIError("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});try{let t=await c.refreshAccessToken(l.refreshToken);return await e.context.internalAdapter.updateAccount(l.id,{accessToken:t.accessToken,accessTokenExpiresAt:t.accessTokenExpiresAt,refreshToken:t.refreshToken,refreshTokenExpiresAt:t.refreshTokenExpiresAt}),e.json(t)}catch(e){throw new s.APIError("BAD_REQUEST",{message:"Failed to refresh access token",cause:e})}})}},654520:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({g:()=>o});var r=e.i(105127);function o(e,t){if(t.advanced?.ipAddress?.disableIpTracking)return null;if(r.i)return"127.0.0.1";let i="headers"in e?e.headers:e;for(let e of t.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let t="get"in i?i.get(e):i[e];if("string"==typeof t){var o;let e=t.split(",")[0].trim();if(o=e,/^(\d{1,3}\.){3}\d{1,3}$/.test(o)?o.split(".").map(Number).every(e=>e>=0&&e<=255):/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(o))return e}}return null}},41997:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({getEndpoints:()=>f,router:()=>A,signUpEmail:()=>t});var r=e.i(311556),o=e.i(151176);e.i(243917);var s=e.i(81714),n=e.i(328902),a=e.i(776569),d=e.i(105127),l=e.i(187615),c=e.i(654520),u=e.i(306192);e.i(30483),e.i(137942),e.i(561336),e.i(483013),e.i(692153),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(771884),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506);let t=()=>(0,o.a)("/sign-up/email",{method:"POST",body:s.z.record(s.z.string(),s.z.any()),metadata:{$Infer:{body:{}},openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async e=>{let t;if(!e.context.options.emailAndPassword?.enabled||e.context.options.emailAndPassword?.disableSignUp)throw new r.APIError("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let i=e.body,{name:l,email:c,password:u,image:p,callbackURL:h,...m}=i;if(!s.z.string().email().safeParse(c).success)throw new r.APIError("BAD_REQUEST",{message:o.B.INVALID_EMAIL});let f=e.context.password.config.minPasswordLength;if(u.length<f)throw e.context.logger.error("Password is too short"),new r.APIError("BAD_REQUEST",{message:o.B.PASSWORD_TOO_SHORT});let A=e.context.password.config.maxPasswordLength;if(u.length>A)throw e.context.logger.error("Password is too long"),new r.APIError("BAD_REQUEST",{message:o.B.PASSWORD_TOO_LONG});let g=await e.context.internalAdapter.findUserByEmail(c);if(g?.user)throw e.context.logger.info(`Sign-up attempt for existing email: ${c}`),new r.APIError("UNPROCESSABLE_ENTITY",{message:o.B.USER_ALREADY_EXISTS});let y=(0,a.f)(e.context.options,m),K=await e.context.password.hash(u);try{if(!(t=await e.context.internalAdapter.createUser({email:c.toLowerCase(),name:l,image:p,...y,emailVerified:!1},e)))throw new r.APIError("BAD_REQUEST",{message:o.B.FAILED_TO_CREATE_USER})}catch(t){if(d.b&&e.context.logger.error("Failed to create user",t),t instanceof r.APIError)throw t;throw new r.APIError("UNPROCESSABLE_ENTITY",{message:o.B.FAILED_TO_CREATE_USER,details:t})}if(!t)throw new r.APIError("UNPROCESSABLE_ENTITY",{message:o.B.FAILED_TO_CREATE_USER});if(await e.context.internalAdapter.linkAccount({userId:t.id,providerId:"credential",accountId:t.id,password:K},e),e.context.options.emailVerification?.sendOnSignUp||e.context.options.emailAndPassword.requireEmailVerification){let r=await (0,o.e)(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),s=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${i.callbackURL||"/"}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:t,url:s,token:r},e.request)}if(!1===e.context.options.emailAndPassword.autoSignIn||e.context.options.emailAndPassword.requireEmailVerification)return e.json({token:null,user:{id:t.id,email:t.email,name:t.name,image:t.image,emailVerified:t.emailVerified,createdAt:t.createdAt,updatedAt:t.updatedAt}});let w=await e.context.internalAdapter.createSession(t.id,e);if(!w)throw new r.APIError("BAD_REQUEST",{message:o.B.FAILED_TO_CREATE_SESSION});return await (0,n.setSessionCookie)(e,{session:w,user:t}),e.json({token:w.token,user:{id:t.id,email:t.email,name:t.name,image:t.image,emailVerified:t.emailVerified,createdAt:t.createdAt,updatedAt:t.updatedAt}})}),i=new Map;async function p(e,t){if(!t.rateLimit.enabled)return;let r=new URL(e.url).pathname.replace(t.options.basePath||"/api/auth",""),s=t.rateLimit.window,n=t.rateLimit.max,a=(0,c.g)(e,t.options);if(!a)return;let d=a+r,l=[{pathMatcher:e=>e.startsWith("/sign-in")||e.startsWith("/sign-up")||e.startsWith("/change-password")||e.startsWith("/change-email"),window:10,max:3}].find(e=>e.pathMatcher(r));for(let e of(l&&(s=l.window,n=l.max),t.options.plugins||[]))if(e.rateLimit){let t=e.rateLimit.find(e=>e.pathMatcher(r));if(t){s=t.window,n=t.max;break}}if(t.rateLimit.customRules){let i=Object.keys(t.rateLimit.customRules).find(e=>e.includes("*")?(0,o.w)(e)(r):e===r);if(i){let r=t.rateLimit.customRules[i],o="function"==typeof r?await r(e):r;o&&(s=o.window,n=o.max)}}let u=function(e){if(e.options.rateLimit?.customStorage)return e.options.rateLimit.customStorage;if("secondary-storage"===e.rateLimit.storage)return{get:async t=>{let i=await e.options.secondaryStorage?.get(t);return i?JSON.parse(i):void 0},set:async(t,i)=>{await e.options.secondaryStorage?.set?.(t,JSON.stringify(i))}};if("memory"===e.rateLimit.storage)return{get:async e=>i.get(e),async set(e,t,r){i.set(e,t)}};e.rateLimit.modelName;let t=e.options.rateLimit?.modelName||"rateLimit",r=e.adapter;return{get:async e=>{let i=(await r.findMany({model:t,where:[{field:"key",value:e}]}))[0];return"bigint"==typeof i?.lastRequest&&(i.lastRequest=Number(i.lastRequest)),i},set:async(t,i,o)=>{try{o?await r.updateMany({model:"rateLimit",where:[{field:"key",value:t}],update:{count:i.count,lastRequest:i.lastRequest}}):await r.create({model:"rateLimit",data:{key:t,count:i.count,lastRequest:i.lastRequest}})}catch(t){e.logger.error("Error setting rate limit",t)}}}}(t),p=await u.get(d),h=Date.now();if(p){var m,f,A,g;let e=h-p.lastRequest;if(m=n,f=s,A=p,Date.now()-A.lastRequest<1e3*f&&A.count>=m){return g=Math.ceil((p.lastRequest+1e3*s-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":g.toString()}})}e>1e3*s?await u.set(d,{...p,count:1,lastRequest:h},!0):await u.set(d,{...p,count:p.count+1,lastRequest:h},!0)}else await u.set(d,{key:d,count:1,lastRequest:h})}async function h(e,t){let i={};for(let r of t)if(r.matcher(e)){let t=await r.handler({...e,returnHeaders:!1});if(t&&"object"==typeof t){if("context"in t&&"object"==typeof t.context){let{headers:e,...r}=t.context;e instanceof Headers&&(i.headers?e.forEach((e,t)=>{i.headers?.set(t,e)}):i.headers=e),i=(0,u.default)(r,i);continue}return t}}return{context:i}}async function m(e,t){for(let i of t)if(i.matcher(e)){let t=await i.handler(e).catch(e=>{if(e instanceof r.APIError)return{response:e,headers:e.headers?new Headers(e.headers):null};throw e});t.headers&&t.headers.forEach((t,i)=>{e.context.responseHeaders?"set-cookie"===i.toLowerCase()?e.context.responseHeaders.append(i,t):e.context.responseHeaders.set(i,t):e.context.responseHeaders=new Headers({[i]:t})}),t.response&&(e.context.returned=t.response)}return{response:e.context.returned,headers:e.context.responseHeaders}}function f(e,i){let s=i.plugins?.reduce((e,t)=>({...e,...t.endpoints}),{}),n=i.plugins?.map(t=>t.middlewares?.map(t=>{let i=async i=>t.middleware({...i,context:{...e,...i.context}});return i.options=t.middleware.options,{path:t.path,middleware:i}})).filter(e=>void 0!==e).flat()||[];return{api:function(e,t){let i={};for(let[o,s]of Object.entries(e))i[o]=async e=>{let i=await t,o={...e,context:{...i,returned:void 0,responseHeaders:void 0,session:null},path:s.path,headers:e?.headers?new Headers(e?.headers):void 0},{beforeHooks:n,afterHooks:a}=function(e){let t=e.options.plugins||[],i=[],r=[];e.options.hooks?.before&&i.push({matcher:()=>!0,handler:e.options.hooks.before}),e.options.hooks?.after&&r.push({matcher:()=>!0,handler:e.options.hooks.after});let o=t.map(e=>{if(e.hooks?.before)return e.hooks.before}).filter(e=>void 0!==e).flat(),s=t.map(e=>{if(e.hooks?.after)return e.hooks.after}).filter(e=>void 0!==e).flat();return o.length&&i.push(...o),s.length&&r.push(...s),{beforeHooks:i,afterHooks:r}}(i),d=await h(o,n);if("context"in d&&d.context&&"object"==typeof d.context){let{headers:e,...t}=d.context;e&&e.forEach((e,t)=>{o.headers.set(t,e)}),o=(0,u.default)(t,o)}else if(d)return d;o.asResponse=!1,o.returnHeaders=!0;let l=await s(o).catch(e=>{if(e instanceof r.APIError)return{response:e,headers:e.headers?new Headers(e.headers):null};throw e});o.context.returned=l.response,o.context.responseHeaders=l.headers;let c=await m(o,a);if(c.response&&(l.response=c.response),l.response instanceof r.APIError&&!e?.asResponse)throw l.response;return e?.asResponse?(0,r.toResponse)(l.response,{headers:l.headers}):e?.returnHeaders?{headers:l.headers,response:l.response}:l.response},i[o].path=s.path,i[o].options=s.options;return i}({...{signInSocial:o.N,callbackOAuth:o.M,getSession:(0,o.b)(),signOut:o.L,signUpEmail:t(),signInEmail:o.K,forgetPassword:o.J,resetPassword:o.I,verifyEmail:o.G,sendVerificationEmail:o.F,changeEmail:o.E,changePassword:o.D,setPassword:o.C,updateUser:(0,o.u)(),deleteUser:o.A,forgetPasswordCallback:o.z,listSessions:(0,o.l)(),revokeSession:o.y,revokeSessions:o.x,revokeOtherSessions:o.v,linkSocialAccount:o.t,listUserAccounts:o.q,deleteUserCallback:o.p,unlinkAccount:o.n,refreshToken:o.r,getAccessToken:o.m},...s,ok:o.k,error:o.j},e),middlewares:n}}let A=(e,t)=>{let{api:i,middlewares:s}=f(e,t),n=new URL(e.baseURL).pathname;return(0,r.createRouter)(i,{routerContext:e,openapi:{disabled:!0},basePath:n,routerMiddleware:[{path:"/**",middleware:o.i},...s],async onRequest(t){let i=e.options.disabledPaths||[],r=new URL(t.url).pathname.replace(n,"");if(i.includes(r))return new Response("Not Found",{status:404});for(let i of e.options.plugins||[])if(i.onRequest){let r=await i.onRequest(t,e);if(r&&"response"in r)return r.response}return p(t,e)},async onResponse(t){for(let i of e.options.plugins||[])if(i.onResponse){let r=await i.onResponse(t,e);if(r)return r.response}return t},onError(i){if(i instanceof r.APIError&&"FOUND"===i.status)return;if(t.onAPIError?.throw)throw i;if(t.onAPIError?.onError)return void t.onAPIError.onError(i,e);let o=t.logger?.level,s="error"===o||"warn"===o||"debug"===o?l.l:void 0;if(t.logger?.disabled!==!0){if(i&&"object"==typeof i&&"message"in i&&"string"==typeof i.message&&(i.message.includes("no column")||i.message.includes("column")||i.message.includes("relation")||i.message.includes("table")||i.message.includes("does not exist")))return void e.logger?.error(i.message);i instanceof r.APIError?("INTERNAL_SERVER_ERROR"===i.status&&e.logger.error(i.status,i),s?.error(i.message)):e.logger?.error(i&&"object"==typeof i&&"name"in i?i.name:"",i)}}})}}},277337:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(311556),e.i(151176),e.i(243917),e.i(328902),e.i(776569),e.i(105127),e.i(187615),e.i(654520),e.i(306192),e.i(30483),e.i(137942),e.i(561336),e.i(483013),e.i(692153),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(771884),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506),e.i(41997)},903206:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({crypto:()=>t});var r=e.i(591032);let t=r&&"object"==typeof r&&"webcrypto"in r?r.webcrypto:r&&"object"==typeof r&&"randomBytes"in r?r:void 0}},260823:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({Hash:()=>z,abytes:()=>n,aexists:()=>d,ahash:()=>a,anumber:()=>s,aoutput:()=>l,asyncLoop:()=>v,byteSwap:()=>A,byteSwap32:()=>g,byteSwapIfBE:()=>k,bytesToHex:()=>y,bytesToUtf8:()=>_,checkOpts:()=>T,clean:()=>p,concatBytes:()=>E,createHasher:()=>C,createOptHasher:()=>x,createView:()=>h,createXOFer:()=>O,hexToBytes:()=>w,isBytes:()=>o,isLE:()=>t,kdfInputToBytes:()=>I,nextTick:()=>L,randomBytes:()=>S,rotl:()=>f,rotr:()=>m,swap32IfBE:()=>R,swap8IfBE:()=>i,toBytes:()=>N,u32:()=>u,u8:()=>c,utf8ToBytes:()=>b,wrapConstructor:()=>B,wrapConstructorWithOpts:()=>j,wrapXOFConstructorWithOpts:()=>q});var r=e.i(903206);function o(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function s(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function n(e,...t){if(!o(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function a(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");s(e.outputLen),s(e.blockLen)}function d(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function l(e,t){n(e);let i=t.outputLen;if(e.length<i)throw Error("digestInto() expects output buffer of length at least "+i)}function c(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function u(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function p(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function h(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function m(e,t){return e<<32-t|e>>>t}function f(e,t){return e<<t|e>>>32-t>>>0}let t=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function A(e){return e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255}let i=t?e=>e:e=>A(e),k=i;function g(e){for(let t=0;t<e.length;t++)e[t]=A(e[t]);return e}let R=t?e=>e:g,P="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,U=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function y(e){if(n(e),P)return e.toHex();let t="";for(let i=0;i<e.length;i++)t+=U[e[i]];return t}let D={_0:48,_9:57,A:65,F:70,a:97,f:102};function K(e){return e>=D._0&&e<=D._9?e-D._0:e>=D.A&&e<=D.F?e-(D.A-10):e>=D.a&&e<=D.f?e-(D.a-10):void 0}function w(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(P)return Uint8Array.fromHex(e);let t=e.length,i=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(i);for(let t=0,o=0;t<i;t++,o+=2){let i=K(e.charCodeAt(o)),s=K(e.charCodeAt(o+1));if(void 0===i||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[o]+e[o+1])+'" at index '+o);r[t]=16*i+s}return r}let L=async()=>{};async function v(e,t,i){let r=Date.now();for(let o=0;o<e;o++){i(o);let e=Date.now()-r;e>=0&&e<t||(await L(),r+=e)}}function b(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function _(e){return new TextDecoder().decode(e)}function N(e){return"string"==typeof e&&(e=b(e)),n(e),e}function I(e){return"string"==typeof e&&(e=b(e)),n(e),e}function E(...e){let t=0;for(let i=0;i<e.length;i++){let r=e[i];n(r),t+=r.length}let i=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let o=e[t];i.set(o,r),r+=o.length}return i}function T(e,t){if(void 0!==t&&"[object Object]"!==({}).toString.call(t))throw Error("options should be object or undefined");return Object.assign(e,t)}class z{}function C(e){let t=t=>e().update(N(t)).digest(),i=e();return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=()=>e(),t}function x(e){let t=(t,i)=>e(i).update(N(t)).digest(),i=e({});return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=t=>e(t),t}function O(e){let t=(t,i)=>e(i).update(N(t)).digest(),i=e({});return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=t=>e(t),t}let B=C,j=x,q=O;function S(e=32){if(r.crypto&&"function"==typeof r.crypto.getRandomValues)return r.crypto.getRandomValues(new Uint8Array(e));if(r.crypto&&"function"==typeof r.crypto.randomBytes)return Uint8Array.from(r.crypto.randomBytes(e));throw Error("crypto.getRandomValues must be defined")}}},811674:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({HMAC:()=>t,hmac:()=>i});var r=e.i(260823);class t extends r.Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,(0,r.ahash)(e);let i=(0,r.toBytes)(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(i.length>o?e.create().update(i).digest():i);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),(0,r.clean)(s)}update(e){return(0,r.aexists)(this),this.iHash.update(e),this}digestInto(e){(0,r.aexists)(this),(0,r.abytes)(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:i,finished:r,destroyed:o,blockLen:s,outputLen:n}=this;return e.finished=r,e.destroyed=o,e.blockLen=s,e.outputLen=n,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let i=(e,i,r)=>new t(e,i).update(r).digest();i.create=(e,i)=>new t(e,i)}},843661:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({pbkdf2:()=>a,pbkdf2Async:()=>d});var r=e.i(811674),o=e.i(260823);function s(e,t,i,s){(0,o.ahash)(e);let{c:n,dkLen:a,asyncTick:d}=(0,o.checkOpts)({dkLen:32,asyncTick:10},s);if((0,o.anumber)(n),(0,o.anumber)(a),(0,o.anumber)(d),n<1)throw Error("iterations (c) should be >= 1");let l=(0,o.kdfInputToBytes)(t),c=(0,o.kdfInputToBytes)(i),u=new Uint8Array(a),p=r.hmac.create(e,l),h=p._cloneInto().update(c);return{c:n,dkLen:a,asyncTick:d,DK:u,PRF:p,PRFSalt:h}}function n(e,t,i,r,s){return e.destroy(),t.destroy(),r&&r.destroy(),(0,o.clean)(s),i}function a(e,t,i,r){let a,{c:d,dkLen:l,DK:c,PRF:u,PRFSalt:p}=s(e,t,i,r),h=new Uint8Array(4),m=(0,o.createView)(h),f=new Uint8Array(u.outputLen);for(let e=1,t=0;t<l;e++,t+=u.outputLen){let i=c.subarray(t,t+u.outputLen);m.setInt32(0,e,!1),(a=p._cloneInto(a)).update(h).digestInto(f),i.set(f.subarray(0,i.length));for(let e=1;e<d;e++){u._cloneInto(a).update(f).digestInto(f);for(let e=0;e<i.length;e++)i[e]^=f[e]}}return n(u,p,c,a,f)}async function d(e,t,i,r){let a,{c:d,dkLen:l,asyncTick:c,DK:u,PRF:p,PRFSalt:h}=s(e,t,i,r),m=new Uint8Array(4),f=(0,o.createView)(m),A=new Uint8Array(p.outputLen);for(let e=1,t=0;t<l;e++,t+=p.outputLen){let i=u.subarray(t,t+p.outputLen);f.setInt32(0,e,!1),(a=h._cloneInto(a)).update(m).digestInto(A),i.set(A.subarray(0,i.length)),await (0,o.asyncLoop)(d-1,c,()=>{p._cloneInto(a).update(A).digestInto(A);for(let e=0;e<i.length;e++)i[e]^=A[e]})}return n(p,h,u,a,A)}},929210:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({Chi:()=>s,HashMD:()=>t,Maj:()=>n,SHA224_IV:()=>a,SHA256_IV:()=>i,SHA384_IV:()=>d,SHA512_IV:()=>l,setBigUint64:()=>o});var r=e.i(260823);function o(e,t,i,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,r);let o=BigInt(32),s=BigInt(0xffffffff),n=Number(i>>o&s),a=Number(i&s),d=4*!!r,l=4*!r;e.setUint32(t+d,n,r),e.setUint32(t+l,a,r)}function s(e,t,i){return e&t^~e&i}function n(e,t,i){return e&t^e&i^t&i}class t extends r.Hash{constructor(e,t,i,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=o,this.buffer=new Uint8Array(e),this.view=(0,r.createView)(this.buffer)}update(e){(0,r.aexists)(this),e=(0,r.toBytes)(e),(0,r.abytes)(e);let{view:t,buffer:i,blockLen:o}=this,s=e.length;for(let n=0;n<s;){let a=Math.min(o-this.pos,s-n);if(a===o){let t=(0,r.createView)(e);for(;o<=s-n;n+=o)this.process(t,n);continue}i.set(e.subarray(n,n+a),this.pos),this.pos+=a,n+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,r.aexists)(this),(0,r.aoutput)(e,this),this.finished=!0;let{buffer:t,view:i,blockLen:s,isLE:n}=this,{pos:a}=this;t[a++]=128,(0,r.clean)(this.buffer.subarray(a)),this.padOffset>s-a&&(this.process(i,0),a=0);for(let e=a;e<s;e++)t[e]=0;o(i,s-8,BigInt(8*this.length),n),this.process(i,0);let d=(0,r.createView)(e),l=this.outputLen;if(l%4)throw Error("_sha2: outputLen should be aligned to 32bit");let c=l/4,u=this.get();if(c>u.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)d.setUint32(4*e,u[e],n)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:i,length:r,finished:o,destroyed:s,pos:n}=this;return e.destroyed=s,e.finished=o,e.length=r,e.pos=n,r%t&&e.buffer.set(i),e}clone(){return this._cloneInto()}}let i=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),a=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),d=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),l=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179])}},415748:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({add:()=>s,add3H:()=>w,add3L:()=>K,add4H:()=>b,add4L:()=>v,add5H:()=>N,add5L:()=>_,default:()=>I,fromBig:()=>r,rotlBH:()=>g,rotlBL:()=>y,rotlSH:()=>f,rotlSL:()=>A,rotr32H:()=>h,rotr32L:()=>m,rotrBH:()=>u,rotrBL:()=>p,rotrSH:()=>l,rotrSL:()=>c,shrSH:()=>a,shrSL:()=>d,split:()=>o,toBig:()=>n});let t=BigInt(0x100000000-1),i=BigInt(32);function r(e,o=!1){return o?{h:Number(e&t),l:Number(e>>i&t)}:{h:0|Number(e>>i&t),l:0|Number(e&t)}}function o(e,t=!1){let i=e.length,s=new Uint32Array(i),n=new Uint32Array(i);for(let o=0;o<i;o++){let{h:i,l:a}=r(e[o],t);[s[o],n[o]]=[i,a]}return[s,n]}let n=(e,t)=>BigInt(e>>>0)<<i|BigInt(t>>>0),a=(e,t,i)=>e>>>i,d=(e,t,i)=>e<<32-i|t>>>i,l=(e,t,i)=>e>>>i|t<<32-i,c=(e,t,i)=>e<<32-i|t>>>i,u=(e,t,i)=>e<<64-i|t>>>i-32,p=(e,t,i)=>e>>>i-32|t<<64-i,h=(e,t)=>t,m=(e,t)=>e,f=(e,t,i)=>e<<i|t>>>32-i,A=(e,t,i)=>t<<i|e>>>32-i,g=(e,t,i)=>t<<i-32|e>>>64-i,y=(e,t,i)=>e<<i-32|t>>>64-i;function s(e,t,i,r){let o=(t>>>0)+(r>>>0);return{h:e+i+(o/0x100000000|0)|0,l:0|o}}let K=(e,t,i)=>(e>>>0)+(t>>>0)+(i>>>0),w=(e,t,i,r)=>t+i+r+(e/0x100000000|0)|0,v=(e,t,i,r)=>(e>>>0)+(t>>>0)+(i>>>0)+(r>>>0),b=(e,t,i,r,o)=>t+i+r+o+(e/0x100000000|0)|0,_=(e,t,i,r,o)=>(e>>>0)+(t>>>0)+(i>>>0)+(r>>>0)+(o>>>0),N=(e,t,i,r,o,s)=>t+i+r+o+s+(e/0x100000000|0)|0,I={fromBig:r,split:o,toBig:n,shrSH:a,shrSL:d,rotrSH:l,rotrSL:c,rotrBH:u,rotrBL:p,rotr32H:h,rotr32L:m,rotlSH:f,rotlSL:A,rotlBH:g,rotlBL:y,add:s,add3L:K,add3H:w,add4L:v,add4H:b,add5H:N,add5L:_}}},79100:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SHA224:()=>a,SHA256:()=>n,SHA384:()=>m,SHA512:()=>h,SHA512_224:()=>g,SHA512_256:()=>y,sha224:()=>w,sha256:()=>K,sha384:()=>b,sha512:()=>v,sha512_224:()=>N,sha512_256:()=>_});var r=e.i(929210),o=e.i(415748),s=e.i(260823);let t=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),i=new Uint32Array(64);class n extends r.HashMD{constructor(e=32){super(64,e,8,!1),this.A=0|r.SHA256_IV[0],this.B=0|r.SHA256_IV[1],this.C=0|r.SHA256_IV[2],this.D=0|r.SHA256_IV[3],this.E=0|r.SHA256_IV[4],this.F=0|r.SHA256_IV[5],this.G=0|r.SHA256_IV[6],this.H=0|r.SHA256_IV[7]}get(){let{A:e,B:t,C:i,D:r,E:o,F:s,G:n,H:a}=this;return[e,t,i,r,o,s,n,a]}set(e,t,i,r,o,s,n,a){this.A=0|e,this.B=0|t,this.C=0|i,this.D=0|r,this.E=0|o,this.F=0|s,this.G=0|n,this.H=0|a}process(e,o){for(let t=0;t<16;t++,o+=4)i[t]=e.getUint32(o,!1);for(let e=16;e<64;e++){let t=i[e-15],r=i[e-2],o=(0,s.rotr)(t,7)^(0,s.rotr)(t,18)^t>>>3,n=(0,s.rotr)(r,17)^(0,s.rotr)(r,19)^r>>>10;i[e]=n+i[e-7]+o+i[e-16]|0}let{A:n,B:a,C:d,D:l,E:c,F:u,G:p,H:h}=this;for(let e=0;e<64;e++){let o=h+((0,s.rotr)(c,6)^(0,s.rotr)(c,11)^(0,s.rotr)(c,25))+(0,r.Chi)(c,u,p)+t[e]+i[e]|0,m=((0,s.rotr)(n,2)^(0,s.rotr)(n,13)^(0,s.rotr)(n,22))+(0,r.Maj)(n,a,d)|0;h=p,p=u,u=c,c=l+o|0,l=d,d=a,a=n,n=o+m|0}n=n+this.A|0,a=a+this.B|0,d=d+this.C|0,l=l+this.D|0,c=c+this.E|0,u=u+this.F|0,p=p+this.G|0,h=h+this.H|0,this.set(n,a,d,l,c,u,p,h)}roundClean(){(0,s.clean)(i)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,s.clean)(this.buffer)}}class a extends n{constructor(){super(28),this.A=0|r.SHA224_IV[0],this.B=0|r.SHA224_IV[1],this.C=0|r.SHA224_IV[2],this.D=0|r.SHA224_IV[3],this.E=0|r.SHA224_IV[4],this.F=0|r.SHA224_IV[5],this.G=0|r.SHA224_IV[6],this.H=0|r.SHA224_IV[7]}}let d=(0,o.split)(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),l=d[0],c=d[1],u=new Uint32Array(80),p=new Uint32Array(80);class h extends r.HashMD{constructor(e=64){super(128,e,16,!1),this.Ah=0|r.SHA512_IV[0],this.Al=0|r.SHA512_IV[1],this.Bh=0|r.SHA512_IV[2],this.Bl=0|r.SHA512_IV[3],this.Ch=0|r.SHA512_IV[4],this.Cl=0|r.SHA512_IV[5],this.Dh=0|r.SHA512_IV[6],this.Dl=0|r.SHA512_IV[7],this.Eh=0|r.SHA512_IV[8],this.El=0|r.SHA512_IV[9],this.Fh=0|r.SHA512_IV[10],this.Fl=0|r.SHA512_IV[11],this.Gh=0|r.SHA512_IV[12],this.Gl=0|r.SHA512_IV[13],this.Hh=0|r.SHA512_IV[14],this.Hl=0|r.SHA512_IV[15]}get(){let{Ah:e,Al:t,Bh:i,Bl:r,Ch:o,Cl:s,Dh:n,Dl:a,Eh:d,El:l,Fh:c,Fl:u,Gh:p,Gl:h,Hh:m,Hl:f}=this;return[e,t,i,r,o,s,n,a,d,l,c,u,p,h,m,f]}set(e,t,i,r,o,s,n,a,d,l,c,u,p,h,m,f){this.Ah=0|e,this.Al=0|t,this.Bh=0|i,this.Bl=0|r,this.Ch=0|o,this.Cl=0|s,this.Dh=0|n,this.Dl=0|a,this.Eh=0|d,this.El=0|l,this.Fh=0|c,this.Fl=0|u,this.Gh=0|p,this.Gl=0|h,this.Hh=0|m,this.Hl=0|f}process(e,t){for(let i=0;i<16;i++,t+=4)u[i]=e.getUint32(t),p[i]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|u[e-15],i=0|p[e-15],r=(0,o.rotrSH)(t,i,1)^(0,o.rotrSH)(t,i,8)^(0,o.shrSH)(t,i,7),s=(0,o.rotrSL)(t,i,1)^(0,o.rotrSL)(t,i,8)^(0,o.shrSL)(t,i,7),n=0|u[e-2],a=0|p[e-2],d=(0,o.rotrSH)(n,a,19)^(0,o.rotrBH)(n,a,61)^(0,o.shrSH)(n,a,6),l=(0,o.rotrSL)(n,a,19)^(0,o.rotrBL)(n,a,61)^(0,o.shrSL)(n,a,6),c=(0,o.add4L)(s,l,p[e-7],p[e-16]),h=(0,o.add4H)(c,r,d,u[e-7],u[e-16]);u[e]=0|h,p[e]=0|c}let{Ah:i,Al:r,Bh:s,Bl:n,Ch:a,Cl:d,Dh:h,Dl:m,Eh:f,El:A,Fh:g,Fl:y,Gh:K,Gl:w,Hh:v,Hl:b}=this;for(let e=0;e<80;e++){let t=(0,o.rotrSH)(f,A,14)^(0,o.rotrSH)(f,A,18)^(0,o.rotrBH)(f,A,41),_=(0,o.rotrSL)(f,A,14)^(0,o.rotrSL)(f,A,18)^(0,o.rotrBL)(f,A,41),N=f&g^~f&K,I=A&y^~A&w,E=(0,o.add5L)(b,_,I,c[e],p[e]),T=(0,o.add5H)(E,v,t,N,l[e],u[e]),C=0|E,x=(0,o.rotrSH)(i,r,28)^(0,o.rotrBH)(i,r,34)^(0,o.rotrBH)(i,r,39),O=(0,o.rotrSL)(i,r,28)^(0,o.rotrBL)(i,r,34)^(0,o.rotrBL)(i,r,39),S=i&s^i&a^s&a,k=r&n^r&d^n&d;v=0|K,b=0|w,K=0|g,w=0|y,g=0|f,y=0|A,({h:f,l:A}=(0,o.add)(0|h,0|m,0|T,0|C)),h=0|a,m=0|d,a=0|s,d=0|n,s=0|i,n=0|r;let R=(0,o.add3L)(C,O,k);i=(0,o.add3H)(R,T,x,S),r=0|R}({h:i,l:r}=(0,o.add)(0|this.Ah,0|this.Al,0|i,0|r)),({h:s,l:n}=(0,o.add)(0|this.Bh,0|this.Bl,0|s,0|n)),({h:a,l:d}=(0,o.add)(0|this.Ch,0|this.Cl,0|a,0|d)),({h:h,l:m}=(0,o.add)(0|this.Dh,0|this.Dl,0|h,0|m)),({h:f,l:A}=(0,o.add)(0|this.Eh,0|this.El,0|f,0|A)),({h:g,l:y}=(0,o.add)(0|this.Fh,0|this.Fl,0|g,0|y)),({h:K,l:w}=(0,o.add)(0|this.Gh,0|this.Gl,0|K,0|w)),({h:v,l:b}=(0,o.add)(0|this.Hh,0|this.Hl,0|v,0|b)),this.set(i,r,s,n,a,d,h,m,f,A,g,y,K,w,v,b)}roundClean(){(0,s.clean)(u,p)}destroy(){(0,s.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class m extends h{constructor(){super(48),this.Ah=0|r.SHA384_IV[0],this.Al=0|r.SHA384_IV[1],this.Bh=0|r.SHA384_IV[2],this.Bl=0|r.SHA384_IV[3],this.Ch=0|r.SHA384_IV[4],this.Cl=0|r.SHA384_IV[5],this.Dh=0|r.SHA384_IV[6],this.Dl=0|r.SHA384_IV[7],this.Eh=0|r.SHA384_IV[8],this.El=0|r.SHA384_IV[9],this.Fh=0|r.SHA384_IV[10],this.Fl=0|r.SHA384_IV[11],this.Gh=0|r.SHA384_IV[12],this.Gl=0|r.SHA384_IV[13],this.Hh=0|r.SHA384_IV[14],this.Hl=0|r.SHA384_IV[15]}}let f=Uint32Array.from([0x8c3d37c8,0x19544da2,0x73e19966,0x89dcd4d6,0x1dfab7ae,0x32ff9c82,0x679dd514,0x582f9fcf,0xf6d2b69,0x7bd44da8,0x77e36f73,0x4c48942,0x3f9d85a8,0x6a1d36c8,0x1112e6ad,0x91d692a1]),A=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class g extends h{constructor(){super(28),this.Ah=0|f[0],this.Al=0|f[1],this.Bh=0|f[2],this.Bl=0|f[3],this.Ch=0|f[4],this.Cl=0|f[5],this.Dh=0|f[6],this.Dl=0|f[7],this.Eh=0|f[8],this.El=0|f[9],this.Fh=0|f[10],this.Fl=0|f[11],this.Gh=0|f[12],this.Gl=0|f[13],this.Hh=0|f[14],this.Hl=0|f[15]}}class y extends h{constructor(){super(32),this.Ah=0|A[0],this.Al=0|A[1],this.Bh=0|A[2],this.Bl=0|A[3],this.Ch=0|A[4],this.Cl=0|A[5],this.Dh=0|A[6],this.Dl=0|A[7],this.Eh=0|A[8],this.El=0|A[9],this.Fh=0|A[10],this.Fl=0|A[11],this.Gh=0|A[12],this.Gl=0|A[13],this.Hh=0|A[14],this.Hl=0|A[15]}}let K=(0,s.createHasher)(()=>new n),w=(0,s.createHasher)(()=>new a),v=(0,s.createHasher)(()=>new h),b=(0,s.createHasher)(()=>new m),_=(0,s.createHasher)(()=>new y),N=(0,s.createHasher)(()=>new g)}},917633:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({scrypt:()=>c,scryptAsync:()=>u});var r=e.i(843661),o=e.i(79100),s=e.i(260823);function n(e,t,i,r,o,n){let a=e[t++]^i[r++],d=e[t++]^i[r++],l=e[t++]^i[r++],c=e[t++]^i[r++],u=e[t++]^i[r++],p=e[t++]^i[r++],h=e[t++]^i[r++],m=e[t++]^i[r++],f=e[t++]^i[r++],A=e[t++]^i[r++],g=e[t++]^i[r++],y=e[t++]^i[r++],K=e[t++]^i[r++],w=e[t++]^i[r++],v=e[t++]^i[r++],b=e[t++]^i[r++],_=a,N=d,I=l,E=c,T=u,C=p,x=h,O=m,S=f,k=A,R=g,P=y,U=K,D=w,L=v,z=b;for(let e=0;e<8;e+=2)T^=(0,s.rotl)(_+U|0,7),S^=(0,s.rotl)(T+_|0,9),U^=(0,s.rotl)(S+T|0,13),_^=(0,s.rotl)(U+S|0,18),k^=(0,s.rotl)(C+N|0,7),D^=(0,s.rotl)(k+C|0,9),N^=(0,s.rotl)(D+k|0,13),C^=(0,s.rotl)(N+D|0,18),L^=(0,s.rotl)(R+x|0,7),I^=(0,s.rotl)(L+R|0,9),x^=(0,s.rotl)(I+L|0,13),R^=(0,s.rotl)(x+I|0,18),E^=(0,s.rotl)(z+P|0,7),O^=(0,s.rotl)(E+z|0,9),P^=(0,s.rotl)(O+E|0,13),z^=(0,s.rotl)(P+O|0,18),N^=(0,s.rotl)(_+E|0,7),I^=(0,s.rotl)(N+_|0,9),E^=(0,s.rotl)(I+N|0,13),_^=(0,s.rotl)(E+I|0,18),x^=(0,s.rotl)(C+T|0,7),O^=(0,s.rotl)(x+C|0,9),T^=(0,s.rotl)(O+x|0,13),C^=(0,s.rotl)(T+O|0,18),P^=(0,s.rotl)(R+k|0,7),S^=(0,s.rotl)(P+R|0,9),k^=(0,s.rotl)(S+P|0,13),R^=(0,s.rotl)(k+S|0,18),U^=(0,s.rotl)(z+L|0,7),D^=(0,s.rotl)(U+z|0,9),L^=(0,s.rotl)(D+U|0,13),z^=(0,s.rotl)(L+D|0,18);o[n++]=a+_|0,o[n++]=d+N|0,o[n++]=l+I|0,o[n++]=c+E|0,o[n++]=u+T|0,o[n++]=p+C|0,o[n++]=h+x|0,o[n++]=m+O|0,o[n++]=f+S|0,o[n++]=A+k|0,o[n++]=g+R|0,o[n++]=y+P|0,o[n++]=K+U|0,o[n++]=w+D|0,o[n++]=v+L|0,o[n++]=b+z|0}function a(e,t,i,r,o){let s=r+0,a=r+16*o;for(let r=0;r<16;r++)i[a+r]=e[t+(2*o-1)*16+r];for(let r=0;r<o;r++,s+=16,t+=16)n(i,a,e,t,i,s),r>0&&(a+=16),n(i,s,e,t+=16,i,a)}function d(e,t,i){let{N:n,r:a,p:d,dkLen:l,asyncTick:c,maxmem:u,onProgress:p}=(0,s.checkOpts)({dkLen:32,asyncTick:10,maxmem:0x40000400},i);if((0,s.anumber)(n),(0,s.anumber)(a),(0,s.anumber)(d),(0,s.anumber)(l),(0,s.anumber)(c),(0,s.anumber)(u),void 0!==p&&"function"!=typeof p)throw Error("progressCb should be function");let h=128*a,m=h/4;if(n<=1||(n&n-1)!=0||n>0x100000000)throw Error("Scrypt: N must be larger than 1, a power of 2, and less than 2^32");if(d<0||d>0x1fffffffe0/h)throw Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(l<0||l>0x1fffffffe0)throw Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");if(h*(n+d)>u)throw Error("Scrypt: memused is bigger than maxMem. Expected 128 * r * (N + p) > maxmem of "+u);let f=(0,r.pbkdf2)(o.sha256,e,t,{c:1,dkLen:h*d}),A=(0,s.u32)(f),g=(0,s.u32)(new Uint8Array(h*n)),y=(0,s.u32)(new Uint8Array(h)),K=()=>{};if(p){let e=2*n*d,t=Math.max(Math.floor(e/1e4),1),i=0;K=()=>{i++,p&&(!(i%t)||i===e)&&p(i/e)}}return{N:n,r:a,p:d,dkLen:l,blockSize32:m,V:g,B32:A,B:f,tmp:y,blockMixCb:K,asyncTick:c}}function l(e,t,i,n,a){let d=(0,r.pbkdf2)(o.sha256,e,i,{c:1,dkLen:t});return(0,s.clean)(i,n,a),d}function c(e,t,i){let{N:r,r:o,p:n,dkLen:c,blockSize32:u,V:p,B32:h,B:m,tmp:f,blockMixCb:A}=d(e,t,i);(0,s.swap32IfBE)(h);for(let e=0;e<n;e++){let t=u*e;for(let e=0;e<u;e++)p[e]=h[t+e];for(let e=0,t=0;e<r-1;e++)a(p,t,p,t+=u,o),A();a(p,(r-1)*u,h,t,o),A();for(let e=0;e<r;e++){let e=h[t+u-16]%r;for(let i=0;i<u;i++)f[i]=h[t+i]^p[e*u+i];a(f,0,h,t,o),A()}}return(0,s.swap32IfBE)(h),l(e,c,m,p,f)}async function u(e,t,i){let{N:r,r:o,p:n,dkLen:c,blockSize32:u,V:p,B32:h,B:m,tmp:f,blockMixCb:A,asyncTick:g}=d(e,t,i);(0,s.swap32IfBE)(h);for(let e=0;e<n;e++){let t=u*e;for(let e=0;e<u;e++)p[e]=h[t+e];let i=0;await (0,s.asyncLoop)(r-1,g,()=>{a(p,i,p,i+=u,o),A()}),a(p,(r-1)*u,h,t,o),A(),await (0,s.asyncLoop)(r,g,()=>{let e=h[t+u-16]%r;for(let i=0;i<u;i++)f[i]=h[t+i]^p[e*u+i];a(f,0,h,t,o),A()})}return(0,s.swap32IfBE)(h),l(e,c,m,p,f)}},896775:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({c:()=>a,h:()=>i,v:()=>l});var r=e.i(917633);e.i(533004);var o=e.i(404300),s=e.i(91997),n=e.i(260823);function a(e,t){let i=new Uint8Array(e),r=new Uint8Array(t);if(i.length!==r.length)return!1;let o=0;for(let e=0;e<i.length;e++)o|=i[e]^r[e];return 0===o}let t={N:16384,r:16,p:1,dkLen:64};async function d(e,i){return await (0,r.scryptAsync)(e.normalize("NFKC"),i,{N:t.N,p:t.p,r:t.r,dkLen:t.dkLen,maxmem:128*t.N*t.r*2})}let i=async e=>{let t=s.hex.encode((0,o.getRandomValues)(new Uint8Array(16))),i=await d(e,t);return`${t}:${s.hex.encode(i)}`},l=async({hash:e,password:t})=>{let[i,r]=e.split(":");return a(await d(t,i),(0,n.hexToBytes)(r))}}},955759:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({g:()=>t});let t=e=>{let t=e.plugins?.reduce((e,t)=>{let i=t.schema;if(!i)return e;for(let[t,r]of Object.entries(i))e[t]={fields:{...e[t]?.fields,...r.fields},modelName:r.modelName||t};return e},{}),i=e.rateLimit?.storage==="database",r={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:o,session:s,account:n,...a}=t||{},d={session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...s?.fields,...e.session?.additionalFields},order:2}};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...o?.fields,...e.user?.additionalFields},order:1},...!e.secondaryStorage||e.session?.storeSessionInDatabase?d:{},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...n?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...a,...i?r:{}}}}},535542:e=>{"use strict";var{g:t,__dirname:i}=e;{function r(e){return Array.isArray(e)||s(e)||u(e)?0===e.length:!!e&&0===Object.keys(e).length}function o(e){return void 0===e||void 0===e}function s(e){return"string"==typeof e}function n(e){return"number"==typeof e}function a(e){return"boolean"==typeof e}function d(e){return null===e}function l(e){return e instanceof Date}function c(e){return"bigint"==typeof e}function u(e){return"undefined"!=typeof Buffer&&Buffer.isBuffer(e)}function p(e){return"function"==typeof e}function h(e){return"object"==typeof e&&null!==e}function m(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function f(e){var i;if(!h(e)||"[object Object]"!==(null==(i=e)?void 0===i?"[object Undefined]":"[object Null]":t.call(i)))return!1;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}function A(e){return e[e.length-1]}function g(e){return Object.freeze(e)}function y(e){return w(e)?e:[e]}function K(e){return w(e)?e:g([e])}function w(e){return Array.isArray(e)}function v(e){return e}e.s({asArray:()=>y,asReadonlyArray:()=>K,compare:()=>function e(t,i){var r,o,s,n,a,d;return w(t)&&w(i)?function(t,i){if(t.length!==i.length)return!1;for(let r=0;r<t.length;++r)if(!e(t[r],i[r]))return!1;return!0}(t,i):h(t)&&h(i)?(r=t,o=i,u(r)&&u(o)?(s=r,n=o,0===Buffer.compare(s,n)):l(r)&&l(o)?(a=r,d=o,a.getTime()===d.getTime()):function(t,i){let r=Object.keys(t),o=Object.keys(i);if(r.length!==o.length)return!1;for(let o of r)if(!e(t[o],i[o]))return!1;return!0}(r,o)):t===i},freeze:()=>g,getLast:()=>A,isArrayBufferOrView:()=>m,isBigInt:()=>c,isBoolean:()=>a,isBuffer:()=>u,isDate:()=>l,isEmpty:()=>r,isFunction:()=>p,isNull:()=>d,isNumber:()=>n,isObject:()=>h,isPlainObject:()=>f,isReadonlyArray:()=>w,isString:()=>s,isUndefined:()=>o,noop:()=>v});let t=Object.prototype.toString}},255757:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AlterTableNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"AlterTableNode"===e.kind,create:e=>(0,r.freeze)({kind:"AlterTableNode",table:e}),cloneWithTableProps:(e,t)=>(0,r.freeze)({...e,...t}),cloneWithColumnAlteration:(e,t)=>(0,r.freeze)({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,t]:[t]})})}},453409:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({IdentifierNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"IdentifierNode"===e.kind,create:e=>(0,r.freeze)({kind:"IdentifierNode",name:e})})}},600702:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateIndexNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"CreateIndexNode"===e.kind,create:e=>(0,r.freeze)({kind:"CreateIndexNode",name:o.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t}),cloneWithColumns:(e,t)=>(0,r.freeze)({...e,columns:[...e.columns||[],...t]})})}},967753:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateSchemaNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"CreateSchemaNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"CreateSchemaNode",schema:o.IdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},441524:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateTableNode:()=>i,ON_COMMIT_ACTIONS:()=>t});var r=e.i(535542);let t=["preserve rows","delete rows","drop"],i=(0,r.freeze)({is:e=>"CreateTableNode"===e.kind,create:e=>(0,r.freeze)({kind:"CreateTableNode",table:e,columns:(0,r.freeze)([])}),cloneWithColumn:(e,t)=>(0,r.freeze)({...e,columns:(0,r.freeze)([...e.columns,t])}),cloneWithConstraint:(e,t)=>(0,r.freeze)({...e,constraints:e.constraints?(0,r.freeze)([...e.constraints,t]):(0,r.freeze)([t])}),cloneWithFrontModifier:(e,t)=>(0,r.freeze)({...e,frontModifiers:e.frontModifiers?(0,r.freeze)([...e.frontModifiers,t]):(0,r.freeze)([t])}),cloneWithEndModifier:(e,t)=>(0,r.freeze)({...e,endModifiers:e.endModifiers?(0,r.freeze)([...e.endModifiers,t]):(0,r.freeze)([t])}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},318106:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SchemableIdentifierNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>(0,r.freeze)({kind:"SchemableIdentifierNode",identifier:o.IdentifierNode.create(e)}),createWithSchema:(e,t)=>(0,r.freeze)({kind:"SchemableIdentifierNode",schema:o.IdentifierNode.create(e),identifier:o.IdentifierNode.create(t)})})}},197823:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropIndexNode:()=>t});var r=e.i(535542),o=e.i(318106);let t=(0,r.freeze)({is:e=>"DropIndexNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"DropIndexNode",name:o.SchemableIdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},659886:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropSchemaNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"DropSchemaNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"DropSchemaNode",schema:o.IdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},526511:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropTableNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"DropTableNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"DropTableNode",table:e,...t}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},55167:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AliasNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"AliasNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"AliasNode",node:e,alias:t})})}},164563:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({TableNode:()=>t});var r=e.i(535542),o=e.i(318106);let t=(0,r.freeze)({is:e=>"TableNode"===e.kind,create:e=>(0,r.freeze)({kind:"TableNode",table:o.SchemableIdentifierNode.create(e)}),createWithSchema:(e,t)=>(0,r.freeze)({kind:"TableNode",table:o.SchemableIdentifierNode.createWithSchema(e,t)})})}},131385:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({isOperationNodeSource:()=>o});var r=e.i(535542);function o(e){return(0,r.isObject)(e)&&(0,r.isFunction)(e.toOperationNode)}},189293:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({isAliasedExpression:()=>n,isExpression:()=>s});var r=e.i(131385),o=e.i(535542);function s(e){return(0,o.isObject)(e)&&"expressionType"in e&&(0,r.isOperationNodeSource)(e)}function n(e){return(0,o.isObject)(e)&&"expression"in e&&(0,o.isString)(e.alias)&&(0,r.isOperationNodeSource)(e)}},720446:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SelectModifierNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"SelectModifierNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"SelectModifierNode",modifier:e,of:t}),createWithExpression:e=>(0,r.freeze)({kind:"SelectModifierNode",rawModifier:e})})}},79045:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AndNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"AndNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"AndNode",left:e,right:t})})}},117792:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OrNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"OrNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"OrNode",left:e,right:t})})}},629306:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OnNode:()=>t});var r=e.i(535542),o=e.i(79045),s=e.i(117792);let t=(0,r.freeze)({is:e=>"OnNode"===e.kind,create:e=>(0,r.freeze)({kind:"OnNode",on:e}),cloneWithOperation:(e,t,i)=>(0,r.freeze)({...e,on:"And"===t?o.AndNode.create(e.on,i):s.OrNode.create(e.on,i)})})}},682152:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({JoinNode:()=>t});var r=e.i(535542),o=e.i(629306);let t=(0,r.freeze)({is:e=>"JoinNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,i)=>(0,r.freeze)({kind:"JoinNode",joinType:e,table:t,on:o.OnNode.create(i)}),cloneWithOn:(e,t)=>(0,r.freeze)({...e,on:e.on?o.OnNode.cloneWithOperation(e.on,"And",t):o.OnNode.create(t)})})}},545090:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({BinaryOperationNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,i)=>(0,r.freeze)({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:i})})}},268375:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ARITHMETIC_OPERATORS:()=>i,BINARY_OPERATORS:()=>c,COMPARISON_OPERATORS:()=>t,JSON_OPERATORS:()=>l,OPERATORS:()=>h,OperatorNode:()=>m,UNARY_FILTER_OPERATORS:()=>u,UNARY_OPERATORS:()=>p,isArithmeticOperator:()=>a,isBinaryOperator:()=>s,isComparisonOperator:()=>n,isJSONOperator:()=>d,isOperator:()=>o});var r=e.i(535542);let t=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],i=["+","-","*","/","%","^","&","|","#","<<",">>"],l=["->","->>"],c=[...t,...i,"&&","||"],u=["exists","not exists"],p=["not","-",...u],h=[...c,...l,...p,"between","between symmetric"],m=(0,r.freeze)({is:e=>"OperatorNode"===e.kind,create:e=>(0,r.freeze)({kind:"OperatorNode",operator:e})});function o(e){return(0,r.isString)(e)&&h.includes(e)}function s(e){return(0,r.isString)(e)&&c.includes(e)}function n(e){return(0,r.isString)(e)&&t.includes(e)}function a(e){return(0,r.isString)(e)&&i.includes(e)}function d(e){return(0,r.isString)(e)&&l.includes(e)}}},326892:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ColumnNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"ColumnNode"===e.kind,create:e=>(0,r.freeze)({kind:"ColumnNode",column:o.IdentifierNode.create(e)})})}},17318:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SelectAllNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"SelectAllNode"===e.kind,create:()=>(0,r.freeze)({kind:"SelectAllNode"})})}},557027:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ReferenceNode:()=>t});var r=e.i(17318),o=e.i(535542);let t=(0,o.freeze)({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>(0,o.freeze)({kind:"ReferenceNode",table:t,column:e}),createSelectAll:e=>(0,o.freeze)({kind:"ReferenceNode",table:e,column:r.SelectAllNode.create()})})}},302061:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DynamicReferenceBuilder:()=>t,isDynamicReferenceBuilder:()=>n});var r=e.i(131385),o=e.i(927766),s=e.i(535542);class t{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return(0,o.parseSimpleReferenceExpression)(this.#e)}}function n(e){return(0,s.isObject)(e)&&(0,r.isOperationNodeSource)(e)&&(0,s.isString)(e.dynamicReference)}}},697875:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OrderByItemNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"OrderByItemNode",orderBy:e,direction:t}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},620581:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({RawNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"RawNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"RawNode",sqlFragments:(0,r.freeze)(e),parameters:(0,r.freeze)(t)}),createWithSql:e=>t.create([e],[]),createWithChild:e=>t.create(["",""],[e]),createWithChildren:e=>t.create(Array(e.length+1).fill(""),e)})}},318349:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CollateNode:()=>t});var r=e.i(535542),o=e.i(453409);let t={is:e=>"CollateNode"===e.kind,create:e=>(0,r.freeze)({kind:"CollateNode",collation:o.IdentifierNode.create(e)})}}},200691:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OrderByItemBuilder:()=>t});var r=e.i(318349),o=e.i(697875),s=e.i(620581),n=e.i(535542);class t{#t;constructor(e){this.#t=(0,n.freeze)(e)}desc(){return new t({node:o.OrderByItemNode.cloneWith(this.#t.node,{direction:s.RawNode.createWithSql("desc")})})}asc(){return new t({node:o.OrderByItemNode.cloneWith(this.#t.node,{direction:s.RawNode.createWithSql("asc")})})}nullsLast(){return new t({node:o.OrderByItemNode.cloneWith(this.#t.node,{nulls:"last"})})}nullsFirst(){return new t({node:o.OrderByItemNode.cloneWith(this.#t.node,{nulls:"first"})})}collate(e){return new t({node:o.OrderByItemNode.cloneWith(this.#t.node,{collation:r.CollateNode.create(e)})})}toOperationNode(){return this.#t.node}}}},57239:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({logOnce:()=>r});let t=new Set;function r(e){t.has(e)||(t.add(e),console.log(e))}}},534650:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({isOrderByDirection:()=>u,parseOrderBy:()=>p,parseOrderByItem:()=>h});var r=e.i(302061),o=e.i(189293),s=e.i(697875),n=e.i(620581),a=e.i(200691),d=e.i(57239),l=e.i(627710),c=e.i(927766);function u(e){return"asc"===e||"desc"===e}function p(e){if(2===e.length)return[h(e[0],e[1])];if(1===e.length){let[t]=e;return Array.isArray(t)?((0,d.logOnce)("orderBy(array) is deprecated, use multiple orderBy calls instead."),t.map(e=>h(e))):[h(t)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function h(e,t){let i=function(e){if((0,l.isExpressionOrFactory)(e))return(0,l.parseExpression)(e);if((0,r.isDynamicReferenceBuilder)(e))return e.toOperationNode();let[t,i]=e.split(" ");return i?((0,d.logOnce)("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),m((0,c.parseStringReference)(t),i)):(0,c.parseStringReference)(e)}(e);if(s.OrderByItemNode.is(i)){if(t)throw Error("Cannot specify direction twice!");return i}return m(i,t)}function m(e,t){if("string"==typeof t){if(!u(t))throw Error(`Invalid order by direction: ${t}`);return s.OrderByItemNode.create(e,n.RawNode.createWithSql(t))}if((0,o.isExpression)(t))return(0,d.logOnce)("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),s.OrderByItemNode.create(e,t.toOperationNode());let i=s.OrderByItemNode.create(e);return t?t(new a.OrderByItemBuilder({node:i})).toOperationNode():i}},211245:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({JSONReferenceNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"JSONReferenceNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"JSONReferenceNode",reference:e,traversal:t}),cloneWithTraversal:(e,t)=>(0,r.freeze)({...e,traversal:t})})}},781094:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({JSONOperatorChainNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"JSONOperatorChainNode"===e.kind,create:e=>(0,r.freeze)({kind:"JSONOperatorChainNode",operator:e,values:(0,r.freeze)([])}),cloneWithValue:(e,t)=>(0,r.freeze)({...e,values:(0,r.freeze)([...e.values,t])})})}},731213:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({JSONPathNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"JSONPathNode"===e.kind,create:e=>(0,r.freeze)({kind:"JSONPathNode",inOperator:e,pathLegs:(0,r.freeze)([])}),cloneWithLeg:(e,t)=>(0,r.freeze)({...e,pathLegs:(0,r.freeze)([...e.pathLegs,t])})})}},927766:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseAliasedStringReference:()=>w,parseColumnName:()=>v,parseJSONReference:()=>y,parseOrderedColumnName:()=>b,parseReferenceExpression:()=>g,parseReferenceExpressionOrList:()=>A,parseSimpleReferenceExpression:()=>f,parseStringReference:()=>K});var r=e.i(55167),o=e.i(326892),s=e.i(557027),n=e.i(164563),a=e.i(535542),d=e.i(627710),l=e.i(453409),c=e.i(534650),u=e.i(268375),p=e.i(211245),h=e.i(781094),m=e.i(731213);function f(e){return(0,a.isString)(e)?K(e):e.toOperationNode()}function A(e){return(0,a.isReadonlyArray)(e)?e.map(e=>g(e)):[g(e)]}function g(e){return(0,d.isExpressionOrFactory)(e)?(0,d.parseExpression)(e):f(e)}function y(e,t){let i=K(e);if((0,u.isJSONOperator)(t))return p.JSONReferenceNode.create(i,h.JSONOperatorChainNode.create(u.OperatorNode.create(t)));let r=t.slice(0,-1);if((0,u.isJSONOperator)(r))return p.JSONReferenceNode.create(i,m.JSONPathNode.create(u.OperatorNode.create(r)));throw Error(`Invalid JSON operator: ${t}`)}function K(e){if(!e.includes("."))return s.ReferenceNode.create(o.ColumnNode.create(e));let t=e.split(".").map(_);if(3===t.length){var i=t;let[e,r,a]=i;return s.ReferenceNode.create(o.ColumnNode.create(a),n.TableNode.createWithSchema(e,r))}if(2===t.length){var r=t;let[e,i]=r;return s.ReferenceNode.create(o.ColumnNode.create(i),n.TableNode.create(e))}throw Error(`invalid column reference ${e}`)}function w(e){let t=" as ";if(!e.includes(t))return K(e);{let[i,o]=e.split(t).map(_);return r.AliasNode.create(K(i),l.IdentifierNode.create(o))}}function v(e){return o.ColumnNode.create(e)}function b(e){if(!e.includes(" "))return v(e);{let[t,i]=e.split(" ").map(_);if(!(0,c.isOrderByDirection)(i))throw Error(`invalid order direction "${i}" next to "${t}"`);return(0,c.parseOrderBy)([t,i])[0]}}function _(e){return e.trim()}},734906:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PrimitiveValueListNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>(0,r.freeze)({kind:"PrimitiveValueListNode",values:(0,r.freeze)([...e])})})}},697622:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ValueListNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ValueListNode"===e.kind,create:e=>(0,r.freeze)({kind:"ValueListNode",values:(0,r.freeze)(e)})})}},21348:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ValueNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ValueNode"===e.kind,create:e=>(0,r.freeze)({kind:"ValueNode",value:e}),createImmediate:e=>(0,r.freeze)({kind:"ValueNode",value:e,immediate:!0})})}},374697:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({isSafeImmediateValue:()=>c,parseSafeImmediateValue:()=>u,parseValueExpression:()=>l,parseValueExpressionOrList:()=>d});var r=e.i(734906),o=e.i(697622),s=e.i(21348),n=e.i(535542),a=e.i(627710);function d(e){var t;return(0,n.isReadonlyArray)(e)?(t=e).some(a.isExpressionOrFactory)?o.ValueListNode.create(t.map(e=>l(e))):r.PrimitiveValueListNode.create(t):l(e)}function l(e){return(0,a.isExpressionOrFactory)(e)?(0,a.parseExpression)(e):s.ValueNode.create(e)}function c(e){return(0,n.isNumber)(e)||(0,n.isBoolean)(e)||(0,n.isNull)(e)}function u(e){if(!c(e))throw Error(`unsafe immediate value ${JSON.stringify(e)}`);return s.ValueNode.createImmediate(e)}},154362:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ParensNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ParensNode"===e.kind,create:e=>(0,r.freeze)({kind:"ParensNode",node:e})})}},458836:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseFilterList:()=>g,parseFilterObject:()=>A,parseReferentialBinaryOperation:()=>f,parseValueBinaryOperation:()=>m,parseValueBinaryOperationOrExpression:()=>h});var r=e.i(545090),o=e.i(535542),s=e.i(131385),n=e.i(268375),a=e.i(927766),d=e.i(374697),l=e.i(21348),c=e.i(79045),u=e.i(154362),p=e.i(117792);function h(e){if(3===e.length)return m(e[0],e[1],e[2]);if(1===e.length)return(0,d.parseValueExpression)(e[0]);throw Error(`invalid arguments: ${JSON.stringify(e)}`)}function m(e,t,i){var o;return("is"===(o=t)||"is not"===o)&&y(i)?r.BinaryOperationNode.create((0,a.parseReferenceExpression)(e),K(t),l.ValueNode.createImmediate(i)):r.BinaryOperationNode.create((0,a.parseReferenceExpression)(e),K(t),(0,d.parseValueExpressionOrList)(i))}function f(e,t,i){return r.BinaryOperationNode.create((0,a.parseReferenceExpression)(e),K(t),(0,a.parseReferenceExpression)(i))}function A(e,t){return g(Object.entries(e).filter(([,e])=>!(0,o.isUndefined)(e)).map(([e,t])=>m(e,y(t)?"is":"=",t)),t)}function g(e,t,i=!0){let o="and"===t?c.AndNode.create:p.OrNode.create;if(0===e.length)return r.BinaryOperationNode.create(l.ValueNode.createImmediate(1),n.OperatorNode.create("="),l.ValueNode.createImmediate(+("and"===t)));let s=w(e[0]);for(let t=1;t<e.length;++t)s=o(s,w(e[t]));return e.length>1&&i?u.ParensNode.create(s):s}function y(e){return(0,o.isNull)(e)||(0,o.isBoolean)(e)}function K(e){if((0,o.isString)(e)&&n.OPERATORS.includes(e))return n.OperatorNode.create(e);if((0,s.isOperationNodeSource)(e))return e.toOperationNode();throw Error(`invalid operator ${JSON.stringify(e)}`)}function w(e){return(0,s.isOperationNodeSource)(e)?e.toOperationNode():e}},840349:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OrderByNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"OrderByNode"===e.kind,create:e=>(0,r.freeze)({kind:"OrderByNode",items:(0,r.freeze)([...e])}),cloneWithItems:(e,t)=>(0,r.freeze)({...e,items:(0,r.freeze)([...e.items,...t])})})}},993479:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PartitionByNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"PartitionByNode"===e.kind,create:e=>(0,r.freeze)({kind:"PartitionByNode",items:(0,r.freeze)(e)}),cloneWithItems:(e,t)=>(0,r.freeze)({...e,items:(0,r.freeze)([...e.items,...t])})})}},373164:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OverNode:()=>t});var r=e.i(535542),o=e.i(840349),s=e.i(993479);let t=(0,r.freeze)({is:e=>"OverNode"===e.kind,create:()=>(0,r.freeze)({kind:"OverNode"}),cloneWithOrderByItems:(e,t)=>(0,r.freeze)({...e,orderBy:e.orderBy?o.OrderByNode.cloneWithItems(e.orderBy,t):o.OrderByNode.create(t)}),cloneWithPartitionByItems:(e,t)=>(0,r.freeze)({...e,partitionBy:e.partitionBy?s.PartitionByNode.cloneWithItems(e.partitionBy,t):s.PartitionByNode.create(t)})})}},192918:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({FromNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"FromNode"===e.kind,create:e=>(0,r.freeze)({kind:"FromNode",froms:(0,r.freeze)(e)}),cloneWithFroms:(e,t)=>(0,r.freeze)({...e,froms:(0,r.freeze)([...e.froms,...t])})})}},268433:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({GroupByNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"GroupByNode"===e.kind,create:e=>(0,r.freeze)({kind:"GroupByNode",items:(0,r.freeze)(e)}),cloneWithItems:(e,t)=>(0,r.freeze)({...e,items:(0,r.freeze)([...e.items,...t])})})}},898902:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({HavingNode:()=>t});var r=e.i(535542),o=e.i(79045),s=e.i(117792);let t=(0,r.freeze)({is:e=>"HavingNode"===e.kind,create:e=>(0,r.freeze)({kind:"HavingNode",having:e}),cloneWithOperation:(e,t,i)=>(0,r.freeze)({...e,having:"And"===t?o.AndNode.create(e.having,i):s.OrNode.create(e.having,i)})})}},777174:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({InsertQueryNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"InsertQueryNode"===e.kind,create:(e,t,i)=>(0,r.freeze)({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:i}),createWithoutInto:()=>(0,r.freeze)({kind:"InsertQueryNode"}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},393799:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ListNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ListNode"===e.kind,create:e=>(0,r.freeze)({kind:"ListNode",items:(0,r.freeze)(e)})})}},636214:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({UpdateQueryNode:()=>t});var r=e.i(535542),o=e.i(192918),s=e.i(393799);let t=(0,r.freeze)({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"UpdateQueryNode",table:1===e.length?e[0]:s.ListNode.create(e),...t&&{with:t}}),createWithoutTable:()=>(0,r.freeze)({kind:"UpdateQueryNode"}),cloneWithFromItems:(e,t)=>(0,r.freeze)({...e,from:e.from?o.FromNode.cloneWithFroms(e.from,t):o.FromNode.create(t)}),cloneWithUpdates:(e,t)=>(0,r.freeze)({...e,updates:e.updates?(0,r.freeze)([...e.updates,...t]):t}),cloneWithLimit:(e,t)=>(0,r.freeze)({...e,limit:t})})}},618403:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({UsingNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"UsingNode"===e.kind,create:e=>(0,r.freeze)({kind:"UsingNode",tables:(0,r.freeze)(e)}),cloneWithTables:(e,t)=>(0,r.freeze)({...e,tables:(0,r.freeze)([...e.tables,...t])})})}},819985:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DeleteQueryNode:()=>t});var r=e.i(535542),o=e.i(192918),s=e.i(618403),n=e.i(430596);let t=(0,r.freeze)({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"DeleteQueryNode",from:o.FromNode.create(e),...t&&{with:t}}),cloneWithOrderByItems:(e,t)=>n.QueryNode.cloneWithOrderByItems(e,t),cloneWithoutOrderBy:e=>n.QueryNode.cloneWithoutOrderBy(e),cloneWithLimit:(e,t)=>(0,r.freeze)({...e,limit:t}),cloneWithoutLimit:e=>(0,r.freeze)({...e,limit:void 0}),cloneWithUsing:(e,t)=>(0,r.freeze)({...e,using:void 0!==e.using?s.UsingNode.cloneWithTables(e.using,t):s.UsingNode.create(t)})})}},339468:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({WhereNode:()=>t});var r=e.i(535542),o=e.i(79045),s=e.i(117792);let t=(0,r.freeze)({is:e=>"WhereNode"===e.kind,create:e=>(0,r.freeze)({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,i)=>(0,r.freeze)({...e,where:"And"===t?o.AndNode.create(e.where,i):s.OrNode.create(e.where,i)})})}},533192:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ReturningNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ReturningNode"===e.kind,create:e=>(0,r.freeze)({kind:"ReturningNode",selections:(0,r.freeze)(e)}),cloneWithSelections:(e,t)=>(0,r.freeze)({...e,selections:e.selections?(0,r.freeze)([...e.selections,...t]):(0,r.freeze)(t)})})}},282098:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ExplainNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ExplainNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"ExplainNode",format:e,options:t})})}},826615:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({WhenNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"WhenNode"===e.kind,create:e=>(0,r.freeze)({kind:"WhenNode",condition:e}),cloneWithResult:(e,t)=>(0,r.freeze)({...e,result:t})})}},860934:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MergeQueryNode:()=>t});var r=e.i(535542),o=e.i(826615);let t=(0,r.freeze)({is:e=>"MergeQueryNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"MergeQueryNode",into:e,...t&&{with:t}}),cloneWithUsing:(e,t)=>(0,r.freeze)({...e,using:t}),cloneWithWhen:(e,t)=>(0,r.freeze)({...e,whens:e.whens?(0,r.freeze)([...e.whens,t]):(0,r.freeze)([t])}),cloneWithThen:(e,t)=>(0,r.freeze)({...e,whens:e.whens?(0,r.freeze)([...e.whens.slice(0,-1),o.WhenNode.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})})}},589002:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OutputNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"OutputNode"===e.kind,create:e=>(0,r.freeze)({kind:"OutputNode",selections:(0,r.freeze)(e)}),cloneWithSelections:(e,t)=>(0,r.freeze)({...e,selections:e.selections?(0,r.freeze)([...e.selections,...t]):(0,r.freeze)(t)})})}},430596:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({QueryNode:()=>t});var r=e.i(777174),o=e.i(302166),s=e.i(636214),n=e.i(819985),a=e.i(339468),d=e.i(535542),l=e.i(533192),c=e.i(282098),u=e.i(860934),p=e.i(589002),h=e.i(840349);let t=(0,d.freeze)({is:e=>o.SelectQueryNode.is(e)||r.InsertQueryNode.is(e)||s.UpdateQueryNode.is(e)||n.DeleteQueryNode.is(e)||u.MergeQueryNode.is(e),cloneWithEndModifier:(e,t)=>(0,d.freeze)({...e,endModifiers:e.endModifiers?(0,d.freeze)([...e.endModifiers,t]):(0,d.freeze)([t])}),cloneWithWhere:(e,t)=>(0,d.freeze)({...e,where:e.where?a.WhereNode.cloneWithOperation(e.where,"And",t):a.WhereNode.create(t)}),cloneWithJoin:(e,t)=>(0,d.freeze)({...e,joins:e.joins?(0,d.freeze)([...e.joins,t]):(0,d.freeze)([t])}),cloneWithReturning:(e,t)=>(0,d.freeze)({...e,returning:e.returning?l.ReturningNode.cloneWithSelections(e.returning,t):l.ReturningNode.create(t)}),cloneWithoutReturning:e=>(0,d.freeze)({...e,returning:void 0}),cloneWithoutWhere:e=>(0,d.freeze)({...e,where:void 0}),cloneWithExplain:(e,t,i)=>(0,d.freeze)({...e,explain:c.ExplainNode.create(t,i?.toOperationNode())}),cloneWithTop:(e,t)=>(0,d.freeze)({...e,top:t}),cloneWithOutput:(e,t)=>(0,d.freeze)({...e,output:e.output?p.OutputNode.cloneWithSelections(e.output,t):p.OutputNode.create(t)}),cloneWithOrderByItems:(e,t)=>(0,d.freeze)({...e,orderBy:e.orderBy?h.OrderByNode.cloneWithItems(e.orderBy,t):h.OrderByNode.create(t)}),cloneWithoutOrderBy:e=>(0,d.freeze)({...e,orderBy:void 0})})}},302166:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SelectQueryNode:()=>t});var r=e.i(535542),o=e.i(192918),s=e.i(268433),n=e.i(898902),a=e.i(430596);let t=(0,r.freeze)({is:e=>"SelectQueryNode"===e.kind,create:e=>(0,r.freeze)({kind:"SelectQueryNode",...e&&{with:e}}),createFrom:(e,t)=>(0,r.freeze)({kind:"SelectQueryNode",from:o.FromNode.create(e),...t&&{with:t}}),cloneWithSelections:(e,t)=>(0,r.freeze)({...e,selections:e.selections?(0,r.freeze)([...e.selections,...t]):(0,r.freeze)(t)}),cloneWithDistinctOn:(e,t)=>(0,r.freeze)({...e,distinctOn:e.distinctOn?(0,r.freeze)([...e.distinctOn,...t]):(0,r.freeze)(t)}),cloneWithFrontModifier:(e,t)=>(0,r.freeze)({...e,frontModifiers:e.frontModifiers?(0,r.freeze)([...e.frontModifiers,t]):(0,r.freeze)([t])}),cloneWithOrderByItems:(e,t)=>a.QueryNode.cloneWithOrderByItems(e,t),cloneWithGroupByItems:(e,t)=>(0,r.freeze)({...e,groupBy:e.groupBy?s.GroupByNode.cloneWithItems(e.groupBy,t):s.GroupByNode.create(t)}),cloneWithLimit:(e,t)=>(0,r.freeze)({...e,limit:t}),cloneWithOffset:(e,t)=>(0,r.freeze)({...e,offset:t}),cloneWithFetch:(e,t)=>(0,r.freeze)({...e,fetch:t}),cloneWithHaving:(e,t)=>(0,r.freeze)({...e,having:e.having?n.HavingNode.cloneWithOperation(e.having,"And",t):n.HavingNode.create(t)}),cloneWithSetOperations:(e,t)=>(0,r.freeze)({...e,setOperations:e.setOperations?(0,r.freeze)([...e.setOperations,...t]):(0,r.freeze)([...t])}),cloneWithoutSelections:e=>(0,r.freeze)({...e,selections:[]}),cloneWithoutLimit:e=>(0,r.freeze)({...e,limit:void 0}),cloneWithoutOffset:e=>(0,r.freeze)({...e,offset:void 0}),cloneWithoutOrderBy:e=>a.QueryNode.cloneWithoutOrderBy(e),cloneWithoutGroupBy:e=>(0,r.freeze)({...e,groupBy:void 0})})}},364523:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({JoinBuilder:()=>t});var r=e.i(682152),o=e.i(620581),s=e.i(458836),n=e.i(535542);class t{#t;constructor(e){this.#t=(0,n.freeze)(e)}on(...e){return new t({...this.#t,joinNode:r.JoinNode.cloneWithOn(this.#t.joinNode,(0,s.parseValueBinaryOperationOrExpression)(e))})}onRef(e,i,o){return new t({...this.#t,joinNode:r.JoinNode.cloneWithOn(this.#t.joinNode,(0,s.parseReferentialBinaryOperation)(e,i,o))})}onTrue(){return new t({...this.#t,joinNode:r.JoinNode.cloneWithOn(this.#t.joinNode,o.RawNode.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#t.joinNode}}}},156877:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PartitionByItemNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"PartitionByItemNode"===e.kind,create:e=>(0,r.freeze)({kind:"PartitionByItemNode",partitionBy:e})})}},981670:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parsePartitionBy:()=>s});var r=e.i(156877),o=e.i(927766);function s(e){return(0,o.parseReferenceExpressionOrList)(e).map(r.PartitionByItemNode.create)}},347542:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OverBuilder:()=>t});var r=e.i(373164),o=e.i(430596),s=e.i(534650),n=e.i(981670),a=e.i(535542);class t{#t;constructor(e){this.#t=(0,a.freeze)(e)}orderBy(...e){return new t({overNode:r.OverNode.cloneWithOrderByItems(this.#t.overNode,(0,s.parseOrderBy)(e))})}clearOrderBy(){return new t({overNode:o.QueryNode.cloneWithoutOrderBy(this.#t.overNode)})}partitionBy(e){return new t({overNode:r.OverNode.cloneWithPartitionByItems(this.#t.overNode,(0,n.parsePartitionBy)(e))})}$call(e){return e(this)}toOperationNode(){return this.#t.overNode}}}},768541:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SelectionNode:()=>t});var r=e.i(535542),o=e.i(557027),s=e.i(17318);let t=(0,r.freeze)({is:e=>"SelectionNode"===e.kind,create:e=>(0,r.freeze)({kind:"SelectionNode",selection:e}),createSelectAll:()=>(0,r.freeze)({kind:"SelectionNode",selection:s.SelectAllNode.create()}),createSelectAllFromTable:e=>(0,r.freeze)({kind:"SelectionNode",selection:o.ReferenceNode.createSelectAll(e)})})}},322848:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseSelectAll:()=>u,parseSelectArg:()=>function e(t){return(0,r.isFunction)(t)?e(t((0,l.expressionBuilder)())):(0,r.isReadonlyArray)(t)?t.map(e=>c(e)):[c(t)]}});var r=e.i(535542),o=e.i(768541),s=e.i(927766),n=e.i(302061),a=e.i(627710),d=e.i(777649),l=e.i(647211);function c(e){return(0,r.isString)(e)?o.SelectionNode.create((0,s.parseAliasedStringReference)(e)):(0,n.isDynamicReferenceBuilder)(e)?o.SelectionNode.create(e.toOperationNode()):o.SelectionNode.create((0,a.parseAliasedExpression)(e))}function u(e){return e?Array.isArray(e)?e.map(p):[p(e)]:[o.SelectionNode.createSelectAll()]}function p(e){if((0,r.isString)(e))return o.SelectionNode.createSelectAllFromTable((0,d.parseTable)(e));throw Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}},182870:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ValuesNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ValuesNode"===e.kind,create:e=>(0,r.freeze)({kind:"ValuesNode",values:(0,r.freeze)(e)})})}},184844:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DefaultInsertValueNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>(0,r.freeze)({kind:"DefaultInsertValueNode"})})}},814301:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseInsertExpression:()=>p});var r=e.i(326892),o=e.i(734906),s=e.i(697622),n=e.i(535542),a=e.i(374697),d=e.i(182870),l=e.i(627710),c=e.i(184844),u=e.i(647211);function p(e){let t=(0,n.isFunction)(e)?e((0,u.expressionBuilder)()):e;var i=(0,n.isReadonlyArray)(t)?t:(0,n.freeze)([t]);let p=function(e){let t=new Map;for(let i of e)for(let e of Object.keys(i))t.has(e)||void 0===i[e]||t.set(e,t.size);return t}(i);return[(0,n.freeze)([...p.keys()].map(r.ColumnNode.create)),d.ValuesNode.create(i.map(e=>(function(e,t){let i=Object.keys(e),r=Array.from({length:t.size}),d=!1,u=i.length;for(let o of i){let i=t.get(o);if((0,n.isUndefined)(i)){u--;continue}let s=e[o];((0,n.isUndefined)(s)||(0,l.isExpressionOrFactory)(s))&&(d=!0),r[i]=s}if(u<t.size||d){let e=c.DefaultInsertValueNode.create();return s.ValueListNode.create(r.map(t=>(0,n.isUndefined)(t)?e:(0,a.parseValueExpression)(t)))}return o.PrimitiveValueListNode.create(r)})(e,p)))]}},172701:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ColumnUpdateNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"ColumnUpdateNode",column:e,value:t})})}},833028:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseUpdate:()=>l,parseUpdateObjectExpression:()=>c});var r=e.i(326892),o=e.i(172701),s=e.i(647211),n=e.i(535542),a=e.i(374697),d=e.i(927766);function l(...e){return 2===e.length?[o.ColumnUpdateNode.create((0,d.parseReferenceExpression)(e[0]),(0,a.parseValueExpression)(e[1]))]:c(e[0])}function c(e){return Object.entries((0,n.isFunction)(e)?e((0,s.expressionBuilder)()):e).filter(([e,t])=>void 0!==t).map(([e,t])=>o.ColumnUpdateNode.create(r.ColumnNode.create(e),(0,a.parseValueExpression)(t)))}},994644:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OnDuplicateKeyNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>(0,r.freeze)({kind:"OnDuplicateKeyNode",updates:e})})}},611549:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({InsertResult:()=>t});class t{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}}}},446767:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({NoResultError:()=>t,isNoResultErrorConstructor:()=>r});class t extends Error{node;constructor(e){super("no result"),this.node=e}}function r(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}}},738519:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OnConflictNode:()=>t});var r=e.i(535542),o=e.i(339468);let t=(0,r.freeze)({is:e=>"OnConflictNode"===e.kind,create:()=>(0,r.freeze)({kind:"OnConflictNode"}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t}),cloneWithIndexWhere:(e,t)=>(0,r.freeze)({...e,indexWhere:e.indexWhere?o.WhereNode.cloneWithOperation(e.indexWhere,"And",t):o.WhereNode.create(t)}),cloneWithIndexOrWhere:(e,t)=>(0,r.freeze)({...e,indexWhere:e.indexWhere?o.WhereNode.cloneWithOperation(e.indexWhere,"Or",t):o.WhereNode.create(t)}),cloneWithUpdateWhere:(e,t)=>(0,r.freeze)({...e,updateWhere:e.updateWhere?o.WhereNode.cloneWithOperation(e.updateWhere,"And",t):o.WhereNode.create(t)}),cloneWithUpdateOrWhere:(e,t)=>(0,r.freeze)({...e,updateWhere:e.updateWhere?o.WhereNode.cloneWithOperation(e.updateWhere,"Or",t):o.WhereNode.create(t)}),cloneWithoutIndexWhere:e=>(0,r.freeze)({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>(0,r.freeze)({...e,updateWhere:void 0})})}},510821:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OnConflictBuilder:()=>t,OnConflictDoNothingBuilder:()=>i,OnConflictUpdateBuilder:()=>l});var r=e.i(326892),o=e.i(453409),s=e.i(738519),n=e.i(458836),a=e.i(833028),d=e.i(535542);class t{#t;constructor(e){this.#t=(0,d.freeze)(e)}column(e){let i=r.ColumnNode.create(e);return new t({...this.#t,onConflictNode:s.OnConflictNode.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?(0,d.freeze)([...this.#t.onConflictNode.columns,i]):(0,d.freeze)([i])})})}columns(e){let i=e.map(r.ColumnNode.create);return new t({...this.#t,onConflictNode:s.OnConflictNode.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?(0,d.freeze)([...this.#t.onConflictNode.columns,...i]):(0,d.freeze)(i)})})}constraint(e){return new t({...this.#t,onConflictNode:s.OnConflictNode.cloneWith(this.#t.onConflictNode,{constraint:o.IdentifierNode.create(e)})})}expression(e){return new t({...this.#t,onConflictNode:s.OnConflictNode.cloneWith(this.#t.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new t({...this.#t,onConflictNode:s.OnConflictNode.cloneWithIndexWhere(this.#t.onConflictNode,(0,n.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,i,r){return new t({...this.#t,onConflictNode:s.OnConflictNode.cloneWithIndexWhere(this.#t.onConflictNode,(0,n.parseReferentialBinaryOperation)(e,i,r))})}clearWhere(){return new t({...this.#t,onConflictNode:s.OnConflictNode.cloneWithoutIndexWhere(this.#t.onConflictNode)})}doNothing(){return new i({...this.#t,onConflictNode:s.OnConflictNode.cloneWith(this.#t.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new l({...this.#t,onConflictNode:s.OnConflictNode.cloneWith(this.#t.onConflictNode,{updates:(0,a.parseUpdateObjectExpression)(e)})})}$call(e){return e(this)}}class i{#t;constructor(e){this.#t=(0,d.freeze)(e)}toOperationNode(){return this.#t.onConflictNode}}class l{#t;constructor(e){this.#t=(0,d.freeze)(e)}where(...e){return new l({...this.#t,onConflictNode:s.OnConflictNode.cloneWithUpdateWhere(this.#t.onConflictNode,(0,n.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,t,i){return new l({...this.#t,onConflictNode:s.OnConflictNode.cloneWithUpdateWhere(this.#t.onConflictNode,(0,n.parseReferentialBinaryOperation)(e,t,i))})}clearWhere(){return new l({...this.#t,onConflictNode:s.OnConflictNode.cloneWithoutUpdateWhere(this.#t.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#t.onConflictNode}}}},249533:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({TopNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"TopNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"TopNode",expression:e,modifiers:t})})}},373900:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseTop:()=>s});var r=e.i(249533),o=e.i(535542);function s(e,t){var i;if(!(0,o.isNumber)(e)&&!(0,o.isBigInt)(e))throw Error(`Invalid top expression: ${e}`);if(!(0,o.isUndefined)(t)&&"percent"!==(i=t)&&"with ties"!==i&&"percent with ties"!==i)throw Error(`Invalid top modifiers: ${t}`);return r.TopNode.create(e,t)}},283513:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OrActionNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"OrActionNode"===e.kind,create:e=>(0,r.freeze)({kind:"OrActionNode",action:e})})}},955530:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({InsertQueryBuilder:()=>t});var r=e.i(322848),o=e.i(814301),s=e.i(777174),n=e.i(430596),a=e.i(833028),d=e.i(535542),l=e.i(994644),c=e.i(611549),u=e.i(446767),p=e.i(627710),h=e.i(326892),m=e.i(510821),f=e.i(738519),A=e.i(373900),g=e.i(283513);class t{#t;constructor(e){this.#t=(0,d.freeze)(e)}values(e){let[i,r]=(0,o.parseInsertExpression)(e);return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{columns:i,values:r})})}columns(e){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{columns:(0,d.freeze)(e.map(h.ColumnNode.create))})})}expression(e){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{values:(0,p.parseExpression)(e)})})}defaultValues(){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{defaultValues:!0})})}modifyEnd(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}ignore(){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{orAction:g.OrActionNode.create("ignore")})})}orIgnore(){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{orAction:g.OrActionNode.create("ignore")})})}orAbort(){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{orAction:g.OrActionNode.create("abort")})})}orFail(){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{orAction:g.OrActionNode.create("fail")})})}orReplace(){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{orAction:g.OrActionNode.create("replace")})})}orRollback(){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{orAction:g.OrActionNode.create("rollback")})})}top(e,i){return new t({...this.#t,queryNode:n.QueryNode.cloneWithTop(this.#t.queryNode,(0,A.parseTop)(e,i))})}onConflict(e){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{onConflict:e(new m.OnConflictBuilder({onConflictNode:f.OnConflictNode.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new t({...this.#t,queryNode:s.InsertQueryNode.cloneWith(this.#t.queryNode,{onDuplicateKey:l.OnDuplicateKeyNode.create((0,a.parseUpdateObjectExpression)(e))})})}returning(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithReturning(this.#t.queryNode,(0,r.parseSelectArg)(e))})}returningAll(){return new t({...this.#t,queryNode:n.QueryNode.cloneWithReturning(this.#t.queryNode,(0,r.parseSelectAll)())})}output(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithOutput(this.#t.queryNode,(0,r.parseSelectArg)(e))})}outputAll(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithOutput(this.#t.queryNode,(0,r.parseSelectAll)(e))})}clearReturning(){return new t({...this.#t,queryNode:n.QueryNode.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#t})}$castTo(){return new t(this.#t)}$narrowType(){return new t(this.#t)}$assertType(){return new t(this.#t)}withPlugin(e){return new t({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:i}=this.#t.executor,r=e.query;return r.returning&&i.supportsReturning||r.output&&i.supportsOutput?t.rows:[new c.InsertResult(t.insertId,t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=u.NoResultError){let t=await this.executeTakeFirst();if(void 0===t)throw(0,u.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let i of this.#t.executor.stream(t,e,this.#t.queryId))yield*i.rows}async explain(e,i){let r=new t({...this.#t,queryNode:n.QueryNode.cloneWithExplain(this.#t.queryNode,e,i)});return await r.execute()}}}},734007:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DeleteResult:()=>t});class t{numDeletedRows;constructor(e){this.numDeletedRows=e}}}},700736:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({LimitNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"LimitNode"===e.kind,create:e=>(0,r.freeze)({kind:"LimitNode",limit:e})})}},924673:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DeleteQueryBuilder:()=>t});var r=e.i(756612),o=e.i(777649),s=e.i(322848),n=e.i(430596),a=e.i(535542),d=e.i(446767),l=e.i(734007),c=e.i(819985),u=e.i(700736),p=e.i(534650),h=e.i(458836),m=e.i(374697),f=e.i(373900);class t{#t;constructor(e){this.#t=(0,a.freeze)(e)}where(...e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithWhere(this.#t.queryNode,(0,h.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,i,r){return new t({...this.#t,queryNode:n.QueryNode.cloneWithWhere(this.#t.queryNode,(0,h.parseReferentialBinaryOperation)(e,i,r))})}clearWhere(){return new t({...this.#t,queryNode:n.QueryNode.cloneWithoutWhere(this.#t.queryNode)})}top(e,i){return new t({...this.#t,queryNode:n.QueryNode.cloneWithTop(this.#t.queryNode,(0,f.parseTop)(e,i))})}using(e){return new t({...this.#t,queryNode:c.DeleteQueryNode.cloneWithUsing(this.#t.queryNode,(0,o.parseTableExpressionOrList)(e))})}innerJoin(...e){return this.#i("InnerJoin",e)}leftJoin(...e){return this.#i("LeftJoin",e)}rightJoin(...e){return this.#i("RightJoin",e)}fullJoin(...e){return this.#i("FullJoin",e)}#i(e,i){return new t({...this.#t,queryNode:n.QueryNode.cloneWithJoin(this.#t.queryNode,(0,r.parseJoin)(e,i))})}returning(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithReturning(this.#t.queryNode,(0,s.parseSelectArg)(e))})}returningAll(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithReturning(this.#t.queryNode,(0,s.parseSelectAll)(e))})}output(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithOutput(this.#t.queryNode,(0,s.parseSelectArg)(e))})}outputAll(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithOutput(this.#t.queryNode,(0,s.parseSelectAll)(e))})}clearReturning(){return new t({...this.#t,queryNode:n.QueryNode.cloneWithoutReturning(this.#t.queryNode)})}clearLimit(){return new t({...this.#t,queryNode:c.DeleteQueryNode.cloneWithoutLimit(this.#t.queryNode)})}orderBy(...e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithOrderByItems(this.#t.queryNode,(0,p.parseOrderBy)(e))})}clearOrderBy(){return new t({...this.#t,queryNode:n.QueryNode.cloneWithoutOrderBy(this.#t.queryNode)})}limit(e){return new t({...this.#t,queryNode:c.DeleteQueryNode.cloneWithLimit(this.#t.queryNode,u.LimitNode.create((0,m.parseValueExpression)(e)))})}modifyEnd(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#t})}$castTo(){return new t(this.#t)}$narrowType(){return new t(this.#t)}$assertType(){return new t(this.#t)}withPlugin(e){return new t({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:i}=this.#t.executor,r=e.query;return r.returning&&i.supportsReturning||r.output&&i.supportsOutput?t.rows:[new l.DeleteResult(t.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=d.NoResultError){let t=await this.executeTakeFirst();if(void 0===t)throw(0,d.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let i of this.#t.executor.stream(t,e,this.#t.queryId))yield*i.rows}async explain(e,i){let r=new t({...this.#t,queryNode:n.QueryNode.cloneWithExplain(this.#t.queryNode,e,i)});return await r.execute()}}}},948313:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({UpdateResult:()=>t});class t{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}}}},537788:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({UpdateQueryBuilder:()=>t});var r=e.i(756612),o=e.i(777649),s=e.i(322848),n=e.i(430596),a=e.i(636214),d=e.i(833028),l=e.i(535542),c=e.i(948313),u=e.i(446767),p=e.i(458836),h=e.i(374697),m=e.i(700736),f=e.i(373900),A=e.i(534650);class t{#t;constructor(e){this.#t=(0,l.freeze)(e)}where(...e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithWhere(this.#t.queryNode,(0,p.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,i,r){return new t({...this.#t,queryNode:n.QueryNode.cloneWithWhere(this.#t.queryNode,(0,p.parseReferentialBinaryOperation)(e,i,r))})}clearWhere(){return new t({...this.#t,queryNode:n.QueryNode.cloneWithoutWhere(this.#t.queryNode)})}top(e,i){return new t({...this.#t,queryNode:n.QueryNode.cloneWithTop(this.#t.queryNode,(0,f.parseTop)(e,i))})}from(e){return new t({...this.#t,queryNode:a.UpdateQueryNode.cloneWithFromItems(this.#t.queryNode,(0,o.parseTableExpressionOrList)(e))})}innerJoin(...e){return this.#i("InnerJoin",e)}leftJoin(...e){return this.#i("LeftJoin",e)}rightJoin(...e){return this.#i("RightJoin",e)}fullJoin(...e){return this.#i("FullJoin",e)}#i(e,i){return new t({...this.#t,queryNode:n.QueryNode.cloneWithJoin(this.#t.queryNode,(0,r.parseJoin)(e,i))})}orderBy(...e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithOrderByItems(this.#t.queryNode,(0,A.parseOrderBy)(e))})}clearOrderBy(){return new t({...this.#t,queryNode:n.QueryNode.cloneWithoutOrderBy(this.#t.queryNode)})}limit(e){return new t({...this.#t,queryNode:a.UpdateQueryNode.cloneWithLimit(this.#t.queryNode,m.LimitNode.create((0,h.parseValueExpression)(e)))})}set(...e){return new t({...this.#t,queryNode:a.UpdateQueryNode.cloneWithUpdates(this.#t.queryNode,(0,d.parseUpdate)(...e))})}returning(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithReturning(this.#t.queryNode,(0,s.parseSelectArg)(e))})}returningAll(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithReturning(this.#t.queryNode,(0,s.parseSelectAll)(e))})}output(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithOutput(this.#t.queryNode,(0,s.parseSelectArg)(e))})}outputAll(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithOutput(this.#t.queryNode,(0,s.parseSelectAll)(e))})}modifyEnd(e){return new t({...this.#t,queryNode:n.QueryNode.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}clearReturning(){return new t({...this.#t,queryNode:n.QueryNode.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#t})}$castTo(){return new t(this.#t)}$narrowType(){return new t(this.#t)}$assertType(){return new t(this.#t)}withPlugin(e){return new t({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:i}=this.#t.executor,r=e.query;return r.returning&&i.supportsReturning||r.output&&i.supportsOutput?t.rows:[new c.UpdateResult(t.numAffectedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=u.NoResultError){let t=await this.executeTakeFirst();if(void 0===t)throw(0,u.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let i of this.#t.executor.stream(t,e,this.#t.queryId))yield*i.rows}async explain(e,i){let r=new t({...this.#t,queryNode:n.QueryNode.cloneWithExplain(this.#t.queryNode,e,i)});return await r.execute()}}}},613246:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CommonTableExpressionNameNode:()=>t});var r=e.i(535542),o=e.i(326892),s=e.i(164563);let t=(0,r.freeze)({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"CommonTableExpressionNameNode",table:s.TableNode.create(e),columns:t?(0,r.freeze)(t.map(o.ColumnNode.create)):void 0})})}},427041:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CommonTableExpressionNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"CommonTableExpressionNode",name:e,expression:t}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},519763:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CTEBuilder:()=>t});var r=e.i(427041),o=e.i(535542);class t{#t;constructor(e){this.#t=(0,o.freeze)(e)}materialized(){return new t({...this.#t,node:r.CommonTableExpressionNode.cloneWith(this.#t.node,{materialized:!0})})}notMaterialized(){return new t({...this.#t,node:r.CommonTableExpressionNode.cloneWith(this.#t.node,{materialized:!1})})}toOperationNode(){return this.#t.node}}}},555537:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseCommonTableExpression:()=>d});var r=e.i(613246),o=e.i(42479),s=e.i(535542),n=e.i(519763),a=e.i(427041);function d(e,t){var i;let r=t((0,o.createQueryCreator)()).toOperationNode();return(0,s.isFunction)(e)?e((i=r,e=>new n.CTEBuilder({node:a.CommonTableExpressionNode.create(l(e),i)}))).toOperationNode():a.CommonTableExpressionNode.create(l(e),r)}function l(e){if(!e.includes("("))return r.CommonTableExpressionNameNode.create(e);{let t=e.split(/[\(\)]/),i=t[0],o=t[1].split(",").map(e=>e.trim());return r.CommonTableExpressionNameNode.create(i,o)}}},748532:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({WithNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"WithNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"WithNode",expressions:(0,r.freeze)([e]),...t}),cloneWithExpression:(e,t)=>(0,r.freeze)({...e,expressions:(0,r.freeze)([...e.expressions,t])})})}},241800:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({randomString:()=>r});let t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function r(e){let i="";for(let r=0;r<e;++r)i+=t[~~(Math.random()*t.length)];return i}}},729895:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createQueryId:()=>o});var r=e.i(241800);function o(){return new t}class t{#r;get queryId(){return void 0===this.#r&&(this.#r=(0,r.randomString)(8)),this.#r}}}},998480:e=>{"use strict";var{g:t,__dirname:i}=e;function r(e){return e}e.s({requireAllProps:()=>r})},794220:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OperationNodeTransformer:()=>t});var r=e.i(535542),o=e.i(998480);class t{nodeStack=[];#o=(0,r.freeze)({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(e,t){if(!e)return e;this.nodeStack.push(e);let i=this.transformNodeImpl(e,t);return this.nodeStack.pop(),(0,r.freeze)(i)}transformNodeImpl(e,t){return this.#o[e.kind](e,t)}transformNodeList(e,t){return e?(0,r.freeze)(e.map(e=>this.transformNode(e,t))):e}transformSelectQuery(e,t){return(0,o.requireAllProps)({kind:"SelectQueryNode",from:this.transformNode(e.from,t),selections:this.transformNodeList(e.selections,t),distinctOn:this.transformNodeList(e.distinctOn,t),joins:this.transformNodeList(e.joins,t),groupBy:this.transformNode(e.groupBy,t),orderBy:this.transformNode(e.orderBy,t),where:this.transformNode(e.where,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),limit:this.transformNode(e.limit,t),offset:this.transformNode(e.offset,t),with:this.transformNode(e.with,t),having:this.transformNode(e.having,t),explain:this.transformNode(e.explain,t),setOperations:this.transformNodeList(e.setOperations,t),fetch:this.transformNode(e.fetch,t),top:this.transformNode(e.top,t)})}transformSelection(e,t){return(0,o.requireAllProps)({kind:"SelectionNode",selection:this.transformNode(e.selection,t)})}transformColumn(e,t){return(0,o.requireAllProps)({kind:"ColumnNode",column:this.transformNode(e.column,t)})}transformAlias(e,t){return(0,o.requireAllProps)({kind:"AliasNode",node:this.transformNode(e.node,t),alias:this.transformNode(e.alias,t)})}transformTable(e,t){return(0,o.requireAllProps)({kind:"TableNode",table:this.transformNode(e.table,t)})}transformFrom(e,t){return(0,o.requireAllProps)({kind:"FromNode",froms:this.transformNodeList(e.froms,t)})}transformReference(e,t){return(0,o.requireAllProps)({kind:"ReferenceNode",column:this.transformNode(e.column,t),table:this.transformNode(e.table,t)})}transformAnd(e,t){return(0,o.requireAllProps)({kind:"AndNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)})}transformOr(e,t){return(0,o.requireAllProps)({kind:"OrNode",left:this.transformNode(e.left,t),right:this.transformNode(e.right,t)})}transformValueList(e,t){return(0,o.requireAllProps)({kind:"ValueListNode",values:this.transformNodeList(e.values,t)})}transformParens(e,t){return(0,o.requireAllProps)({kind:"ParensNode",node:this.transformNode(e.node,t)})}transformJoin(e,t){return(0,o.requireAllProps)({kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table,t),on:this.transformNode(e.on,t)})}transformRaw(e,t){return(0,o.requireAllProps)({kind:"RawNode",sqlFragments:(0,r.freeze)([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters,t)})}transformWhere(e,t){return(0,o.requireAllProps)({kind:"WhereNode",where:this.transformNode(e.where,t)})}transformInsertQuery(e,t){return(0,o.requireAllProps)({kind:"InsertQueryNode",into:this.transformNode(e.into,t),columns:this.transformNodeList(e.columns,t),values:this.transformNode(e.values,t),returning:this.transformNode(e.returning,t),onConflict:this.transformNode(e.onConflict,t),onDuplicateKey:this.transformNode(e.onDuplicateKey,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),ignore:e.ignore,orAction:this.transformNode(e.orAction,t),replace:e.replace,explain:this.transformNode(e.explain,t),defaultValues:e.defaultValues,top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)})}transformValues(e,t){return(0,o.requireAllProps)({kind:"ValuesNode",values:this.transformNodeList(e.values,t)})}transformDeleteQuery(e,t){return(0,o.requireAllProps)({kind:"DeleteQueryNode",from:this.transformNode(e.from,t),using:this.transformNode(e.using,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),orderBy:this.transformNode(e.orderBy,t),limit:this.transformNode(e.limit,t),explain:this.transformNode(e.explain,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t)})}transformReturning(e,t){return(0,o.requireAllProps)({kind:"ReturningNode",selections:this.transformNodeList(e.selections,t)})}transformCreateTable(e,t){return(0,o.requireAllProps)({kind:"CreateTableNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),constraints:this.transformNodeList(e.constraints,t),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),selectQuery:this.transformNode(e.selectQuery,t)})}transformColumnDefinition(e,t){return(0,o.requireAllProps)({kind:"ColumnDefinitionNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),references:this.transformNode(e.references,t),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo,t),check:this.transformNode(e.check,t),generated:this.transformNode(e.generated,t),frontModifiers:this.transformNodeList(e.frontModifiers,t),endModifiers:this.transformNodeList(e.endModifiers,t),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists})}transformAddColumn(e,t){return(0,o.requireAllProps)({kind:"AddColumnNode",column:this.transformNode(e.column,t)})}transformDropTable(e,t){return(0,o.requireAllProps)({kind:"DropTableNode",table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade})}transformOrderBy(e,t){return(0,o.requireAllProps)({kind:"OrderByNode",items:this.transformNodeList(e.items,t)})}transformOrderByItem(e,t){return(0,o.requireAllProps)({kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy,t),direction:this.transformNode(e.direction,t),collation:this.transformNode(e.collation,t),nulls:e.nulls})}transformGroupBy(e,t){return(0,o.requireAllProps)({kind:"GroupByNode",items:this.transformNodeList(e.items,t)})}transformGroupByItem(e,t){return(0,o.requireAllProps)({kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy,t)})}transformUpdateQuery(e,t){return(0,o.requireAllProps)({kind:"UpdateQueryNode",table:this.transformNode(e.table,t),from:this.transformNode(e.from,t),joins:this.transformNodeList(e.joins,t),where:this.transformNode(e.where,t),updates:this.transformNodeList(e.updates,t),returning:this.transformNode(e.returning,t),endModifiers:this.transformNodeList(e.endModifiers,t),with:this.transformNode(e.with,t),explain:this.transformNode(e.explain,t),limit:this.transformNode(e.limit,t),top:this.transformNode(e.top,t),output:this.transformNode(e.output,t),orderBy:this.transformNode(e.orderBy,t)})}transformColumnUpdate(e,t){return(0,o.requireAllProps)({kind:"ColumnUpdateNode",column:this.transformNode(e.column,t),value:this.transformNode(e.value,t)})}transformLimit(e,t){return(0,o.requireAllProps)({kind:"LimitNode",limit:this.transformNode(e.limit,t)})}transformOffset(e,t){return(0,o.requireAllProps)({kind:"OffsetNode",offset:this.transformNode(e.offset,t)})}transformOnConflict(e,t){return(0,o.requireAllProps)({kind:"OnConflictNode",columns:this.transformNodeList(e.columns,t),constraint:this.transformNode(e.constraint,t),indexExpression:this.transformNode(e.indexExpression,t),indexWhere:this.transformNode(e.indexWhere,t),updates:this.transformNodeList(e.updates,t),updateWhere:this.transformNode(e.updateWhere,t),doNothing:e.doNothing})}transformOnDuplicateKey(e,t){return(0,o.requireAllProps)({kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates,t)})}transformCreateIndex(e,t){return(0,o.requireAllProps)({kind:"CreateIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists,where:this.transformNode(e.where,t),nullsNotDistinct:e.nullsNotDistinct})}transformList(e,t){return(0,o.requireAllProps)({kind:"ListNode",items:this.transformNodeList(e.items,t)})}transformDropIndex(e,t){return(0,o.requireAllProps)({kind:"DropIndexNode",name:this.transformNode(e.name,t),table:this.transformNode(e.table,t),ifExists:e.ifExists,cascade:e.cascade})}transformPrimaryKeyConstraint(e,t){return(0,o.requireAllProps)({kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred})}transformUniqueConstraint(e,t){return(0,o.requireAllProps)({kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns,t),name:this.transformNode(e.name,t),nullsNotDistinct:e.nullsNotDistinct,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred})}transformForeignKeyConstraint(e,t){return(0,o.requireAllProps)({kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns,t),references:this.transformNode(e.references,t),name:this.transformNode(e.name,t),onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable,initiallyDeferred:e.initiallyDeferred})}transformSetOperation(e,t){return(0,o.requireAllProps)({kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression,t),all:e.all})}transformReferences(e,t){return(0,o.requireAllProps)({kind:"ReferencesNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t),onDelete:e.onDelete,onUpdate:e.onUpdate})}transformCheckConstraint(e,t){return(0,o.requireAllProps)({kind:"CheckConstraintNode",expression:this.transformNode(e.expression,t),name:this.transformNode(e.name,t)})}transformWith(e,t){return(0,o.requireAllProps)({kind:"WithNode",expressions:this.transformNodeList(e.expressions,t),recursive:e.recursive})}transformCommonTableExpression(e,t){return(0,o.requireAllProps)({kind:"CommonTableExpressionNode",name:this.transformNode(e.name,t),materialized:e.materialized,expression:this.transformNode(e.expression,t)})}transformCommonTableExpressionName(e,t){return(0,o.requireAllProps)({kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table,t),columns:this.transformNodeList(e.columns,t)})}transformHaving(e,t){return(0,o.requireAllProps)({kind:"HavingNode",having:this.transformNode(e.having,t)})}transformCreateSchema(e,t){return(0,o.requireAllProps)({kind:"CreateSchemaNode",schema:this.transformNode(e.schema,t),ifNotExists:e.ifNotExists})}transformDropSchema(e,t){return(0,o.requireAllProps)({kind:"DropSchemaNode",schema:this.transformNode(e.schema,t),ifExists:e.ifExists,cascade:e.cascade})}transformAlterTable(e,t){return(0,o.requireAllProps)({kind:"AlterTableNode",table:this.transformNode(e.table,t),renameTo:this.transformNode(e.renameTo,t),setSchema:this.transformNode(e.setSchema,t),columnAlterations:this.transformNodeList(e.columnAlterations,t),addConstraint:this.transformNode(e.addConstraint,t),dropConstraint:this.transformNode(e.dropConstraint,t),renameConstraint:this.transformNode(e.renameConstraint,t),addIndex:this.transformNode(e.addIndex,t),dropIndex:this.transformNode(e.dropIndex,t)})}transformDropColumn(e,t){return(0,o.requireAllProps)({kind:"DropColumnNode",column:this.transformNode(e.column,t)})}transformRenameColumn(e,t){return(0,o.requireAllProps)({kind:"RenameColumnNode",column:this.transformNode(e.column,t),renameTo:this.transformNode(e.renameTo,t)})}transformAlterColumn(e,t){return(0,o.requireAllProps)({kind:"AlterColumnNode",column:this.transformNode(e.column,t),dataType:this.transformNode(e.dataType,t),dataTypeExpression:this.transformNode(e.dataTypeExpression,t),setDefault:this.transformNode(e.setDefault,t),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull})}transformModifyColumn(e,t){return(0,o.requireAllProps)({kind:"ModifyColumnNode",column:this.transformNode(e.column,t)})}transformAddConstraint(e,t){return(0,o.requireAllProps)({kind:"AddConstraintNode",constraint:this.transformNode(e.constraint,t)})}transformDropConstraint(e,t){return(0,o.requireAllProps)({kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName,t),ifExists:e.ifExists,modifier:e.modifier})}transformRenameConstraint(e,t){return(0,o.requireAllProps)({kind:"RenameConstraintNode",oldName:this.transformNode(e.oldName,t),newName:this.transformNode(e.newName,t)})}transformCreateView(e,t){return(0,o.requireAllProps)({kind:"CreateViewNode",name:this.transformNode(e.name,t),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns,t),as:this.transformNode(e.as,t)})}transformRefreshMaterializedView(e,t){return(0,o.requireAllProps)({kind:"RefreshMaterializedViewNode",name:this.transformNode(e.name,t),concurrently:e.concurrently,withNoData:e.withNoData})}transformDropView(e,t){return(0,o.requireAllProps)({kind:"DropViewNode",name:this.transformNode(e.name,t),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade})}transformGenerated(e,t){return(0,o.requireAllProps)({kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression,t)})}transformDefaultValue(e,t){return(0,o.requireAllProps)({kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue,t)})}transformOn(e,t){return(0,o.requireAllProps)({kind:"OnNode",on:this.transformNode(e.on,t)})}transformSelectModifier(e,t){return(0,o.requireAllProps)({kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier,t),of:this.transformNodeList(e.of,t)})}transformCreateType(e,t){return(0,o.requireAllProps)({kind:"CreateTypeNode",name:this.transformNode(e.name,t),enum:this.transformNode(e.enum,t)})}transformDropType(e,t){return(0,o.requireAllProps)({kind:"DropTypeNode",name:this.transformNode(e.name,t),ifExists:e.ifExists})}transformExplain(e,t){return(0,o.requireAllProps)({kind:"ExplainNode",format:e.format,options:this.transformNode(e.options,t)})}transformSchemableIdentifier(e,t){return(0,o.requireAllProps)({kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema,t),identifier:this.transformNode(e.identifier,t)})}transformAggregateFunction(e,t){return(0,o.requireAllProps)({kind:"AggregateFunctionNode",func:e.func,aggregated:this.transformNodeList(e.aggregated,t),distinct:e.distinct,orderBy:this.transformNode(e.orderBy,t),withinGroup:this.transformNode(e.withinGroup,t),filter:this.transformNode(e.filter,t),over:this.transformNode(e.over,t)})}transformOver(e,t){return(0,o.requireAllProps)({kind:"OverNode",orderBy:this.transformNode(e.orderBy,t),partitionBy:this.transformNode(e.partitionBy,t)})}transformPartitionBy(e,t){return(0,o.requireAllProps)({kind:"PartitionByNode",items:this.transformNodeList(e.items,t)})}transformPartitionByItem(e,t){return(0,o.requireAllProps)({kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy,t)})}transformBinaryOperation(e,t){return(0,o.requireAllProps)({kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand,t),operator:this.transformNode(e.operator,t),rightOperand:this.transformNode(e.rightOperand,t)})}transformUnaryOperation(e,t){return(0,o.requireAllProps)({kind:"UnaryOperationNode",operator:this.transformNode(e.operator,t),operand:this.transformNode(e.operand,t)})}transformUsing(e,t){return(0,o.requireAllProps)({kind:"UsingNode",tables:this.transformNodeList(e.tables,t)})}transformFunction(e,t){return(0,o.requireAllProps)({kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments,t)})}transformCase(e,t){return(0,o.requireAllProps)({kind:"CaseNode",value:this.transformNode(e.value,t),when:this.transformNodeList(e.when,t),else:this.transformNode(e.else,t),isStatement:e.isStatement})}transformWhen(e,t){return(0,o.requireAllProps)({kind:"WhenNode",condition:this.transformNode(e.condition,t),result:this.transformNode(e.result,t)})}transformJSONReference(e,t){return(0,o.requireAllProps)({kind:"JSONReferenceNode",reference:this.transformNode(e.reference,t),traversal:this.transformNode(e.traversal,t)})}transformJSONPath(e,t){return(0,o.requireAllProps)({kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator,t),pathLegs:this.transformNodeList(e.pathLegs,t)})}transformJSONPathLeg(e,t){return(0,o.requireAllProps)({kind:"JSONPathLegNode",type:e.type,value:e.value})}transformJSONOperatorChain(e,t){return(0,o.requireAllProps)({kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator,t),values:this.transformNodeList(e.values,t)})}transformTuple(e,t){return(0,o.requireAllProps)({kind:"TupleNode",values:this.transformNodeList(e.values,t)})}transformMergeQuery(e,t){return(0,o.requireAllProps)({kind:"MergeQueryNode",into:this.transformNode(e.into,t),using:this.transformNode(e.using,t),whens:this.transformNodeList(e.whens,t),with:this.transformNode(e.with,t),top:this.transformNode(e.top,t),endModifiers:this.transformNodeList(e.endModifiers,t),output:this.transformNode(e.output,t),returning:this.transformNode(e.returning,t)})}transformMatched(e,t){return(0,o.requireAllProps)({kind:"MatchedNode",not:e.not,bySource:e.bySource})}transformAddIndex(e,t){return(0,o.requireAllProps)({kind:"AddIndexNode",name:this.transformNode(e.name,t),columns:this.transformNodeList(e.columns,t),unique:e.unique,using:this.transformNode(e.using,t),ifNotExists:e.ifNotExists})}transformCast(e,t){return(0,o.requireAllProps)({kind:"CastNode",expression:this.transformNode(e.expression,t),dataType:this.transformNode(e.dataType,t)})}transformFetch(e,t){return(0,o.requireAllProps)({kind:"FetchNode",rowCount:this.transformNode(e.rowCount,t),modifier:e.modifier})}transformTop(e,t){return(0,o.requireAllProps)({kind:"TopNode",expression:e.expression,modifiers:e.modifiers})}transformOutput(e,t){return(0,o.requireAllProps)({kind:"OutputNode",selections:this.transformNodeList(e.selections,t)})}transformDataType(e,t){return e}transformSelectAll(e,t){return e}transformIdentifier(e,t){return e}transformValue(e,t){return e}transformPrimitiveValueList(e,t){return e}transformOperator(e,t){return e}transformDefaultInsertValue(e,t){return e}transformOrAction(e,t){return e}transformCollate(e,t){return e}}}},580441:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({WithSchemaTransformer:()=>l});var r=e.i(55167),o=e.i(453409),s=e.i(393799),n=e.i(794220),a=e.i(318106),d=e.i(164563);let t=(0,e.i(535542).freeze)({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),i={json_agg:!0,to_json:!0};class l extends n.OperationNodeTransformer{#s;#n=new Set;#a=new Set;constructor(e){super(),this.#s=e}transformNodeImpl(e,t){if(!this.#d(e))return super.transformNodeImpl(e,t);let i=this.#l(e);for(let e of i)this.#a.add(e);let r=this.#c(e);for(let e of r)this.#n.add(e);let o=super.transformNodeImpl(e,t);for(let e of r)this.#n.delete(e);for(let e of i)this.#a.delete(e);return o}transformSchemableIdentifier(e,t){let i=super.transformSchemableIdentifier(e,t);return i.schema||!this.#n.has(e.identifier.name)?i:{...i,schema:o.IdentifierNode.create(this.#s)}}transformReferences(e,t){let i=super.transformReferences(e,t);return i.table.table.schema?i:{...i,table:d.TableNode.createWithSchema(this.#s,i.table.table.identifier.name)}}transformAggregateFunction(e,t){return{...super.transformAggregateFunction({...e,aggregated:[]},t),aggregated:this.#u(e,t,"aggregated")}}transformFunction(e,t){return{...super.transformFunction({...e,arguments:[]},t),arguments:this.#u(e,t,"arguments")}}#u(e,t,r){return i[e.func]?e[r].map(e=>!d.TableNode.is(e)||e.table.schema?this.transformNode(e,t):{...e,table:this.transformIdentifier(e.table.identifier,t)}):this.transformNodeList(e[r],t)}#d(e){return e.kind in t}#c(e){let t=new Set;if("name"in e&&e.name&&a.SchemableIdentifierNode.is(e.name)&&this.#p(e.name,t),"from"in e&&e.from)for(let i of e.from.froms)this.#h(i,t);if("into"in e&&e.into&&this.#h(e.into,t),"table"in e&&e.table&&this.#h(e.table,t),"joins"in e&&e.joins)for(let i of e.joins)this.#h(i.table,t);return"using"in e&&e.using&&this.#h(e.using,t),t}#l(e){let t=new Set;return"with"in e&&e.with&&this.#m(e.with,t),t}#h(e,t){if(d.TableNode.is(e))this.#p(e.table,t);else if(r.AliasNode.is(e)&&d.TableNode.is(e.node))this.#p(e.node.table,t);else if(s.ListNode.is(e))for(let i of e.items)this.#h(i,t)}#p(e,t){let i=e.identifier.name;this.#n.has(i)||this.#a.has(i)||t.add(i)}#m(e,t){for(let i of e.expressions){let e=i.name.table.table.identifier.name;this.#a.has(e)||t.add(e)}}}}},569292:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({WithSchemaPlugin:()=>t});var r=e.i(580441);class t{#f;constructor(e){this.#f=new r.WithSchemaTransformer(e)}transformQuery(e){return this.#f.transformNode(e.node,e.queryId)}async transformResult(e){return e.result}}}},503366:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MatchedNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"MatchedNode"===e.kind,create:(e,t=!1)=>(0,r.freeze)({kind:"MatchedNode",not:e,bySource:t})})}},343664:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseMergeThen:()=>c,parseMergeWhen:()=>l});var r=e.i(503366),o=e.i(131385),s=e.i(620581),n=e.i(826615),a=e.i(535542),d=e.i(458836);function l(e,t,i){return n.WhenNode.create((0,d.parseFilterList)([r.MatchedNode.create(!e.isMatched,e.bySource),...t&&t.length>0?[3===t.length&&i?(0,d.parseReferentialBinaryOperation)(t[0],t[1],t[2]):(0,d.parseValueBinaryOperationOrExpression)(t)]:[]],"and",!1))}function c(e){return(0,a.isString)(e)?s.RawNode.create([e],[]):(0,o.isOperationNodeSource)(e)?e.toOperationNode():e}},55530:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({Deferred:()=>t});class t{#A;#g;#y;constructor(){this.#A=new Promise((e,t)=>{this.#y=t,this.#g=e})}get promise(){return this.#A}resolve=e=>{this.#g&&this.#g(e)};reject=e=>{this.#y&&this.#y(e)}}}},643207:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({provideControlledConnection:()=>s});var r=e.i(55530),o=e.i(535542);async function s(e){let t=new r.Deferred,i=new r.Deferred;return e.provideConnection(async e=>(t.resolve(e),await i.promise)).catch(e=>t.reject(e)),(0,o.freeze)({connection:await t.promise,release:i.resolve})}},736340:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({QueryExecutorBase:()=>i});var r=e.i(535542),o=e.i(643207),s=e.i(57239);let t=(0,r.freeze)([]);class i{#K;constructor(e=t){this.#K=e}get plugins(){return this.#K}transformQuery(e,t){for(let i of this.#K){let r=i.transformQuery({node:e,queryId:t});if(r.kind===e.kind)e=r;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${e.kind} but it returned a ${r.kind}`)}return e}async executeQuery(e,t){return await this.provideConnection(async i=>{let r=await i.executeQuery(e);return"numUpdatedOrDeletedRows"in r&&(0,s.logOnce)("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#w(r,t)})}async *stream(e,t,i){let{connection:r,release:s}=await (0,o.provideControlledConnection)(this);try{for await(let o of r.streamQuery(e,t))yield await this.#w(o,i)}finally{s()}}async #w(e,t){for(let i of this.#K)e=await i.transformResult({result:e,queryId:t});return e}}}},137096:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({NOOP_QUERY_EXECUTOR:()=>i,NoopQueryExecutor:()=>t});var r=e.i(736340);class t extends r.QueryExecutorBase{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(e){return new t([...this.plugins,e])}withPlugins(e){return new t([...this.plugins,...e])}withPluginAtFront(e){return new t([e,...this.plugins])}withoutPlugins(){return new t([])}}let i=new t}},198638:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MergeResult:()=>t});class t{numChangedRows;constructor(e){this.numChangedRows=e}}}},577558:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MatchedThenableMergeQueryBuilder:()=>g,MergeQueryBuilder:()=>t,NotMatchedThenableMergeQueryBuilder:()=>y,WheneableMergeQueryBuilder:()=>i});var r=e.i(777174),o=e.i(860934),s=e.i(430596),n=e.i(636214),a=e.i(814301),d=e.i(756612),l=e.i(343664),c=e.i(322848),u=e.i(373900),p=e.i(137096),h=e.i(535542),m=e.i(198638),f=e.i(446767),A=e.i(537788);class t{#t;constructor(e){this.#t=(0,h.freeze)(e)}modifyEnd(e){return new t({...this.#t,queryNode:s.QueryNode.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,i){return new t({...this.#t,queryNode:s.QueryNode.cloneWithTop(this.#t.queryNode,(0,u.parseTop)(e,i))})}using(...e){return new i({...this.#t,queryNode:o.MergeQueryNode.cloneWithUsing(this.#t.queryNode,(0,d.parseJoin)("Using",e))})}returning(e){return new t({...this.#t,queryNode:s.QueryNode.cloneWithReturning(this.#t.queryNode,(0,c.parseSelectArg)(e))})}returningAll(e){return new t({...this.#t,queryNode:s.QueryNode.cloneWithReturning(this.#t.queryNode,(0,c.parseSelectAll)(e))})}output(e){return new t({...this.#t,queryNode:s.QueryNode.cloneWithOutput(this.#t.queryNode,(0,c.parseSelectArg)(e))})}outputAll(e){return new t({...this.#t,queryNode:s.QueryNode.cloneWithOutput(this.#t.queryNode,(0,c.parseSelectAll)(e))})}}class i{#t;constructor(e){this.#t=(0,h.freeze)(e)}modifyEnd(e){return new i({...this.#t,queryNode:s.QueryNode.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new i({...this.#t,queryNode:s.QueryNode.cloneWithTop(this.#t.queryNode,(0,u.parseTop)(e,t))})}whenMatched(){return this.#v([])}whenMatchedAnd(...e){return this.#v(e)}whenMatchedAndRef(e,t,i){return this.#v([e,t,i],!0)}#v(e,t){return new g({...this.#t,queryNode:o.MergeQueryNode.cloneWithWhen(this.#t.queryNode,(0,l.parseMergeWhen)({isMatched:!0},e,t))})}whenNotMatched(){return this.#b([])}whenNotMatchedAnd(...e){return this.#b(e)}whenNotMatchedAndRef(e,t,i){return this.#b([e,t,i],!0)}whenNotMatchedBySource(){return this.#b([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#b(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,i){return this.#b([e,t,i],!0,!0)}returning(e){return new i({...this.#t,queryNode:s.QueryNode.cloneWithReturning(this.#t.queryNode,(0,c.parseSelectArg)(e))})}returningAll(e){return new i({...this.#t,queryNode:s.QueryNode.cloneWithReturning(this.#t.queryNode,(0,c.parseSelectAll)(e))})}output(e){return new i({...this.#t,queryNode:s.QueryNode.cloneWithOutput(this.#t.queryNode,(0,c.parseSelectArg)(e))})}outputAll(e){return new i({...this.#t,queryNode:s.QueryNode.cloneWithOutput(this.#t.queryNode,(0,c.parseSelectAll)(e))})}#b(e,t=!1,i=!1){let r={...this.#t,queryNode:o.MergeQueryNode.cloneWithWhen(this.#t.queryNode,(0,l.parseMergeWhen)({isMatched:!1,bySource:i},e,t))};return new(i?g:y)(r)}$call(e){return e(this)}$if(e,t){return e?t(this):new i({...this.#t})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:i}=this.#t.executor,r=e.query;return r.returning&&i.supportsReturning||r.output&&i.supportsOutput?t.rows:[new m.MergeResult(t.numAffectedRows)]}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=f.NoResultError){let t=await this.executeTakeFirst();if(void 0===t)throw(0,f.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}}class g{#t;constructor(e){this.#t=(0,h.freeze)(e)}thenDelete(){return new i({...this.#t,queryNode:o.MergeQueryNode.cloneWithThen(this.#t.queryNode,(0,l.parseMergeThen)("delete"))})}thenDoNothing(){return new i({...this.#t,queryNode:o.MergeQueryNode.cloneWithThen(this.#t.queryNode,(0,l.parseMergeThen)("do nothing"))})}thenUpdate(e){return new i({...this.#t,queryNode:o.MergeQueryNode.cloneWithThen(this.#t.queryNode,(0,l.parseMergeThen)(e(new A.UpdateQueryBuilder({queryId:this.#t.queryId,executor:p.NOOP_QUERY_EXECUTOR,queryNode:n.UpdateQueryNode.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(t=>t.set(...e))}}class y{#t;constructor(e){this.#t=(0,h.freeze)(e)}thenDoNothing(){return new i({...this.#t,queryNode:o.MergeQueryNode.cloneWithThen(this.#t.queryNode,(0,l.parseMergeThen)("do nothing"))})}thenInsertValues(e){let[t,s]=(0,a.parseInsertExpression)(e);return new i({...this.#t,queryNode:o.MergeQueryNode.cloneWithThen(this.#t.queryNode,(0,l.parseMergeThen)(r.InsertQueryNode.cloneWith(r.InsertQueryNode.createWithoutInto(),{columns:t,values:s})))})}}}},145520:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({QueryCreator:()=>t});var r=e.i(814129),o=e.i(955530),s=e.i(924673),n=e.i(537788),a=e.i(819985),d=e.i(777174),l=e.i(302166),c=e.i(636214),u=e.i(777649),p=e.i(555537),h=e.i(748532),m=e.i(729895),f=e.i(569292),A=e.i(535542),g=e.i(322848),y=e.i(577558),K=e.i(860934);class t{#t;constructor(e){this.#t=(0,A.freeze)(e)}selectFrom(e){return(0,r.createSelectQueryBuilder)({queryId:(0,m.createQueryId)(),executor:this.#t.executor,queryNode:l.SelectQueryNode.createFrom((0,u.parseTableExpressionOrList)(e),this.#t.withNode)})}selectNoFrom(e){return(0,r.createSelectQueryBuilder)({queryId:(0,m.createQueryId)(),executor:this.#t.executor,queryNode:l.SelectQueryNode.cloneWithSelections(l.SelectQueryNode.create(this.#t.withNode),(0,g.parseSelectArg)(e))})}insertInto(e){return new o.InsertQueryBuilder({queryId:(0,m.createQueryId)(),executor:this.#t.executor,queryNode:d.InsertQueryNode.create((0,u.parseTable)(e),this.#t.withNode)})}replaceInto(e){return new o.InsertQueryBuilder({queryId:(0,m.createQueryId)(),executor:this.#t.executor,queryNode:d.InsertQueryNode.create((0,u.parseTable)(e),this.#t.withNode,!0)})}deleteFrom(e){return new s.DeleteQueryBuilder({queryId:(0,m.createQueryId)(),executor:this.#t.executor,queryNode:a.DeleteQueryNode.create((0,u.parseTableExpressionOrList)(e),this.#t.withNode)})}updateTable(e){return new n.UpdateQueryBuilder({queryId:(0,m.createQueryId)(),executor:this.#t.executor,queryNode:c.UpdateQueryNode.create((0,u.parseTableExpressionOrList)(e),this.#t.withNode)})}mergeInto(e){return new y.MergeQueryBuilder({queryId:(0,m.createQueryId)(),executor:this.#t.executor,queryNode:K.MergeQueryNode.create((0,u.parseAliasedTable)(e),this.#t.withNode)})}with(e,i){let r=(0,p.parseCommonTableExpression)(e,i);return new t({...this.#t,withNode:this.#t.withNode?h.WithNode.cloneWithExpression(this.#t.withNode,r):h.WithNode.create(r)})}withRecursive(e,i){let r=(0,p.parseCommonTableExpression)(e,i);return new t({...this.#t,withNode:this.#t.withNode?h.WithNode.cloneWithExpression(this.#t.withNode,r):h.WithNode.create(r,{recursive:!0})})}withPlugin(e){return new t({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new t({...this.#t,executor:this.#t.executor.withPluginAtFront(new f.WithSchemaPlugin(e))})}}}},42479:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createJoinBuilder:()=>f,createOverBuilder:()=>A,createQueryCreator:()=>m,createSelectQueryBuilder:()=>h});var r=e.i(682152),o=e.i(373164),s=e.i(302166),n=e.i(364523),a=e.i(347542),d=e.i(814129),l=e.i(145520),c=e.i(137096),u=e.i(729895),p=e.i(777649);function h(){return(0,d.createSelectQueryBuilder)({queryId:(0,u.createQueryId)(),executor:c.NOOP_QUERY_EXECUTOR,queryNode:s.SelectQueryNode.createFrom((0,p.parseTableExpressionOrList)([]))})}function m(){return new l.QueryCreator({executor:c.NOOP_QUERY_EXECUTOR})}function f(e,t){return new n.JoinBuilder({joinNode:r.JoinNode.create(e,(0,p.parseTableExpression)(t))})}function A(){return new a.OverBuilder({overNode:o.OverNode.create()})}},756612:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseJoin:()=>a});var r=e.i(682152),o=e.i(458836),s=e.i(42479),n=e.i(777649);function a(e,t){var i,a,d,l,c,u,p,h;if(3===t.length){return i=e,a=t[0],d=t[1],l=t[2],r.JoinNode.createWithOn(i,(0,n.parseTableExpression)(a),(0,o.parseReferentialBinaryOperation)(d,"=",l))}if(2===t.length){return c=e,u=t[0],(0,t[1])((0,s.createJoinBuilder)(c,u)).toOperationNode()}if(1===t.length){return p=e,h=t[0],r.JoinNode.create(p,(0,n.parseTableExpression)(h))}throw Error("not implemented")}},516820:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OffsetNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"OffsetNode"===e.kind,create:e=>(0,r.freeze)({kind:"OffsetNode",offset:e})})}},905268:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({GroupByItemNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"GroupByItemNode"===e.kind,create:e=>(0,r.freeze)({kind:"GroupByItemNode",groupBy:e})})}},135742:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseGroupBy:()=>a});var r=e.i(905268),o=e.i(647211),s=e.i(535542),n=e.i(927766);function a(e){return e=(0,s.isFunction)(e)?e((0,o.expressionBuilder)()):e,(0,n.parseReferenceExpressionOrList)(e).map(r.GroupByItemNode.create)}},505072:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SetOperationNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"SetOperationNode"===e.kind,create:(e,t,i)=>(0,r.freeze)({kind:"SetOperationNode",operator:e,expression:t,all:i})})}},824640:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseSetOperations:()=>a});var r=e.i(647211),o=e.i(505072),s=e.i(535542),n=e.i(627710);function a(e,t,i){return(0,s.isFunction)(t)&&(t=t((0,r.createExpressionBuilder)())),(0,s.isReadonlyArray)(t)||(t=[t]),t.map(t=>o.SetOperationNode.create(e,(0,n.parseExpression)(t),i))}},661193:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AliasedExpressionWrapper:()=>i,AndWrapper:()=>u,ExpressionWrapper:()=>t,OrWrapper:()=>c});var r=e.i(55167),o=e.i(79045),s=e.i(453409),n=e.i(131385),a=e.i(117792),d=e.i(154362),l=e.i(458836);class t{#_;constructor(e){this.#_=e}get expressionType(){}as(e){return new i(this,e)}or(...e){return new c(a.OrNode.create(this.#_,(0,l.parseValueBinaryOperationOrExpression)(e)))}and(...e){return new u(o.AndNode.create(this.#_,(0,l.parseValueBinaryOperationOrExpression)(e)))}$castTo(){return new t(this.#_)}$notNull(){return new t(this.#_)}toOperationNode(){return this.#_}}class i{#N;#I;constructor(e,t){this.#N=e,this.#I=t}get expression(){return this.#N}get alias(){return this.#I}toOperationNode(){return r.AliasNode.create(this.#N.toOperationNode(),(0,n.isOperationNodeSource)(this.#I)?this.#I.toOperationNode():s.IdentifierNode.create(this.#I))}}class c{#_;constructor(e){this.#_=e}get expressionType(){}as(e){return new i(this,e)}or(...e){return new c(a.OrNode.create(this.#_,(0,l.parseValueBinaryOperationOrExpression)(e)))}$castTo(){return new c(this.#_)}toOperationNode(){return d.ParensNode.create(this.#_)}}class u{#_;constructor(e){this.#_=e}get expressionType(){}as(e){return new i(this,e)}and(...e){return new u(o.AndNode.create(this.#_,(0,l.parseValueBinaryOperationOrExpression)(e)))}$castTo(){return new u(this.#_)}toOperationNode(){return d.ParensNode.create(this.#_)}}}},465859:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({FetchNode:()=>t});var r=e.i(21348);let t={is:e=>"FetchNode"===e.kind,create:(e,t)=>({kind:"FetchNode",rowCount:r.ValueNode.create(e),modifier:t})}}},985447:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseFetch:()=>s});var r=e.i(465859),o=e.i(535542);function s(e,t){var i;if(!(0,o.isNumber)(e)&&!(0,o.isBigInt)(e))throw Error(`Invalid fetch row count: ${e}`);if("only"!==(i=t)&&"with ties"!==i)throw Error(`Invalid fetch modifier: ${t}`);return r.FetchNode.create(e,t)}},814129:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createSelectQueryBuilder:()=>N});var r=e.i(55167),o=e.i(720446),s=e.i(756612),n=e.i(777649),a=e.i(322848),d=e.i(927766),l=e.i(302166),c=e.i(430596),u=e.i(534650),p=e.i(700736),h=e.i(516820),m=e.i(535542),f=e.i(135742),A=e.i(446767),g=e.i(453409),y=e.i(824640),K=e.i(458836),w=e.i(661193),v=e.i(374697),b=e.i(985447),_=e.i(373900);class t{#t;constructor(e){this.#t=(0,m.freeze)(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new t({...this.#t,queryNode:c.QueryNode.cloneWithWhere(this.#t.queryNode,(0,K.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,i,r){return new t({...this.#t,queryNode:c.QueryNode.cloneWithWhere(this.#t.queryNode,(0,K.parseReferentialBinaryOperation)(e,i,r))})}having(...e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithHaving(this.#t.queryNode,(0,K.parseValueBinaryOperationOrExpression)(e))})}havingRef(e,i,r){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithHaving(this.#t.queryNode,(0,K.parseReferentialBinaryOperation)(e,i,r))})}select(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithSelections(this.#t.queryNode,(0,a.parseSelectArg)(e))})}distinctOn(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithDistinctOn(this.#t.queryNode,(0,d.parseReferenceExpressionOrList)(e))})}modifyFront(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithFrontModifier(this.#t.queryNode,o.SelectModifierNode.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new t({...this.#t,queryNode:c.QueryNode.cloneWithEndModifier(this.#t.queryNode,o.SelectModifierNode.createWithExpression(e.toOperationNode()))})}distinct(){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithFrontModifier(this.#t.queryNode,o.SelectModifierNode.create("Distinct"))})}forUpdate(e){return new t({...this.#t,queryNode:c.QueryNode.cloneWithEndModifier(this.#t.queryNode,o.SelectModifierNode.create("ForUpdate",e?(0,m.asArray)(e).map(n.parseTable):void 0))})}forShare(e){return new t({...this.#t,queryNode:c.QueryNode.cloneWithEndModifier(this.#t.queryNode,o.SelectModifierNode.create("ForShare",e?(0,m.asArray)(e).map(n.parseTable):void 0))})}forKeyShare(e){return new t({...this.#t,queryNode:c.QueryNode.cloneWithEndModifier(this.#t.queryNode,o.SelectModifierNode.create("ForKeyShare",e?(0,m.asArray)(e).map(n.parseTable):void 0))})}forNoKeyUpdate(e){return new t({...this.#t,queryNode:c.QueryNode.cloneWithEndModifier(this.#t.queryNode,o.SelectModifierNode.create("ForNoKeyUpdate",e?(0,m.asArray)(e).map(n.parseTable):void 0))})}skipLocked(){return new t({...this.#t,queryNode:c.QueryNode.cloneWithEndModifier(this.#t.queryNode,o.SelectModifierNode.create("SkipLocked"))})}noWait(){return new t({...this.#t,queryNode:c.QueryNode.cloneWithEndModifier(this.#t.queryNode,o.SelectModifierNode.create("NoWait"))})}selectAll(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithSelections(this.#t.queryNode,(0,a.parseSelectAll)(e))})}innerJoin(...e){return this.#i("InnerJoin",e)}leftJoin(...e){return this.#i("LeftJoin",e)}rightJoin(...e){return this.#i("RightJoin",e)}fullJoin(...e){return this.#i("FullJoin",e)}crossJoin(...e){return this.#i("CrossJoin",e)}innerJoinLateral(...e){return this.#i("LateralInnerJoin",e)}leftJoinLateral(...e){return this.#i("LateralLeftJoin",e)}crossJoinLateral(...e){return this.#i("LateralCrossJoin",e)}crossApply(...e){return this.#i("CrossApply",e)}outerApply(...e){return this.#i("OuterApply",e)}#i(e,i){return new t({...this.#t,queryNode:c.QueryNode.cloneWithJoin(this.#t.queryNode,(0,s.parseJoin)(e,i))})}orderBy(...e){return new t({...this.#t,queryNode:c.QueryNode.cloneWithOrderByItems(this.#t.queryNode,(0,u.parseOrderBy)(e))})}groupBy(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithGroupByItems(this.#t.queryNode,(0,f.parseGroupBy)(e))})}limit(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithLimit(this.#t.queryNode,p.LimitNode.create((0,v.parseValueExpression)(e)))})}offset(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithOffset(this.#t.queryNode,h.OffsetNode.create((0,v.parseValueExpression)(e)))})}fetch(e,i="only"){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithFetch(this.#t.queryNode,(0,b.parseFetch)(e,i))})}top(e,i){return new t({...this.#t,queryNode:c.QueryNode.cloneWithTop(this.#t.queryNode,(0,_.parseTop)(e,i))})}union(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithSetOperations(this.#t.queryNode,(0,y.parseSetOperations)("union",e,!1))})}unionAll(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithSetOperations(this.#t.queryNode,(0,y.parseSetOperations)("union",e,!0))})}intersect(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithSetOperations(this.#t.queryNode,(0,y.parseSetOperations)("intersect",e,!1))})}intersectAll(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithSetOperations(this.#t.queryNode,(0,y.parseSetOperations)("intersect",e,!0))})}except(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithSetOperations(this.#t.queryNode,(0,y.parseSetOperations)("except",e,!1))})}exceptAll(e){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithSetOperations(this.#t.queryNode,(0,y.parseSetOperations)("except",e,!0))})}as(e){return new i(this,e)}clearSelect(){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithoutSelections(this.#t.queryNode)})}clearWhere(){return new t({...this.#t,queryNode:c.QueryNode.cloneWithoutWhere(this.#t.queryNode)})}clearLimit(){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithoutLimit(this.#t.queryNode)})}clearOffset(){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithoutOffset(this.#t.queryNode)})}clearOrderBy(){return new t({...this.#t,queryNode:c.QueryNode.cloneWithoutOrderBy(this.#t.queryNode)})}clearGroupBy(){return new t({...this.#t,queryNode:l.SelectQueryNode.cloneWithoutGroupBy(this.#t.queryNode)})}$call(e){return e(this)}$if(e,i){return e?i(this):new t({...this.#t})}$castTo(){return new t(this.#t)}$narrowType(){return new t(this.#t)}$assertType(){return new t(this.#t)}$asTuple(){return new w.ExpressionWrapper(this.toOperationNode())}$asScalar(){return new w.ExpressionWrapper(this.toOperationNode())}withPlugin(e){return new t({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){let e=this.compile();return(await this.#t.executor.executeQuery(e,this.#t.queryId)).rows}async executeTakeFirst(){let[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=A.NoResultError){let t=await this.executeTakeFirst();if(void 0===t)throw(0,A.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode());return t}async *stream(e=100){let t=this.compile();for await(let i of this.#t.executor.stream(t,e,this.#t.queryId))yield*i.rows}async explain(e,i){let r=new t({...this.#t,queryNode:c.QueryNode.cloneWithExplain(this.#t.queryNode,e,i)});return await r.execute()}}function N(e){return new t(e)}class i{#E;#I;constructor(e,t){this.#E=e,this.#I=t}get expression(){return this.#E}get alias(){return this.#I}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return r.AliasNode.create(this.#E.toOperationNode(),g.IdentifierNode.create(this.#I))}}}},897772:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AggregateFunctionNode:()=>t});var r=e.i(535542),o=e.i(339468),s=e.i(840349);let t=(0,r.freeze)({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t=[])=>(0,r.freeze)({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>(0,r.freeze)({...e,distinct:!0}),cloneWithOrderBy(e,t,i=!1){let o=i?"withinGroup":"orderBy";return(0,r.freeze)({...e,[o]:e[o]?s.OrderByNode.cloneWithItems(e[o],t):s.OrderByNode.create(t)})},cloneWithFilter:(e,t)=>(0,r.freeze)({...e,filter:e.filter?o.WhereNode.cloneWithOperation(e.filter,"And",t):o.WhereNode.create(t)}),cloneWithOrFilter:(e,t)=>(0,r.freeze)({...e,filter:e.filter?o.WhereNode.cloneWithOperation(e.filter,"Or",t):o.WhereNode.create(t)}),cloneWithOver:(e,t)=>(0,r.freeze)({...e,over:t})})}},70519:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({FunctionNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"FunctionNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"FunctionNode",func:e,arguments:t})})}},740881:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AggregateFunctionBuilder:()=>t,AliasedAggregateFunctionBuilder:()=>i});var r=e.i(535542),o=e.i(897772),s=e.i(55167),n=e.i(453409),a=e.i(42479),d=e.i(458836),l=e.i(534650),c=e.i(430596);class t{#t;constructor(e){this.#t=(0,r.freeze)(e)}get expressionType(){}as(e){return new i(this,e)}distinct(){return new t({...this.#t,aggregateFunctionNode:o.AggregateFunctionNode.cloneWithDistinct(this.#t.aggregateFunctionNode)})}orderBy(...e){return new t({...this.#t,aggregateFunctionNode:c.QueryNode.cloneWithOrderByItems(this.#t.aggregateFunctionNode,(0,l.parseOrderBy)(e))})}clearOrderBy(){return new t({...this.#t,aggregateFunctionNode:c.QueryNode.cloneWithoutOrderBy(this.#t.aggregateFunctionNode)})}withinGroupOrderBy(...e){return new t({...this.#t,aggregateFunctionNode:o.AggregateFunctionNode.cloneWithOrderBy(this.#t.aggregateFunctionNode,(0,l.parseOrderBy)(e),!0)})}filterWhere(...e){return new t({...this.#t,aggregateFunctionNode:o.AggregateFunctionNode.cloneWithFilter(this.#t.aggregateFunctionNode,(0,d.parseValueBinaryOperationOrExpression)(e))})}filterWhereRef(e,i,r){return new t({...this.#t,aggregateFunctionNode:o.AggregateFunctionNode.cloneWithFilter(this.#t.aggregateFunctionNode,(0,d.parseReferentialBinaryOperation)(e,i,r))})}over(e){let i=(0,a.createOverBuilder)();return new t({...this.#t,aggregateFunctionNode:o.AggregateFunctionNode.cloneWithOver(this.#t.aggregateFunctionNode,(e?e(i):i).toOperationNode())})}$call(e){return e(this)}$castTo(){return new t(this.#t)}$notNull(){return new t(this.#t)}toOperationNode(){return this.#t.aggregateFunctionNode}}class i{#T;#I;constructor(e,t){this.#T=e,this.#I=t}get expression(){return this.#T}get alias(){return this.#I}toOperationNode(){return s.AliasNode.create(this.#T.toOperationNode(),n.IdentifierNode.create(this.#I))}}}},633752:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createFunctionModule:()=>u});var r=e.i(661193),o=e.i(897772),s=e.i(70519),n=e.i(927766),a=e.i(322848),d=e.i(740881),l=e.i(535542),c=e.i(777649);function u(){let e=(e,t)=>new r.ExpressionWrapper(s.FunctionNode.create(e,(0,n.parseReferenceExpressionOrList)(t??[]))),t=(e,t)=>new d.AggregateFunctionBuilder({aggregateFunctionNode:o.AggregateFunctionNode.create(e,t?(0,n.parseReferenceExpressionOrList)(t):void 0)});return Object.assign(e,{agg:t,avg:e=>t("avg",[e]),coalesce:(...t)=>e("coalesce",t),count:e=>t("count",[e]),countAll:e=>new d.AggregateFunctionBuilder({aggregateFunctionNode:o.AggregateFunctionNode.create("count",(0,a.parseSelectAll)(e))}),max:e=>t("max",[e]),min:e=>t("min",[e]),sum:e=>t("sum",[e]),any:t=>e("any",[t]),jsonAgg:e=>new d.AggregateFunctionBuilder({aggregateFunctionNode:o.AggregateFunctionNode.create("json_agg",[(0,l.isString)(e)?(0,c.parseTable)(e):e.toOperationNode()])}),toJson:e=>new r.ExpressionWrapper(s.FunctionNode.create("to_json",[(0,l.isString)(e)?(0,c.parseTable)(e):e.toOperationNode()]))})}},544953:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({UnaryOperationNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"UnaryOperationNode",operator:e,operand:t})})}},780431:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseExists:()=>n,parseNotExists:()=>a,parseUnaryOperation:()=>d});var r=e.i(268375),o=e.i(544953),s=e.i(927766);function n(e){return d("exists",e)}function a(e){return d("not exists",e)}function d(e,t){return o.UnaryOperationNode.create(r.OperatorNode.create(e),(0,s.parseReferenceExpression)(t))}},92773:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CaseNode:()=>t});var r=e.i(535542),o=e.i(826615);let t=(0,r.freeze)({is:e=>"CaseNode"===e.kind,create:e=>(0,r.freeze)({kind:"CaseNode",value:e}),cloneWithWhen:(e,t)=>(0,r.freeze)({...e,when:(0,r.freeze)(e.when?[...e.when,t]:[t])}),cloneWithThen:(e,t)=>(0,r.freeze)({...e,when:e.when?(0,r.freeze)([...e.when.slice(0,-1),o.WhenNode.cloneWithResult(e.when[e.when.length-1],t)]):void 0}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},200362:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CaseBuilder:()=>t,CaseEndBuilder:()=>c,CaseThenBuilder:()=>i,CaseWhenBuilder:()=>l});var r=e.i(661193),o=e.i(535542),s=e.i(92773),n=e.i(826615),a=e.i(458836),d=e.i(374697);class t{#t;constructor(e){this.#t=(0,o.freeze)(e)}when(...e){return new i({...this.#t,node:s.CaseNode.cloneWithWhen(this.#t.node,n.WhenNode.create((0,a.parseValueBinaryOperationOrExpression)(e)))})}}class i{#t;constructor(e){this.#t=(0,o.freeze)(e)}then(e){return new l({...this.#t,node:s.CaseNode.cloneWithThen(this.#t.node,(0,d.isSafeImmediateValue)(e)?(0,d.parseSafeImmediateValue)(e):(0,d.parseValueExpression)(e))})}}class l{#t;constructor(e){this.#t=(0,o.freeze)(e)}when(...e){return new i({...this.#t,node:s.CaseNode.cloneWithWhen(this.#t.node,n.WhenNode.create((0,a.parseValueBinaryOperationOrExpression)(e)))})}else(e){return new c({...this.#t,node:s.CaseNode.cloneWith(this.#t.node,{else:(0,d.isSafeImmediateValue)(e)?(0,d.parseSafeImmediateValue)(e):(0,d.parseValueExpression)(e)})})}end(){return new r.ExpressionWrapper(s.CaseNode.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new r.ExpressionWrapper(s.CaseNode.cloneWith(this.#t.node,{isStatement:!0}))}}class c{#t;constructor(e){this.#t=(0,o.freeze)(e)}end(){return new r.ExpressionWrapper(s.CaseNode.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new r.ExpressionWrapper(s.CaseNode.cloneWith(this.#t.node,{isStatement:!0}))}}}},191242:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({JSONPathLegNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"JSONPathLegNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"JSONPathLegNode",type:e,value:t})})}},640875:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AliasedJSONPathBuilder:()=>u,JSONPathBuilder:()=>t,TraversedJSONPathBuilder:()=>i});var r=e.i(55167),o=e.i(453409),s=e.i(781094),n=e.i(191242),a=e.i(731213),d=e.i(211245),l=e.i(131385),c=e.i(21348);class t{#_;constructor(e){this.#_=e}at(e){return this.#C("ArrayLocation",e)}key(e){return this.#C("Member",e)}#C(e,t){return new i(d.JSONReferenceNode.is(this.#_)?d.JSONReferenceNode.cloneWithTraversal(this.#_,a.JSONPathNode.is(this.#_.traversal)?a.JSONPathNode.cloneWithLeg(this.#_.traversal,n.JSONPathLegNode.create(e,t)):s.JSONOperatorChainNode.cloneWithValue(this.#_.traversal,c.ValueNode.createImmediate(t))):a.JSONPathNode.cloneWithLeg(this.#_,n.JSONPathLegNode.create(e,t)))}}class i extends t{#_;constructor(e){super(e),this.#_=e}get expressionType(){}as(e){return new u(this,e)}$castTo(){return new i(this.#_)}$notNull(){return new i(this.#_)}toOperationNode(){return this.#_}}class u{#x;#I;constructor(e,t){this.#x=e,this.#I=t}get expression(){return this.#x}get alias(){return this.#I}toOperationNode(){return r.AliasNode.create(this.#x.toOperationNode(),(0,l.isOperationNodeSource)(this.#I)?this.#I.toOperationNode():o.IdentifierNode.create(this.#I))}}}},211256:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({TupleNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"TupleNode"===e.kind,create:e=>(0,r.freeze)({kind:"TupleNode",values:(0,r.freeze)(e)})})}},995852:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DataTypeNode:()=>s,isColumnDataType:()=>o});var r=e.i(535542);let t=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],i=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],s=(0,r.freeze)({is:e=>"DataTypeNode"===e.kind,create:e=>(0,r.freeze)({kind:"DataTypeNode",dataType:e})});function o(e){return!!(t.includes(e)||i.some(t=>t.test(e)))}}},328918:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseDataTypeExpression:()=>s});var r=e.i(995852),o=e.i(131385);function s(e){if((0,o.isOperationNodeSource)(e))return e.toOperationNode();if((0,r.isColumnDataType)(e))return r.DataTypeNode.create(e);throw Error(`invalid column data type ${JSON.stringify(e)}`)}},46150:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CastNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"CastNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"CastNode",expression:e,dataType:t})})}},647211:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createExpressionBuilder:()=>T,expressionBuilder:()=>C});var r=e.i(814129),o=e.i(302166),s=e.i(777649),n=e.i(569292),a=e.i(729895),d=e.i(633752),l=e.i(927766),c=e.i(458836),u=e.i(154362),p=e.i(661193),h=e.i(268375),m=e.i(780431),f=e.i(374697),A=e.i(137096),g=e.i(200362),y=e.i(92773),K=e.i(535542),w=e.i(640875),v=e.i(545090),b=e.i(79045),_=e.i(211256),N=e.i(731213),I=e.i(328918),E=e.i(46150);function T(e=A.NOOP_QUERY_EXECUTOR){function t(e,t){return new p.ExpressionWrapper((0,m.parseUnaryOperation)(e,t))}let i=Object.assign(function(e,t,i){return new p.ExpressionWrapper((0,c.parseValueBinaryOperation)(e,t,i))},{fn:void 0,eb:void 0,selectFrom:t=>(0,r.createSelectQueryBuilder)({queryId:(0,a.createQueryId)(),executor:e,queryNode:o.SelectQueryNode.createFrom((0,s.parseTableExpressionOrList)(t))}),case:e=>new g.CaseBuilder({node:y.CaseNode.create((0,K.isUndefined)(e)?void 0:(0,l.parseReferenceExpression)(e))}),ref:(e,t)=>(0,K.isUndefined)(t)?new p.ExpressionWrapper((0,l.parseStringReference)(e)):new w.JSONPathBuilder((0,l.parseJSONReference)(e,t)),jsonPath:()=>new w.JSONPathBuilder(N.JSONPathNode.create()),table:e=>new p.ExpressionWrapper((0,s.parseTable)(e)),val:e=>new p.ExpressionWrapper((0,f.parseValueExpression)(e)),refTuple:(...e)=>new p.ExpressionWrapper(_.TupleNode.create(e.map(l.parseReferenceExpression))),tuple:(...e)=>new p.ExpressionWrapper(_.TupleNode.create(e.map(f.parseValueExpression))),lit:e=>new p.ExpressionWrapper((0,f.parseSafeImmediateValue)(e)),unary:t,not:e=>t("not",e),exists:e=>t("exists",e),neg:e=>t("-",e),between:(e,t,i)=>new p.ExpressionWrapper(v.BinaryOperationNode.create((0,l.parseReferenceExpression)(e),h.OperatorNode.create("between"),b.AndNode.create((0,f.parseValueExpression)(t),(0,f.parseValueExpression)(i)))),betweenSymmetric:(e,t,i)=>new p.ExpressionWrapper(v.BinaryOperationNode.create((0,l.parseReferenceExpression)(e),h.OperatorNode.create("between symmetric"),b.AndNode.create((0,f.parseValueExpression)(t),(0,f.parseValueExpression)(i)))),and:e=>new p.ExpressionWrapper((0,K.isReadonlyArray)(e)?(0,c.parseFilterList)(e,"and"):(0,c.parseFilterObject)(e,"and")),or:e=>new p.ExpressionWrapper((0,K.isReadonlyArray)(e)?(0,c.parseFilterList)(e,"or"):(0,c.parseFilterObject)(e,"or")),parens(...e){let t=(0,c.parseValueBinaryOperationOrExpression)(e);return new p.ExpressionWrapper(u.ParensNode.is(t)?t:u.ParensNode.create(t))},cast:(e,t)=>new p.ExpressionWrapper(E.CastNode.create((0,l.parseReferenceExpression)(e),(0,I.parseDataTypeExpression)(t))),withSchema:t=>T(e.withPluginAtFront(new n.WithSchemaPlugin(t)))});return i.fn=(0,d.createFunctionModule)(),i.eb=i,i}function C(e){return T()}},627710:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({isExpressionOrFactory:()=>l,parseAliasedExpression:()=>d,parseExpression:()=>a});var r=e.i(189293),o=e.i(131385),s=e.i(647211),n=e.i(535542);function a(e){if((0,o.isOperationNodeSource)(e))return e.toOperationNode();if((0,n.isFunction)(e))return e((0,s.expressionBuilder)()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(e)}`)}function d(e){if((0,o.isOperationNodeSource)(e))return e.toOperationNode();if((0,n.isFunction)(e))return e((0,s.expressionBuilder)()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function l(e){return(0,r.isExpression)(e)||(0,r.isAliasedExpression)(e)||(0,n.isFunction)(e)}},814783:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AliasedDynamicTableBuilder:()=>i,DynamicTableBuilder:()=>t,isAliasedDynamicTableBuilder:()=>d});var r=e.i(55167),o=e.i(453409),s=e.i(131385),n=e.i(777649),a=e.i(535542);class t{#O;get table(){return this.#O}constructor(e){this.#O=e}as(e){return new i(this.#O,e)}}class i{#O;#I;get table(){return this.#O}get alias(){return this.#I}constructor(e,t){this.#O=e,this.#I=t}toOperationNode(){return r.AliasNode.create((0,n.parseTable)(this.#O),o.IdentifierNode.create(this.#I))}}function d(e){return(0,a.isObject)(e)&&(0,s.isOperationNodeSource)(e)&&(0,a.isString)(e.table)&&(0,a.isString)(e.alias)}}},777649:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseAliasedTable:()=>u,parseTable:()=>p,parseTableExpression:()=>c,parseTableExpressionOrList:()=>l});var r=e.i(535542),o=e.i(55167),s=e.i(164563),n=e.i(627710),a=e.i(453409),d=e.i(814783);function l(e){return(0,r.isReadonlyArray)(e)?e.map(e=>c(e)):[c(e)]}function c(e){return(0,r.isString)(e)?u(e):(0,d.isAliasedDynamicTableBuilder)(e)?e.toOperationNode():(0,n.parseAliasedExpression)(e)}function u(e){let t=" as ";if(!e.includes(t))return p(e);{let[i,r]=e.split(t).map(h);return o.AliasNode.create(p(i),a.IdentifierNode.create(r))}}function p(e){if(!e.includes("."))return s.TableNode.create(e);{let[t,i]=e.split(".").map(h);return s.TableNode.createWithSchema(t,i)}}function h(e){return e.trim()}},152802:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AddColumnNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"AddColumnNode"===e.kind,create:e=>(0,r.freeze)({kind:"AddColumnNode",column:e})})}},202200:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ColumnDefinitionNode:()=>t});var r=e.i(535542),o=e.i(326892);let t=(0,r.freeze)({is:e=>"ColumnDefinitionNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"ColumnDefinitionNode",column:o.ColumnNode.create(e),dataType:t}),cloneWithFrontModifier:(e,t)=>(0,r.freeze)({...e,frontModifiers:e.frontModifiers?(0,r.freeze)([...e.frontModifiers,t]):[t]}),cloneWithEndModifier:(e,t)=>(0,r.freeze)({...e,endModifiers:e.endModifiers?(0,r.freeze)([...e.endModifiers,t]):[t]}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},333040:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropColumnNode:()=>t});var r=e.i(535542),o=e.i(326892);let t=(0,r.freeze)({is:e=>"DropColumnNode"===e.kind,create:e=>(0,r.freeze)({kind:"DropColumnNode",column:o.ColumnNode.create(e)})})}},472840:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({RenameColumnNode:()=>t});var r=e.i(535542),o=e.i(326892);let t=(0,r.freeze)({is:e=>"RenameColumnNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"RenameColumnNode",column:o.ColumnNode.create(e),renameTo:o.ColumnNode.create(t)})})}},98500:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CheckConstraintNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"CheckConstraintNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"CheckConstraintNode",expression:e,name:t?o.IdentifierNode.create(t):void 0})})}},700872:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ON_MODIFY_FOREIGN_ACTIONS:()=>t,ReferencesNode:()=>i});var r=e.i(535542);let t=["no action","restrict","cascade","set null","set default"],i=(0,r.freeze)({is:e=>"ReferencesNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"ReferencesNode",table:e,columns:(0,r.freeze)([...t])}),cloneWithOnDelete:(e,t)=>(0,r.freeze)({...e,onDelete:t}),cloneWithOnUpdate:(e,t)=>(0,r.freeze)({...e,onUpdate:t})})}},137745:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseDefaultValueExpression:()=>s});var r=e.i(131385),o=e.i(21348);function s(e){return(0,r.isOperationNodeSource)(e)?e.toOperationNode():o.ValueNode.createImmediate(e)}},139927:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({GeneratedNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"GeneratedNode"===e.kind,create:e=>(0,r.freeze)({kind:"GeneratedNode",...e}),createWithExpression:e=>(0,r.freeze)({kind:"GeneratedNode",always:!0,expression:e}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},331504:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DefaultValueNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"DefaultValueNode"===e.kind,create:e=>(0,r.freeze)({kind:"DefaultValueNode",defaultValue:e})})}},86141:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseOnModifyForeignAction:()=>o});var r=e.i(700872);function o(e){if(r.ON_MODIFY_FOREIGN_ACTIONS.includes(e))return e;throw Error(`invalid OnModifyForeignAction ${e}`)}},214307:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ColumnDefinitionBuilder:()=>t});var r=e.i(98500),o=e.i(700872),s=e.i(17318),n=e.i(927766),a=e.i(202200),d=e.i(137745),l=e.i(139927),c=e.i(331504),u=e.i(86141);class t{#_;constructor(e){this.#_=e}autoIncrement(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{autoIncrement:!0}))}identity(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{identity:!0}))}primaryKey(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{primaryKey:!0}))}references(e){let i=(0,n.parseStringReference)(e);if(!i.table||s.SelectAllNode.is(i.column))throw Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{references:o.ReferencesNode.create(i.table,[i.column])}))}onDelete(e){if(!this.#_.references)throw Error("on delete constraint can only be added for foreign keys");return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{references:o.ReferencesNode.cloneWithOnDelete(this.#_.references,(0,u.parseOnModifyForeignAction)(e))}))}onUpdate(e){if(!this.#_.references)throw Error("on update constraint can only be added for foreign keys");return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{references:o.ReferencesNode.cloneWithOnUpdate(this.#_.references,(0,u.parseOnModifyForeignAction)(e))}))}unique(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{unique:!0}))}notNull(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{notNull:!0}))}unsigned(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{unsigned:!0}))}defaultTo(e){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{defaultTo:c.DefaultValueNode.create((0,d.parseDefaultValueExpression)(e))}))}check(e){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{check:r.CheckConstraintNode.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{generated:l.GeneratedNode.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{generated:l.GeneratedNode.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{generated:l.GeneratedNode.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#_.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{generated:l.GeneratedNode.cloneWith(this.#_.generated,{stored:!0})}))}modifyFront(e){return new t(a.ColumnDefinitionNode.cloneWithFrontModifier(this.#_,e.toOperationNode()))}nullsNotDistinct(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{nullsNotDistinct:!0}))}ifNotExists(){return new t(a.ColumnDefinitionNode.cloneWith(this.#_,{ifNotExists:!0}))}modifyEnd(e){return new t(a.ColumnDefinitionNode.cloneWithEndModifier(this.#_,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#_}}}},232696:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ModifyColumnNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"ModifyColumnNode"===e.kind,create:e=>(0,r.freeze)({kind:"ModifyColumnNode",column:e})})}},960546:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ForeignKeyConstraintNode:()=>t});var r=e.i(535542),o=e.i(453409),s=e.i(700872);let t=(0,r.freeze)({is:e=>"ForeignKeyConstraintNode"===e.kind,create:(e,t,i,n)=>(0,r.freeze)({kind:"ForeignKeyConstraintNode",columns:e,references:s.ReferencesNode.create(t,i),name:n?o.IdentifierNode.create(n):void 0}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},14466:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ForeignKeyConstraintBuilder:()=>t});var r=e.i(960546),o=e.i(86141);class t{#_;constructor(e){this.#_=e}onDelete(e){return new t(r.ForeignKeyConstraintNode.cloneWith(this.#_,{onDelete:(0,o.parseOnModifyForeignAction)(e)}))}onUpdate(e){return new t(r.ForeignKeyConstraintNode.cloneWith(this.#_,{onUpdate:(0,o.parseOnModifyForeignAction)(e)}))}deferrable(){return new t(r.ForeignKeyConstraintNode.cloneWith(this.#_,{deferrable:!0}))}notDeferrable(){return new t(r.ForeignKeyConstraintNode.cloneWith(this.#_,{deferrable:!1}))}initiallyDeferred(){return new t(r.ForeignKeyConstraintNode.cloneWith(this.#_,{initiallyDeferred:!0}))}initiallyImmediate(){return new t(r.ForeignKeyConstraintNode.cloneWith(this.#_,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#_}}}},710107:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AddConstraintNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"AddConstraintNode"===e.kind,create:e=>(0,r.freeze)({kind:"AddConstraintNode",constraint:e})})}},429245:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({UniqueConstraintNode:()=>t});var r=e.i(535542),o=e.i(326892),s=e.i(453409);let t=(0,r.freeze)({is:e=>"UniqueConstraintNode"===e.kind,create:(e,t,i)=>(0,r.freeze)({kind:"UniqueConstraintNode",columns:(0,r.freeze)(e.map(o.ColumnNode.create)),name:t?s.IdentifierNode.create(t):void 0,nullsNotDistinct:i}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},707853:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropConstraintNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"DropConstraintNode"===e.kind,create:e=>(0,r.freeze)({kind:"DropConstraintNode",constraintName:o.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},925985:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AlterColumnNode:()=>t});var r=e.i(535542),o=e.i(326892);let t=(0,r.freeze)({is:e=>"AlterColumnNode"===e.kind,create:(e,t,i)=>(0,r.freeze)({kind:"AlterColumnNode",column:o.ColumnNode.create(e),[t]:i})})}},570404:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AlterColumnBuilder:()=>t,AlteredColumnBuilder:()=>i});var r=e.i(925985),o=e.i(328918),s=e.i(137745);class t{#S;constructor(e){this.#S=e}setDataType(e){return new i(r.AlterColumnNode.create(this.#S,"dataType",(0,o.parseDataTypeExpression)(e)))}setDefault(e){return new i(r.AlterColumnNode.create(this.#S,"setDefault",(0,s.parseDefaultValueExpression)(e)))}dropDefault(){return new i(r.AlterColumnNode.create(this.#S,"dropDefault",!0))}setNotNull(){return new i(r.AlterColumnNode.create(this.#S,"setNotNull",!0))}dropNotNull(){return new i(r.AlterColumnNode.create(this.#S,"dropNotNull",!0))}$call(e){return e(this)}}class i{#k;constructor(e){this.#k=e}toOperationNode(){return this.#k}}}},683783:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AlterTableExecutor:()=>t});var r=e.i(535542);class t{#t;constructor(e){this.#t=(0,r.freeze)(e)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},739909:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AlterTableAddForeignKeyConstraintBuilder:()=>t});var r=e.i(710107),o=e.i(255757),s=e.i(535542);class t{#t;constructor(e){this.#t=(0,s.freeze)(e)}onDelete(e){return new t({...this.#t,constraintBuilder:this.#t.constraintBuilder.onDelete(e)})}onUpdate(e){return new t({...this.#t,constraintBuilder:this.#t.constraintBuilder.onUpdate(e)})}deferrable(){return new t({...this.#t,constraintBuilder:this.#t.constraintBuilder.deferrable()})}notDeferrable(){return new t({...this.#t,constraintBuilder:this.#t.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new t({...this.#t,constraintBuilder:this.#t.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new t({...this.#t,constraintBuilder:this.#t.constraintBuilder.initiallyImmediate()})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(o.AlterTableNode.cloneWithTableProps(this.#t.node,{addConstraint:r.AddConstraintNode.create(this.#t.constraintBuilder.toOperationNode())}),this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},242695:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AlterTableDropConstraintBuilder:()=>t});var r=e.i(255757),o=e.i(707853),s=e.i(535542);class t{#t;constructor(e){this.#t=(0,s.freeze)(e)}ifExists(){return new t({...this.#t,node:r.AlterTableNode.cloneWithTableProps(this.#t.node,{dropConstraint:o.DropConstraintNode.cloneWith(this.#t.node.dropConstraint,{ifExists:!0})})})}cascade(){return new t({...this.#t,node:r.AlterTableNode.cloneWithTableProps(this.#t.node,{dropConstraint:o.DropConstraintNode.cloneWith(this.#t.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new t({...this.#t,node:r.AlterTableNode.cloneWithTableProps(this.#t.node,{dropConstraint:o.DropConstraintNode.cloneWith(this.#t.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},418696:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PrimaryConstraintNode:()=>i,PrimaryKeyConstraintNode:()=>t});var r=e.i(535542),o=e.i(326892),s=e.i(453409);let t=(0,r.freeze)({is:e=>"PrimaryKeyConstraintNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"PrimaryKeyConstraintNode",columns:(0,r.freeze)(e.map(o.ColumnNode.create)),name:t?s.IdentifierNode.create(t):void 0}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})}),i=t}},161379:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AddIndexNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"AddIndexNode"===e.kind,create:e=>(0,r.freeze)({kind:"AddIndexNode",name:o.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t}),cloneWithColumns:(e,t)=>(0,r.freeze)({...e,columns:[...e.columns||[],...t]})})}},286500:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AlterTableAddIndexBuilder:()=>t});var r=e.i(161379),o=e.i(255757),s=e.i(620581),n=e.i(927766),a=e.i(535542);class t{#t;constructor(e){this.#t=(0,a.freeze)(e)}unique(){return new t({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addIndex:r.AddIndexNode.cloneWith(this.#t.node.addIndex,{unique:!0})})})}column(e){return new t({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addIndex:r.AddIndexNode.cloneWithColumns(this.#t.node.addIndex,[(0,n.parseOrderedColumnName)(e)])})})}columns(e){return new t({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addIndex:r.AddIndexNode.cloneWithColumns(this.#t.node.addIndex,e.map(n.parseOrderedColumnName))})})}expression(e){return new t({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addIndex:r.AddIndexNode.cloneWithColumns(this.#t.node.addIndex,[e.toOperationNode()])})})}using(e){return new t({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addIndex:r.AddIndexNode.cloneWith(this.#t.node.addIndex,{using:s.RawNode.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},315238:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({UniqueConstraintNodeBuilder:()=>t});var r=e.i(429245);class t{#_;constructor(e){this.#_=e}nullsNotDistinct(){return new t(r.UniqueConstraintNode.cloneWith(this.#_,{nullsNotDistinct:!0}))}deferrable(){return new t(r.UniqueConstraintNode.cloneWith(this.#_,{deferrable:!0}))}notDeferrable(){return new t(r.UniqueConstraintNode.cloneWith(this.#_,{deferrable:!1}))}initiallyDeferred(){return new t(r.UniqueConstraintNode.cloneWith(this.#_,{initiallyDeferred:!0}))}initiallyImmediate(){return new t(r.UniqueConstraintNode.cloneWith(this.#_,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#_}}}},531643:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PrimaryKeyConstraintBuilder:()=>t});var r=e.i(418696);class t{#_;constructor(e){this.#_=e}deferrable(){return new t(r.PrimaryKeyConstraintNode.cloneWith(this.#_,{deferrable:!0}))}notDeferrable(){return new t(r.PrimaryKeyConstraintNode.cloneWith(this.#_,{deferrable:!1}))}initiallyDeferred(){return new t(r.PrimaryKeyConstraintNode.cloneWith(this.#_,{initiallyDeferred:!0}))}initiallyImmediate(){return new t(r.PrimaryKeyConstraintNode.cloneWith(this.#_,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#_}}}},634121:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CheckConstraintBuilder:()=>t});class t{#_;constructor(e){this.#_=e}$call(e){return e(this)}toOperationNode(){return this.#_}}}},684242:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({RenameConstraintNode:()=>t});var r=e.i(535542),o=e.i(453409);let t=(0,r.freeze)({is:e=>"RenameConstraintNode"===e.kind,create:(e,t)=>(0,r.freeze)({kind:"RenameConstraintNode",oldName:o.IdentifierNode.create(e),newName:o.IdentifierNode.create(t)})})}},378910:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({AlterTableBuilder:()=>t,AlterTableColumnAlteringBuilder:()=>i});var r=e.i(152802),o=e.i(255757),s=e.i(202200),n=e.i(333040),a=e.i(453409),d=e.i(472840),l=e.i(535542),c=e.i(214307),u=e.i(232696),p=e.i(328918),h=e.i(14466),m=e.i(710107),f=e.i(429245),A=e.i(98500),g=e.i(960546),y=e.i(326892),K=e.i(777649),w=e.i(707853),v=e.i(570404),b=e.i(683783),_=e.i(739909),N=e.i(242695),I=e.i(418696),E=e.i(197823),T=e.i(161379),C=e.i(286500),x=e.i(315238),O=e.i(531643),S=e.i(634121),k=e.i(684242);class t{#t;constructor(e){this.#t=(0,l.freeze)(e)}renameTo(e){return new b.AlterTableExecutor({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{renameTo:(0,K.parseTable)(e)})})}setSchema(e){return new b.AlterTableExecutor({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{setSchema:a.IdentifierNode.create(e)})})}alterColumn(e,t){let r=t(new v.AlterColumnBuilder(e));return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,r.toOperationNode())})}dropColumn(e){return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,n.DropColumnNode.create(e))})}renameColumn(e,t){return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,d.RenameColumnNode.create(e,t))})}addColumn(e,t,n=l.noop){let a=n(new c.ColumnDefinitionBuilder(s.ColumnDefinitionNode.create(e,(0,p.parseDataTypeExpression)(t))));return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,r.AddColumnNode.create(a.toOperationNode()))})}modifyColumn(e,t,r=l.noop){let n=r(new c.ColumnDefinitionBuilder(s.ColumnDefinitionNode.create(e,(0,p.parseDataTypeExpression)(t))));return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,u.ModifyColumnNode.create(n.toOperationNode()))})}addUniqueConstraint(e,t,i=l.noop){let r=i(new x.UniqueConstraintNodeBuilder(f.UniqueConstraintNode.create(t,e)));return new b.AlterTableExecutor({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addConstraint:m.AddConstraintNode.create(r.toOperationNode())})})}addCheckConstraint(e,t,i=l.noop){let r=i(new S.CheckConstraintBuilder(A.CheckConstraintNode.create(t.toOperationNode(),e)));return new b.AlterTableExecutor({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addConstraint:m.AddConstraintNode.create(r.toOperationNode())})})}addForeignKeyConstraint(e,t,i,r,o=l.noop){let s=o(new h.ForeignKeyConstraintBuilder(g.ForeignKeyConstraintNode.create(t.map(y.ColumnNode.create),(0,K.parseTable)(i),r.map(y.ColumnNode.create),e)));return new _.AlterTableAddForeignKeyConstraintBuilder({...this.#t,constraintBuilder:s})}addPrimaryKeyConstraint(e,t,i=l.noop){let r=i(new O.PrimaryKeyConstraintBuilder(I.PrimaryKeyConstraintNode.create(t,e)));return new b.AlterTableExecutor({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addConstraint:m.AddConstraintNode.create(r.toOperationNode())})})}dropConstraint(e){return new N.AlterTableDropConstraintBuilder({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{dropConstraint:w.DropConstraintNode.create(e)})})}renameConstraint(e,t){return new N.AlterTableDropConstraintBuilder({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{renameConstraint:k.RenameConstraintNode.create(e,t)})})}addIndex(e){return new C.AlterTableAddIndexBuilder({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{addIndex:T.AddIndexNode.create(e)})})}dropIndex(e){return new b.AlterTableExecutor({...this.#t,node:o.AlterTableNode.cloneWithTableProps(this.#t.node,{dropIndex:E.DropIndexNode.create(e)})})}$call(e){return e(this)}}class i{#t;constructor(e){this.#t=(0,l.freeze)(e)}alterColumn(e,t){let r=t(new v.AlterColumnBuilder(e));return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,r.toOperationNode())})}dropColumn(e){return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,n.DropColumnNode.create(e))})}renameColumn(e,t){return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,d.RenameColumnNode.create(e,t))})}addColumn(e,t,n=l.noop){let a=n(new c.ColumnDefinitionBuilder(s.ColumnDefinitionNode.create(e,(0,p.parseDataTypeExpression)(t))));return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,r.AddColumnNode.create(a.toOperationNode()))})}modifyColumn(e,t,r=l.noop){let n=r(new c.ColumnDefinitionBuilder(s.ColumnDefinitionNode.create(e,(0,p.parseDataTypeExpression)(t))));return new i({...this.#t,node:o.AlterTableNode.cloneWithColumnAlteration(this.#t.node,u.ModifyColumnNode.create(n.toOperationNode()))})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},444586:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ImmediateValueTransformer:()=>t});var r=e.i(794220),o=e.i(697622),s=e.i(21348);class t extends r.OperationNodeTransformer{transformPrimitiveValueList(e){return o.ValueListNode.create(e.values.map(s.ValueNode.createImmediate))}transformValue(e){return s.ValueNode.createImmediate(e.value)}}}},386204:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateIndexBuilder:()=>t});var r=e.i(600702),o=e.i(620581),s=e.i(927766),n=e.i(777649),a=e.i(535542),d=e.i(458836),l=e.i(430596),c=e.i(444586);class t{#t;constructor(e){this.#t=(0,a.freeze)(e)}ifNotExists(){return new t({...this.#t,node:r.CreateIndexNode.cloneWith(this.#t.node,{ifNotExists:!0})})}unique(){return new t({...this.#t,node:r.CreateIndexNode.cloneWith(this.#t.node,{unique:!0})})}nullsNotDistinct(){return new t({...this.#t,node:r.CreateIndexNode.cloneWith(this.#t.node,{nullsNotDistinct:!0})})}on(e){return new t({...this.#t,node:r.CreateIndexNode.cloneWith(this.#t.node,{table:(0,n.parseTable)(e)})})}column(e){return new t({...this.#t,node:r.CreateIndexNode.cloneWithColumns(this.#t.node,[(0,s.parseOrderedColumnName)(e)])})}columns(e){return new t({...this.#t,node:r.CreateIndexNode.cloneWithColumns(this.#t.node,e.map(s.parseOrderedColumnName))})}expression(e){return new t({...this.#t,node:r.CreateIndexNode.cloneWithColumns(this.#t.node,[e.toOperationNode()])})}using(e){return new t({...this.#t,node:r.CreateIndexNode.cloneWith(this.#t.node,{using:o.RawNode.createWithSql(e)})})}where(...e){let i=new c.ImmediateValueTransformer;return new t({...this.#t,node:l.QueryNode.cloneWithWhere(this.#t.node,i.transformNode((0,d.parseValueBinaryOperationOrExpression)(e),this.#t.queryId))})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},687605:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateSchemaBuilder:()=>t});var r=e.i(967753),o=e.i(535542);class t{#t;constructor(e){this.#t=(0,o.freeze)(e)}ifNotExists(){return new t({...this.#t,node:r.CreateSchemaNode.cloneWith(this.#t.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},936944:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseOnCommitAction:()=>o});var r=e.i(441524);function o(e){if(r.ON_COMMIT_ACTIONS.includes(e))return e;throw Error(`invalid OnCommitAction ${e}`)}},20036:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateTableBuilder:()=>t});var r=e.i(202200),o=e.i(441524),s=e.i(214307),n=e.i(535542),a=e.i(960546),d=e.i(326892),l=e.i(14466),c=e.i(328918),u=e.i(418696),p=e.i(429245),h=e.i(98500),m=e.i(777649),f=e.i(936944),A=e.i(315238),g=e.i(627710),y=e.i(531643),K=e.i(634121);class t{#t;constructor(e){this.#t=(0,n.freeze)(e)}temporary(){return new t({...this.#t,node:o.CreateTableNode.cloneWith(this.#t.node,{temporary:!0})})}onCommit(e){return new t({...this.#t,node:o.CreateTableNode.cloneWith(this.#t.node,{onCommit:(0,f.parseOnCommitAction)(e)})})}ifNotExists(){return new t({...this.#t,node:o.CreateTableNode.cloneWith(this.#t.node,{ifNotExists:!0})})}addColumn(e,i,a=n.noop){let d=a(new s.ColumnDefinitionBuilder(r.ColumnDefinitionNode.create(e,(0,c.parseDataTypeExpression)(i))));return new t({...this.#t,node:o.CreateTableNode.cloneWithColumn(this.#t.node,d.toOperationNode())})}addPrimaryKeyConstraint(e,i,r=n.noop){let s=r(new y.PrimaryKeyConstraintBuilder(u.PrimaryKeyConstraintNode.create(i,e)));return new t({...this.#t,node:o.CreateTableNode.cloneWithConstraint(this.#t.node,s.toOperationNode())})}addUniqueConstraint(e,i,r=n.noop){let s=r(new A.UniqueConstraintNodeBuilder(p.UniqueConstraintNode.create(i,e)));return new t({...this.#t,node:o.CreateTableNode.cloneWithConstraint(this.#t.node,s.toOperationNode())})}addCheckConstraint(e,i,r=n.noop){let s=r(new K.CheckConstraintBuilder(h.CheckConstraintNode.create(i.toOperationNode(),e)));return new t({...this.#t,node:o.CreateTableNode.cloneWithConstraint(this.#t.node,s.toOperationNode())})}addForeignKeyConstraint(e,i,r,s,c=n.noop){let u=c(new l.ForeignKeyConstraintBuilder(a.ForeignKeyConstraintNode.create(i.map(d.ColumnNode.create),(0,m.parseTable)(r),s.map(d.ColumnNode.create),e)));return new t({...this.#t,node:o.CreateTableNode.cloneWithConstraint(this.#t.node,u.toOperationNode())})}modifyFront(e){return new t({...this.#t,node:o.CreateTableNode.cloneWithFrontModifier(this.#t.node,e.toOperationNode())})}modifyEnd(e){return new t({...this.#t,node:o.CreateTableNode.cloneWithEndModifier(this.#t.node,e.toOperationNode())})}as(e){return new t({...this.#t,node:o.CreateTableNode.cloneWith(this.#t.node,{selectQuery:(0,g.parseExpression)(e)})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},937595:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropIndexBuilder:()=>t});var r=e.i(197823),o=e.i(777649),s=e.i(535542);class t{#t;constructor(e){this.#t=(0,s.freeze)(e)}on(e){return new t({...this.#t,node:r.DropIndexNode.cloneWith(this.#t.node,{table:(0,o.parseTable)(e)})})}ifExists(){return new t({...this.#t,node:r.DropIndexNode.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new t({...this.#t,node:r.DropIndexNode.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},443089:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropSchemaBuilder:()=>t});var r=e.i(659886),o=e.i(535542);class t{#t;constructor(e){this.#t=(0,o.freeze)(e)}ifExists(){return new t({...this.#t,node:r.DropSchemaNode.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new t({...this.#t,node:r.DropSchemaNode.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},218869:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropTableBuilder:()=>t});var r=e.i(526511),o=e.i(535542);class t{#t;constructor(e){this.#t=(0,o.freeze)(e)}ifExists(){return new t({...this.#t,node:r.DropTableNode.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new t({...this.#t,node:r.DropTableNode.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},339967:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateViewNode:()=>t});var r=e.i(535542),o=e.i(318106);let t=(0,r.freeze)({is:e=>"CreateViewNode"===e.kind,create:e=>(0,r.freeze)({kind:"CreateViewNode",name:o.SchemableIdentifierNode.create(e)}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},255286:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ImmediateValuePlugin:()=>t});var r=e.i(444586);class t{#f=new r.ImmediateValueTransformer;transformQuery(e){return this.#f.transformNode(e.node,e.queryId)}transformResult(e){return Promise.resolve(e.result)}}}},481471:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateViewBuilder:()=>t});var r=e.i(535542),o=e.i(339967),s=e.i(927766),n=e.i(255286);class t{#t;constructor(e){this.#t=(0,r.freeze)(e)}temporary(){return new t({...this.#t,node:o.CreateViewNode.cloneWith(this.#t.node,{temporary:!0})})}materialized(){return new t({...this.#t,node:o.CreateViewNode.cloneWith(this.#t.node,{materialized:!0})})}ifNotExists(){return new t({...this.#t,node:o.CreateViewNode.cloneWith(this.#t.node,{ifNotExists:!0})})}orReplace(){return new t({...this.#t,node:o.CreateViewNode.cloneWith(this.#t.node,{orReplace:!0})})}columns(e){return new t({...this.#t,node:o.CreateViewNode.cloneWith(this.#t.node,{columns:e.map(s.parseColumnName)})})}as(e){let i=e.withPlugin(new n.ImmediateValuePlugin).toOperationNode();return new t({...this.#t,node:o.CreateViewNode.cloneWith(this.#t.node,{as:i})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},122794:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropViewNode:()=>t});var r=e.i(535542),o=e.i(318106);let t=(0,r.freeze)({is:e=>"DropViewNode"===e.kind,create:e=>(0,r.freeze)({kind:"DropViewNode",name:o.SchemableIdentifierNode.create(e)}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},52130:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropViewBuilder:()=>t});var r=e.i(535542),o=e.i(122794);class t{#t;constructor(e){this.#t=(0,r.freeze)(e)}materialized(){return new t({...this.#t,node:o.DropViewNode.cloneWith(this.#t.node,{materialized:!0})})}ifExists(){return new t({...this.#t,node:o.DropViewNode.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new t({...this.#t,node:o.DropViewNode.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},144999:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateTypeNode:()=>t});var r=e.i(535542),o=e.i(697622),s=e.i(21348);let t=(0,r.freeze)({is:e=>"CreateTypeNode"===e.kind,create:e=>(0,r.freeze)({kind:"CreateTypeNode",name:e}),cloneWithEnum:(e,t)=>(0,r.freeze)({...e,enum:o.ValueListNode.create(t.map(s.ValueNode.createImmediate))})})}},818672:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CreateTypeBuilder:()=>t});var r=e.i(535542),o=e.i(144999);class t{#t;constructor(e){this.#t=(0,r.freeze)(e)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}asEnum(e){return new t({...this.#t,node:o.CreateTypeNode.cloneWithEnum(this.#t.node,e)})}$call(e){return e(this)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},365234:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropTypeNode:()=>t});var r=e.i(535542);let t=(0,r.freeze)({is:e=>"DropTypeNode"===e.kind,create:e=>(0,r.freeze)({kind:"DropTypeNode",name:e}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},104130:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DropTypeBuilder:()=>t});var r=e.i(365234),o=e.i(535542);class t{#t;constructor(e){this.#t=(0,o.freeze)(e)}ifExists(){return new t({...this.#t,node:r.DropTypeNode.cloneWith(this.#t.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},245451:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseSchemableIdentifier:()=>o});var r=e.i(318106);function o(e){if(!e.includes("."))return r.SchemableIdentifierNode.create(e);{let t=e.split(".").map(s);if(2===t.length)return r.SchemableIdentifierNode.createWithSchema(t[0],t[1]);throw Error(`invalid schemable identifier ${e}`)}}function s(e){return e.trim()}},307593:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({RefreshMaterializedViewNode:()=>t});var r=e.i(535542),o=e.i(318106);let t=(0,r.freeze)({is:e=>"RefreshMaterializedViewNode"===e.kind,create:e=>(0,r.freeze)({kind:"RefreshMaterializedViewNode",name:o.SchemableIdentifierNode.create(e)}),cloneWith:(e,t)=>(0,r.freeze)({...e,...t})})}},300581:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({RefreshMaterializedViewBuilder:()=>t});var r=e.i(535542),o=e.i(307593);class t{#t;constructor(e){this.#t=(0,r.freeze)(e)}concurrently(){return new t({...this.#t,node:o.RefreshMaterializedViewNode.cloneWith(this.#t.node,{concurrently:!0,withNoData:!1})})}withData(){return new t({...this.#t,node:o.RefreshMaterializedViewNode.cloneWith(this.#t.node,{withNoData:!1})})}withNoData(){return new t({...this.#t,node:o.RefreshMaterializedViewNode.cloneWith(this.#t.node,{withNoData:!0,concurrently:!1})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}}},306275:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SchemaModule:()=>t});var r=e.i(255757),o=e.i(600702),s=e.i(967753),n=e.i(441524),a=e.i(197823),d=e.i(659886),l=e.i(526511),c=e.i(777649),u=e.i(378910),p=e.i(386204),h=e.i(687605),m=e.i(20036),f=e.i(937595),A=e.i(443089),g=e.i(218869),y=e.i(729895),K=e.i(569292),w=e.i(481471),v=e.i(339967),b=e.i(52130),_=e.i(122794),N=e.i(818672),I=e.i(104130),E=e.i(144999),T=e.i(365234),C=e.i(245451),x=e.i(300581),O=e.i(307593);class t{#R;constructor(e){this.#R=e}createTable(e){return new m.CreateTableBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:n.CreateTableNode.create((0,c.parseTable)(e))})}dropTable(e){return new g.DropTableBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:l.DropTableNode.create((0,c.parseTable)(e))})}createIndex(e){return new p.CreateIndexBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:o.CreateIndexNode.create(e)})}dropIndex(e){return new f.DropIndexBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:a.DropIndexNode.create(e)})}createSchema(e){return new h.CreateSchemaBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:s.CreateSchemaNode.create(e)})}dropSchema(e){return new A.DropSchemaBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:d.DropSchemaNode.create(e)})}alterTable(e){return new u.AlterTableBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:r.AlterTableNode.create((0,c.parseTable)(e))})}createView(e){return new w.CreateViewBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:v.CreateViewNode.create(e)})}refreshMaterializedView(e){return new x.RefreshMaterializedViewBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:O.RefreshMaterializedViewNode.create(e)})}dropView(e){return new b.DropViewBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:_.DropViewNode.create(e)})}createType(e){return new N.CreateTypeBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:E.CreateTypeNode.create((0,C.parseSchemableIdentifier)(e))})}dropType(e){return new I.DropTypeBuilder({queryId:(0,y.createQueryId)(),executor:this.#R,node:T.DropTypeNode.create((0,C.parseSchemableIdentifier)(e))})}withPlugin(e){return new t(this.#R.withPlugin(e))}withoutPlugins(){return new t(this.#R.withoutPlugins())}withSchema(e){return new t(this.#R.withPluginAtFront(new K.WithSchemaPlugin(e)))}}}},771104:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DynamicModule:()=>t});var r=e.i(302061),o=e.i(814783);class t{ref(e){return new r.DynamicReferenceBuilder(e)}table(e){return new o.DynamicTableBuilder(e)}}}},24e3:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DefaultConnectionProvider:()=>t});class t{#P;constructor(e){this.#P=e}async provideConnection(e){let t=await this.#P.acquireConnection();try{return await e(t)}finally{await this.#P.releaseConnection(t)}}}}},991025:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DefaultQueryExecutor:()=>t});var r=e.i(736340);class t extends r.QueryExecutorBase{#U;#D;#L;constructor(e,t,i,r=[]){super(r),this.#U=e,this.#D=t,this.#L=i}get adapter(){return this.#D}compileQuery(e,t){return this.#U.compileQuery(e,t)}provideConnection(e){return this.#L.provideConnection(e)}withPlugins(e){return new t(this.#U,this.#D,this.#L,[...this.plugins,...e])}withPlugin(e){return new t(this.#U,this.#D,this.#L,[...this.plugins,e])}withPluginAtFront(e){return new t(this.#U,this.#D,this.#L,[e,...this.plugins])}withConnectionProvider(e){return new t(this.#U,this.#D,e,[...this.plugins])}withoutPlugins(){return new t(this.#U,this.#D,this.#L,[])}}}},261706:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({performanceNow:()=>o});var r=e.i(535542);function o(){return"undefined"!=typeof performance&&(0,r.isFunction)(performance.now)?performance.now():Date.now()}},323475:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({RuntimeDriver:()=>t});var r=e.i(261706);class t{#P;#z;#B;#j;#q;#Z=new WeakSet;constructor(e,t){this.#j=!1,this.#P=e,this.#z=t}async init(){if(this.#q)throw Error("driver has already been destroyed");this.#B||(this.#B=this.#P.init().then(()=>{this.#j=!0}).catch(e=>(this.#B=void 0,Promise.reject(e)))),await this.#B}async acquireConnection(){if(this.#q)throw Error("driver has already been destroyed");this.#j||await this.init();let e=await this.#P.acquireConnection();return this.#Z.has(e)||(this.#M()&&this.#V(e),this.#Z.add(e)),e}async releaseConnection(e){await this.#P.releaseConnection(e)}beginTransaction(e,t){return this.#P.beginTransaction(e,t)}commitTransaction(e){return this.#P.commitTransaction(e)}rollbackTransaction(e){return this.#P.rollbackTransaction(e)}savepoint(e,t,i){if(this.#P.savepoint)return this.#P.savepoint(e,t,i);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(e,t,i){if(this.#P.rollbackToSavepoint)return this.#P.rollbackToSavepoint(e,t,i);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(e,t,i){if(this.#P.releaseSavepoint)return this.#P.releaseSavepoint(e,t,i);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#B&&(await this.#B,this.#q||(this.#q=this.#P.destroy().catch(e=>(this.#q=void 0,Promise.reject(e)))),await this.#q)}#M(){return this.#z.isLevelEnabled("query")||this.#z.isLevelEnabled("error")}#V(e){let t=e.executeQuery,i=e.streamQuery,o=this;e.executeQuery=async i=>{let s,n=(0,r.performanceNow)();try{return await t.call(e,i)}catch(e){throw s=e,await o.#W(e,i,n),e}finally{s||await o.#F(i,n)}},e.streamQuery=async function*(t,s){let n,a=(0,r.performanceNow)();try{for await(let r of i.call(e,t,s))yield r}catch(e){throw n=e,await o.#W(e,t,a),e}finally{n||await o.#F(t,a,!0)}}}async #W(e,t,i){await this.#z.error(()=>({level:"error",error:e,query:t,queryDurationMillis:this.#$(i)}))}async #F(e,t,i=!1){await this.#z.query(()=>({level:"query",isStream:i,query:e,queryDurationMillis:this.#$(t)}))}#$(e){return(0,r.performanceNow)()-e}}}},160070:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SingleConnectionProvider:()=>i});let t=()=>{};class i{#H;#Q;constructor(e){this.#H=e}async provideConnection(e){for(;this.#Q;)await this.#Q.catch(t);return this.#Q=this.#J(e).finally(()=>{this.#Q=void 0}),this.#Q}async #J(e){return await e(this.#H)}}}},656668:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({TRANSACTION_ACCESS_MODES:()=>t,TRANSACTION_ISOLATION_LEVELS:()=>i,validateTransactionSettings:()=>r});let t=["read only","read write"],i=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function r(e){if(e.accessMode&&!t.includes(e.accessMode))throw Error(`invalid transaction access mode ${e.accessMode}`);if(e.isolationLevel&&!i.includes(e.isolationLevel))throw Error(`invalid transaction isolation level ${e.isolationLevel}`)}}},677719:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({LOG_LEVELS:()=>t,Log:()=>i});var r=e.i(535542);let t=(0,r.freeze)(["query","error"]);class i{#G;#Y;constructor(e){(0,r.isFunction)(e)?(this.#Y=e,this.#G=(0,r.freeze)({query:!0,error:!0})):(this.#Y=o,this.#G=(0,r.freeze)({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#G[e]}async query(e){this.#G.query&&await this.#Y(e())}async error(e){this.#G.error&&await this.#Y(e())}}function o(e){if("query"===e.level){let t=`kysely:query:${e.isStream?"stream:":""}`;console.log(`${t} ${e.query.sql}`),console.log(`${t} duration: ${e.queryDurationMillis.toFixed(1)}ms`)}else"error"===e.level&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}}},171466:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({isCompilable:()=>o});var r=e.i(535542);function o(e){return(0,r.isObject)(e)&&(0,r.isFunction)(e.compile)}},536159:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({Command:()=>T,ConnectionBuilder:()=>_,ControlledTransaction:()=>E,ControlledTransactionBuilder:()=>I,Kysely:()=>t,Transaction:()=>i,TransactionBuilder:()=>N,isKyselyProps:()=>v});var r=e.i(306275),o=e.i(771104),s=e.i(24e3),n=e.i(145520),a=e.i(991025),d=e.i(535542),l=e.i(323475),c=e.i(160070),u=e.i(656668),p=e.i(633752),h=e.i(677719),m=e.i(729895),f=e.i(171466),A=e.i(200362),g=e.i(92773),y=e.i(627710),K=e.i(569292),w=e.i(643207);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class t extends n.QueryCreator{#t;constructor(e){let t,i;if(v(e))t={executor:e.executor},i={...e};else{let r=e.dialect,o=r.createDriver(),n=r.createQueryCompiler(),d=r.createAdapter(),c=new h.Log(e.log??[]),u=new l.RuntimeDriver(o,c),p=new s.DefaultConnectionProvider(u),m=new a.DefaultQueryExecutor(n,d,p,e.plugins??[]);t={executor:m},i={config:e,executor:m,dialect:r,driver:u}}super(t),this.#t=(0,d.freeze)(i)}get schema(){return new r.SchemaModule(this.#t.executor)}get dynamic(){return new o.DynamicModule}get introspection(){return this.#t.dialect.createIntrospector(this.withoutPlugins())}case(e){return new A.CaseBuilder({node:g.CaseNode.create((0,d.isUndefined)(e)?void 0:(0,y.parseExpression)(e))})}get fn(){return(0,p.createFunctionModule)()}transaction(){return new N({...this.#t})}startTransaction(){return new I({...this.#t})}connection(){return new _({...this.#t})}withPlugin(e){return new t({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new t({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new t({...this.#t,executor:this.#t.executor.withPluginAtFront(new K.WithSchemaPlugin(e))})}withTables(){return new t({...this.#t})}async destroy(){await this.#t.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#t.executor}executeQuery(e,t=(0,m.createQueryId)()){let i=(0,f.isCompilable)(e)?e.compile():e;return this.getExecutor().executeQuery(i,t)}async [Symbol.asyncDispose](){await this.destroy()}}class i extends t{#t;constructor(e){super(e),this.#t=e}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new i({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new i({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new i({...this.#t,executor:this.#t.executor.withPluginAtFront(new K.WithSchemaPlugin(e))})}withTables(){return new i({...this.#t})}}function v(e){return(0,d.isObject)(e)&&(0,d.isObject)(e.config)&&(0,d.isObject)(e.driver)&&(0,d.isObject)(e.executor)&&(0,d.isObject)(e.dialect)}class _{#t;constructor(e){this.#t=(0,d.freeze)(e)}async execute(e){return this.#t.executor.provideConnection(async i=>{let r=this.#t.executor.withConnectionProvider(new c.SingleConnectionProvider(i)),o=new t({...this.#t,executor:r});return await e(o)})}}class N{#t;constructor(e){this.#t=(0,d.freeze)(e)}setAccessMode(e){return new N({...this.#t,accessMode:e})}setIsolationLevel(e){return new N({...this.#t,isolationLevel:e})}async execute(e){let{isolationLevel:t,accessMode:r,...o}=this.#t,s={isolationLevel:t,accessMode:r};return(0,u.validateTransactionSettings)(s),this.#t.executor.provideConnection(async t=>{let r=this.#t.executor.withConnectionProvider(new c.SingleConnectionProvider(t)),n=new i({...o,executor:r});try{await this.#t.driver.beginTransaction(t,s);let i=await e(n);return await this.#t.driver.commitTransaction(t),i}catch(e){throw await this.#t.driver.rollbackTransaction(t),e}})}}class I{#t;constructor(e){this.#t=(0,d.freeze)(e)}setAccessMode(e){return new I({...this.#t,accessMode:e})}setIsolationLevel(e){return new I({...this.#t,isolationLevel:e})}async execute(){let{isolationLevel:e,accessMode:t,...i}=this.#t,r={isolationLevel:e,accessMode:t};(0,u.validateTransactionSettings)(r);let o=await (0,w.provideControlledConnection)(this.#t.executor);return await this.#t.driver.beginTransaction(o.connection,r),new E({...i,connection:o,executor:this.#t.executor.withConnectionProvider(new c.SingleConnectionProvider(o.connection))})}}class E extends i{#t;#X;#ee;constructor(e){let t={isCommitted:!1,isRolledBack:!1},{connection:i,...r}=e={...e,executor:new C(e.executor,t)};super(r),this.#t=(0,d.freeze)(e),this.#ee=t;let o=(0,m.createQueryId)();this.#X=t=>e.executor.compileQuery(t,o)}get isCommitted(){return this.#ee.isCommitted}get isRolledBack(){return this.#ee.isRolledBack}commit(){return b(this.#ee),new T(async()=>{await this.#t.driver.commitTransaction(this.#t.connection.connection),this.#ee.isCommitted=!0,this.#t.connection.release()})}rollback(){return b(this.#ee),new T(async()=>{await this.#t.driver.rollbackTransaction(this.#t.connection.connection),this.#ee.isRolledBack=!0,this.#t.connection.release()})}savepoint(e){return b(this.#ee),new T(async()=>(await this.#t.driver.savepoint?.(this.#t.connection.connection,e,this.#X),new E({...this.#t})))}rollbackToSavepoint(e){return b(this.#ee),new T(async()=>(await this.#t.driver.rollbackToSavepoint?.(this.#t.connection.connection,e,this.#X),new E({...this.#t})))}releaseSavepoint(e){return b(this.#ee),new T(async()=>(await this.#t.driver.releaseSavepoint?.(this.#t.connection.connection,e,this.#X),new E({...this.#t})))}withPlugin(e){return new E({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new E({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new E({...this.#t,executor:this.#t.executor.withPluginAtFront(new K.WithSchemaPlugin(e))})}withTables(){return new E({...this.#t})}}class T{#et;constructor(e){this.#et=e}async execute(){return await this.#et()}}function b(e){if(e.isCommitted)throw Error("Transaction is already committed");if(e.isRolledBack)throw Error("Transaction is already rolled back")}class C{#R;#ee;constructor(e,t){e instanceof C?this.#R=e.#R:this.#R=e,this.#ee=t}get adapter(){return this.#R.adapter}get plugins(){return this.#R.plugins}transformQuery(e,t){return this.#R.transformQuery(e,t)}compileQuery(e,t){return this.#R.compileQuery(e,t)}provideConnection(e){return this.#R.provideConnection(e)}executeQuery(e,t){return b(this.#ee),this.#R.executeQuery(e,t)}stream(e,t,i){return b(this.#ee),this.#R.stream(e,t,i)}withConnectionProvider(e){return new C(this.#R.withConnectionProvider(e),this.#ee)}withPlugin(e){return new C(this.#R.withPlugin(e),this.#ee)}withPlugins(e){return new C(this.#R.withPlugins(e),this.#ee)}withPluginAtFront(e){return new C(this.#R.withPluginAtFront(e),this.#ee)}withoutPlugins(){return new C(this.#R.withoutPlugins(),this.#ee)}}}},962952:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({parseSavepointCommand:()=>s});var r=e.i(453409),o=e.i(620581);function s(e,t){return o.RawNode.createWithChildren([o.RawNode.createWithSql(`${e} `),r.IdentifierNode.create(t)])}},741836:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({CompiledQuery:()=>t});var r=e.i(620581),o=e.i(535542),s=e.i(729895);let t=(0,o.freeze)({raw:(e,t=[])=>(0,o.freeze)({sql:e,query:r.RawNode.createWithSql(e),parameters:(0,o.freeze)(t),queryId:(0,s.createQueryId)()})})}},607490:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SqliteDriver:()=>t});var r=e.i(302166),o=e.i(962952),s=e.i(741836),n=e.i(535542),a=e.i(729895);class t{#ei;#er=new d;#eo;#H;constructor(e){this.#ei=(0,n.freeze)({...e})}async init(){this.#eo=(0,n.isFunction)(this.#ei.database)?await this.#ei.database():this.#ei.database,this.#H=new i(this.#eo),this.#ei.onCreateConnection&&await this.#ei.onCreateConnection(this.#H)}async acquireConnection(){return await this.#er.lock(),this.#H}async beginTransaction(e){await e.executeQuery(s.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(s.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(s.CompiledQuery.raw("rollback"))}async savepoint(e,t,i){await e.executeQuery(i((0,o.parseSavepointCommand)("savepoint",t),(0,a.createQueryId)()))}async rollbackToSavepoint(e,t,i){await e.executeQuery(i((0,o.parseSavepointCommand)("rollback to",t),(0,a.createQueryId)()))}async releaseSavepoint(e,t,i){await e.executeQuery(i((0,o.parseSavepointCommand)("release",t),(0,a.createQueryId)()))}async releaseConnection(){this.#er.unlock()}async destroy(){this.#eo?.close()}}class i{#eo;constructor(e){this.#eo=e}executeQuery(e){let{sql:t,parameters:i}=e,r=this.#eo.prepare(t);if(r.reader)return Promise.resolve({rows:r.all(i)});let{changes:o,lastInsertRowid:s}=r.run(i);return Promise.resolve({numAffectedRows:null!=o?BigInt(o):void 0,insertId:null!=s?BigInt(s):void 0,rows:[]})}async *streamQuery(e,t){let{sql:i,parameters:o,query:s}=e,n=this.#eo.prepare(i);if(r.SelectQueryNode.is(s))for(let e of n.iterate(o))yield{rows:[e]};else throw Error("Sqlite driver only supports streaming of select queries")}}class d{#A;#g;async lock(){for(;this.#A;)await this.#A;this.#A=new Promise(e=>{this.#g=e})}unlock(){let e=this.#g;this.#A=void 0,this.#g=void 0,e?.()}}}},214857:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({OperationNodeVisitor:()=>t});var r=e.i(535542);class t{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#es=(0,r.freeze)({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=e=>{this.nodeStack.push(e),this.#es[e.kind](e),this.nodeStack.pop()}}}},607186:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DefaultQueryCompiler:()=>i});var r=e.i(441524),o=e.i(777174),s=e.i(214857),n=e.i(268375),a=e.i(154362),d=e.i(430596),l=e.i(535542),c=e.i(339967),u=e.i(505072),p=e.i(860934),h=e.i(57239);let t=/'/g;class i extends s.OperationNodeVisitor{#en="";#ea=[];get numParameters(){return this.#ea.length}compileQuery(e,t){return this.#en="",this.#ea=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(e),(0,l.freeze)({query:e,queryId:t,sql:this.getSql(),parameters:[...this.#ea]})}getSql(){return this.#en}visitSelectQuery(e){let t=void 0!==this.parentNode&&!a.ParensNode.is(this.parentNode)&&!o.InsertQueryNode.is(this.parentNode)&&!r.CreateTableNode.is(this.parentNode)&&!c.CreateViewNode.is(this.parentNode)&&!u.SetOperationNode.is(this.parentNode);void 0===this.parentNode&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("select"),e.distinctOn&&(this.append(" "),this.compileDistinctOn(e.distinctOn)),e.frontModifiers?.length&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.top&&(this.append(" "),this.visitNode(e.top)),e.selections&&(this.append(" "),this.compileList(e.selections)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.groupBy&&(this.append(" "),this.visitNode(e.groupBy)),e.having&&(this.append(" "),this.visitNode(e.having)),e.setOperations&&(this.append(" "),this.compileList(e.setOperations," ")),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.offset&&(this.append(" "),this.visitNode(e.offset)),e.fetch&&(this.append(" "),this.visitNode(e.fetch)),e.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...e.endModifiers])," ")),t&&this.append(")")}visitFrom(e){this.append("from "),this.compileList(e.froms)}visitSelection(e){this.visitNode(e.selection)}visitColumn(e){this.visitNode(e.column)}compileDistinctOn(e){this.append("distinct on ("),this.compileList(e),this.append(")")}compileList(e,t=", "){let i=e.length-1;for(let r=0;r<=i;r++)this.visitNode(e[r]),r<i&&this.append(t)}visitWhere(e){this.append("where "),this.visitNode(e.where)}visitHaving(e){this.append("having "),this.visitNode(e.having)}visitInsertQuery(e){let t=this.nodeStack.find(d.QueryNode.is),i=t!==e;!i&&e.explain&&(this.visitNode(e.explain),this.append(" ")),i&&!p.MergeQueryNode.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append(e.replace?"replace":"insert"),e.ignore&&((0,h.logOnce)("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),e.orAction&&(this.append(" "),this.visitNode(e.orAction)),e.top&&(this.append(" "),this.visitNode(e.top)),e.into&&(this.append(" into "),this.visitNode(e.into)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.output&&(this.append(" "),this.visitNode(e.output)),e.values&&(this.append(" "),this.visitNode(e.values)),e.defaultValues&&(this.append(" "),this.append("default values")),e.onConflict&&(this.append(" "),this.visitNode(e.onConflict)),e.onDuplicateKey&&(this.append(" "),this.visitNode(e.onDuplicateKey)),e.returning&&(this.append(" "),this.visitNode(e.returning)),i&&!p.MergeQueryNode.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitValues(e){this.append("values "),this.compileList(e.values)}visitDeleteQuery(e){let t=this.nodeStack.find(d.QueryNode.is)!==e;!t&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("delete "),e.top&&(this.visitNode(e.top),this.append(" ")),this.visitNode(e.from),e.output&&(this.append(" "),this.visitNode(e.output)),e.using&&(this.append(" "),this.visitNode(e.using)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),t&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitReturning(e){this.append("returning "),this.compileList(e.selections)}visitAlias(e){this.visitNode(e.node),this.append(" as "),this.visitNode(e.alias)}visitReference(e){e.table&&(this.visitNode(e.table),this.append(".")),this.visitNode(e.column)}visitSelectAll(e){this.append("*")}visitIdentifier(e){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(e),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(e){if(!(0,l.isString)(e.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(e.name))}visitAnd(e){this.visitNode(e.left),this.append(" and "),this.visitNode(e.right)}visitOr(e){this.visitNode(e.left),this.append(" or "),this.visitNode(e.right)}visitValue(e){e.immediate?this.appendImmediateValue(e.value):this.appendValue(e.value)}visitValueList(e){this.append("("),this.compileList(e.values),this.append(")")}visitTuple(e){this.append("("),this.compileList(e.values),this.append(")")}visitPrimitiveValueList(e){this.append("(");let{values:t}=e;for(let e=0;e<t.length;++e)this.appendValue(t[e]),e!==t.length-1&&this.append(", ");this.append(")")}visitParens(e){this.append("("),this.visitNode(e.node),this.append(")")}visitJoin(e){this.append(A[e.joinType]),this.append(" "),this.visitNode(e.table),e.on&&(this.append(" "),this.visitNode(e.on))}visitOn(e){this.append("on "),this.visitNode(e.on)}visitRaw(e){let{sqlFragments:t,parameters:i}=e;for(let e=0;e<t.length;++e)this.append(t[e]),i.length>e&&this.visitNode(i[e])}visitOperator(e){this.append(e.operator)}visitTable(e){this.visitNode(e.table)}visitSchemableIdentifier(e){e.schema&&(this.visitNode(e.schema),this.append(".")),this.visitNode(e.identifier)}visitCreateTable(e){this.append("create "),e.frontModifiers&&e.frontModifiers.length>0&&(this.compileList(e.frontModifiers," "),this.append(" ")),e.temporary&&this.append("temporary "),this.append("table "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.table),e.selectQuery?(this.append(" as "),this.visitNode(e.selectQuery)):(this.append(" ("),this.compileList([...e.columns,...e.constraints??[]]),this.append(")"),e.onCommit&&(this.append(" on commit "),this.append(e.onCommit)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," ")))}visitColumnDefinition(e){e.ifNotExists&&this.append("if not exists "),this.visitNode(e.column),this.append(" "),this.visitNode(e.dataType),e.unsigned&&this.append(" unsigned"),e.frontModifiers&&e.frontModifiers.length>0&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.generated&&(this.append(" "),this.visitNode(e.generated)),e.identity&&this.append(" identity"),e.defaultTo&&(this.append(" "),this.visitNode(e.defaultTo)),e.notNull&&this.append(" not null"),e.unique&&this.append(" unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.primaryKey&&this.append(" primary key"),e.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),e.references&&(this.append(" "),this.visitNode(e.references)),e.check&&(this.append(" "),this.visitNode(e.check)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(e){this.append("references "),this.visitNode(e.table),this.append(" ("),this.compileList(e.columns),this.append(")"),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitDropTable(e){this.append("drop table "),e.ifExists&&this.append("if exists "),this.visitNode(e.table),e.cascade&&this.append(" cascade")}visitDataType(e){this.append(e.dataType)}visitOrderBy(e){this.append("order by "),this.compileList(e.items)}visitOrderByItem(e){this.visitNode(e.orderBy),e.collation&&(this.append(" "),this.visitNode(e.collation)),e.direction&&(this.append(" "),this.visitNode(e.direction)),e.nulls&&(this.append(" nulls "),this.append(e.nulls))}visitGroupBy(e){this.append("group by "),this.compileList(e.items)}visitGroupByItem(e){this.visitNode(e.groupBy)}visitUpdateQuery(e){let t=this.nodeStack.find(d.QueryNode.is),i=t!==e;if(!i&&e.explain&&(this.visitNode(e.explain),this.append(" ")),i&&!p.MergeQueryNode.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("update "),e.top&&(this.visitNode(e.top),this.append(" ")),e.table&&(this.visitNode(e.table),this.append(" ")),this.append("set "),e.updates&&this.compileList(e.updates),e.output&&(this.append(" "),this.visitNode(e.output)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins){if(!e.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(e.joins," ")}e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),i&&!p.MergeQueryNode.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitColumnUpdate(e){this.visitNode(e.column),this.append(" = "),this.visitNode(e.value)}visitLimit(e){this.append("limit "),this.visitNode(e.limit)}visitOffset(e){this.append("offset "),this.visitNode(e.offset)}visitOnConflict(e){this.append("on conflict"),e.columns?(this.append(" ("),this.compileList(e.columns),this.append(")")):e.constraint?(this.append(" on constraint "),this.visitNode(e.constraint)):e.indexExpression&&(this.append(" ("),this.visitNode(e.indexExpression),this.append(")")),e.indexWhere&&(this.append(" "),this.visitNode(e.indexWhere)),!0===e.doNothing?this.append(" do nothing"):e.updates&&(this.append(" do update set "),this.compileList(e.updates),e.updateWhere&&(this.append(" "),this.visitNode(e.updateWhere)))}visitOnDuplicateKey(e){this.append("on duplicate key update "),this.compileList(e.updates)}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.using&&(this.append(" using "),this.visitNode(e.using)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.where&&(this.append(" "),this.visitNode(e.where))}visitDropIndex(e){this.append("drop index "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.cascade&&this.append(" cascade")}visitCreateSchema(e){this.append("create schema "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.schema)}visitDropSchema(e){this.append("drop schema "),e.ifExists&&this.append("if exists "),this.visitNode(e.schema),e.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("primary key ("),this.compileList(e.columns),this.append(")"),this.buildDeferrable(e)}buildDeferrable(e){void 0!==e.deferrable&&(e.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==e.initiallyDeferred&&(e.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(e.columns),this.append(")"),this.buildDeferrable(e)}visitCheckConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("check ("),this.visitNode(e.expression),this.append(")")}visitForeignKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("foreign key ("),this.compileList(e.columns),this.append(") "),this.visitNode(e.references),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate)),this.buildDeferrable(e)}visitList(e){this.compileList(e.items)}visitWith(e){this.append("with "),e.recursive&&this.append("recursive "),this.compileList(e.expressions)}visitCommonTableExpression(e){this.visitNode(e.name),this.append(" as "),(0,l.isBoolean)(e.materialized)&&(e.materialized||this.append("not "),this.append("materialized ")),this.visitNode(e.expression)}visitCommonTableExpressionName(e){this.visitNode(e.table),e.columns&&(this.append("("),this.compileList(e.columns),this.append(")"))}visitAlterTable(e){this.append("alter table "),this.visitNode(e.table),this.append(" "),e.renameTo&&(this.append("rename to "),this.visitNode(e.renameTo)),e.setSchema&&(this.append("set schema "),this.visitNode(e.setSchema)),e.addConstraint&&this.visitNode(e.addConstraint),e.dropConstraint&&this.visitNode(e.dropConstraint),e.renameConstraint&&this.visitNode(e.renameConstraint),e.columnAlterations&&this.compileColumnAlterations(e.columnAlterations),e.addIndex&&this.visitNode(e.addIndex),e.dropIndex&&this.visitNode(e.dropIndex)}visitAddColumn(e){this.append("add column "),this.visitNode(e.column)}visitRenameColumn(e){this.append("rename column "),this.visitNode(e.column),this.append(" to "),this.visitNode(e.renameTo)}visitDropColumn(e){this.append("drop column "),this.visitNode(e.column)}visitAlterColumn(e){this.append("alter column "),this.visitNode(e.column),this.append(" "),e.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(e.dataType),e.dataTypeExpression&&(this.append("using "),this.visitNode(e.dataTypeExpression))),e.setDefault&&(this.append("set default "),this.visitNode(e.setDefault)),e.dropDefault&&this.append("drop default"),e.setNotNull&&this.append("set not null"),e.dropNotNull&&this.append("drop not null")}visitModifyColumn(e){this.append("modify column "),this.visitNode(e.column)}visitAddConstraint(e){this.append("add "),this.visitNode(e.constraint)}visitDropConstraint(e){this.append("drop constraint "),e.ifExists&&this.append("if exists "),this.visitNode(e.constraintName),"cascade"===e.modifier?this.append(" cascade"):"restrict"===e.modifier&&this.append(" restrict")}visitRenameConstraint(e){this.append("rename constraint "),this.visitNode(e.oldName),this.append(" to "),this.visitNode(e.newName)}visitSetOperation(e){this.append(e.operator),this.append(" "),e.all&&this.append("all "),this.visitNode(e.expression)}visitCreateView(e){this.append("create "),e.orReplace&&this.append("or replace "),e.materialized&&this.append("materialized "),e.temporary&&this.append("temporary "),this.append("view "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),this.append(" "),e.columns&&(this.append("("),this.compileList(e.columns),this.append(") ")),e.as&&(this.append("as "),this.visitNode(e.as))}visitRefreshMaterializedView(e){this.append("refresh materialized view "),e.concurrently&&this.append("concurrently "),this.visitNode(e.name),e.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(e){this.append("drop "),e.materialized&&this.append("materialized "),this.append("view "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.cascade&&this.append(" cascade")}visitGenerated(e){this.append("generated "),e.always&&this.append("always "),e.byDefault&&this.append("by default "),this.append("as "),e.identity&&this.append("identity"),e.expression&&(this.append("("),this.visitNode(e.expression),this.append(")")),e.stored&&this.append(" stored")}visitDefaultValue(e){this.append("default "),this.visitNode(e.defaultValue)}visitSelectModifier(e){e.rawModifier?this.visitNode(e.rawModifier):this.append(m[e.modifier]),e.of&&(this.append(" of "),this.compileList(e.of,", "))}visitCreateType(e){this.append("create type "),this.visitNode(e.name),e.enum&&(this.append(" as enum "),this.visitNode(e.enum))}visitDropType(e){this.append("drop type "),e.ifExists&&this.append("if exists "),this.visitNode(e.name)}visitExplain(e){this.append("explain"),(e.options||e.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),e.options&&(this.visitNode(e.options),e.format&&this.append(this.getExplainOptionsDelimiter())),e.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(e.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(e){this.append("default")}visitAggregateFunction(e){this.append(e.func),this.append("("),e.distinct&&this.append("distinct "),this.compileList(e.aggregated),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),this.append(")"),e.withinGroup&&(this.append(" within group ("),this.visitNode(e.withinGroup),this.append(")")),e.filter&&(this.append(" filter("),this.visitNode(e.filter),this.append(")")),e.over&&(this.append(" "),this.visitNode(e.over))}visitOver(e){this.append("over("),e.partitionBy&&(this.visitNode(e.partitionBy),e.orderBy&&this.append(" ")),e.orderBy&&this.visitNode(e.orderBy),this.append(")")}visitPartitionBy(e){this.append("partition by "),this.compileList(e.items)}visitPartitionByItem(e){this.visitNode(e.partitionBy)}visitBinaryOperation(e){this.visitNode(e.leftOperand),this.append(" "),this.visitNode(e.operator),this.append(" "),this.visitNode(e.rightOperand)}visitUnaryOperation(e){this.visitNode(e.operator),this.isMinusOperator(e.operator)||this.append(" "),this.visitNode(e.operand)}isMinusOperator(e){return n.OperatorNode.is(e)&&"-"===e.operator}visitUsing(e){this.append("using "),this.compileList(e.tables)}visitFunction(e){this.append(e.func),this.append("("),this.compileList(e.arguments),this.append(")")}visitCase(e){this.append("case"),e.value&&(this.append(" "),this.visitNode(e.value)),e.when&&(this.append(" "),this.compileList(e.when," ")),e.else&&(this.append(" else "),this.visitNode(e.else)),this.append(" end"),e.isStatement&&this.append(" case")}visitWhen(e){this.append("when "),this.visitNode(e.condition),e.result&&(this.append(" then "),this.visitNode(e.result))}visitJSONReference(e){this.visitNode(e.reference),this.visitNode(e.traversal)}visitJSONPath(e){for(let t of(e.inOperator&&this.visitNode(e.inOperator),this.append("'$"),e.pathLegs))this.visitNode(t);this.append("'")}visitJSONPathLeg(e){let t="ArrayLocation"===e.type;this.append(t?"[":"."),this.append(String(e.value)),t&&this.append("]")}visitJSONOperatorChain(e){for(let t=0,i=e.values.length;t<i;t++)t===i-1?this.visitNode(e.operator):this.append("->"),this.visitNode(e.values[t])}visitMergeQuery(e){e.with&&(this.visitNode(e.with),this.append(" ")),this.append("merge "),e.top&&(this.visitNode(e.top),this.append(" ")),this.append("into "),this.visitNode(e.into),e.using&&(this.append(" "),this.visitNode(e.using)),e.whens&&(this.append(" "),this.compileList(e.whens," ")),e.returning&&(this.append(" "),this.visitNode(e.returning)),e.output&&(this.append(" "),this.visitNode(e.output)),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitMatched(e){e.not&&this.append("not "),this.append("matched"),e.bySource&&this.append(" by source")}visitAddIndex(e){this.append("add "),e.unique&&this.append("unique "),this.append("index "),this.visitNode(e.name),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.using&&(this.append(" using "),this.visitNode(e.using))}visitCast(e){this.append("cast("),this.visitNode(e.expression),this.append(" as "),this.visitNode(e.dataType),this.append(")")}visitFetch(e){this.append("fetch next "),this.visitNode(e.rowCount),this.append(` rows ${e.modifier}`)}visitOutput(e){this.append("output "),this.compileList(e.selections)}visitTop(e){this.append(`top(${e.expression})`),e.modifiers&&this.append(` ${e.modifiers}`)}visitOrAction(e){this.append(e.action)}visitCollate(e){this.append("collate "),this.visitNode(e.collation)}append(e){this.#en+=e}appendValue(e){this.addParameter(e),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(e){let t=this.getLeftIdentifierWrapper(),i=this.getRightIdentifierWrapper(),r="";for(let o of e)r+=o,o===t?r+=t:o===i&&(r+=i);return r}sanitizeStringLiteral(e){return e.replace(t,"''")}addParameter(e){this.#ea.push(e)}appendImmediateValue(e){if((0,l.isString)(e))this.appendStringLiteral(e);else if((0,l.isNumber)(e)||(0,l.isBoolean)(e))this.append(e.toString());else if((0,l.isNull)(e))this.append("null");else if((0,l.isDate)(e))this.appendImmediateValue(e.toISOString());else if((0,l.isBigInt)(e))this.appendImmediateValue(e.toString());else throw Error(`invalid immediate value ${e}`)}appendStringLiteral(e){this.append("'"),this.append(this.sanitizeStringLiteral(e)),this.append("'")}sortSelectModifiers(e){return e.sort((e,t)=>e.modifier&&t.modifier?f[e.modifier]-f[t.modifier]:1),(0,l.freeze)(e)}compileColumnAlterations(e){this.compileList(e)}announcesNewColumnDataType(){return!0}}let m=(0,l.freeze)({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),f=(0,l.freeze)({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),A=(0,l.freeze)({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"})}},677521:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SqliteQueryCompiler:()=>i});var r=e.i(607186);let t=/"/g;class i extends r.DefaultQueryCompiler{visitOrAction(e){this.append("or "),this.append(e.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(t,'""')}visitDefaultInsertValue(e){this.append("null")}}}},90757:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({NoopPlugin:()=>t});class t{transformQuery(e){return e.node}async transformResult(e){return e.result}}}},719657:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DEFAULT_ALLOW_UNORDERED_MIGRATIONS:()=>n,DEFAULT_MIGRATION_LOCK_TABLE:()=>i,DEFAULT_MIGRATION_TABLE:()=>t,MIGRATION_LOCK_ID:()=>a,Migrator:()=>l,NO_MIGRATIONS:()=>d});var r=e.i(90757),o=e.i(569292),s=e.i(535542);let t="kysely_migration",i="kysely_migration_lock",n=!1,a="migration_lock",d=(0,s.freeze)({__noMigrations__:!0});class l{#t;constructor(e){this.#t=(0,s.freeze)(e)}async getMigrations(){let e=await this.#ed(this.#el)?await this.#t.db.withPlugin(this.#ec).selectFrom(this.#el).select(["name","timestamp"]).$narrowType().execute():[];return(await this.#eu()).map(({name:t,...i})=>{let r=e.find(e=>e.name===t);return{name:t,migration:i,executedAt:r?new Date(r.timestamp):void 0}})}async migrateToLatest(){return this.#ep(()=>({direction:"Up",step:1/0}))}async migrateTo(e){return this.#ep(({migrations:t,executedMigrations:i,pendingMigrations:r})=>{if(e===d)return{direction:"Down",step:1/0};if(!t.find(t=>t.name===e))throw Error(`migration "${e}" doesn't exist`);let o=i.indexOf(e),s=r.findIndex(t=>t.name===e);if(-1!==o)return{direction:"Down",step:i.length-o-1};if(-1!==s)return{direction:"Up",step:s+1};throw Error(`migration "${e}" isn't executed or pending`)})}async migrateUp(){return this.#ep(()=>({direction:"Up",step:1}))}async migrateDown(){return this.#ep(()=>({direction:"Down",step:1}))}async #ep(e){try{return await this.#eh(),await this.#em(e)}catch(e){if(e instanceof c)return e.resultSet;return{error:e}}}get #ef(){return this.#t.migrationTableSchema}get #el(){return this.#t.migrationTableName??t}get #eA(){return this.#t.migrationLockTableName??i}get #eg(){return this.#t.allowUnorderedMigrations??n}get #ec(){return this.#ef?new o.WithSchemaPlugin(this.#ef):new r.NoopPlugin}async #eh(){await this.#ey(),await this.#eK(),await this.#ew(),await this.#ev()}async #ey(){if(this.#ef&&!await this.#eb())try{await this.#e_(this.#t.db.schema.createSchema(this.#ef))}catch(e){if(!await this.#eb())throw e}}async #eK(){if(!await this.#ed(this.#el))try{this.#ef&&await this.#e_(this.#t.db.schema.createSchema(this.#ef)),await this.#e_(this.#t.db.schema.withPlugin(this.#ec).createTable(this.#el).addColumn("name","varchar(255)",e=>e.notNull().primaryKey()).addColumn("timestamp","varchar(255)",e=>e.notNull()))}catch(e){if(!await this.#ed(this.#el))throw e}}async #ew(){if(!await this.#ed(this.#eA))try{await this.#e_(this.#t.db.schema.withPlugin(this.#ec).createTable(this.#eA).addColumn("id","varchar(255)",e=>e.notNull().primaryKey()).addColumn("is_locked","integer",e=>e.notNull().defaultTo(0)))}catch(e){if(!await this.#ed(this.#eA))throw e}}async #ev(){if(!await this.#eN())try{await this.#t.db.withPlugin(this.#ec).insertInto(this.#eA).values({id:a,is_locked:0}).execute()}catch(e){if(!await this.#eN())throw e}}async #eb(){return(await this.#t.db.introspection.getSchemas()).some(e=>e.name===this.#ef)}async #ed(e){let t=this.#ef;return(await this.#t.db.introspection.getTables({withInternalKyselyTables:!0})).some(i=>i.name===e&&(!t||i.schema===t))}async #eN(){return!!await this.#t.db.withPlugin(this.#ec).selectFrom(this.#eA).where("id","=",a).select("id").executeTakeFirst()}async #em(e){let t=this.#t.db.getExecutor().adapter,r=(0,s.freeze)({lockTable:this.#t.migrationLockTableName??i,lockRowId:a,lockTableSchema:this.#t.migrationTableSchema}),o=async i=>{try{await t.acquireMigrationLock(i,r);let o=await this.#eI(i);if(0===o.migrations.length)return{results:[]};let{direction:s,step:n}=e(o);if(n<=0)return{results:[]};if("Down"===s)return await this.#eE(i,o,n);if("Up"===s)return await this.#eT(i,o,n);return{results:[]}}finally{await t.releaseMigrationLock(i,r)}};return t.supportsTransactionalDdl&&!this.#t.disableTransactions?this.#t.db.transaction().execute(o):this.#t.db.connection().execute(o)}async #eI(e){let t=await this.#eu(),i=await this.#eC(e);this.#ex(t,i),this.#eg||this.#eO(t,i);let r=this.#eS(t,i);return(0,s.freeze)({migrations:t,executedMigrations:i,lastMigration:(0,s.getLast)(i),pendingMigrations:r})}#eS(e,t){return e.filter(e=>!t.includes(e.name))}async #eu(){let e=await this.#t.provider.getMigrations();return Object.keys(e).sort().map(t=>({...e[t],name:t}))}async #eC(e){let t=await e.withPlugin(this.#ec).selectFrom(this.#el).select(["name","timestamp"]).$narrowType().execute(),i=this.#t.nameComparator||((e,t)=>e.localeCompare(t));return t.sort((e,t)=>e.timestamp===t.timestamp?i(e.name,t.name):new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()).map(e=>e.name)}#ex(e,t){for(let i of t)if(!e.some(e=>e.name===i))throw Error(`corrupted migrations: previously executed migration ${i} is missing`)}#eO(e,t){for(let i=0;i<t.length;++i)if(e[i].name!==t[i])throw Error(`corrupted migrations: expected previously executed migration ${t[i]} to be at index ${i} but ${e[i].name} was found in its place. New migrations must always have a name that comes alphabetically after the last executed migration.`)}async #eE(e,t,i){let r=t.executedMigrations.slice().reverse().slice(0,i).map(e=>t.migrations.find(t=>t.name===e)),o=r.map(e=>({migrationName:e.name,direction:"Down",status:"NotExecuted"}));for(let t=0;t<o.length;++t){let i=r[t];try{i.down&&(await i.down(e),await e.withPlugin(this.#ec).deleteFrom(this.#el).where("name","=",i.name).execute(),o[t]={migrationName:i.name,direction:"Down",status:"Success"})}catch(e){throw o[t]={migrationName:i.name,direction:"Down",status:"Error"},new c({error:e,results:o})}}return{results:o}}async #eT(e,t,i){let r=t.pendingMigrations.slice(0,i).map(e=>({migrationName:e.name,direction:"Up",status:"NotExecuted"}));for(let i=0;i<r.length;i++){let o=t.pendingMigrations[i];try{await o.up(e),await e.withPlugin(this.#ec).insertInto(this.#el).values({name:o.name,timestamp:new Date().toISOString()}).execute(),r[i]={migrationName:o.name,direction:"Up",status:"Success"}}catch(e){throw r[i]={migrationName:o.name,direction:"Up",status:"Error"},new c({error:e,results:r})}}return{results:r}}async #e_(e){this.#t.db.getExecutor().adapter.supportsCreateIfNotExists&&(e=e.ifNotExists()),await e.execute()}}class c extends Error{#ek;constructor(e){super(),this.#ek=e}get resultSet(){return this.#ek}}}},320454:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createRawBuilder:()=>d});var r=e.i(55167),o=e.i(535542),s=e.i(137096),n=e.i(453409),a=e.i(131385);class t{#t;constructor(e){this.#t=(0,o.freeze)(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new i(this,e)}$castTo(){return new t({...this.#t})}$notNull(){return new t(this.#t)}withPlugin(e){return new t({...this.#t,plugins:void 0!==this.#t.plugins?(0,o.freeze)([...this.#t.plugins,e]):(0,o.freeze)([e])})}toOperationNode(){return this.#eR(this.#eP())}compile(e){return this.#eU(this.#eP(e))}async execute(e){let t=this.#eP(e);return t.executeQuery(this.#eU(t),this.#t.queryId)}#eP(e){let t=void 0!==e?e.getExecutor():s.NOOP_QUERY_EXECUTOR;return void 0!==this.#t.plugins?t.withPlugins(this.#t.plugins):t}#eR(e){return e.transformQuery(this.#t.rawNode,this.#t.queryId)}#eU(e){return e.compileQuery(this.#eR(e),this.#t.queryId)}}function d(e){return new t(e)}class i{#eD;#I;constructor(e,t){this.#eD=e,this.#I=t}get expression(){return this.#eD}get alias(){return this.#I}get rawBuilder(){return this.#eD}toOperationNode(){return r.AliasNode.create(this.#eD.toOperationNode(),(0,a.isOperationNodeSource)(this.#I)?this.#I.toOperationNode():n.IdentifierNode.create(this.#I))}}}},755047:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({sql:()=>t});var r=e.i(453409),o=e.i(131385),s=e.i(620581),n=e.i(21348),a=e.i(927766),d=e.i(777649),l=e.i(374697),c=e.i(729895),u=e.i(320454);let t=Object.assign((e,...t)=>(0,u.createRawBuilder)({queryId:(0,c.createQueryId)(),rawNode:s.RawNode.create(e,t?.map(p)??[])}),{ref:e=>(0,u.createRawBuilder)({queryId:(0,c.createQueryId)(),rawNode:s.RawNode.createWithChild((0,a.parseStringReference)(e))}),val:e=>(0,u.createRawBuilder)({queryId:(0,c.createQueryId)(),rawNode:s.RawNode.createWithChild((0,l.parseValueExpression)(e))}),value(e){return this.val(e)},table:e=>(0,u.createRawBuilder)({queryId:(0,c.createQueryId)(),rawNode:s.RawNode.createWithChild((0,d.parseTable)(e))}),id(...e){let t=Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",(0,u.createRawBuilder)({queryId:(0,c.createQueryId)(),rawNode:s.RawNode.create(t,e.map(r.IdentifierNode.create))})},lit:e=>(0,u.createRawBuilder)({queryId:(0,c.createQueryId)(),rawNode:s.RawNode.createWithChild(n.ValueNode.createImmediate(e))}),literal(e){return this.lit(e)},raw:e=>(0,u.createRawBuilder)({queryId:(0,c.createQueryId)(),rawNode:s.RawNode.createWithSql(e)}),join(e,i=t`, `){let r=Array(Math.max(2*e.length-1,0)),o=i.toOperationNode();for(let t=0;t<e.length;++t)r[2*t]=p(e[t]),t!==e.length-1&&(r[2*t+1]=o);return(0,u.createRawBuilder)({queryId:(0,c.createQueryId)(),rawNode:s.RawNode.createWithChildren(r)})}});function p(e){return(0,o.isOperationNodeSource)(e)?e.toOperationNode():(0,l.parseValueExpression)(e)}}},131099:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SqliteIntrospector:()=>t});var r=e.i(719657),o=e.i(755047);class t{#eo;constructor(e){this.#eo=e}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){return await this.#eL(e)}async getMetadata(e){return{tables:await this.getTables(e)}}#ez(e,t){let i=e.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return t.withInternalKyselyTables||(i=i.where("name","!=",r.DEFAULT_MIGRATION_TABLE).where("name","!=",r.DEFAULT_MIGRATION_LOCK_TABLE)),i}async #eL(e){let t=await this.#ez(this.#eo,e).execute(),i=await this.#eo.with("table_list",t=>this.#ez(t,e)).selectFrom(["table_list as tl",o.sql`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),r={};for(let e of i)r[e.table]??=[],r[e.table].push(e);return t.map(({name:e,sql:t,type:i})=>{let o=t?.split(/[\(\),]/)?.find(e=>e.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),s=r[e]??[];if(!o){let e=s.filter(e=>e.pk>0);1===e.length&&"integer"===e[0].type.toLowerCase()&&(o=e[0].name)}return{name:e,isView:"view"===i,columns:s.map(e=>({name:e.name,dataType:e.type,isNullable:!e.notnull,isAutoIncrementing:e.name===o,hasDefaultValue:null!=e.dflt_value,comment:void 0}))}})}}}},636478:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DialectAdapterBase:()=>t});class t{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}}},937081:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SqliteAdapter:()=>t});var r=e.i(636478);class t extends r.DialectAdapterBase{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}}},132340:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({SqliteDialect:()=>t});var r=e.i(607490),o=e.i(677521),s=e.i(131099),n=e.i(937081),a=e.i(535542);class t{#ei;constructor(e){this.#ei=(0,a.freeze)({...e})}createDriver(){return new r.SqliteDriver(this.#ei)}createQueryCompiler(){return new o.SqliteQueryCompiler}createAdapter(){return new n.SqliteAdapter}createIntrospector(e){return new s.SqliteIntrospector(e)}}}},567778:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({extendStackTrace:()=>o});var r=e.i(535542);function o(e,t){var i;if(i=e,(0,r.isObject)(i)&&(0,r.isString)(i.stack)&&t.stack){let i=t.stack.split("\n").slice(1).join("\n");e.stack+=`
${i}`}return e}},647021:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MysqlDriver:()=>i});var r=e.i(962952),o=e.i(741836),s=e.i(535542),n=e.i(729895),a=e.i(567778);let t=Symbol();class i{#ei;#Z=new WeakMap;#eB;constructor(e){this.#ei=(0,s.freeze)({...e})}async init(){this.#eB=(0,s.isFunction)(this.#ei.pool)?await this.#ei.pool():this.#ei.pool}async acquireConnection(){let e=await this.#ej(),t=this.#Z.get(e);return!t&&(t=new d(e),this.#Z.set(e,t),this.#ei?.onCreateConnection&&await this.#ei.onCreateConnection(t)),this.#ei?.onReserveConnection&&await this.#ei.onReserveConnection(t),t}async #ej(){return new Promise((e,t)=>{this.#eB.getConnection(async(i,r)=>{i?t(i):e(r)})})}async beginTransaction(e,t){if(t.isolationLevel||t.accessMode){let i=[];t.isolationLevel&&i.push(`isolation level ${t.isolationLevel}`),t.accessMode&&i.push(t.accessMode);let r=`set transaction ${i.join(", ")}`;await e.executeQuery(o.CompiledQuery.raw(r))}await e.executeQuery(o.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(o.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(o.CompiledQuery.raw("rollback"))}async savepoint(e,t,i){await e.executeQuery(i((0,r.parseSavepointCommand)("savepoint",t),(0,n.createQueryId)()))}async rollbackToSavepoint(e,t,i){await e.executeQuery(i((0,r.parseSavepointCommand)("rollback to",t),(0,n.createQueryId)()))}async releaseSavepoint(e,t,i){await e.executeQuery(i((0,r.parseSavepointCommand)("release savepoint",t),(0,n.createQueryId)()))}async releaseConnection(e){e[t]()}async destroy(){return new Promise((e,t)=>{this.#eB.end(i=>{i?t(i):e()})})}}class d{#eq;constructor(e){this.#eq=e}async executeQuery(e){try{let t=await this.#eZ(e);if((0,s.isObject)(t)&&"insertId"in t&&"affectedRows"in t){let{insertId:e,affectedRows:i,changedRows:r}=t;return{insertId:null!=e&&"0"!==e.toString()?BigInt(e):void 0,numAffectedRows:null!=i?BigInt(i):void 0,numChangedRows:null!=r?BigInt(r):void 0,rows:[]}}if(Array.isArray(t))return{rows:t};return{rows:[]}}catch(e){throw(0,a.extendStackTrace)(e,Error())}}#eZ(e){return new Promise((t,i)=>{this.#eq.query(e.sql,e.parameters,(e,r)=>{e?i(e):t(r)})})}async *streamQuery(e,t){let i=this.#eq.query(e.sql,e.parameters).stream({objectMode:!0});try{for await(let e of i)yield{rows:[e]}}catch(e){if(e&&"object"==typeof e&&"code"in e&&"ERR_STREAM_PREMATURE_CLOSE"===e.code)return;throw e}}[t](){this.#eq.release()}}}},789435:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MysqlQueryCompiler:()=>i});var r=e.i(607186);let t=/`/g;class i extends r.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(e){return e.replace(t,"``")}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.using&&(this.append(" using "),this.visitNode(e.using)),e.table&&(this.append(" on "),this.visitNode(e.table)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.where&&(this.append(" "),this.visitNode(e.where))}}}},984686:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MysqlIntrospector:()=>t});var r=e.i(719657),o=e.i(535542),s=e.i(755047);class t{#eo;constructor(e){this.#eo=e}async getSchemas(){return(await this.#eo.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(e=>({name:e.SCHEMA_NAME}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#eo.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",e=>e.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",s.sql`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();e.withInternalKyselyTables||(t=t.where("columns.TABLE_NAME","!=",r.DEFAULT_MIGRATION_TABLE).where("columns.TABLE_NAME","!=",r.DEFAULT_MIGRATION_LOCK_TABLE));let i=await t.execute();return this.#eM(i)}async getMetadata(e){return{tables:await this.getTables(e)}}#eM(e){return e.reduce((e,t)=>{let i=e.find(e=>e.name===t.TABLE_NAME);return i||(i=(0,o.freeze)({name:t.TABLE_NAME,isView:"VIEW"===t.TABLE_TYPE,schema:t.TABLE_SCHEMA,columns:[]}),e.push(i)),i.columns.push((0,o.freeze)({name:t.COLUMN_NAME,dataType:t.DATA_TYPE,isNullable:"YES"===t.IS_NULLABLE,isAutoIncrementing:t.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==t.COLUMN_DEFAULT,comment:""===t.COLUMN_COMMENT?void 0:t.COLUMN_COMMENT})),e},[])}}}},440074:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MysqlAdapter:()=>i});var r=e.i(755047),o=e.i(636478);let t="ea586330-2c93-47c8-908d-981d9d270f9d";class i extends o.DialectAdapterBase{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(e,i){await r.sql`select get_lock(${r.sql.lit(t)}, ${r.sql.lit(3600)})`.execute(e)}async releaseMigrationLock(e,i){await r.sql`select release_lock(${r.sql.lit(t)})`.execute(e)}}}},978321:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MysqlDialect:()=>t});var r=e.i(647021),o=e.i(789435),s=e.i(984686),n=e.i(440074);class t{#ei;constructor(e){this.#ei=e}createDriver(){return new r.MysqlDriver(this.#ei)}createQueryCompiler(){return new o.MysqlQueryCompiler}createAdapter(){return new n.MysqlAdapter}createIntrospector(e){return new s.MysqlIntrospector(e)}}}},402326:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PostgresDriver:()=>i});var r=e.i(962952),o=e.i(741836),s=e.i(535542),n=e.i(729895),a=e.i(567778);let t=Symbol();class i{#ei;#Z=new WeakMap;#eB;constructor(e){this.#ei=(0,s.freeze)({...e})}async init(){this.#eB=(0,s.isFunction)(this.#ei.pool)?await this.#ei.pool():this.#ei.pool}async acquireConnection(){let e=await this.#eB.connect(),t=this.#Z.get(e);return!t&&(t=new d(e,{cursor:this.#ei.cursor??null}),this.#Z.set(e,t),this.#ei.onCreateConnection&&await this.#ei.onCreateConnection(t)),this.#ei.onReserveConnection&&await this.#ei.onReserveConnection(t),t}async beginTransaction(e,t){if(t.isolationLevel||t.accessMode){let i="start transaction";t.isolationLevel&&(i+=` isolation level ${t.isolationLevel}`),t.accessMode&&(i+=` ${t.accessMode}`),await e.executeQuery(o.CompiledQuery.raw(i))}else await e.executeQuery(o.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(o.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(o.CompiledQuery.raw("rollback"))}async savepoint(e,t,i){await e.executeQuery(i((0,r.parseSavepointCommand)("savepoint",t),(0,n.createQueryId)()))}async rollbackToSavepoint(e,t,i){await e.executeQuery(i((0,r.parseSavepointCommand)("rollback to",t),(0,n.createQueryId)()))}async releaseSavepoint(e,t,i){await e.executeQuery(i((0,r.parseSavepointCommand)("release",t),(0,n.createQueryId)()))}async releaseConnection(e){e[t]()}async destroy(){if(this.#eB){let e=this.#eB;this.#eB=void 0,await e.end()}}}class d{#eV;#eW;constructor(e,t){this.#eV=e,this.#eW=t}async executeQuery(e){try{let{command:t,rowCount:i,rows:r}=await this.#eV.query(e.sql,[...e.parameters]);return{numAffectedRows:"INSERT"===t||"UPDATE"===t||"DELETE"===t||"MERGE"===t?BigInt(i):void 0,rows:r??[]}}catch(e){throw(0,a.extendStackTrace)(e,Error())}}async *streamQuery(e,t){if(!this.#eW.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(t)||t<=0)throw Error("chunkSize must be a positive integer");let i=this.#eV.query(new this.#eW.cursor(e.sql,e.parameters.slice()));try{for(;;){let e=await i.read(t);if(0===e.length)break;yield{rows:e}}}finally{await i.close()}}[t](){this.#eV.release()}}}},646629:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PostgresIntrospector:()=>t});var r=e.i(719657),o=e.i(535542),s=e.i(755047);class t{#eo;constructor(e){this.#eo=e}async getSchemas(){return(await this.#eo.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(e=>({name:e.nspname}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#eo.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",s.sql`col_description(a.attrelid, a.attnum)`.as("column_description"),s.sql`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();e.withInternalKyselyTables||(t=t.where("c.relname","!=",r.DEFAULT_MIGRATION_TABLE).where("c.relname","!=",r.DEFAULT_MIGRATION_LOCK_TABLE));let i=await t.execute();return this.#eM(i)}async getMetadata(e){return{tables:await this.getTables(e)}}#eM(e){return e.reduce((e,t)=>{let i=e.find(e=>e.name===t.table&&e.schema===t.schema);return i||(i=(0,o.freeze)({name:t.table,isView:"v"===t.table_type,schema:t.schema,columns:[]}),e.push(i)),i.columns.push((0,o.freeze)({name:t.column,dataType:t.type,dataTypeSchema:t.type_schema,isNullable:!t.not_null,isAutoIncrementing:null!==t.auto_incrementing,hasDefaultValue:t.has_default,comment:t.column_description??void 0})),e},[])}}}},395500:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PostgresQueryCompiler:()=>i});var r=e.i(607186);let t=/"/g;class i extends r.DefaultQueryCompiler{sanitizeIdentifier(e){return e.replace(t,'""')}}}},899609:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PostgresAdapter:()=>i});var r=e.i(755047),o=e.i(636478);let t=BigInt("3853314791062309107");class i extends o.DialectAdapterBase{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e,i){await r.sql`select pg_advisory_xact_lock(${r.sql.lit(t)})`.execute(e)}async releaseMigrationLock(e,t){}}}},399712:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({PostgresDialect:()=>t});var r=e.i(402326),o=e.i(646629),s=e.i(395500),n=e.i(899609);class t{#ei;constructor(e){this.#ei=e}createDriver(){return new r.PostgresDriver(this.#ei)}createQueryCompiler(){return new s.PostgresQueryCompiler}createAdapter(){return new n.PostgresAdapter}createIntrospector(e){return new o.PostgresIntrospector(e)}}}},515409:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MssqlAdapter:()=>t});var r=e.i(719657),o=e.i(755047),s=e.i(636478);class t extends s.DialectAdapterBase{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(e){await o.sql`exec sp_getapplock @DbPrincipal = ${o.sql.lit("dbo")}, @Resource = ${o.sql.lit(r.DEFAULT_MIGRATION_TABLE)}, @LockMode = ${o.sql.lit("Exclusive")}`.execute(e)}async releaseMigrationLock(){}}}},318046:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MssqlDriver:()=>d});var r=e.i(535542),o=e.i(741836),s=e.i(567778),n=e.i(241800),a=e.i(55530);let t=Symbol(),i=Symbol();class d{#ei;#eB;constructor(e){this.#ei=(0,r.freeze)({...e});let{tarn:t,tedious:o,validateConnections:s}=this.#ei,{validateConnections:n,...a}=t.options;this.#eB=new t.Pool({...a,create:async()=>{let e=await o.connectionFactory();return await new l(e,o).connect()},destroy:async e=>{await e[i]()},validate:!1===s||!1===n?void 0:e=>e.validate()})}async init(){}async acquireConnection(){return await this.#eB.acquire().promise}async beginTransaction(e,t){await e.beginTransaction(t)}async commitTransaction(e){await e.commitTransaction()}async rollbackTransaction(e){await e.rollbackTransaction()}async savepoint(e,t){await e.savepoint(t)}async rollbackToSavepoint(e,t){await e.rollbackTransaction(t)}async releaseConnection(e){(this.#ei.resetConnectionsOnRelease||this.#ei.tedious.resetConnectionOnRelease)&&await e[t](),this.#eB.release(e)}async destroy(){await this.#eB.destroy()}}class l{#H;#eF;constructor(e,t){this.#H=e,this.#eF=t,this.#H.on("error",console.error),this.#H.once("end",()=>{this.#H.off("error",console.error)})}async beginTransaction(e){let{isolationLevel:t}=e;await new Promise((e,i)=>this.#H.beginTransaction(t=>{t?i(t):e(void 0)},t?(0,n.randomString)(8):void 0,t?this.#e$(t):void 0))}async commitTransaction(){await new Promise((e,t)=>this.#H.commitTransaction(i=>{i?t(i):e(void 0)}))}async connect(){return await new Promise((e,t)=>{this.#H.connect(i=>{i?(console.error(i),t(i)):e(void 0)})}),this}async executeQuery(e){try{let t=new a.Deferred,i=new c({compiledQuery:e,tedious:this.#eF,onDone:t});this.#H.execSql(i.request);let{rowCount:r,rows:o}=await t.promise;return{numAffectedRows:void 0!==r?BigInt(r):void 0,rows:o}}catch(e){throw(0,s.extendStackTrace)(e,Error())}}async rollbackTransaction(e){await new Promise((t,i)=>this.#H.rollbackTransaction(e=>{e?i(e):t(void 0)},e))}async savepoint(e){await new Promise((t,i)=>this.#H.saveTransaction(e=>{e?i(e):t(void 0)},e))}async *streamQuery(e,t){if(!Number.isInteger(t)||t<=0)throw Error("chunkSize must be a positive integer");let i=new c({compiledQuery:e,streamChunkSize:t,tedious:this.#eF});this.#H.execSql(i.request);try{for(;;){let e=await i.readChunk();if(0===e.length||(yield{rows:e},e.length<t))break}}finally{await this.#eH(i)}}async validate(){try{let e=new a.Deferred,t=new c({compiledQuery:o.CompiledQuery.raw("select 1"),onDone:e,tedious:this.#eF});return this.#H.execSql(t.request),await e.promise,!0}catch{return!1}}#e$(e){let{ISOLATION_LEVEL:t}=this.#eF,i={"read committed":t.READ_COMMITTED,"read uncommitted":t.READ_UNCOMMITTED,"repeatable read":t.REPEATABLE_READ,serializable:t.SERIALIZABLE,snapshot:t.SNAPSHOT}[e];if(void 0===i)throw Error(`Unknown isolation level: ${e}`);return i}#eH(e){return new Promise(t=>{e.request.once("requestCompleted",t),this.#H.cancel()||(e.request.off("requestCompleted",t),t(void 0))})}async [t](){await new Promise((e,t)=>{this.#H.reset(i=>{i?t(i):e(void 0)})})}[i](){return new Promise(e=>{this.#H.once("end",()=>{e(void 0)}),this.#H.close()})}}class c{#eQ;#eJ;#eG;#eY;#eF;#eX;constructor(e){let{compiledQuery:t,onDone:i,streamChunkSize:r,tedious:o}=e;if(this.#eJ=[],this.#eG=r,this.#eY={},this.#eF=o,i){let e="onDone";this.#eY[e]=(t,r)=>{"chunkReady"!==t&&(delete this.#eY[e],"error"===t?i.reject(r):i.resolve({rowCount:this.#eX,rows:this.#eJ}))}}this.#eQ=new this.#eF.Request(t.sql,(e,t)=>{e?Object.values(this.#eY).forEach(t=>t("error",e instanceof AggregateError?e.errors:e)):this.#eX=t}),this.#e0(t.parameters),this.#e1()}get request(){return this.#eQ}readChunk(){let e=this.readChunk.name;return new Promise((t,i)=>{this.#eY[e]=(r,o)=>{delete this.#eY[e],"error"===r?i(o):t(this.#eJ.splice(0,this.#eG))},this.#eQ.resume()})}#e0(e){for(let t=0;t<e.length;t++){let i=e[t];this.#eQ.addParameter(String(t+1),this.#e2(i),i)}}#e1(){let e=this.#eG?()=>{this.#eG<=this.#eJ.length&&(this.#eQ.pause(),Object.values(this.#eY).forEach(e=>e("chunkReady")))}:()=>{},t=t=>{let i={};for(let e of t)i[e.metadata.colName]=e.value;this.#eJ.push(i),e()};this.#eQ.on("row",t),this.#eQ.once("requestCompleted",()=>{Object.values(this.#eY).forEach(e=>e("completed")),this.#eQ.off("row",t)})}#e2(e){if((0,r.isNull)(e)||(0,r.isUndefined)(e)||(0,r.isString)(e))return this.#eF.TYPES.NVarChar;if((0,r.isBigInt)(e)||(0,r.isNumber)(e)&&e%1==0)if(e<-0x80000000||e>0x7fffffff)return this.#eF.TYPES.BigInt;else return this.#eF.TYPES.Int;return(0,r.isNumber)(e)?this.#eF.TYPES.Float:(0,r.isBoolean)(e)?this.#eF.TYPES.Bit:(0,r.isDate)(e)?this.#eF.TYPES.DateTime:(0,r.isBuffer)(e)?this.#eF.TYPES.VarBinary:this.#eF.TYPES.NVarChar}}}},930491:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MssqlIntrospector:()=>t});var r=e.i(719657),o=e.i(535542);class t{#eo;constructor(e){this.#eo=e}async getSchemas(){return await this.#eo.selectFrom("sys.schemas").select("name").execute()}async getTables(e={withInternalKyselyTables:!1}){let t=await this.#eo.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",e=>e.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!e.withInternalKyselyTables,e=>e.where("tables.name","!=",r.DEFAULT_MIGRATION_TABLE).where("tables.name","!=",r.DEFAULT_MIGRATION_LOCK_TABLE)).select(["tables.name as table_name",e=>e.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#eo.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",e=>e.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),i={};for(let e of t){let t=`${e.table_schema_name}.${e.table_name}`;(i[t]=i[t]||(0,o.freeze)({columns:[],isView:"V "===e.table_type,name:e.table_name,schema:e.table_schema_name??void 0})).columns.push((0,o.freeze)({dataType:e.type_name,dataTypeSchema:e.type_schema_name??void 0,hasDefaultValue:e.column_default_object_id>0||"NOT_APPLICABLE"!==e.column_generated_always_type||e.column_is_identity||e.column_is_computed||e.column_is_rowguidcol,isAutoIncrementing:e.column_is_identity,isNullable:e.column_is_nullable&&e.type_is_nullable,name:e.column_name,comment:e.column_comment??void 0}))}return Object.values(i)}async getMetadata(e){return{tables:await this.getTables(e)}}}}},1492:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MssqlQueryCompiler:()=>i});var r=e.i(607186);let t=/^[a-z0-9_]$/i;class i extends r.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(e){super.visitOffset(e),this.append(" rows")}compileColumnAlterations(e){let t={};for(let i of e)t[i.kind]||(t[i.kind]=[]),t[i.kind].push(i);let i=!0;t.AddColumnNode&&(this.append("add "),this.compileList(t.AddColumnNode),i=!1),t.AlterColumnNode&&(i||this.append(", "),this.compileList(t.AlterColumnNode)),t.DropColumnNode&&(i||this.append(", "),this.append("drop column "),this.compileList(t.DropColumnNode)),t.ModifyColumnNode&&(i||this.append(", "),this.compileList(t.ModifyColumnNode)),t.RenameColumnNode&&(i||this.append(", "),this.compileList(t.RenameColumnNode))}visitAddColumn(e){this.visitNode(e.column)}visitDropColumn(e){this.visitNode(e.column)}visitMergeQuery(e){super.visitMergeQuery(e),this.append(";")}visitCollate(e){this.append("collate ");let{name:i}=e.collation;for(let e of i)if(!t.test(e))throw Error(`Invalid collation: ${i}`);this.append(i)}announcesNewColumnDataType(){return!1}}}},920330:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({MssqlDialect:()=>t});var r=e.i(515409),o=e.i(318046),s=e.i(930491),n=e.i(1492);class t{#ei;constructor(e){this.#ei=e}createDriver(){return new o.MssqlDriver(this.#ei)}createQueryCompiler(){return new n.MssqlQueryCompiler}createAdapter(){return new r.MssqlAdapter}createIntrospector(e){return new s.MssqlIntrospector(e)}}}},64041:e=>{"use strict";var{g:t,__dirname:i}=e;function r(e,t,i){return"update"===i?e:null==e&&t.defaultValue?"function"==typeof t.defaultValue?t.defaultValue():t.defaultValue:e}e.s({w:()=>r})},805494:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({c:()=>h});var r=e.i(316944),o=e.i(64041),s=e.i(955759),n=e.i(628146);e.i(243917),e.i(311556),e.i(74222),e.i(483013),e.i(533004),e.i(91997),e.i(382320);var a=e.i(187615);let t=[],i=-1,p={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{yellow:"\x1b[33m",magenta:"\x1b[35m"},bg:{black:"\x1b[40m"}},h=({adapter:e,config:p})=>h=>{let m={...p,supportsBooleans:p.supportsBooleans??!0,supportsDates:p.supportsDates??!0,supportsJSON:p.supportsJSON??!1,adapterName:p.adapterName??p.adapterId,supportsNumericIds:p.supportsNumericIds??!0};if(h.advanced?.database?.useNumberId===!0&&!1===m.supportsNumericIds)throw Error(`[${m.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let f=(0,s.g)(h),A=({field:e,model:t})=>{if("id"===e)return e;let i=g(t),r=f[i]?.fields[e];if(r||(r=Object.values(f[i]?.fields).find(t=>t.fieldName===e)),!r)throw w(`Field ${e} not found in model ${i}`),w("Schema:",f),Error(`Field ${e} not found in model ${i}`);return e},g=e=>{if(m.usePlural&&"s"===e.charAt(e.length-1)){let t=e.slice(0,-1),i=f[t]?t:void 0;if(i||(i=Object.entries(f).find(([e,i])=>i.modelName===t)?.[0]),i)return i}let t=f[e]?e:void 0;if(t||(t=Object.entries(f).find(([t,i])=>i.modelName===e)?.[0]),!t)throw w(`Model "${e}" not found in schema`),w("Schema:",f),Error(`Model "${e}" not found in schema`);return t},y=e=>f[g(e)].modelName!==e?f[g(e)].modelName:m.usePlural?`${e}s`:e;function K({model:e,field:t}){let i=g(e),r=A({model:i,field:t});return f[i]?.fields[r]?.fieldName||r}let w=(...e)=>{if(!0===m.debugLogs||"object"==typeof m.debugLogs){if("object"==typeof m.debugLogs&&"isRunningAdapterTests"in m.debugLogs){m.debugLogs.isRunningAdapterTests&&(e.shift(),t.push(e));return}if("object"!=typeof m.debugLogs||!m.debugLogs.logCondition||m.debugLogs.logCondition?.())if("object"==typeof e[0]&&"method"in e[0]){let t=e.shift().method;if("object"==typeof m.debugLogs){if("create"===t&&!m.debugLogs.create)return;else if("update"===t&&!m.debugLogs.update)return;else if("updateMany"===t&&!m.debugLogs.updateMany)return;else if("findOne"===t&&!m.debugLogs.findOne)return;else if("findMany"===t&&!m.debugLogs.findMany)return;else if("delete"===t&&!m.debugLogs.delete)return;else if("deleteMany"===t&&!m.debugLogs.deleteMany)return;else if("count"===t&&!m.debugLogs.count)return}a.l.info(`[${m.adapterName}]`,...e)}else a.l.info(`[${m.adapterName}]`,...e)}},v=({customModelName:e,forceAllowId:t})=>{let i=!m.disableIdGeneration&&!h.advanced?.database?.useNumberId&&!t,r=g(e??"id");return{type:h.advanced?.database?.useNumberId?"number":"string",required:!!i,...i?{defaultValue(){if(m.disableIdGeneration)return;let e=h.advanced?.database?.useNumberId,t=h.advanced?.database?.generateId;if(h.advanced?.generateId!==void 0&&(a.l.warn("Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases."),t=h.advanced?.generateId),!1!==t&&!e)return t?t({model:r}):m.customIdGenerator?m.customIdGenerator({model:r}):(0,n.g)()}}:{}}},b=({model:e,field:t})=>{let i=g(e),r=A({field:t,model:e}),o=f[i].fields;return o.id=v({customModelName:i}),o[r]},_=e({options:h,schema:f,debugLog:w,getFieldName:K,getModelName:y,getDefaultModelName:g,getDefaultFieldName:A,getFieldAttributes:b}),N=async(e,t,i,r)=>{let s={},n=f[t].fields,a=m.mapKeysTransformInput??{};for(let d in m.disableIdGeneration||h.advanced?.database?.useNumberId||(n.id=v({customModelName:t,forceAllowId:r})),n){let r=e[d],l=n[d],c=a[d]||n[d].fieldName||d;if(void 0===r&&(!l.defaultValue&&!l.transform?.input||"update"===i))continue;let u=(0,o.w)(r,l,i);l.transform?.input&&(u=await l.transform.input(u)),l.references?.field==="id"&&h.advanced?.database?.useNumberId?u=Array.isArray(u)?u.map(Number):Number(u):!1===m.supportsJSON&&"object"==typeof u&&"json"===l.type?u=JSON.stringify(u):!1===m.supportsDates&&u instanceof Date&&"date"===l.type?u=u.toISOString():!1===m.supportsBooleans&&"boolean"==typeof u&&(u=+!!u),m.customTransformInput&&(u=m.customTransformInput({data:u,action:i,field:c,fieldAttributes:l,model:t,schema:f,options:h})),s[c]=u}return s},I=async(e,t,i=[])=>{if(!e)return null;let o=m.mapKeysTransformOutput??{},s={},n=f[t].fields;for(let a in n[Object.entries(o).find(([e,t])=>"id"===t)?.[0]??"id"]={type:h.advanced?.database?.useNumberId?"number":"string"},n){if(i.length&&!i.includes(a))continue;let d=n[a];if(d){let n=d.fieldName||a,l=e[Object.entries(o).find(([e,t])=>t===n)?.[0]||n];d.transform?.output&&(l=await d.transform.output(l));let c=o[a]||a;"id"===n||d.references?.field==="id"?void 0!==l&&(l=String(l)):!1===m.supportsJSON&&"string"==typeof l&&"json"===d.type?l=(0,r.s)(l):!1===m.supportsDates&&"string"==typeof l&&"date"===d.type?l=new Date(l):!1===m.supportsBooleans&&"number"==typeof l&&"boolean"===d.type&&(l=1===l),m.customTransformOutput&&(l=m.customTransformOutput({data:l,field:c,fieldAttributes:d,select:i,model:t,schema:f,options:h})),s[c]=l}}return s},E=({model:e,where:t})=>{if(t)return t.map(t=>{let{field:i,value:r,operator:o="eq",connector:s="AND"}=t;if("in"===o&&!Array.isArray(r))throw Error("Value must be an array");let n=g(e),a=A({field:i,model:e}),d=K({field:a,model:n}),l=b({field:a,model:n});return("id"===a||l.references?.field==="id")&&h.advanced?.database?.useNumberId?Array.isArray(r)?{operator:o,connector:s,field:d,value:r.map(Number)}:{operator:o,connector:s,field:d,value:Number(r)}:{operator:o,connector:s,field:d,value:r}})};return{create:async({data:e,model:t,select:r,forceAllowId:o=!1})=>{let s=++i,n=y(t);if("id"in e&&!o){a.l.warn(`[${m.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`);let t=Error();console.log(t.stack?.split("\n").filter((e,t)=>1!==t).join("\n").replace("Error:","Create method with `id` being called at:")),e.id=void 0}w({method:"create"},`${d(s)} ${l(1,4)}`,`${c("create")} ${u("Unsafe Input")}:`,{model:n,data:e});let p=await N(e,t,"create",o);w({method:"create"},`${d(s)} ${l(2,4)}`,`${c("create")} ${u("Parsed Input")}:`,{model:n,data:p});let h=await _.create({data:p,model:n});w({method:"create"},`${d(s)} ${l(3,4)}`,`${c("create")} ${u("DB Result")}:`,{model:n,res:h});let f=await I(h,t,r);return w({method:"create"},`${d(s)} ${l(4,4)}`,`${c("create")} ${u("Parsed Result")}:`,{model:n,data:f}),f},update:async({model:e,where:t,update:r})=>{let o=++i,s=y(e),n=E({model:e,where:t});w({method:"update"},`${d(o)} ${l(1,4)}`,`${c("update")} ${u("Unsafe Input")}:`,{model:s,data:r});let a=await N(r,e,"update");w({method:"update"},`${d(o)} ${l(2,4)}`,`${c("update")} ${u("Parsed Input")}:`,{model:s,data:a});let p=await _.update({model:s,where:n,update:a});w({method:"update"},`${d(o)} ${l(3,4)}`,`${c("update")} ${u("DB Result")}:`,{model:s,data:p});let h=await I(p,e);return w({method:"update"},`${d(o)} ${l(4,4)}`,`${c("update")} ${u("Parsed Result")}:`,{model:s,data:h}),h},updateMany:async({model:e,where:t,update:r})=>{let o=++i,s=y(e),n=E({model:e,where:t});w({method:"updateMany"},`${d(o)} ${l(1,4)}`,`${c("updateMany")} ${u("Unsafe Input")}:`,{model:s,data:r});let a=await N(r,e,"update");w({method:"updateMany"},`${d(o)} ${l(2,4)}`,`${c("updateMany")} ${u("Parsed Input")}:`,{model:s,data:a});let p=await _.updateMany({model:s,where:n,update:a});return w({method:"updateMany"},`${d(o)} ${l(3,4)}`,`${c("updateMany")} ${u("DB Result")}:`,{model:s,data:p}),w({method:"updateMany"},`${d(o)} ${l(4,4)}`,`${c("updateMany")} ${u("Parsed Result")}:`,{model:s,data:p}),p},findOne:async({model:e,where:t,select:r})=>{let o=++i,s=y(e),n=E({model:e,where:t});w({method:"findOne"},`${d(o)} ${l(1,3)}`,`${c("findOne")}:`,{model:s,where:n,select:r});let a=await _.findOne({model:s,where:n,select:r});w({method:"findOne"},`${d(o)} ${l(2,3)}`,`${c("findOne")} ${u("DB Result")}:`,{model:s,data:a});let p=await I(a,e,r);return w({method:"findOne"},`${d(o)} ${l(3,3)}`,`${c("findOne")} ${u("Parsed Result")}:`,{model:s,data:p}),p},findMany:async({model:e,where:t,limit:r,sortBy:o,offset:s})=>{let n=++i,a=r??h.advanced?.database?.defaultFindManyLimit??100,p=y(e),m=E({model:e,where:t});w({method:"findMany"},`${d(n)} ${l(1,3)}`,`${c("findMany")}:`,{model:p,where:m,limit:a,sortBy:o,offset:s});let f=await _.findMany({model:p,where:m,limit:a,sortBy:o,offset:s});w({method:"findMany"},`${d(n)} ${l(2,3)}`,`${c("findMany")} ${u("DB Result")}:`,{model:p,data:f});let A=await Promise.all(f.map(async t=>await I(t,e)));return w({method:"findMany"},`${d(n)} ${l(3,3)}`,`${c("findMany")} ${u("Parsed Result")}:`,{model:p,data:A}),A},delete:async({model:e,where:t})=>{let r=++i,o=y(e),s=E({model:e,where:t});w({method:"delete"},`${d(r)} ${l(1,2)}`,`${c("delete")}:`,{model:o,where:s}),await _.delete({model:o,where:s}),w({method:"delete"},`${d(r)} ${l(2,2)}`,`${c("delete")} ${u("DB Result")}:`,{model:o})},deleteMany:async({model:e,where:t})=>{let r=++i,o=y(e),s=E({model:e,where:t});w({method:"deleteMany"},`${d(r)} ${l(1,2)}`,`${c("deleteMany")} ${u("DeleteMany")}:`,{model:o,where:s});let n=await _.deleteMany({model:o,where:s});return w({method:"deleteMany"},`${d(r)} ${l(2,2)}`,`${c("deleteMany")} ${u("DB Result")}:`,{model:o,data:n}),n},count:async({model:e,where:t})=>{let r=++i,o=y(e),s=E({model:e,where:t});w({method:"count"},`${d(r)} ${l(1,2)}`,`${c("count")}:`,{model:o,where:s});let n=await _.count({model:o,where:s});return w({method:"count"},`${d(r)} ${l(2,2)}`,`${c("count")}:`,{model:o,data:n}),n},createSchema:_.createSchema?async(e,t)=>{let i=(0,s.g)(h);return h.secondaryStorage&&!h.session?.storeSessionInDatabase&&delete i.session,h.rateLimit&&"database"===h.rateLimit.storage&&(void 0===h.rateLimit.enabled||!0===h.rateLimit.enabled)&&(i.ratelimit={modelName:h.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:h.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:h.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:h.rateLimit.fields?.lastRequest??"lastRequest"}}}),_.createSchema({file:t,tables:i})}:void 0,options:{adapterConfig:m,..._.options??{}},id:m.adapterId,...m.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){t=[]},printDebugLogs(){let e=`\u2500`.repeat(80);console.log(...t.reverse().map(e=>(e[0]=`
${e[0]}`,[...e,"\n"])).reduce((e,t)=>[...t,...e],[`
${e}`]))}}}:{}}};function d(e){return`${p.fg.magenta}#${e}${p.reset}`}function l(e,t){return`${p.bg.black}${p.fg.yellow}[${e}/${t}]${p.reset}`}function c(e){return`${p.bright}${e}${p.reset}`}function u(e){return`${p.dim}(${e})${p.reset}`}}},480954:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({c:()=>t,k:()=>i});var r=e.i(536159),o=e.i(132340),s=e.i(978321),n=e.i(399712),a=e.i(920330),d=e.i(805494);let t=async e=>{let t,i=e.database;if(!i)return{kysely:null,databaseType:null};if("db"in i)return{kysely:i.db,databaseType:i.type};if("dialect"in i)return{kysely:new r.Kysely({dialect:i.dialect}),databaseType:i.type};let d=function e(t){if(!t)return null;if("dialect"in t)return e(t.dialect);if("createDriver"in t){if(t instanceof o.SqliteDialect)return"sqlite";if(t instanceof s.MysqlDialect)return"mysql";if(t instanceof n.PostgresDialect)return"postgres";if(t instanceof a.MssqlDialect)return"mssql"}return"aggregate"in t?"sqlite":"getConnection"in t?"mysql":"connect"in t?"postgres":null}(i);return"createDriver"in i&&(t=i),"aggregate"in i&&(t=new o.SqliteDialect({database:i})),"getConnection"in i&&(t=new s.MysqlDialect(i)),"connect"in i&&(t=new n.PostgresDialect({pool:i})),{kysely:t?new r.Kysely({dialect:t}):null,databaseType:d}},i=(e,t)=>(0,d.c)({config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:t?.usePlural,debugLogs:t?.debugLogs,supportsBooleans:t?.type!=="sqlite"&&t?.type!=="mssql"&&!!t?.type,supportsDates:t?.type!=="sqlite"&&t?.type!=="mssql"&&!!t?.type,supportsJSON:!1},adapter:({getFieldName:i,schema:r})=>{let o=async(r,o,s,n)=>{let a;if(t?.type==="mysql"){await o.execute();let t=r.id?"id":n.length>0&&n[0].field?n[0].field:"id";if(!r.id&&0===n.length)return await e.selectFrom(s).selectAll().orderBy(i({model:s,field:t}),"desc").limit(1).executeTakeFirst();let a=r[t]||n[0].value;return await e.selectFrom(s).selectAll().orderBy(i({model:s,field:t}),"desc").where(i({model:s,field:t}),"=",a).limit(1).executeTakeFirst()}return t?.type==="mssql"?await o.outputAll("inserted").executeTakeFirst():await o.returningAll().executeTakeFirst()};function s(e,o){if(!o)return{and:null,or:null};let s={and:[],or:[]};return o.forEach(o=>{let{field:n,value:a,operator:d="=",connector:l="AND"}=o,c=i({model:e,field:n});a=function(e,i,o){if("id"===o)return e;let{type:s="sqlite"}=t||{},n=r[i]?.fields[o];return(n||(n=Object.values(r).find(e=>e.modelName===i)),"boolean"===n.type&&("sqlite"===s||"mssql"===s)&&null!=e)?+!!e:"date"===n.type&&e&&e instanceof Date&&"sqlite"===s?e.toISOString():e}(a,e,n);let u=e=>"in"===d.toLowerCase()?e(c,"in",Array.isArray(a)?a:[a]):"contains"===d?e(c,"like",`%${a}%`):"starts_with"===d?e(c,"like",`${a}%`):"ends_with"===d?e(c,"like",`%${a}`):e(c,"eq"===d?"=":"ne"===d?"<>":"gt"===d?">":"gte"===d?">=":"lt"===d?"<":"lte"===d?"<=":d,a);"OR"===l?s.or.push(u):s.and.push(u)}),{and:s.and.length?s.and:null,or:s.or.length?s.or:null}}return{async create({data:t,model:i}){let r=e.insertInto(i).values(t);return await o(t,r,i,[])},async findOne({model:t,where:i,select:r}){let{and:o,or:n}=s(t,i),a=e.selectFrom(t).selectAll();o&&(a=a.where(e=>e.and(o.map(t=>t(e))))),n&&(a=a.where(e=>e.or(n.map(t=>t(e)))));let d=await a.executeTakeFirst();return d||null},async findMany({model:r,where:o,limit:n,offset:a,sortBy:d}){let{and:l,or:c}=s(r,o),u=e.selectFrom(r);l&&(u=u.where(e=>e.and(l.map(t=>t(e))))),c&&(u=u.where(e=>e.or(c.map(t=>t(e))))),t?.type==="mssql"?a||(u=u.top(n||100)):u=u.limit(n||100),d&&(u=u.orderBy(i({model:r,field:d.field}),d.direction)),a&&(t?.type==="mssql"?(d||(u=u.orderBy(i({model:r,field:"id"}))),u=u.offset(a).fetch(n||100)):u=u.offset(a));let p=await u.selectAll().execute();return p||[]},async update({model:t,where:i,update:r}){let{and:n,or:a}=s(t,i),d=e.updateTable(t).set(r);return n&&(d=d.where(e=>e.and(n.map(t=>t(e))))),a&&(d=d.where(e=>e.or(a.map(t=>t(e))))),await o(r,d,t,i)},async updateMany({model:t,where:i,update:r}){let{and:o,or:n}=s(t,i),a=e.updateTable(t).set(r);return o&&(a=a.where(e=>e.and(o.map(t=>t(e))))),n&&(a=a.where(e=>e.or(n.map(t=>t(e))))),(await a.execute()).length},async count({model:t,where:i}){let{and:r,or:o}=s(t,i),n=e.selectFrom(t).select(e.fn.count("id").as("count"));return r&&(n=n.where(e=>e.and(r.map(t=>t(e))))),o&&(n=n.where(e=>e.or(o.map(t=>t(e))))),(await n.execute())[0].count},async delete({model:t,where:i}){let{and:r,or:o}=s(t,i),n=e.deleteFrom(t);r&&(n=n.where(e=>e.and(r.map(t=>t(e))))),o&&(n=n.where(e=>e.or(o.map(t=>t(e))))),await n.execute()},async deleteMany({model:t,where:i}){let{and:r,or:o}=s(t,i),n=e.deleteFrom(t);return r&&(n=n.where(e=>e.and(r.map(t=>t(e))))),o&&(n=n.where(e=>e.or(o.map(t=>t(e))))),(await n.execute()).length},options:t}}})}},392187:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({m:()=>t});var r=e.i(805494);let t=(e,t)=>(0,r.c)({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:t?.debugLogs||!1,customTransformInput:t=>t.options.advanced?.database?.useNumberId&&"id"===t.field&&"create"===t.action?e[t.model].length+1:t.data},adapter:({getFieldName:t,options:i})=>{function r(e,t){return t.filter(t=>e.every(e=>{let{field:i,value:r,operator:o}=e;if("in"===o){if(!Array.isArray(r))throw Error("Value must be an array");return r.includes(t[i])}return"contains"===o?t[i].includes(r):"starts_with"===o?t[i].startsWith(r):"ends_with"===o?t[i].endsWith(r):t[i]===r}))}return{create:async({model:t,data:r})=>(i.advanced?.database?.useNumberId&&(r.id=e[t].length+1),e[t].push(r),r),findOne:async({model:t,where:i})=>r(i,e[t])[0]||null,findMany:async({model:i,where:o,sortBy:s,limit:n,offset:a})=>{let d=e[i];return o&&(d=r(o,d)),s&&(d=d.sort((e,r)=>{let o=t({model:i,field:s.field});return"asc"===s.direction?e[o]>r[o]?1:-1:e[o]<r[o]?1:-1})),void 0!==a&&(d=d.slice(a)),void 0!==n&&(d=d.slice(0,n)),d},count:async({model:t})=>e[t].length,update:async({model:t,where:i,update:o})=>{let s=r(i,e[t]);return s.forEach(e=>{Object.assign(e,o)}),s[0]||null},delete:async({model:t,where:i})=>{let o=e[t],s=r(i,o);e[t]=o.filter(e=>!s.includes(e))},deleteMany:async({model:t,where:i})=>{let o=e[t],s=r(i,o),n=0;return e[t]=o.filter(e=>s.includes(e)?(n++,!1):!s.includes(e)),n},updateMany({model:t,where:i,update:o}){let s=r(i,e[t]);return s.forEach(e=>{Object.assign(e,o)}),s[0]||null}}}})}},677172:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({a:()=>m,b:()=>f,c:()=>t,d:()=>A,e:()=>K,f:()=>g,g:()=>h,m:()=>y});var r=e.i(692153),o=e.i(776569),s=e.i(654520),n=e.i(316944),a=e.i(628146);e.i(243917),e.i(311556),e.i(74222),e.i(483013),e.i(533004),e.i(91997),e.i(382320);var d=e.i(187615);e.i(105127),e.i(4887);var l=e.i(955759),c=e.i(771884),u=e.i(480954),p=e.i(392187);function h(e,t){let i=t.hooks;return{createWithHooks:async function(t,r,o,s){let n=t;for(let e of i||[]){let t=e[r]?.create?.before;if(t){let e=await t(n,s);if(!1===e)return null;"object"==typeof e&&"data"in e&&(n={...n,...e.data})}}let a=o?await o.fn(n):null,d=!o||o.executeMainFn?await e.create({model:r,data:n}):a;for(let e of i||[]){let t=e[r]?.create?.after;t&&await t(d,s)}return d},updateWithHooks:async function(t,r,o,s,n){let a=t;for(let e of i||[]){let i=e[o]?.update?.before;if(i){let e=await i(t,n);if(!1===e)return null;a="object"==typeof e?e.data:e}}let d=s?await s.fn(a):null,l=!s||s.executeMainFn?await e.update({model:o,update:a,where:r}):d;for(let e of i||[]){let t=e[o]?.update?.after;t&&await t(l,n)}return l},updateManyWithHooks:async function(t,r,o,s,n){let a=t;for(let e of i||[]){let i=e[o]?.update?.before;if(i){let e=await i(t,n);if(!1===e)return null;a="object"==typeof e?e.data:e}}let d=s?await s.fn(a):null,l=!s||s.executeMainFn?await e.updateMany({model:o,update:a,where:r}):d;for(let e of i||[]){let t=e[o]?.update?.after;t&&await t(l,n)}return l}}}let t=(e,t)=>{let i=t.options,d=i.secondaryStorage,l=i.session?.expiresIn||604800,{createWithHooks:c,updateWithHooks:u,updateManyWithHooks:p}=h(e,t);return{createOAuthUser:async(e,t,i)=>{let r=await c({createdAt:new Date,updatedAt:new Date,...e},"user",void 0,i),o=await c({...t,userId:r.id||e.id,createdAt:new Date,updatedAt:new Date},"account",void 0,i);return{user:r,account:o}},createUser:async(e,t)=>await c({createdAt:new Date,updatedAt:new Date,emailVerified:!1,...e,email:e.email?.toLowerCase()},"user",void 0,t),createAccount:async(e,t)=>await c({createdAt:new Date,updatedAt:new Date,...e},"account",void 0,t),listSessions:async i=>{if(d){let e=await d.get(`active-sessions-${i}`);if(!e)return[];let r=(0,n.s)(e)||[],s=Date.now(),a=r.filter(e=>e.expiresAt>s),l=[];for(let e of a){let i=await d.get(e.token);if(i){let e=JSON.parse(i),r=(0,o.d)(t.options,{...e.session,expiresAt:new Date(e.session.expiresAt)});l.push(r)}}return l}return await e.findMany({model:"session",where:[{field:"userId",value:i}]})},listUsers:async(t,i,r,o)=>await e.findMany({model:"user",limit:t,offset:i,sortBy:r,where:o}),countTotalUsers:async t=>{let i=await e.count({model:"user",where:t});return"string"==typeof i?parseInt(i):i},deleteUser:async t=>{d&&await d.delete(`active-sessions-${t}`),(!d||i.session?.storeSessionInDatabase)&&await e.deleteMany({model:"session",where:[{field:"userId",value:t}]}),await e.deleteMany({model:"account",where:[{field:"userId",value:t}]}),await e.delete({model:"user",where:[{field:"id",value:t}]})},createSession:async(e,t,o,u,p)=>{let h=t.headers||t.request?.headers,{id:m,...f}=u||{},A={ipAddress:(t.request||t.headers)&&(0,s.g)(t.request||t.headers,t.context.options)||"",userAgent:h?.get("user-agent")||"",...f,expiresAt:o?(0,r.g)(86400,"sec"):(0,r.g)(l,"sec"),userId:e,token:(0,a.g)(32),createdAt:new Date,updatedAt:new Date,...p?f:{}};return await c(A,"session",d?{fn:async t=>{let i=await d.get(`active-sessions-${e}`),r=[],o=Date.now();return i&&(r=(r=(0,n.s)(i)||[]).filter(e=>e.expiresAt>o)),r.push({token:A.token,expiresAt:o+1e3*l}),await d.set(`active-sessions-${e}`,JSON.stringify(r),l),t},executeMainFn:i.session?.storeSessionInDatabase}:void 0,t)},findSession:async r=>{if(d){let e=await d.get(r);if(!e&&!i.session?.storeSessionInDatabase)return null;if(e){let i=JSON.parse(e);return{session:(0,o.d)(t.options,{...i.session,expiresAt:new Date(i.session.expiresAt),createdAt:new Date(i.session.createdAt),updatedAt:new Date(i.session.updatedAt)}),user:(0,o.b)(t.options,{...i.user,createdAt:new Date(i.user.createdAt),updatedAt:new Date(i.user.updatedAt)})}}}let s=await e.findOne({model:"session",where:[{value:r,field:"token"}]});if(!s)return null;let n=await e.findOne({model:"user",where:[{value:s.userId,field:"id"}]});return n?{session:(0,o.d)(t.options,s),user:(0,o.b)(t.options,n)}:null},findSessions:async t=>{if(d){let e=[];for(let i of t){let t=await d.get(i);if(t){let i=JSON.parse(t),r={session:{...i.session,expiresAt:new Date(i.session.expiresAt)},user:{...i.user,createdAt:new Date(i.user.createdAt),updatedAt:new Date(i.user.updatedAt)}};e.push(r)}}return e}let i=await e.findMany({model:"session",where:[{field:"token",value:t,operator:"in"}]}),r=i.map(e=>e.userId);if(!r.length)return[];let o=await e.findMany({model:"user",where:[{field:"id",value:r,operator:"in"}]});return i.map(e=>{let t=o.find(t=>t.id===e.userId);return t?{session:e,user:t}:null})},updateSession:async(e,t,r)=>await u(t,[{field:"token",value:e}],"session",d?{async fn(t){let i=await d.get(e),r=null;return i?{...JSON.parse(i).session,...t}:null},executeMainFn:i.session?.storeSessionInDatabase}:void 0,r),deleteSession:async r=>{d&&(await d.delete(r),!i.session?.storeSessionInDatabase||t.options.session?.preserveSessionInDatabase)||await e.delete({model:"session",where:[{field:"token",value:r}]})},deleteAccounts:async t=>{await e.deleteMany({model:"account",where:[{field:"userId",value:t}]})},deleteAccount:async t=>{await e.delete({model:"account",where:[{field:"id",value:t}]})},deleteSessions:async r=>{if(d){if("string"==typeof r){let e=await d.get(`active-sessions-${r}`),t=e?(0,n.s)(e):[];if(!t)return;for(let e of t)await d.delete(e.token)}else for(let e of r)await d.get(e)&&await d.delete(e);if(!i.session?.storeSessionInDatabase||t.options.session?.preserveSessionInDatabase)return}await e.deleteMany({model:"session",where:[{field:Array.isArray(r)?"token":"userId",value:r,operator:Array.isArray(r)?"in":void 0}]})},findOAuthUser:async(t,i,r)=>{let o=await e.findOne({model:"account",where:[{value:i,field:"accountId"},{value:r,field:"providerId"}]});if(o){let t=await e.findOne({model:"user",where:[{value:o.userId,field:"id"}]});return t?{user:t,accounts:[o]}:null}{let i=await e.findOne({model:"user",where:[{value:t.toLowerCase(),field:"email"}]});if(!i)return null;{let t=await e.findMany({model:"account",where:[{value:i.id,field:"userId"}]});return{user:i,accounts:t||[]}}}},findUserByEmail:async(t,i)=>{let r=await e.findOne({model:"user",where:[{value:t.toLowerCase(),field:"email"}]});if(!r)return null;if(i?.includeAccounts){let t=await e.findMany({model:"account",where:[{value:r.id,field:"userId"}]});return{user:r,accounts:t}}return{user:r,accounts:[]}},findUserById:async t=>await e.findOne({model:"user",where:[{field:"id",value:t}]}),linkAccount:async(e,t)=>await c({...e,createdAt:new Date,updatedAt:new Date},"account",void 0,t),updateUser:async(e,t,i)=>await u(t,[{field:"id",value:e}],"user",void 0,i),updateUserByEmail:async(e,t,i)=>await u(t,[{field:"email",value:e.toLowerCase()}],"user",void 0,i),updatePassword:async(e,t,i)=>{await p({password:t},[{field:"userId",value:e},{field:"providerId",value:"credential"}],"account",void 0,i)},findAccounts:async t=>await e.findMany({model:"account",where:[{field:"userId",value:t}]}),findAccount:async t=>await e.findOne({model:"account",where:[{field:"accountId",value:t}]}),findAccountByProviderId:async(t,i)=>await e.findOne({model:"account",where:[{field:"accountId",value:t},{field:"providerId",value:i}]}),findAccountByUserId:async t=>await e.findMany({model:"account",where:[{field:"userId",value:t}]}),updateAccount:async(e,t,i)=>await u(t,[{field:"id",value:e}],"account",void 0,i),createVerificationValue:async(e,t)=>await c({createdAt:new Date,updatedAt:new Date,...e},"verification",void 0,t),findVerificationValue:async t=>{let r=await e.findMany({model:"verification",where:[{field:"identifier",value:t}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return i.verification?.disableCleanup||await e.deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),r[0]},deleteVerificationValue:async t=>{await e.delete({model:"verification",where:[{field:"id",value:t}]})},deleteVerificationByIdentifier:async t=>{await e.delete({model:"verification",where:[{field:"identifier",value:t}]})},updateVerificationValue:async(e,t,i)=>await u(t,[{field:"id",value:e}],"verification",void 0,i)}};async function m(e){if(!e.database){let t=Object.keys((0,l.g)(e)).reduce((e,t)=>(e[t]=[],e),{});return d.l.warn("No database configuration provided. Using memory adapter in development"),(0,p.m)(t)(e)}if("function"==typeof e.database)return e.database(e);let{kysely:t,databaseType:i}=await (0,u.c)(e);if(!t)throw new c.B("Failed to initialize database adapter");return(0,u.k)(t,{type:i||"sqlite"})(e)}function f(e,t){let i=t.id?{id:t.id}:{};for(let r in e){let o=e[r],s=t[r];void 0!==s&&(i[o.fieldName||r]=s)}return i}function A(e,t){if(!t)return null;let i={id:t.id};for(let[r,o]of Object.entries(e))i[r]=t[o.fieldName||r];return i}function g(e){let t=(0,l.g)(e),i={};for(let e in t){let r=t[e],o=r.fields,s={};if(Object.entries(o).forEach(([e,i])=>{if(s[i.fieldName||e]=i,i.references){let r=t[i.references.model];r&&(s[i.fieldName||e].references={model:r.modelName,field:i.references.field})}}),i[r.modelName]){i[r.modelName].fields={...i[r.modelName].fields,...s};continue}i[r.modelName]={fields:s,order:r.order||1/0}}return i}let i={postgres:{string:["character varying","text"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamp","date"]},mysql:{string:["varchar","text"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"]},mssql:{string:["text","varchar"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime","date"]}};function y(e,t,r){if("string[]"===t||"number[]"===t)return e.toLowerCase().includes("json");let o=i[r];return(Array.isArray(t)?o.string.map(e=>e.toLowerCase()):o[t].map(e=>e.toLowerCase())).includes(e.toLowerCase())}async function K(e){let t=g(e),i=(0,d.c)(e.logger),{kysely:r,databaseType:o}=await (0,u.c)(e);o||(i.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),o="sqlite"),r||(i.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let s=await r.introspection.getTables(),n=[],a=[];for(let[e,r]of Object.entries(t)){let t=s.find(t=>t.name===e);if(!t){let t=n.findIndex(t=>t.table===e),i={table:e,fields:r.fields,order:r.order||1/0},o=n.findIndex(e=>(e.order||1/0)>i.order);-1===o?-1===t?n.push(i):n[t].fields={...n[t].fields,...r.fields}:n.splice(o,0,i);continue}let d={};for(let[s,n]of Object.entries(r.fields)){let r=t.columns.find(e=>e.name===s);if(!r){d[s]=n;continue}y(r.dataType,n.type,o)||i.warn(`Field ${s} in table ${e} has a different type in the database. Expected ${n.type} but got ${r.dataType}.`)}Object.keys(d).length>0&&a.push({table:e,fields:d,order:r.order||1/0})}let l=[];function c(t,i){let r=t.type,s={string:{sqlite:"text",postgres:"text",mysql:t.unique?"varchar(255)":t.references?"varchar(36)":"text",mssql:t.unique||t.sortable?"varchar(255)":t.references?"varchar(36)":"text"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:t.bigint?"bigint":"integer",postgres:t.bigint?"bigint":"integer",mysql:t.bigint?"bigint":"integer",mssql:t.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamp",mysql:"datetime",mssql:"datetime"},id:{postgres:e.advanced?.database?.useNumberId?"serial":"text",mysql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:e.advanced?.database?.useNumberId?"integer":"text"}};return"id"===i||t.references?.field==="id"?s.id[o]:"sqlite"===o&&("string[]"===r||"number[]"===r)?"text":"string[]"===r||"number[]"===r?"jsonb":Array.isArray(r)?"text":s[r][o||"sqlite"]}if(a.length)for(let e of a)for(let[t,i]of Object.entries(e.fields)){let o=c(i,t),s=r.schema.alterTable(e.table).addColumn(t,o,e=>(e=!1!==i.required?e.notNull():e,i.references&&(e=e.references(`${i.references.model}.${i.references.field}`)),i.unique&&(e=e.unique()),e));l.push(s)}if(n.length)for(let t of n){let i=r.schema.createTable(t.table).addColumn("id",e.advanced?.database?.useNumberId?"postgres"===o?"serial":"integer":"mysql"===o||"mssql"===o?"varchar(36)":"text",t=>e.advanced?.database?.useNumberId?"postgres"===o?t.primaryKey().notNull():t.autoIncrement().primaryKey().notNull():t.primaryKey().notNull());for(let[e,r]of Object.entries(t.fields)){let t=c(r,e);i=i.addColumn(e,t,e=>(e=!1!==r.required?e.notNull():e,r.references&&(e=e.references(`${r.references.model}.${r.references.field}`)),r.unique&&(e=e.unique()),e))}l.push(i)}return{toBeCreated:n,toBeAdded:a,runMigrations:async function(){for(let e of l)await e.execute()},compileMigrations:async function(){return l.map(e=>e.compile().sql).join(";\n\n")+";"}}}}},55262:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({c:()=>s,v:()=>o});var r=e.i(311556);async function o(e,t){let i=await e.context.internalAdapter.findAccounts(t.userId),r=i?.find(e=>"credential"===e.providerId),o=r?.password;return!!r&&!!o&&await e.context.password.verify({hash:o,password:t.password})}async function s(e,t){let i=await t.context.internalAdapter.findAccounts(e),o=i?.find(e=>"credential"===e.providerId),s=o?.password;if(!o||!s||!t.body.password)throw new r.APIError("BAD_REQUEST",{message:"No password credential found"});if(!await t.context.password.verify({hash:s,password:t.body.password}))throw new r.APIError("BAD_REQUEST",{message:"Invalid password"});return!0}},444537:e=>{"use strict";var{g:t,__dirname:i}=e;function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}e.s({c:()=>r})},838172:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({betterAuth:()=>g}),e.i(277337);var r=e.i(41997),o=e.i(306192),s=e.i(896775),n=e.i(677172),a=e.i(955759);e.i(243917),e.i(776569);var d=e.i(328902),l=e.i(187615),c=e.i(30483),u=e.i(628146);e.i(311556),e.i(74222),e.i(483013),e.i(382320);var p=e.i(105127),h=e.i(55262),m=e.i(664764),f=e.i(771884),A=e.i(151176);e.i(444537),e.i(692218),e.i(654520),e.i(533004),e.i(91997),e.i(692153),e.i(316944),e.i(4887),e.i(480954),e.i(805494),e.i(64041),e.i(392187),e.i(558692),e.i(137942),e.i(561336),e.i(968915),e.i(504506);let t="better-auth-secret-123456789",i=async e=>{var i;let r=await (0,n.a)(e),A=e.plugins||[],g=(i=e,i.advanced?.crossSubDomainCookies?.enabled,[]),y=(0,l.c)(e.logger),K=(0,m.a)(e.baseURL,e.basePath),w=e.secret||p.e.BETTER_AUTH_SECRET||p.e.AUTH_SECRET||t;w===t&&p.a&&y.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config."),e={...e,secret:w,baseURL:K?new URL(K).origin:"",basePath:e.basePath||"/api/auth",plugins:A.concat(g)};let v=(0,d.getCookies)(e),b=(0,a.g)(e),_=Object.keys(e.socialProviders||{}).map(t=>{let i=e.socialProviders?.[t];if(!i||!1===i.enabled)return null;i.clientId||y.warn(`Social provider ${t} is missing clientId or clientSecret`);let r=c.socialProviders[t](i);return r.disableImplicitSignUp=i.disableImplicitSignUp,r}).filter(e=>null!==e),{context:N}=function(e){let t=e.options,i=t.plugins||[],r=e,s=[];for(let n of i)if(n.init){let i=n.init(e);if("object"==typeof i){if(i.options){let{databaseHooks:e,...r}=i.options;e&&s.push(e),t=(0,o.defu)(t,r)}i.context&&(r={...r,...i.context})}}return s.push(t.databaseHooks),r.internalAdapter=(0,n.c)(e.adapter,{options:t,hooks:s.filter(e=>void 0!==e),generateId:e.generateId}),r.options=t,{context:r}}({appName:e.appName||"Better Auth",socialProviders:_,options:e,tables:b,trustedOrigins:function(e){let t=(0,m.a)(e.baseURL,e.basePath);if(!t)return[];let i=[new URL(t).origin];e.trustedOrigins&&Array.isArray(e.trustedOrigins)&&i.push(...e.trustedOrigins);let r=p.e.BETTER_AUTH_TRUSTED_ORIGINS;return r&&i.push(...r.split(",")),i}(e),baseURL:K||"",sessionConfig:{updateAge:e.session?.updateAge!==void 0?e.session.updateAge:86400,expiresIn:e.session?.expiresIn||604800,freshAge:e.session?.freshAge===void 0?86400:e.session.freshAge},secret:w,rateLimit:{...e.rateLimit,enabled:e.rateLimit?.enabled??p.a,window:e.rateLimit?.window||10,max:e.rateLimit?.max||100,storage:e.rateLimit?.storage||(e.secondaryStorage?"secondary-storage":"memory")},authCookies:v,logger:y,generateId:({model:t,size:i})=>"function"==typeof e.advanced?.generateId?e.advanced.generateId({model:t,size:i}):"function"==typeof e?.advanced?.database?.generateId?e.advanced.database.generateId({model:t,size:i}):(0,u.g)(i),session:null,secondaryStorage:e.secondaryStorage,password:{hash:e.emailAndPassword?.password?.hash||s.h,verify:e.emailAndPassword?.password?.verify||s.v,config:{minPasswordLength:e.emailAndPassword?.minPasswordLength||8,maxPasswordLength:e.emailAndPassword?.maxPasswordLength||128},checkPassword:h.c},setNewSession(e){this.newSession=e},newSession:null,adapter:r,internalAdapter:(0,n.c)(r,{options:e,hooks:e.databaseHooks?[e.databaseHooks]:[]}),createAuthCookie:(0,d.createCookieGetter)(e),async runMigrations(){if(!e.database||"updateMany"in e.database)throw new f.B("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:t}=await (0,n.e)(e);await t()}});return N},g=e=>{let t=i(e),{api:o}=(0,r.getEndpoints)(t,e),s=e.plugins?.reduce((e,t)=>t.$ERROR_CODES?{...e,...t.$ERROR_CODES}:e,{});return{handler:async i=>{let o=await t,s=o.options.basePath||"/api/auth";if(!o.options.baseURL){let e=(0,m.a)(void 0,s,i);if(e)o.baseURL=e,o.options.baseURL=(0,m.g)(o.baseURL)||void 0;else throw new f.B("Could not get base URL from request. Please provide a valid base URL.")}o.trustedOrigins=[...e.trustedOrigins?Array.isArray(e.trustedOrigins)?e.trustedOrigins:await e.trustedOrigins(i):[],o.options.baseURL];let{handler:n}=(0,r.router)(o,e);return n(i)},api:o,options:e,$context:t,$Infer:{},$ERROR_CODES:{...s,...A.B}}}}},701454:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(277337),e.i(306192),e.i(896775),e.i(677172),e.i(955759),e.i(243917),e.i(776569),e.i(328902),e.i(187615),e.i(30483),e.i(628146),e.i(311556),e.i(74222),e.i(483013),e.i(382320),e.i(105127),e.i(55262),e.i(664764),e.i(771884),e.i(151176),e.i(444537),e.i(692218),e.i(654520),e.i(533004),e.i(91997),e.i(692153),e.i(316944),e.i(4887),e.i(480954),e.i(805494),e.i(64041),e.i(392187),e.i(558692),e.i(137942),e.i(561336),e.i(968915),e.i(504506),e.i(838172)},91890:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({avg:()=>d,avgDistinct:()=>l,count:()=>n,countDistinct:()=>a,max:()=>p,min:()=>h,sum:()=>c,sumDistinct:()=>u});var r=e.i(588677),o=e.i(684668),s=e.i(367027);function n(e){return s.sql`count(${e||s.sql.raw("*")})`.mapWith(Number)}function a(e){return s.sql`count(distinct ${e})`.mapWith(Number)}function d(e){return s.sql`avg(${e})`.mapWith(String)}function l(e){return s.sql`avg(distinct ${e})`.mapWith(String)}function c(e){return s.sql`sum(${e})`.mapWith(String)}function u(e){return s.sql`sum(distinct ${e})`.mapWith(String)}function p(e){return s.sql`max(${e})`.mapWith((0,o.is)(e,r.Column)?e:String)}function h(e){return s.sql`min(${e})`.mapWith((0,o.is)(e,r.Column)?e:String)}},43007:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({drizzleAdapter:()=>t});var r=e.i(91890),o=e.i(460009),s=e.i(367027),n=e.i(176825),a=e.i(771884),d=e.i(805494);e.i(316944),e.i(64041),e.i(955759),e.i(628146),e.i(4887),e.i(243917),e.i(311556),e.i(74222),e.i(483013),e.i(533004),e.i(91997),e.i(382320),e.i(187615);let t=(e,t)=>(0,d.c)({config:{adapterId:"drizzle",adapterName:"Drizzle Adapter",usePlural:t.usePlural??!1,debugLogs:t.debugLogs??!1},adapter:({getFieldName:i,debugLog:d})=>{function l(i){let r=t.schema||e._.fullSchema;if(!r)throw new a.B("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");let o=r[i];if(!o)throw new a.B(`[# Drizzle Adapter]: The model "${i}" was not found in the schema object. Please pass the schema directly to the adapter options.`);return o}let c=async(i,r,d,c)=>{if("mysql"!==t.provider)return(await r.returning())[0];await r.execute();let p=l(i),h=r.config?.values;if(c?.length){let t=u(c,i);return(await e.select().from(p).where(...t))[0]}if(h&&h[0]?.id?.value){let t=h[0]?.id?.value;return t||(t=(await e.select({id:s.sql`LAST_INSERT_ID()`}).from(p).orderBy((0,o.desc)(p.id)).limit(1))[0].id),(await e.select().from(p).where((0,n.eq)(p.id,t)).limit(1).execute())[0]}if(d.id)return(await e.select().from(p).where((0,n.eq)(p.id,d.id)).limit(1).execute())[0];if(!("id"in p))throw new a.B(`The model "${i}" does not have an "id" field. Please use the "id" field as your primary key.`);return(await e.select().from(p).orderBy((0,o.desc)(p.id)).limit(1).execute())[0]};function u(e,t){let r=l(t);if(!e)return[];if(1===e.length){let o=e[0];if(!o)return[];let s=i({model:t,field:o.field});if(!r[s])throw new a.B(`The field "${o.field}" does not exist in the schema for the model "${t}". Please update your schema.`);if("in"===o.operator){if(!Array.isArray(o.value))throw new a.B(`The value for the field "${o.field}" must be an array when using the "in" operator.`);return[(0,n.inArray)(r[s],o.value)]}return"contains"===o.operator?[(0,n.like)(r[s],`%${o.value}%`)]:"starts_with"===o.operator?[(0,n.like)(r[s],`${o.value}%`)]:"ends_with"===o.operator?[(0,n.like)(r[s],`%${o.value}`)]:"lt"===o.operator?[(0,n.lt)(r[s],o.value)]:"lte"===o.operator?[(0,n.lte)(r[s],o.value)]:"ne"===o.operator?[(0,n.ne)(r[s],o.value)]:"gt"===o.operator?[(0,n.gt)(r[s],o.value)]:"gte"===o.operator?[(0,n.gte)(r[s],o.value)]:[(0,n.eq)(r[s],o.value)]}let o=e.filter(e=>"AND"===e.connector||!e.connector),s=e.filter(e=>"OR"===e.connector),d=(0,n.and)(...o.map(e=>{let o=i({model:t,field:e.field});if("in"===e.operator){if(!Array.isArray(e.value))throw new a.B(`The value for the field "${e.field}" must be an array when using the "in" operator.`);return(0,n.inArray)(r[o],e.value)}return(0,n.eq)(r[o],e.value)})),c=(0,n.or)(...s.map(e=>{let o=i({model:t,field:e.field});return(0,n.eq)(r[o],e.value)})),u=[];return o.length&&u.push(d),s.length&&u.push(c),u}return{async create({model:t,data:i}){let r=l(t);if(!r)throw new a.B("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");for(let e in i)if(!r[e])throw new a.B(`The field "${e}" does not exist in the "${t}" schema. Please update your drizzle schema or re-generate using "npx @better-auth/cli generate".`);let o=e.insert(r).values(i);return await c(t,o,i)},async findOne({model:t,where:i}){let r=l(t),o=u(i,t),s=await e.select().from(r).where(...o);return s.length?s[0]:null},async findMany({model:t,where:r,sortBy:s,limit:n,offset:a}){let d=l(t),c=r?u(r,t):[],p=s?.direction==="desc"?o.desc:o.asc,h=e.select().from(d).limit(n||100).offset(a||0);return s?.field&&h.orderBy(p(d[i({model:t,field:s?.field})])),await h.where(...c)},async count({model:t,where:i}){let o=l(t),s=i?u(i,t):[];return(await e.select({count:(0,r.count)()}).from(o).where(...s))[0].count},async update({model:t,where:i,update:r}){let o=l(t),s=u(i,t),n=e.update(o).set(r).where(...s);return await c(t,n,r,i)},async updateMany({model:t,where:i,update:r}){let o=l(t),s=u(i,t),n=e.update(o).set(r).where(...s);return await n},async delete({model:t,where:i}){let r=l(t),o=u(i,t),s=e.delete(r).where(...o);return await s},async deleteMany({model:t,where:i}){let r=l(t),o=u(i,t),s=e.delete(r).where(...o);return await s},options:t}}})}},217884:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({logger:()=>r.l});var r=e.i(187615)},706567:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({p:()=>r});let t={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},i=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,o={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},s=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function r(e,n={strict:!0}){return function(e,r={}){let{strict:n=!1,warnings:a=!1,reviver:d,parseDates:l=!0}=r;if("string"!=typeof e)return e;let c=e.trim();if('"'===c[0]&&c.endsWith('"')&&!c.slice(1,-1).includes('"'))return c.slice(1,-1);let u=c.toLowerCase();if(u.length<=9&&u in o)return o[u];if(!i.test(c)){if(n)throw SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(t).some(([e,t])=>{let i=t.test(c);return i&&a&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${e} pattern`),i})&&n)throw Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(c,(e,t)=>{if("__proto__"===e||"constructor"===e&&t&&"object"==typeof t&&"prototype"in t){a&&console.warn(`[better-json] Dropping "${e}" key to prevent prototype pollution`);return}if(l&&"string"==typeof t){let e=function(e){let t=s.exec(e);if(!t)return null;let[,i,r,o,n,a,d,l,c,u,p]=t,h=new Date(Date.UTC(parseInt(i,10),parseInt(r,10)-1,parseInt(o,10),parseInt(n,10),parseInt(a,10),parseInt(d,10),l?parseInt(l.padEnd(3,"0"),10):0));if(c){let e=(60*parseInt(u,10)+parseInt(p,10))*("+"===c?-1:1);h.setUTCMinutes(h.getUTCMinutes()+e)}return h instanceof Date&&!isNaN(h.getTime())?h:null}(t);if(e)return e}return d?d(e,t):t})}catch(t){if(n)throw t;return e}}(e,n)}}},152967:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createAccessControl:()=>s,role:()=>o});var r=e.i(771884);function o(e){return{authorize(t,i="AND"){let o=!1;for(let[s,n]of Object.entries(t)){let t=e[s];if(!t)return{success:!1,error:`You are not allowed to access resource: ${s}`};if(Array.isArray(n))o=n.every(e=>t.includes(e));else if("object"==typeof n)o="OR"===n.connector?n.actions.some(e=>t.includes(e)):n.actions.every(e=>t.includes(e));else throw new r.B("Invalid access control request");if(o&&"OR"===i)return{success:o};if(!o&&"AND"===i)return{success:!1,error:`unauthorized to access resource "${s}"`}}return o?{success:o}:{success:!1,error:"Not authorized"}},statements:e}}function s(e){return{newRole:e=>o(e),statements:e}}},861464:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({adminAc:()=>o,defaultAc:()=>i,defaultRoles:()=>a,defaultStatements:()=>t,memberAc:()=>n,ownerAc:()=>s});var r=e.i(152967);e.i(771884);let t={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"]},i=(0,r.createAccessControl)(t),o=i.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"]}),s=i.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"]}),n=i.newRole({organization:[],member:[],invitation:[],team:[]}),a={admin:o,owner:s,member:n}}},345172:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({h:()=>t});var r=e.i(861464);let t=e=>{if(!e.permissions&&!e.permission)return!1;let t=e.role.split(","),i=e.options.roles||r.defaultRoles;for(let r of t){let t=i[r],o=t?.authorize(e.permissions??e.permission);if(o?.success)return!0}return!1}}},793491:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({o:()=>Z,p:()=>h});var r=e.i(311556);e.i(243917);var o=e.i(81714),s=e.i(151176);e.i(105127),e.i(483013),e.i(558692),e.i(776569);var n=e.i(692153),a=e.i(771884),d=e.i(706567);e.i(187615),e.i(306192);var l=e.i(345172),c=e.i(328902),u=e.i(628146);e.i(74222),e.i(533004),e.i(91997),e.i(382320);var p=e.i(861464);let t=(e,t)=>{let i={};for(let[r,o]of Object.entries(e))i[r]=e=>o({...e,context:{...t,...e.context}}),i[r].path=o.path,i[r].method=o.method,i[r].options=o.options,i[r].headers=o.headers;return i},i=(e,t)=>{let i=e.adapter;return{findOrganizationBySlug:async e=>await i.findOne({model:"organization",where:[{field:"slug",value:e}]}),createOrganization:async e=>{let t=await i.create({model:"organization",data:{...e.organization,metadata:e.organization.metadata?JSON.stringify(e.organization.metadata):void 0}});return{...t,metadata:t.metadata?JSON.parse(t.metadata):void 0}},findMemberByEmail:async e=>{let t=await i.findOne({model:"user",where:[{field:"email",value:e.email}]});if(!t)return null;let r=await i.findOne({model:"member",where:[{field:"organizationId",value:e.organizationId},{field:"userId",value:t.id}]});return r?{...r,user:{id:t.id,name:t.name,email:t.email,image:t.image}}:null},listMembers:async e=>await i.findMany({model:"member",where:[{field:"organizationId",value:e.organizationId}],limit:t?.membershipLimit||100}),findMemberByOrgId:async e=>{let[t,r]=await Promise.all([await i.findOne({model:"member",where:[{field:"userId",value:e.userId},{field:"organizationId",value:e.organizationId}]}),await i.findOne({model:"user",where:[{field:"id",value:e.userId}]})]);return r&&t?{...t,user:{id:r.id,name:r.name,email:r.email,image:r.image}}:null},findMemberById:async e=>{let t=await i.findOne({model:"member",where:[{field:"id",value:e}]});if(!t)return null;let r=await i.findOne({model:"user",where:[{field:"id",value:t.userId}]});return r?{...t,user:{id:r.id,name:r.name,email:r.email,image:r.image}}:null},createMember:async e=>await i.create({model:"member",data:{...e,createdAt:new Date}}),updateMember:async(e,t)=>await i.update({model:"member",where:[{field:"id",value:e}],update:{role:t}}),deleteMember:async e=>await i.delete({model:"member",where:[{field:"id",value:e}]}),updateOrganization:async(e,t)=>{let r=await i.update({model:"organization",where:[{field:"id",value:e}],update:{...t,metadata:"object"==typeof t.metadata?JSON.stringify(t.metadata):t.metadata}});return r?{...r,metadata:r.metadata?(0,d.p)(r.metadata):void 0}:null},deleteOrganization:async e=>(await i.delete({model:"member",where:[{field:"organizationId",value:e}]}),await i.delete({model:"invitation",where:[{field:"organizationId",value:e}]}),await i.delete({model:"organization",where:[{field:"id",value:e}]}),e),setActiveOrganization:async(t,i)=>await e.internalAdapter.updateSession(t,{activeOrganizationId:i}),findOrganizationById:async e=>await i.findOne({model:"organization",where:[{field:"id",value:e}]}),findFullOrganization:async({organizationId:e,isSlug:r,includeTeams:o})=>{let s=await i.findOne({model:"organization",where:[{field:r?"slug":"id",value:e}]});if(!s)return null;let[n,d,l]=await Promise.all([i.findMany({model:"invitation",where:[{field:"organizationId",value:s.id}]}),i.findMany({model:"member",where:[{field:"organizationId",value:s.id}],limit:t?.membershipLimit||100}),o?i.findMany({model:"team",where:[{field:"organizationId",value:s.id}]}):null]);if(!s)return null;let c=d.map(e=>e.userId),u=new Map((await i.findMany({model:"user",where:[{field:"id",value:c,operator:"in"}],limit:t?.membershipLimit||100})).map(e=>[e.id,e])),p=d.map(e=>{let t=u.get(e.userId);if(!t)throw new a.B("Unexpected error: User not found for member");return{...e,user:{id:t.id,name:t.name,email:t.email,image:t.image}}});return{...s,invitations:n,members:p,teams:l}},listOrganizations:async e=>{let t=await i.findMany({model:"member",where:[{field:"userId",value:e}]});if(!t||0===t.length)return[];let r=t.map(e=>e.organizationId);return await i.findMany({model:"organization",where:[{field:"id",value:r,operator:"in"}]})},createTeam:async e=>await i.create({model:"team",data:e}),findTeamById:async({teamId:e,organizationId:r,includeTeamMembers:o})=>{let s=await i.findOne({model:"team",where:[{field:"id",value:e},...r?[{field:"organizationId",value:r}]:[]]});if(!s)return null;let n=[];return o?(n=await i.findMany({model:"member",where:[{field:"teamId",value:e}],limit:t?.membershipLimit||100}),{...s,members:n}):s},updateTeam:async(e,t)=>await i.update({model:"team",where:[{field:"id",value:e}],update:{...t}}),deleteTeam:async e=>await i.delete({model:"team",where:[{field:"id",value:e}]}),listTeams:async e=>await i.findMany({model:"team",where:[{field:"organizationId",value:e}]}),createTeamInvitation:async({email:e,role:t,teamId:r,organizationId:o,inviterId:s,expiresIn:a=1728e5})=>{let d=(0,n.g)(a);return await i.create({model:"invitation",data:{email:e,role:t,organizationId:o,teamId:r,inviterId:s,status:"pending",expiresAt:d}})},findInvitationsByTeamId:async e=>await i.findMany({model:"invitation",where:[{field:"teamId",value:e}]}),createInvitation:async({invitation:e,user:r})=>{let o=(0,n.g)(t?.invitationExpiresIn||172800,"sec");return await i.create({model:"invitation",data:{status:"pending",expiresAt:o,inviterId:r.id,...e}})},findInvitationById:async e=>await i.findOne({model:"invitation",where:[{field:"id",value:e}]}),findPendingInvitation:async e=>(await i.findMany({model:"invitation",where:[{field:"email",value:e.email},{field:"organizationId",value:e.organizationId},{field:"status",value:"pending"}]})).filter(e=>new Date(e.expiresAt)>new Date),findPendingInvitations:async e=>(await i.findMany({model:"invitation",where:[{field:"organizationId",value:e.organizationId},{field:"status",value:"pending"}]})).filter(e=>new Date(e.expiresAt)>new Date),listInvitations:async e=>await i.findMany({model:"invitation",where:[{field:"organizationId",value:e.organizationId}]}),updateInvitation:async e=>await i.update({model:"invitation",where:[{field:"id",value:e.invitationId}],update:{status:e.status}})}},m=(0,s.c)(async e=>({})),f=(0,s.c)({use:[s.s]},async e=>({session:e.context.session})),A={YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION:"You are not allowed to create a new organization",YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS:"You have reached the maximum number of organizations",ORGANIZATION_ALREADY_EXISTS:"Organization already exists",ORGANIZATION_NOT_FOUND:"Organization not found",USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION:"User is not a member of the organization",YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION:"You are not allowed to update this organization",YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION:"You are not allowed to delete this organization",NO_ACTIVE_ORGANIZATION:"No active organization",USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION:"User is already a member of this organization",MEMBER_NOT_FOUND:"Member not found",ROLE_NOT_FOUND:"Role not found",YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM:"You are not allowed to create a new team",TEAM_ALREADY_EXISTS:"Team already exists",TEAM_NOT_FOUND:"Team not found",YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER:"You cannot leave the organization as the only owner",YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER:"You are not allowed to delete this member",YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION:"You are not allowed to invite users to this organization",USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION:"User is already invited to this organization",INVITATION_NOT_FOUND:"Invitation not found",YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION:"You are not the recipient of the invitation",YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION:"You are not allowed to cancel this invitation",INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION:"Inviter is no longer a member of the organization",YOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE:"you are not allowed to invite user with this role",FAILED_TO_RETRIEVE_INVITATION:"Failed to retrieve invitation",YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS:"You have reached the maximum number of teams",UNABLE_TO_REMOVE_LAST_TEAM:"Unable to remove last team",YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER:"You are not allowed to update this member",ORGANIZATION_MEMBERSHIP_LIMIT_REACHED:"Organization membership limit reached",YOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION:"You are not allowed to create teams in this organization",YOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION:"You are not allowed to delete teams in this organization",YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM:"You are not allowed to update this team",YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM:"You are not allowed to delete this team",INVITATION_LIMIT_REACHED:"Invitation limit reached"},g=e=>(0,s.a)("/organization/invite-member",{method:"POST",use:[m,f],body:o.z.object({email:o.z.string({description:"The email address of the user to invite"}),role:o.z.union([o.z.string({description:"The role to assign to the user"}),o.z.array(o.z.string({description:"The roles to assign to the user"}))]),organizationId:o.z.string({description:"The organization ID to invite the user to"}).optional(),resend:o.z.boolean({description:"Resend the invitation email, if the user is already invited"}).optional(),teamId:o.z.string({description:"The team ID to invite the user to"}).optional()}),metadata:{$Infer:{body:{}},openapi:{description:"Invite a user to an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string"},email:{type:"string"},role:{type:"string"},organizationId:{type:"string"},inviterId:{type:"string"},status:{type:"string"},expiresAt:{type:"string"}},required:["id","email","role","organizationId","inviterId","status","expiresAt"]}}}}}}}},async e=>{let t=e.context.session,o=e.body.organizationId||t.session.activeOrganizationId;if(!o)throw new r.APIError("BAD_REQUEST",{message:A.ORGANIZATION_NOT_FOUND});let s=i(e.context,e.context.orgOptions),n=await s.findMemberByOrgId({userId:t.user.id,organizationId:o});if(!n)throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});if(!(0,l.h)({role:n.role,options:e.context.orgOptions,permissions:{invitation:["create"]}}))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION});let a=e.context.orgOptions.creatorRole||"owner",d=h(e.body.role);if(n.role!==a&&d.split(",").includes(a))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE});if(await s.findMemberByEmail({email:e.body.email,organizationId:o}))throw new r.APIError("BAD_REQUEST",{message:A.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION});let c=await s.findPendingInvitation({email:e.body.email,organizationId:o});if(c.length&&!e.body.resend)throw new r.APIError("BAD_REQUEST",{message:A.USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION});c.length&&e.context.orgOptions.cancelPendingInvitationsOnReInvite&&await s.updateInvitation({invitationId:c[0].id,status:"canceled"});let u=await s.findOrganizationById(o);if(!u)throw new r.APIError("BAD_REQUEST",{message:A.ORGANIZATION_NOT_FOUND});let p="function"==typeof e.context.orgOptions.invitationLimit?await e.context.orgOptions.invitationLimit({user:t.user,organization:u,member:n},e.context):e.context.orgOptions.invitationLimit??100;if((await s.findPendingInvitations({organizationId:o})).length>=p)throw new r.APIError("FORBIDDEN",{message:A.INVITATION_LIMIT_REACHED});let m=await s.createInvitation({invitation:{role:d,email:e.body.email.toLowerCase(),organizationId:o,..."teamId"in e.body?{teamId:e.body.teamId}:{}},user:t.user});return await e.context.orgOptions.sendInvitationEmail?.({id:m.id,role:m.role,email:m.email.toLowerCase(),organization:u,inviter:{...n,user:t.user},invitation:m},e.request),e.json(m)}),y=(0,s.a)("/organization/accept-invitation",{method:"POST",body:o.z.object({invitationId:o.z.string({description:"The ID of the invitation to accept"})}),use:[m,f],metadata:{openapi:{description:"Accept an invitation to an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{invitation:{type:"object"},member:{type:"object"}}}}}}}}}},async e=>{let t=e.context.session,o=i(e.context,e.context.orgOptions),s=await o.findInvitationById(e.body.invitationId);if(!s||s.expiresAt<new Date||"pending"!==s.status)throw new r.APIError("BAD_REQUEST",{message:A.INVITATION_NOT_FOUND});if(s.email.toLowerCase()!==t.user.email.toLowerCase())throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION});let n=e.context.orgOptions?.membershipLimit||100;if((await o.listMembers({organizationId:s.organizationId})).length>=n)throw new r.APIError("FORBIDDEN",{message:A.ORGANIZATION_MEMBERSHIP_LIMIT_REACHED});let a=await o.updateInvitation({invitationId:e.body.invitationId,status:"accepted"});if(!a)throw new r.APIError("BAD_REQUEST",{message:A.FAILED_TO_RETRIEVE_INVITATION});let d=await o.createMember({organizationId:s.organizationId,userId:t.user.id,role:s.role,createdAt:new Date,..."teamId"in a?{teamId:a.teamId}:{}});return(await o.setActiveOrganization(t.session.token,s.organizationId),a)?e.json({invitation:a,member:d}):e.json(null,{status:400,body:{message:A.INVITATION_NOT_FOUND}})}),K=(0,s.a)("/organization/reject-invitation",{method:"POST",body:o.z.object({invitationId:o.z.string({description:"The ID of the invitation to reject"})}),use:[m,f],metadata:{openapi:{description:"Reject an invitation to an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{invitation:{type:"object"},member:{type:"null"}}}}}}}}}},async e=>{let t=e.context.session,o=i(e.context,e.context.orgOptions),s=await o.findInvitationById(e.body.invitationId);if(!s||s.expiresAt<new Date||"pending"!==s.status)throw new r.APIError("BAD_REQUEST",{message:"Invitation not found!"});if(s.email.toLowerCase()!==t.user.email.toLowerCase())throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION});let n=await o.updateInvitation({invitationId:e.body.invitationId,status:"rejected"});return e.json({invitation:n,member:null})}),w=(0,s.a)("/organization/cancel-invitation",{method:"POST",body:o.z.object({invitationId:o.z.string({description:"The ID of the invitation to cancel"})}),use:[m,f],openapi:{description:"Cancel an invitation to an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{invitation:{type:"object"}}}}}}}}},async e=>{let t=e.context.session,o=i(e.context,e.context.orgOptions),s=await o.findInvitationById(e.body.invitationId);if(!s)throw new r.APIError("BAD_REQUEST",{message:A.INVITATION_NOT_FOUND});let n=await o.findMemberByOrgId({userId:t.user.id,organizationId:s.organizationId});if(!n)throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});if(!(0,l.h)({role:n.role,options:e.context.orgOptions,permissions:{invitation:["cancel"]}}))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION});let a=await o.updateInvitation({invitationId:e.body.invitationId,status:"canceled"});return e.json(a)}),v=(0,s.a)("/organization/get-invitation",{method:"GET",use:[m],requireHeaders:!0,query:o.z.object({id:o.z.string({description:"The ID of the invitation to get"})}),metadata:{openapi:{description:"Get an invitation by ID",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string"},email:{type:"string"},role:{type:"string"},organizationId:{type:"string"},inviterId:{type:"string"},status:{type:"string"},expiresAt:{type:"string"},organizationName:{type:"string"},organizationSlug:{type:"string"},inviterEmail:{type:"string"}},required:["id","email","role","organizationId","inviterId","status","expiresAt","organizationName","organizationSlug","inviterEmail"]}}}}}}}},async e=>{let t=await (0,s.g)(e);if(!t)throw new r.APIError("UNAUTHORIZED",{message:"Not authenticated"});let o=i(e.context,e.context.orgOptions),n=await o.findInvitationById(e.query.id);if(!n||"pending"!==n.status||n.expiresAt<new Date)throw new r.APIError("BAD_REQUEST",{message:"Invitation not found!"});if(n.email.toLowerCase()!==t.user.email.toLowerCase())throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION});let a=await o.findOrganizationById(n.organizationId);if(!a)throw new r.APIError("BAD_REQUEST",{message:A.ORGANIZATION_NOT_FOUND});let d=await o.findMemberByOrgId({userId:n.inviterId,organizationId:n.organizationId});if(!d)throw new r.APIError("BAD_REQUEST",{message:A.INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION});return e.json({...n,organizationName:a.name,organizationSlug:a.slug,inviterEmail:d.user.email})}),b=(0,s.a)("/organization/list-invitations",{method:"GET",use:[m,f],query:o.z.object({organizationId:o.z.string({description:"The ID of the organization to list invitations for"}).optional()}).optional()},async e=>{let t=await (0,s.g)(e);if(!t)throw new r.APIError("UNAUTHORIZED",{message:"Not authenticated"});let o=e.query?.organizationId||t.session.activeOrganizationId;if(!o)throw new r.APIError("BAD_REQUEST",{message:"Organization ID is required"});let n=i(e.context,e.context.orgOptions);if(!await n.findMemberByOrgId({userId:t.user.id,organizationId:o}))throw new r.APIError("FORBIDDEN",{message:"You are not a member of this organization"});let a=await n.listInvitations({organizationId:o});return e.json(a)}),_=()=>(0,s.a)("/organization/add-member",{method:"POST",body:o.z.object({userId:o.z.coerce.string(),role:o.z.union([o.z.string(),o.z.array(o.z.string())]),organizationId:o.z.string().optional()}),use:[m],metadata:{SERVER_ONLY:!0,$Infer:{body:{}}}},async e=>{let t=e.body.userId?await (0,s.g)(e).catch(e=>null):null,o=e.body.organizationId||t?.session.activeOrganizationId;if(!o)return e.json(null,{status:400,body:{message:A.NO_ACTIVE_ORGANIZATION}});let n="teamId"in e.body?e.body.teamId:void 0;if(n&&!e.context.orgOptions.teams?.enabled)throw e.context.logger.error("Teams are not enabled"),new r.APIError("BAD_REQUEST",{message:"Teams are not enabled"});let a=i(e.context,e.context.orgOptions),d=await e.context.internalAdapter.findUserById(e.body.userId);if(!d)throw new r.APIError("BAD_REQUEST",{message:s.B.USER_NOT_FOUND});if(await a.findMemberByEmail({email:d.email,organizationId:o}))throw new r.APIError("BAD_REQUEST",{message:A.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION});if(n){let e=await a.findTeamById({teamId:n,organizationId:o});if(!e||e.organizationId!==o)throw new r.APIError("BAD_REQUEST",{message:A.TEAM_NOT_FOUND})}let l=e.context.orgOptions?.membershipLimit||100;if((await a.listMembers({organizationId:o})).length>=l)throw new r.APIError("FORBIDDEN",{message:A.ORGANIZATION_MEMBERSHIP_LIMIT_REACHED});let c=await a.createMember({organizationId:o,userId:d.id,role:h(e.body.role),createdAt:new Date,...n?{teamId:n}:{}});return e.json(c)}),N=(0,s.a)("/organization/remove-member",{method:"POST",body:o.z.object({memberIdOrEmail:o.z.string({description:"The ID or email of the member to remove"}),organizationId:o.z.string({description:"The ID of the organization to remove the member from. If not provided, the active organization will be used"}).optional()}),use:[m,f],metadata:{openapi:{description:"Remove a member from an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{member:{type:"object",properties:{id:{type:"string"},userId:{type:"string"},organizationId:{type:"string"},role:{type:"string"}},required:["id","userId","organizationId","role"]}},required:["member"]}}}}}}}},async e=>{let t=e.context.session,o=e.body.organizationId||t.session.activeOrganizationId;if(!o)return e.json(null,{status:400,body:{message:A.NO_ACTIVE_ORGANIZATION}});let s=i(e.context,e.context.orgOptions),n=await s.findMemberByOrgId({userId:t.user.id,organizationId:o});if(!n)throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});let a=null;if(!(a=e.body.memberIdOrEmail.includes("@")?await s.findMemberByEmail({email:e.body.memberIdOrEmail,organizationId:o}):await s.findMemberById(e.body.memberIdOrEmail)))throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});let d=a.role.split(","),c=e.context.orgOptions?.creatorRole||"owner";if(d.includes(c)&&(n.role!==c||(await s.listMembers({organizationId:o})).filter(e=>e.role.split(",").includes(c)).length<=1))throw new r.APIError("BAD_REQUEST",{message:A.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER});if(!(0,l.h)({role:n.role,options:e.context.orgOptions,permissions:{member:["delete"]}}))throw new r.APIError("UNAUTHORIZED",{message:A.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER});if(a?.organizationId!==o)throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});return await s.deleteMember(a.id),t.user.id===a.userId&&t.session.activeOrganizationId===a.organizationId&&await s.setActiveOrganization(t.session.token,null),e.json({member:a})}),I=e=>(0,s.a)("/organization/update-member-role",{method:"POST",body:o.z.object({role:o.z.union([o.z.string(),o.z.array(o.z.string())]),memberId:o.z.string(),organizationId:o.z.string().optional()}),use:[m,f],metadata:{$Infer:{body:{}},openapi:{description:"Update the role of a member in an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{member:{type:"object",properties:{id:{type:"string"},userId:{type:"string"},organizationId:{type:"string"},role:{type:"string"}},required:["id","userId","organizationId","role"]}},required:["member"]}}}}}}}},async e=>{let t=e.context.session;if(!e.body.role)throw new r.APIError("BAD_REQUEST");let o=e.body.organizationId||t.session.activeOrganizationId;if(!o)throw new r.APIError("BAD_REQUEST",{message:A.NO_ACTIVE_ORGANIZATION});let s=i(e.context,e.context.orgOptions),n=Array.isArray(e.body.role)?e.body.role:e.body.role?[e.body.role]:[],a=await s.findMemberByOrgId({userId:t.user.id,organizationId:o});if(!a)throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});let d=a.id!==e.body.memberId?await s.findMemberById(e.body.memberId):a;if(!d)throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});let c=d.role.split(","),u=a.role.split(","),p=e.context.orgOptions?.creatorRole||"owner";if(c.includes(p)&&!u.includes(p)||n.includes(p)&&!u.includes(p)||!(0,l.h)({role:a.role,options:e.context.orgOptions,permissions:{member:["update"]}}))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER});let m=await s.updateMember(e.body.memberId,h(e.body.role));if(!m)throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});return e.json(m)}),E=(0,s.a)("/organization/get-active-member",{method:"GET",use:[m,f],metadata:{openapi:{description:"Get the active member in the organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string"},userId:{type:"string"},organizationId:{type:"string"},role:{type:"string"}},required:["id","userId","organizationId","role"]}}}}}}}},async e=>{let t=e.context.session,r=t.session.activeOrganizationId;if(!r)return e.json(null,{status:400,body:{message:A.NO_ACTIVE_ORGANIZATION}});let o=i(e.context,e.context.orgOptions),s=await o.findMemberByOrgId({userId:t.user.id,organizationId:r});return s?e.json(s):e.json(null,{status:400,body:{message:A.MEMBER_NOT_FOUND}})}),T=(0,s.a)("/organization/leave",{method:"POST",body:o.z.object({organizationId:o.z.string()}),use:[s.s,m]},async e=>{let t=e.context.session,o=i(e.context),s=await o.findMemberByOrgId({userId:t.user.id,organizationId:e.body.organizationId});if(!s)throw new r.APIError("BAD_REQUEST",{message:A.MEMBER_NOT_FOUND});if(s.role===(e.context.orgOptions?.creatorRole||"owner")&&(await e.context.adapter.findMany({model:"member",where:[{field:"organizationId",value:e.body.organizationId}]})).filter(t=>t.role===(e.context.orgOptions?.creatorRole||"owner")).length<=1)throw new r.APIError("BAD_REQUEST",{message:A.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER});return await o.deleteMember(s.id),t.session.activeOrganizationId===e.body.organizationId&&await o.setActiveOrganization(t.session.token,null),e.json(s)}),C=(0,s.a)("/organization/create",{method:"POST",body:o.z.object({name:o.z.string({description:"The name of the organization"}),slug:o.z.string({description:"The slug of the organization"}),userId:o.z.coerce.string({description:"The user id of the organization creator. If not provided, the current user will be used. Should only be used by admins or when called by the server."}).optional(),logo:o.z.string({description:"The logo of the organization"}).optional(),metadata:o.z.record(o.z.string(),o.z.any(),{description:"The metadata of the organization"}).optional(),keepCurrentActiveOrganization:o.z.boolean({description:"Whether to keep the current active organization active after creating a new one"}).optional()}),use:[m],metadata:{openapi:{description:"Create an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",description:"The organization that was created",$ref:"#/components/schemas/Organization"}}}}}}}},async e=>{let t,o,n=await (0,s.g)(e);if(!n&&(e.request||e.headers))throw new r.APIError("UNAUTHORIZED");let a=n?.user||null;if(!a){if(!e.body.userId)throw new r.APIError("UNAUTHORIZED");a=await e.context.internalAdapter.findUserById(e.body.userId)}if(!a)return e.json(null,{status:401});let d=e.context.orgOptions;if(!("function"==typeof d?.allowUserToCreateOrganization?await d.allowUserToCreateOrganization(a):d?.allowUserToCreateOrganization===void 0||d.allowUserToCreateOrganization))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION});let l=i(e.context,d),c=await l.listOrganizations(a.id);if("number"==typeof d.organizationLimit?c.length>=d.organizationLimit:"function"==typeof d.organizationLimit&&await d.organizationLimit(a))throw new r.APIError("FORBIDDEN",{message:A.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS});if(await l.findOrganizationBySlug(e.body.slug))throw new r.APIError("BAD_REQUEST",{message:A.ORGANIZATION_ALREADY_EXISTS});if(d.organizationCreation?.beforeCreate){let t=await d.organizationCreation.beforeCreate({organization:{slug:e.body.slug,name:e.body.name,logo:e.body.logo,createdAt:new Date,metadata:e.body.metadata},user:a},e.request);t&&"object"==typeof t&&"data"in t&&(o=t)}let u=await l.createOrganization({organization:{slug:e.body.slug,name:e.body.name,logo:e.body.logo,createdAt:new Date,metadata:e.body.metadata,...o?.data||{}}});if(d?.teams?.enabled&&d.teams.defaultTeam?.enabled!==!1){let i=await d.teams.defaultTeam?.customCreateDefaultTeam?.(u,e.request)||await l.createTeam({organizationId:u.id,name:`${u.name}`,createdAt:new Date});t=await l.createMember({teamId:i.id,userId:a.id,organizationId:u.id,role:e.context.orgOptions.creatorRole||"owner"})}else t=await l.createMember({userId:a.id,organizationId:u.id,role:e.context.orgOptions.creatorRole||"owner"});return d.organizationCreation?.afterCreate&&await d.organizationCreation.afterCreate({organization:u,user:a,member:t},e.request),e.context.session&&!e.body.keepCurrentActiveOrganization&&await l.setActiveOrganization(e.context.session.session.token,u.id),e.json({...u,metadata:e.body.metadata,members:[t]})}),x=(0,s.a)("/organization/check-slug",{method:"POST",body:o.z.object({slug:o.z.string()}),use:[s.O,m]},async e=>{let t=i(e.context);if(!await t.findOrganizationBySlug(e.body.slug))return e.json({status:!0});throw new r.APIError("BAD_REQUEST",{message:"slug is taken"})}),O=(0,s.a)("/organization/update",{method:"POST",body:o.z.object({data:o.z.object({name:o.z.string({description:"The name of the organization"}).optional(),slug:o.z.string({description:"The slug of the organization"}).optional(),logo:o.z.string({description:"The logo of the organization"}).optional(),metadata:o.z.record(o.z.string(),o.z.any(),{description:"The metadata of the organization"}).optional()}).partial(),organizationId:o.z.string().optional()}),requireHeaders:!0,use:[m],metadata:{openapi:{description:"Update an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",description:"The updated organization",$ref:"#/components/schemas/Organization"}}}}}}}},async e=>{let t=await e.context.getSession(e);if(!t)throw new r.APIError("UNAUTHORIZED",{message:"User not found"});let o=e.body.organizationId||t.session.activeOrganizationId;if(!o)throw new r.APIError("BAD_REQUEST",{message:A.ORGANIZATION_NOT_FOUND});let s=i(e.context,e.context.orgOptions),n=await s.findMemberByOrgId({userId:t.user.id,organizationId:o});if(!n)throw new r.APIError("BAD_REQUEST",{message:A.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION});if(!(0,l.h)({permissions:{organization:["update"]},role:n.role,options:e.context.orgOptions}))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION});let a=await s.updateOrganization(o,e.body.data);return e.json(a)}),S=(0,s.a)("/organization/delete",{method:"POST",body:o.z.object({organizationId:o.z.string({description:"The organization id to delete"})}),requireHeaders:!0,use:[m],metadata:{openapi:{description:"Delete an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"string",description:"The organization id that was deleted"}}}}}}}},async e=>{let t=await e.context.getSession(e);if(!t)return e.json(null,{status:401});let o=e.body.organizationId;if(!o)return e.json(null,{status:400,body:{message:A.ORGANIZATION_NOT_FOUND}});let s=i(e.context,e.context.orgOptions),n=await s.findMemberByOrgId({userId:t.user.id,organizationId:o});if(!n)return e.json(null,{status:400,body:{message:A.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION}});if(!(0,l.h)({role:n.role,permissions:{organization:["delete"]},options:e.context.orgOptions}))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION});o===t.session.activeOrganizationId&&await s.setActiveOrganization(t.session.token,null);let a=e.context.orgOptions.organizationDeletion;if(a?.disabled)throw new r.APIError("FORBIDDEN");let d=await s.findOrganizationById(o);if(!d)throw new r.APIError("BAD_REQUEST");return a?.beforeDelete&&await a.beforeDelete({organization:d,user:t.user}),await s.deleteOrganization(o),a?.afterDelete&&await a.afterDelete({organization:d,user:t.user}),e.json(d)}),k=()=>(0,s.a)("/organization/get-full-organization",{method:"GET",query:o.z.optional(o.z.object({organizationId:o.z.string({description:"The organization id to get"}).optional(),organizationSlug:o.z.string({description:"The organization slug to get"}).optional()})),requireHeaders:!0,use:[m,f],metadata:{openapi:{description:"Get the full organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",description:"The organization",$ref:"#/components/schemas/Organization"}}}}}}}},async e=>{let t=e.context.session,o=e.query?.organizationSlug||e.query?.organizationId||t.session.activeOrganizationId;if(!o)return e.json(null,{status:200});let s=i(e.context,e.context.orgOptions),n=await s.findFullOrganization({organizationId:o,isSlug:!!e.query?.organizationSlug,includeTeams:e.context.orgOptions.teams?.enabled});if(!n?.members.find(e=>e.userId===t.user.id))throw new r.APIError("FORBIDDEN",{message:A.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION});if(!n)throw new r.APIError("BAD_REQUEST",{message:A.ORGANIZATION_NOT_FOUND});return e.json(n)}),R=()=>(0,s.a)("/organization/set-active",{method:"POST",body:o.z.object({organizationId:o.z.string({description:"The organization id to set as active. It can be null to unset the active organization"}).nullable().optional(),organizationSlug:o.z.string({description:"The organization slug to set as active. It can be null to unset the active organization if organizationId is not provided"}).optional()}),use:[f,m],metadata:{openapi:{description:"Set the active organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",description:"The organization",$ref:"#/components/schemas/Organization"}}}}}}}},async e=>{let t=i(e.context,e.context.orgOptions),o=e.context.session,s=e.body.organizationSlug||e.body.organizationId;if(null===s){if(!o.session.activeOrganizationId)return e.json(null);let i=await t.setActiveOrganization(o.session.token,null);return await (0,c.setSessionCookie)(e,{session:i,user:o.user}),e.json(null)}if(!s){let t=o.session.activeOrganizationId;if(!t)return e.json(null);s=t}let n=await t.findFullOrganization({organizationId:s,isSlug:!!e.body.organizationSlug});if(!n?.members.find(e=>e.userId===o.user.id))throw await t.setActiveOrganization(o.session.token,null),new r.APIError("FORBIDDEN",{message:A.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION});if(!n)throw new r.APIError("BAD_REQUEST",{message:A.ORGANIZATION_NOT_FOUND});let a=await t.setActiveOrganization(o.session.token,n.id);return await (0,c.setSessionCookie)(e,{session:a,user:o.user}),e.json(n)}),P=(0,s.a)("/organization/list",{method:"GET",use:[m,f],metadata:{openapi:{description:"List all organizations",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Organization"}}}}}}}}},async e=>{let t=i(e.context,e.context.orgOptions),r=await t.listOrganizations(e.context.session.user.id);return e.json(r)}),U=o.z.string(),D=o.z.enum(["pending","accepted","rejected","canceled"]).default("pending");o.z.object({id:o.z.string().default(u.g),name:o.z.string(),slug:o.z.string(),logo:o.z.string().nullish().optional(),metadata:o.z.record(o.z.string()).or(o.z.string().transform(e=>JSON.parse(e))).optional(),createdAt:o.z.date()}),o.z.object({id:o.z.string().default(u.g),organizationId:o.z.string(),userId:o.z.coerce.string(),role:U,createdAt:o.z.date().default(()=>new Date),teamId:o.z.string().optional()}),o.z.object({id:o.z.string().default(u.g),organizationId:o.z.string(),email:o.z.string(),role:U,status:D,teamId:o.z.string().optional(),inviterId:o.z.string(),expiresAt:o.z.date()});let L=o.z.object({id:o.z.string().default(u.g),name:o.z.string().min(1),organizationId:o.z.string(),createdAt:o.z.date(),updatedAt:o.z.date().optional()}),z=e=>(0,s.a)("/organization/create-team",{method:"POST",body:o.z.object({organizationId:o.z.string().optional(),name:o.z.string()}),use:[m],metadata:{openapi:{description:"Create a new team within an organization",responses:{200:{description:"Team created successfully",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string",description:"Unique identifier of the created team"},name:{type:"string",description:"Name of the team"},organizationId:{type:"string",description:"ID of the organization the team belongs to"},createdAt:{type:"string",format:"date-time",description:"Timestamp when the team was created"},updatedAt:{type:"string",format:"date-time",description:"Timestamp when the team was last updated"}},required:["id","name","organizationId","createdAt","updatedAt"]}}}}}}}},async e=>{let t=await (0,s.g)(e),o=e.body.organizationId||t?.session.activeOrganizationId;if(!t&&(e.request||e.headers))throw new r.APIError("UNAUTHORIZED");if(!o)throw new r.APIError("BAD_REQUEST",{message:A.NO_ACTIVE_ORGANIZATION});let n=i(e.context,e.context.orgOptions);if(t){let i=await n.findMemberByOrgId({userId:t.user.id,organizationId:o});if(!i)throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION});if(!(0,l.h)({role:i.role,options:e.context.orgOptions,permissions:{team:["create"]}}))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION})}let a=await n.listTeams(o),d="function"==typeof e.context.orgOptions.teams?.maximumTeams?await e.context.orgOptions.teams?.maximumTeams({organizationId:o,session:t},e.request):e.context.orgOptions.teams?.maximumTeams;if(d&&a.length>=d)throw new r.APIError("BAD_REQUEST",{message:A.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS});let c=await n.createTeam({name:e.body.name,organizationId:o,createdAt:new Date,updatedAt:new Date});return e.json(c)}),B=(0,s.a)("/organization/remove-team",{method:"POST",body:o.z.object({teamId:o.z.string(),organizationId:o.z.string().optional()}),use:[m],metadata:{openapi:{description:"Remove a team from an organization",responses:{200:{description:"Team removed successfully",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Confirmation message indicating successful removal",enum:["Team removed successfully."]}},required:["message"]}}}}}}}},async e=>{let t=await (0,s.g)(e),o=e.body.organizationId||t?.session.activeOrganizationId;if(!o)return e.json(null,{status:400,body:{message:A.NO_ACTIVE_ORGANIZATION}});if(!t&&(e.request||e.headers))throw new r.APIError("UNAUTHORIZED");let n=i(e.context,e.context.orgOptions);if(t){let i=await n.findMemberByOrgId({userId:t.user.id,organizationId:o});if(!i||i.teamId===e.body.teamId)throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM});if(!(0,l.h)({role:i.role,options:e.context.orgOptions,permissions:{team:["delete"]}}))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION})}let a=await n.findTeamById({teamId:e.body.teamId,organizationId:o});if(!a||a.organizationId!==o)throw new r.APIError("BAD_REQUEST",{message:A.TEAM_NOT_FOUND});if(!e.context.orgOptions.teams?.allowRemovingAllTeams&&(await n.listTeams(o)).length<=1)throw new r.APIError("BAD_REQUEST",{message:A.UNABLE_TO_REMOVE_LAST_TEAM});return await n.deleteTeam(a.id),e.json({message:"Team removed successfully."})}),j=(0,s.a)("/organization/update-team",{method:"POST",body:o.z.object({teamId:o.z.string(),data:L.partial()}),use:[m,f],metadata:{openapi:{description:"Update an existing team in an organization",responses:{200:{description:"Team updated successfully",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string",description:"Unique identifier of the updated team"},name:{type:"string",description:"Updated name of the team"},organizationId:{type:"string",description:"ID of the organization the team belongs to"},createdAt:{type:"string",format:"date-time",description:"Timestamp when the team was created"},updatedAt:{type:"string",format:"date-time",description:"Timestamp when the team was last updated"}},required:["id","name","organizationId","createdAt","updatedAt"]}}}}}}}},async e=>{let t=e.context.session,o=e.body.data.organizationId||t.session.activeOrganizationId;if(!o)return e.json(null,{status:400,body:{message:A.NO_ACTIVE_ORGANIZATION}});let s=i(e.context,e.context.orgOptions),n=await s.findMemberByOrgId({userId:t.user.id,organizationId:o});if(!n||!(0,l.h)({role:n.role,options:e.context.orgOptions,permissions:{team:["update"]}}))throw new r.APIError("FORBIDDEN",{message:A.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM});let a=await s.findTeamById({teamId:e.body.teamId,organizationId:o});if(!a||a.organizationId!==o)throw new r.APIError("BAD_REQUEST",{message:A.TEAM_NOT_FOUND});let d=await s.updateTeam(a.id,{name:e.body.data.name});return e.json(d)}),q=(0,s.a)("/organization/list-teams",{method:"GET",query:o.z.optional(o.z.object({organizationId:o.z.string().optional()})),metadata:{openapi:{description:"List all teams in an organization",responses:{200:{description:"Teams retrieved successfully",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string",description:"Unique identifier of the team"},name:{type:"string",description:"Name of the team"},organizationId:{type:"string",description:"ID of the organization the team belongs to"},createdAt:{type:"string",format:"date-time",description:"Timestamp when the team was created"},updatedAt:{type:"string",format:"date-time",description:"Timestamp when the team was last updated"}},required:["id","name","organizationId","createdAt","updatedAt"]},description:"Array of team objects within the organization"}}}}}}},use:[m,f]},async e=>{let t=e.context.session,o=t.session.activeOrganizationId||e.query?.organizationId;if(!o)return e.json(null,{status:400,body:{message:A.NO_ACTIVE_ORGANIZATION}});let s=i(e.context,e.context.orgOptions);if(!await s.findMemberByOrgId({userId:t?.user.id,organizationId:o||""}))throw new r.APIError("FORBIDDEN");let n=await s.listTeams(o);return e.json(n)});function h(e){return Array.isArray(e)?e.join(","):e}let Z=e=>{let n={createOrganization:C,updateOrganization:O,deleteOrganization:S,setActiveOrganization:R(),getFullOrganization:k(),listOrganizations:P,createInvitation:g(),cancelInvitation:w,acceptInvitation:y,getInvitation:v,rejectInvitation:K,checkOrganizationSlug:x,addMember:_(),removeMember:N,updateMemberRole:I(),getActiveMember:E,leaveOrganization:T,listInvitations:b},a=e?.teams?.enabled,d={createTeam:z(),listOrganizationTeams:q,removeTeam:B,updateTeam:j};a&&(n={...n,...d});let c={...p.defaultRoles,...e?.roles},u=a?{team:{modelName:e?.schema?.team?.modelName,fields:{name:{type:"string",required:!0,fieldName:e?.schema?.team?.fields?.name},organizationId:{type:"string",required:!0,references:{model:"organization",field:"id"},fieldName:e?.schema?.team?.fields?.organizationId},createdAt:{type:"date",required:!0,fieldName:e?.schema?.team?.fields?.createdAt},updatedAt:{type:"date",required:!1,fieldName:e?.schema?.team?.fields?.updatedAt}}}}:void 0;return{id:"organization",endpoints:{...t(n,{orgOptions:e||{},roles:c,getSession:async e=>await (0,s.g)(e)}),hasPermission:(0,s.a)("/organization/has-permission",{method:"POST",requireHeaders:!0,body:o.z.object({organizationId:o.z.string().optional()}).and(o.z.union([o.z.object({permission:o.z.record(o.z.string(),o.z.array(o.z.string())),permissions:o.z.undefined()}),o.z.object({permission:o.z.undefined(),permissions:o.z.record(o.z.string(),o.z.array(o.z.string()))})])),use:[f],metadata:{$Infer:{body:{}},openapi:{description:"Check if the user has permission",requestBody:{content:{"application/json":{schema:{type:"object",properties:{permission:{type:"object",description:"The permission to check",deprecated:!0},permissions:{type:"object",description:"The permission to check"}},required:["permissions"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{error:{type:"string"},success:{type:"boolean"}},required:["success"]}}}}}}}},async t=>{let o=t.body.organizationId||t.context.session.session.activeOrganizationId;if(!o)throw new r.APIError("BAD_REQUEST",{message:A.NO_ACTIVE_ORGANIZATION});let s=i(t.context),n=await s.findMemberByOrgId({userId:t.context.session.user.id,organizationId:o});if(!n)throw new r.APIError("UNAUTHORIZED",{message:A.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION});let a=(0,l.h)({role:n.role,options:e,permissions:t.body.permissions??t.body.permission});return t.json({error:null,success:a})})},schema:{session:{fields:{activeOrganizationId:{type:"string",required:!1,fieldName:e?.schema?.session?.fields?.activeOrganizationId}}},organization:{modelName:e?.schema?.organization?.modelName,fields:{name:{type:"string",required:!0,sortable:!0,fieldName:e?.schema?.organization?.fields?.name},slug:{type:"string",unique:!0,sortable:!0,fieldName:e?.schema?.organization?.fields?.slug},logo:{type:"string",required:!1,fieldName:e?.schema?.organization?.fields?.logo},createdAt:{type:"date",required:!0,fieldName:e?.schema?.organization?.fields?.createdAt},metadata:{type:"string",required:!1,fieldName:e?.schema?.organization?.fields?.metadata}}},member:{modelName:e?.schema?.member?.modelName,fields:{organizationId:{type:"string",required:!0,references:{model:"organization",field:"id"},fieldName:e?.schema?.member?.fields?.organizationId},userId:{type:"string",required:!0,fieldName:e?.schema?.member?.fields?.userId,references:{model:"user",field:"id"}},role:{type:"string",required:!0,sortable:!0,defaultValue:"member",fieldName:e?.schema?.member?.fields?.role},...a?{teamId:{type:"string",required:!1,sortable:!0,fieldName:e?.schema?.member?.fields?.teamId}}:{},createdAt:{type:"date",required:!0,fieldName:e?.schema?.member?.fields?.createdAt}}},invitation:{modelName:e?.schema?.invitation?.modelName,fields:{organizationId:{type:"string",required:!0,references:{model:"organization",field:"id"},fieldName:e?.schema?.invitation?.fields?.organizationId},email:{type:"string",required:!0,sortable:!0,fieldName:e?.schema?.invitation?.fields?.email},role:{type:"string",required:!1,sortable:!0,fieldName:e?.schema?.invitation?.fields?.role},...a?{teamId:{type:"string",required:!1,sortable:!0,fieldName:e?.schema?.invitation?.fields?.teamId}}:{},status:{type:"string",required:!0,sortable:!0,defaultValue:"pending",fieldName:e?.schema?.invitation?.fields?.status},expiresAt:{type:"date",required:!0,fieldName:e?.schema?.invitation?.fields?.expiresAt},inviterId:{type:"string",references:{model:"user",field:"id"},fieldName:e?.schema?.invitation?.fields?.inviterId,required:!0}}},...a?u:{}},$Infer:{Organization:{},Invitation:{},Member:{},Team:{},ActiveOrganization:{}},$ERROR_CODES:A}}}},408374:e=>{"use strict";var{g:t,__dirname:i}=e;{function r(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, not ${e}`)}function o(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function s(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function n(e,...t){if(!s(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function a(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("hash must be wrapped by utils.wrapConstructor");r(e.outputLen),r(e.blockLen)}function d(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function l(e,t){n(e);let i=t.outputLen;if(e.length<i)throw Error(`digestInto() expects output buffer of length at least ${i}`)}e.s({bool:()=>o,bytes:()=>n,default:()=>t,exists:()=>d,hash:()=>a,isBytes:()=>s,number:()=>r,output:()=>l});let t={number:r,bool:o,bytes:n,hash:a,exists:d,output:l}}},69618:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({Hash:()=>C,asyncLoop:()=>c,bytesToHex:()=>o,bytesToNumberBE:()=>d,bytesToUtf8:()=>p,checkOpts:()=>f,clean:()=>v,concatBytes:()=>m,copyBytes:()=>w,createView:()=>_,equalBytes:()=>A,hexToBytes:()=>n,hexToNumber:()=>a,isAligned32:()=>K,isLE:()=>N,nextTick:()=>T,numberToBytesBE:()=>l,setBigUint64:()=>g,toBytes:()=>h,u16:()=>i,u32:()=>b,u64Lengths:()=>y,u8:()=>t,utf8ToBytes:()=>u,wrapCipher:()=>x});var r=e.i(408374);let t=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=e=>new Uint16Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/2)),b=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),_=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),N=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];if(!N)throw Error("Non little-endian hardware is not supported");let I=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function o(e){(0,r.bytes)(e);let t="";for(let i=0;i<e.length;i++)t+=I[e[i]];return t}let E={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function s(e){return e>=E._0&&e<=E._9?e-E._0:e>=E._A&&e<=E._F?e-(E._A-10):e>=E._a&&e<=E._f?e-(E._a-10):void 0}function n(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,i=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(i);for(let t=0,o=0;t<i;t++,o+=2){let i=s(e.charCodeAt(o)),n=s(e.charCodeAt(o+1));if(void 0===i||void 0===n)throw Error('hex string expected, got non-hex character "'+(e[o]+e[o+1])+'" at index '+o);r[t]=16*i+n}return r}function a(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function d(e){return a(o(e))}function l(e,t){return n(e.toString(16).padStart(2*t,"0"))}let T=async()=>{};async function c(e,t,i){let r=Date.now();for(let o=0;o<e;o++){i(o);let e=Date.now()-r;e>=0&&e<t||(await T(),r+=e)}}function u(e){if("string"!=typeof e)throw Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function p(e){return new TextDecoder().decode(e)}function h(e){if("string"==typeof e)e=u(e);else if((0,r.isBytes)(e))e=w(e);else throw Error(`Uint8Array expected, got ${typeof e}`);return e}function m(...e){let t=0;for(let i=0;i<e.length;i++){let o=e[i];(0,r.bytes)(o),t+=o.length}let i=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){let o=e[t];i.set(o,r),r+=o.length}return i}function f(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}function A(e,t){if(e.length!==t.length)return!1;let i=0;for(let r=0;r<e.length;r++)i|=e[r]^t[r];return 0===i}class C{}let x=(e,t)=>(Object.assign(t,e),t);function g(e,t,i,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,r);let o=BigInt(32),s=BigInt(0xffffffff),n=Number(i>>o&s),a=Number(i&s),d=4*!!r,l=4*!r;e.setUint32(t+d,n,r),e.setUint32(t+l,a,r)}function y(e,t){let i=new Uint8Array(16),r=_(i);return g(r,0,BigInt(t?t.length:0),!0),g(r,8,BigInt(e.length),!0),i}function K(e){return e.byteOffset%4==0}function w(e){return Uint8Array.from(e)}function v(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}}},148121:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createCipher:()=>a,rotl:()=>s,sigma:()=>u});var r=e.i(408374),o=e.i(69618);let t=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),i=t("expand 16-byte k"),d=t("expand 32-byte k"),l=(0,o.u32)(i),c=(0,o.u32)(d),u=c.slice();function s(e,t){return e<<t|e>>>32-t}function n(e){return e.byteOffset%4==0}let p=0x100000000-1,h=new Uint32Array;function a(e,t){let{allowShortKeys:i,extendNonceFn:s,counterLength:a,counterRight:d,rounds:u}=(0,o.checkOpts)({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return(0,r.number)(a),(0,r.number)(u),(0,r.bool)(d),(0,r.bool)(i),(t,m,f,A,g=0)=>{(0,r.bytes)(t),(0,r.bytes)(m),(0,r.bytes)(f);let y=f.length;if(void 0===A&&(A=new Uint8Array(y)),(0,r.bytes)(A),(0,r.number)(g),g<0||g>=p)throw Error("arx: counter overflow");if(A.length<y)throw Error(`arx: output (${A.length}) is shorter than data (${y})`);let K=[],w=t.length,v,b;if(32===w)K.push(v=(0,o.copyBytes)(t)),b=c;else if(16===w&&i)(v=new Uint8Array(32)).set(t),v.set(t,16),b=l,K.push(v);else throw Error(`arx: invalid 32-byte key, got length=${w}`);n(m)||K.push(m=(0,o.copyBytes)(m));let _=(0,o.u32)(v);if(s){if(24!==m.length)throw Error("arx: extended nonce must be 24 bytes");s(b,_,(0,o.u32)(m.subarray(0,16)),_),m=m.subarray(16)}let N=16-a;if(N!==m.length)throw Error(`arx: nonce must be ${N} or 16 bytes`);if(12!==N){let e=new Uint8Array(12);e.set(m,d?0:12-m.length),m=e,K.push(m)}return!function(e,t,i,r,s,a,d,l){let c=s.length,u=new Uint8Array(64),m=(0,o.u32)(u),f=n(s)&&n(a),A=f?(0,o.u32)(s):h,g=f?(0,o.u32)(a):h;for(let o=0;o<c;d++){if(e(t,i,r,m,d,l),d>=p)throw Error("arx: counter overflow");let n=Math.min(64,c-o);if(f&&64===n){let e=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let t=0,i;t<16;t++)g[i=e+t]=A[i]^m[t];o+=64;continue}for(let e=0,t;e<n;e++)a[t=o+e]=s[t]^u[e];o+=n}}(e,b,_,(0,o.u32)(m),f,A,g,u),(0,o.clean)(...K),A}}}},283365:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({poly1305:()=>n,wrapConstructorWithKey:()=>s});var r=e.i(408374),o=e.i(69618);let t=(e,t)=>255&e[t++]|(255&e[t++])<<8;class i{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=(0,o.toBytes)(e),(0,r.bytes)(e,32);let i=t(e,0),s=t(e,2),n=t(e,4),a=t(e,6),d=t(e,8),l=t(e,10),c=t(e,12),u=t(e,14);this.r[0]=8191&i,this.r[1]=(i>>>13|s<<3)&8191,this.r[2]=(s>>>10|n<<6)&7939,this.r[3]=(n>>>7|a<<9)&8191,this.r[4]=(a>>>4|d<<12)&255,this.r[5]=d>>>1&8190,this.r[6]=(d>>>14|l<<2)&8191,this.r[7]=(l>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let i=0;i<8;i++)this.pad[i]=t(e,16+2*i)}process(e,i,r=!1){let{h:o,r:s}=this,n=s[0],a=s[1],d=s[2],l=s[3],c=s[4],u=s[5],p=s[6],h=s[7],m=s[8],f=s[9],A=t(e,i+0),g=t(e,i+2),y=t(e,i+4),K=t(e,i+6),w=t(e,i+8),v=t(e,i+10),b=t(e,i+12),_=t(e,i+14),N=o[0]+(8191&A),I=o[1]+((A>>>13|g<<3)&8191),E=o[2]+((g>>>10|y<<6)&8191),T=o[3]+((y>>>7|K<<9)&8191),C=o[4]+((K>>>4|w<<12)&8191),x=o[5]+(w>>>1&8191),O=o[6]+((w>>>14|v<<2)&8191),S=o[7]+((v>>>11|b<<5)&8191),k=o[8]+((b>>>8|_<<8)&8191),R=o[9]+(_>>>5|2048*!r),P=0,U=0+N*n+5*f*I+5*m*E+5*h*T+5*p*C;P=U>>>13,U&=8191,U+=5*u*x+5*c*O+5*l*S+5*d*k+5*a*R,P+=U>>>13,U&=8191;let D=P+N*a+I*n+5*f*E+5*m*T+5*h*C;P=D>>>13,D&=8191,D+=5*p*x+5*u*O+5*c*S+5*l*k+5*d*R,P+=D>>>13,D&=8191;let L=P+N*d+I*a+E*n+5*f*T+5*m*C;P=L>>>13,L&=8191,L+=5*h*x+5*p*O+5*u*S+5*c*k+5*l*R,P+=L>>>13,L&=8191;let z=P+N*l+I*d+E*a+T*n+5*f*C;P=z>>>13,z&=8191,z+=5*m*x+5*h*O+5*p*S+5*u*k+5*c*R,P+=z>>>13,z&=8191;let B=P+N*c+I*l+E*d+T*a+C*n;P=B>>>13,B&=8191,B+=5*f*x+5*m*O+5*h*S+5*p*k+5*u*R,P+=B>>>13,B&=8191;let j=P+N*u+I*c+E*l+T*d+C*a;P=j>>>13,j&=8191,j+=x*n+5*f*O+5*m*S+5*h*k+5*p*R,P+=j>>>13,j&=8191;let q=P+N*p+I*u+E*c+T*l+C*d;P=q>>>13,q&=8191,q+=x*a+O*n+5*f*S+5*m*k+5*h*R,P+=q>>>13,q&=8191;let Z=P+N*h+I*p+E*u+T*c+C*l;P=Z>>>13,Z&=8191,Z+=x*d+O*a+S*n+5*f*k+5*m*R,P+=Z>>>13,Z&=8191;let M=P+N*m+I*h+E*p+T*u+C*c;P=M>>>13,M&=8191,M+=x*l+O*d+S*a+k*n+5*f*R,P+=M>>>13,M&=8191;let V=P+N*f+I*m+E*h+T*p+C*u;P=V>>>13,V&=8191,V+=x*c+O*l+S*d+k*a+R*n,P+=V>>>13,V&=8191,U=8191&(P=(P=(P<<2)+P|0)+U|0),P>>>=13,D+=P,o[0]=U,o[1]=D,o[2]=L,o[3]=z,o[4]=B,o[5]=j,o[6]=q,o[7]=Z,o[8]=M,o[9]=V}finalize(){let{h:e,pad:t}=this,i=new Uint16Array(10),r=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=r,r=e[t]>>>13,e[t]&=8191;e[0]+=5*r,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,i[0]=e[0]+5,r=i[0]>>>13,i[0]&=8191;for(let t=1;t<10;t++)i[t]=e[t]+r,r=i[t]>>>13,i[t]&=8191;i[9]-=8192;let s=(1^r)-1;for(let e=0;e<10;e++)i[e]&=s;s=~s;for(let t=0;t<10;t++)e[t]=e[t]&s|i[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let n=e[0]+t[0];e[0]=65535&n;for(let i=1;i<8;i++)n=(e[i]+t[i]|0)+(n>>>16)|0,e[i]=65535&n;(0,o.clean)(i)}update(e){(0,r.exists)(this);let{buffer:t,blockLen:i}=this,s=(e=(0,o.toBytes)(e)).length;for(let r=0;r<s;){let o=Math.min(i-this.pos,s-r);if(o===i){for(;i<=s-r;r+=i)this.process(e,r);continue}t.set(e.subarray(r,r+o),this.pos),this.pos+=o,r+=o,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){(0,o.clean)(this.h,this.r,this.buffer,this.pad)}digestInto(e){(0,r.exists)(this),(0,r.output)(e,this),this.finished=!0;let{buffer:t,h:i}=this,{pos:o}=this;if(o){for(t[o++]=1;o<16;o++)t[o]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let t=0;t<8;t++)e[s++]=i[t]>>>0,e[s++]=i[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}}function s(e){let t=(t,i)=>e(i).update((0,o.toBytes)(t)).digest(),i=e(new Uint8Array(32));return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=t=>e(t),t}let n=s(e=>new i(e))}},535853:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({_poly1305_aead:()=>A,chacha12:()=>p,chacha20:()=>i,chacha20orig:()=>t,chacha20poly1305:()=>g,chacha8:()=>u,hchacha:()=>d,xchacha20:()=>c,xchacha20poly1305:()=>y});var r=e.i(148121),o=e.i(408374),s=e.i(283365),n=e.i(69618);function a(e,t,i,o,s,n=20){let d=e[0],l=e[1],c=e[2],u=e[3],p=t[0],h=t[1],m=t[2],f=t[3],A=t[4],g=t[5],y=t[6],K=t[7],w=i[0],v=i[1],b=i[2],_=d,N=l,I=c,E=u,T=p,C=h,x=m,O=f,S=A,k=g,R=y,P=K,U=s,D=w,L=v,z=b;for(let e=0;e<n;e+=2)_=_+T|0,S=S+(U=(0,r.rotl)(U^_,16))|0,_=_+(T=(0,r.rotl)(T^S,12))|0,S=S+(U=(0,r.rotl)(U^_,8))|0,T=(0,r.rotl)(T^S,7),N=N+C|0,k=k+(D=(0,r.rotl)(D^N,16))|0,N=N+(C=(0,r.rotl)(C^k,12))|0,k=k+(D=(0,r.rotl)(D^N,8))|0,C=(0,r.rotl)(C^k,7),I=I+x|0,R=R+(L=(0,r.rotl)(L^I,16))|0,I=I+(x=(0,r.rotl)(x^R,12))|0,R=R+(L=(0,r.rotl)(L^I,8))|0,x=(0,r.rotl)(x^R,7),E=E+O|0,P=P+(z=(0,r.rotl)(z^E,16))|0,E=E+(O=(0,r.rotl)(O^P,12))|0,P=P+(z=(0,r.rotl)(z^E,8))|0,O=(0,r.rotl)(O^P,7),_=_+C|0,R=R+(z=(0,r.rotl)(z^_,16))|0,_=_+(C=(0,r.rotl)(C^R,12))|0,R=R+(z=(0,r.rotl)(z^_,8))|0,C=(0,r.rotl)(C^R,7),N=N+x|0,P=P+(U=(0,r.rotl)(U^N,16))|0,N=N+(x=(0,r.rotl)(x^P,12))|0,P=P+(U=(0,r.rotl)(U^N,8))|0,x=(0,r.rotl)(x^P,7),I=I+O|0,S=S+(D=(0,r.rotl)(D^I,16))|0,I=I+(O=(0,r.rotl)(O^S,12))|0,S=S+(D=(0,r.rotl)(D^I,8))|0,O=(0,r.rotl)(O^S,7),E=E+T|0,k=k+(L=(0,r.rotl)(L^E,16))|0,E=E+(T=(0,r.rotl)(T^k,12))|0,k=k+(L=(0,r.rotl)(L^E,8))|0,T=(0,r.rotl)(T^k,7);let B=0;o[B++]=d+_|0,o[B++]=l+N|0,o[B++]=c+I|0,o[B++]=u+E|0,o[B++]=p+T|0,o[B++]=h+C|0,o[B++]=m+x|0,o[B++]=f+O|0,o[B++]=A+S|0,o[B++]=g+k|0,o[B++]=y+R|0,o[B++]=K+P|0,o[B++]=s+U|0,o[B++]=w+D|0,o[B++]=v+L|0,o[B++]=b+z|0}function d(e,t,i,o){let s=e[0],n=e[1],a=e[2],d=e[3],l=t[0],c=t[1],u=t[2],p=t[3],h=t[4],m=t[5],f=t[6],A=t[7],g=i[0],y=i[1],K=i[2],w=i[3];for(let e=0;e<20;e+=2)s=s+l|0,h=h+(g=(0,r.rotl)(g^s,16))|0,s=s+(l=(0,r.rotl)(l^h,12))|0,h=h+(g=(0,r.rotl)(g^s,8))|0,l=(0,r.rotl)(l^h,7),n=n+c|0,m=m+(y=(0,r.rotl)(y^n,16))|0,n=n+(c=(0,r.rotl)(c^m,12))|0,m=m+(y=(0,r.rotl)(y^n,8))|0,c=(0,r.rotl)(c^m,7),a=a+u|0,f=f+(K=(0,r.rotl)(K^a,16))|0,a=a+(u=(0,r.rotl)(u^f,12))|0,f=f+(K=(0,r.rotl)(K^a,8))|0,u=(0,r.rotl)(u^f,7),d=d+p|0,A=A+(w=(0,r.rotl)(w^d,16))|0,d=d+(p=(0,r.rotl)(p^A,12))|0,A=A+(w=(0,r.rotl)(w^d,8))|0,p=(0,r.rotl)(p^A,7),s=s+c|0,f=f+(w=(0,r.rotl)(w^s,16))|0,s=s+(c=(0,r.rotl)(c^f,12))|0,f=f+(w=(0,r.rotl)(w^s,8))|0,c=(0,r.rotl)(c^f,7),n=n+u|0,A=A+(g=(0,r.rotl)(g^n,16))|0,n=n+(u=(0,r.rotl)(u^A,12))|0,A=A+(g=(0,r.rotl)(g^n,8))|0,u=(0,r.rotl)(u^A,7),a=a+p|0,h=h+(y=(0,r.rotl)(y^a,16))|0,a=a+(p=(0,r.rotl)(p^h,12))|0,h=h+(y=(0,r.rotl)(y^a,8))|0,p=(0,r.rotl)(p^h,7),d=d+l|0,m=m+(K=(0,r.rotl)(K^d,16))|0,d=d+(l=(0,r.rotl)(l^m,12))|0,m=m+(K=(0,r.rotl)(K^d,8))|0,l=(0,r.rotl)(l^m,7);let v=0;o[v++]=s,o[v++]=n,o[v++]=a,o[v++]=d,o[v++]=g,o[v++]=y,o[v++]=K,o[v++]=w}let t=(0,r.createCipher)(a,{counterRight:!1,counterLength:8,allowShortKeys:!0}),i=(0,r.createCipher)(a,{counterRight:!1,counterLength:4,allowShortKeys:!1}),c=(0,r.createCipher)(a,{counterRight:!1,counterLength:8,extendNonceFn:d,allowShortKeys:!1}),u=(0,r.createCipher)(a,{counterRight:!1,counterLength:4,rounds:8}),p=(0,r.createCipher)(a,{counterRight:!1,counterLength:4,rounds:12}),h=new Uint8Array(16),m=(e,t)=>{e.update(t);let i=t.length%16;i&&e.update(h.subarray(i))},f=new Uint8Array(32);function l(e,t,i,r,o){let a=e(t,i,f),d=s.poly1305.create(a);o&&m(d,o),m(d,r);let l=new Uint8Array(16),c=(0,n.createView)(l);(0,n.setBigUint64)(c,0,BigInt(o?o.length:0),!0),(0,n.setBigUint64)(c,8,BigInt(r.length),!0),d.update(l);let u=d.digest();return(0,n.clean)(a,l),u}let A=e=>(t,i,r)=>((0,o.bytes)(t,32),(0,o.bytes)(i),{encrypt(s,a){let d=s.length,c=d+16;a?(0,o.bytes)(a,c):a=new Uint8Array(c),e(t,i,s,a,1);let u=l(e,t,i,a.subarray(0,-16),r);return a.set(u,d),(0,n.clean)(u),a},decrypt(s,a){let d=s.length,c=d-16;if(d<16)throw Error("encrypted data must be at least 16 bytes");a?(0,o.bytes)(a,c):a=new Uint8Array(c);let u=s.subarray(0,-16),p=s.subarray(-16),h=l(e,t,i,u,r);if(!(0,n.equalBytes)(p,h))throw Error("invalid tag");return e(t,i,u,a,1),(0,n.clean)(h),a}}),g=(0,n.wrapCipher)({blockSize:64,nonceLength:12,tagLength:16},A(i)),y=(0,n.wrapCipher)({blockSize:64,nonceLength:24,tagLength:16},A(c))}},253099:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({crypto:()=>t});var r=e.i(591032);let t=r&&"object"==typeof r&&"webcrypto"in r?r.webcrypto:void 0}},452521:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({cbc:()=>c,ctr:()=>u,gcm:()=>p,getWebcryptoSubtle:()=>a,managedNonce:()=>d,randomBytes:()=>n,utils:()=>t});var r=e.i(253099),o=e.i(408374),s=e.i(69618);function n(e=32){if(r.crypto&&"function"==typeof r.crypto.getRandomValues)return r.crypto.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}function a(){if(r.crypto&&"object"==typeof r.crypto.subtle&&null!=r.crypto.subtle)return r.crypto.subtle;throw Error("crypto.subtle must be defined")}function d(e){return(0,o.number)(e.nonceLength),(t,...i)=>({encrypt(r,...o){let{nonceLength:a}=e,d=n(a),l=e(t,d,...i).encrypt(r,...o),c=(0,s.concatBytes)(d,l);return l.fill(0),c},decrypt(r,...o){let{nonceLength:s}=e,n=r.subarray(0,s),a=r.subarray(s);return e(t,n,...i).decrypt(a,...o)}})}let t={async encrypt(e,t,i,r){let o=a(),s=await o.importKey("raw",e,t,!0,["encrypt"]);return new Uint8Array(await o.encrypt(i,s,r))},async decrypt(e,t,i,r){let o=a(),s=await o.importKey("raw",e,t,!0,["decrypt"]);return new Uint8Array(await o.decrypt(i,s,r))}},i={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function l(e){return(r,s,n)=>{(0,o.bytes)(r),(0,o.bytes)(s);let a={name:e,length:8*r.length},d=function(e,t,r){if(e===i.CBC)return{name:i.CBC,iv:t};if(e===i.CTR)return{name:i.CTR,counter:t,length:64};if(e===i.GCM)if(r)return{name:i.GCM,iv:t,additionalData:r};else return{name:i.GCM,iv:t};throw Error("unknown aes block mode")}(e,s,n);return{encrypt:e=>((0,o.bytes)(e),t.encrypt(r,a,d,e)),decrypt:e=>((0,o.bytes)(e),t.decrypt(r,a,d,e))}}}let c=l(i.CBC),u=l(i.CTR),p=l(i.GCM)}},526962:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({compareHash:()=>c,hashToBase64:()=>l,symmetricDecrypt:()=>i,symmetricEncrypt:()=>t});var r=e.i(74222),o=e.i(535853),s=e.i(69618),n=e.i(452521),a=e.i(896775),d=e.i(483013);async function l(e){let t=await (0,r.createHash)("SHA-256").digest(e);return d.base64.encode(t)}async function c(e,t){let i=await (0,r.createHash)("SHA-256").digest("string"==typeof e?new TextEncoder().encode(e):e),o=d.base64.decode(t);return(0,a.c)(i,o)}e.i(968915),e.i(382320),e.i(533004),e.i(91997),e.i(4887);let t=async({key:e,data:t})=>{let i=await (0,r.createHash)("SHA-256").digest(e),a=(0,s.utf8ToBytes)(t),d=(0,n.managedNonce)(o.xchacha20poly1305)(new Uint8Array(i));return(0,s.bytesToHex)(d.encrypt(a))},i=async({key:e,data:t})=>{let i=await (0,r.createHash)("SHA-256").digest(e),a=(0,s.hexToBytes)(t),d=(0,n.managedNonce)(o.xchacha20poly1305)(new Uint8Array(i));return new TextDecoder().decode(d.decrypt(a))}}},169429:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(74222),e.i(896775),e.i(483013),e.i(968915),e.i(382320),e.i(533004),e.i(91997),e.i(4887),e.i(526962)},499987:e=>{"use strict";var{g:t,__dirname:i}=e;{function r(e){return e?"0123456789ABCDEFGHIJKLMNOPQRSTUV":"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"}function o(e,t,i){let r="",o=0,s=0;for(let i of e)for(o=o<<8|i,s+=8;s>=5;)s-=5,r+=t[o>>s&31];if(s>0&&(r+=t[o<<5-s&31]),i){let e=(8-r.length%8)%8;r+="=".repeat(e)}return r}function s(e,t){let i=function(e){let t=new Map;for(let i=0;i<e.length;i++)t.set(e[i],i);return t}(t),r=[],o=0,s=0;for(let t of e){if("="===t)break;let e=i.get(t);if(void 0===e)throw Error(`Invalid Base32 character: ${t}`);for(o=o<<5|e,s+=5;s>=8;)s-=8,r.push(o>>s&255)}return Uint8Array.from(r)}e.s({base32:()=>t,base32hex:()=>i});let t={encode(e,t={}){let i=r(!1);return o("string"==typeof e?new TextEncoder().encode(e):new Uint8Array(e),i,t.padding??!0)},decode(e){"string"!=typeof e&&(e=new TextDecoder().decode(e));let t=r(!1);return s(e,t)}},i={encode(e,t={}){let i=r(!0);return o("string"==typeof e?new TextEncoder().encode(e):new Uint8Array(e),i,t.padding??!0)},decode:e=>s(e,r(!0))}}},211588:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createOTP:()=>t});var r=e.i(499987),o=e.i(558692);async function s(e,{counter:t,digits:i,hash:r="SHA-1"}){let s=i??6;if(s<1||s>8)throw TypeError("Digits must be between 1 and 8");let n=new ArrayBuffer(8);new DataView(n).setBigUint64(0,BigInt(t),!1);let a=new Uint8Array(n),d=new Uint8Array(await (0,o.createHMAC)(r).sign(e,a)),l=15&d[d.length-1];return(((127&d[l])<<24|(255&d[l+1])<<16|(255&d[l+2])<<8|255&d[l+3])%10**s).toString().padStart(s,"0")}async function n(e,t){let i=t?.digits??6,r=t?.period??30,o=Math.floor(Date.now()/(1e3*r));return await s(e,{counter:o,digits:i,hash:t?.hash})}async function a(e,{window:t=1,digits:i=6,secret:r,period:o=30}){let n=Math.floor(Date.now()/(1e3*o));for(let o=-t;o<=t;o++)if(e===await s(r,{counter:n+o,digits:i}))return!0;return!1}e.i(91997),e.i(483013);let t=(e,t)=>{let i=t?.digits??6,o=t?.period??30;return{hotp:t=>s(e,{counter:t,digits:i}),totp:()=>n(e,{digits:i,period:o}),verify:(t,r)=>a(t,{secret:e,digits:i,period:o,...r}),url:(t,s)=>(function({issuer:e,account:t,secret:i,digits:o=6,period:s=30}){let n=encodeURIComponent(e),a=encodeURIComponent(t),d=`otpauth://totp/${n}:${a}`,l=new URLSearchParams({secret:r.base32.encode(i,{padding:!1}),issuer:e});return void 0!==o&&l.set("digits",o.toString()),void 0!==s&&l.set("period",s.toString()),`${d}?${l.toString()}`})({issuer:t,account:s,secret:e,digits:i,period:o})}}}},383120:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({t:()=>t});let t=e=>({id:"two-factor",$InferServerPlugin:{},atomListeners:[{matcher:e=>e.startsWith("/two-factor/"),signal:"$sessionSignal"}],pathMethods:{"/two-factor/disable":"POST","/two-factor/enable":"POST","/two-factor/send-otp":"POST","/two-factor/generate-backup-codes":"POST"},fetchPlugins:[{id:"two-factor",name:"two-factor",hooks:{async onSuccess(t){t.data?.twoFactorRedirect&&e?.onTwoFactorRedirect&&await e.onTwoFactorRedirect()}}}]})}},493597:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({TWO_FACTOR_ERROR_CODES:()=>t,twoFactor:()=>b});var r=e.i(382320);e.i(243917);var o=e.i(81714),s=e.i(151176),n=e.i(311556),a=e.i(328902),d=e.i(776569);e.i(105127),e.i(187615),e.i(306192),e.i(169429);var l=e.i(526962);e.i(483013);var c=e.i(558692);e.i(74222),e.i(533004),e.i(91997);var u=e.i(211588),p=e.i(55262);e.i(383120),e.i(4887),e.i(30483),e.i(137942),e.i(561336),e.i(692153),e.i(771884),e.i(692218),e.i(316944),e.i(628146),e.i(968915),e.i(664764),e.i(504506),e.i(896775);let t={OTP_NOT_ENABLED:"OTP not enabled",OTP_HAS_EXPIRED:"OTP has expired",TOTP_NOT_ENABLED:"TOTP not enabled",TWO_FACTOR_NOT_ENABLED:"Two factor isn't enabled",BACKUP_CODES_NOT_ENABLED:"Backup codes aren't enabled",INVALID_BACKUP_CODE:"Invalid backup code",INVALID_CODE:"Invalid code",TOO_MANY_ATTEMPTS_REQUEST_NEW_CODE:"Too many attempts. Please request a new code.",INVALID_TWO_FACTOR_COOKIE:"Invalid two factor cookie"},i="two_factor",g="trust_device";async function h(e){let r=await (0,s.g)(e);if(!r){let r=e.context.createAuthCookie(i),o=await e.getSignedCookie(r.name,e.context.secret);if(!o)throw new n.APIError("UNAUTHORIZED",{message:t.INVALID_TWO_FACTOR_COOKIE});let s=await e.context.internalAdapter.findVerificationValue(o);if(!s)throw new n.APIError("UNAUTHORIZED",{message:t.INVALID_TWO_FACTOR_COOKIE});let d=await e.context.internalAdapter.findUserById(s.value);if(!d)throw new n.APIError("UNAUTHORIZED",{message:t.INVALID_TWO_FACTOR_COOKIE});let l=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);return{valid:async e=>{let t=await e.context.internalAdapter.createSession(s.value,e,!!l);if(!t)throw new n.APIError("INTERNAL_SERVER_ERROR",{message:"failed to create session"});if(await (0,a.setSessionCookie)(e,{session:t,user:d}),e.body.trustDevice){let i=e.context.createAuthCookie(g,{maxAge:2592e3}),o=await (0,c.createHMAC)("SHA-256","base64urlnopad").sign(e.context.secret,`${d.id}!${t.token}`);await e.setSignedCookie(i.name,`${o}!${t.token}`,e.context.secret,i.attributes),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{maxAge:0}),e.setCookie(r.name,"",{maxAge:0})}return e.json({token:t.token,user:{id:d.id,email:d.email,emailVerified:d.emailVerified,name:d.name,image:d.image,createdAt:d.createdAt,updatedAt:d.updatedAt}})},invalid:async e=>{throw new n.APIError("UNAUTHORIZED",{message:t[e]})},session:{session:null,user:d},key:o}}return{valid:async e=>e.json({token:r.session.token,user:{id:r.user.id,email:r.user.email,emailVerified:r.user.emailVerified,name:r.user.name,image:r.user.image,createdAt:r.user.createdAt,updatedAt:r.user.updatedAt}}),invalid:async()=>{throw new n.APIError("UNAUTHORIZED",{message:t.INVALID_TWO_FACTOR_COOKIE})},session:r,key:`${r.user.id}!${r.session.id}`}}async function m(e,t){let i=t?.customBackupCodesGenerate?t.customBackupCodesGenerate():Array.from({length:t?.amount??10}).fill(null).map(()=>(0,r.g)(t?.length??10,"a-z","0-9","A-Z")).map(e=>`${e.slice(0,5)}-${e.slice(5)}`),o=await (0,l.symmetricEncrypt)({data:JSON.stringify(i),key:e});return{backupCodes:i,encryptedBackupCodes:o}}async function f(e,t){let i=await A(e.backupCodes,t);return i?{status:i.includes(e.code),updated:i.filter(t=>t!==e.code)}:{status:!1,updated:null}}async function A(e,t){let i=JSON.parse(new TextDecoder("utf-8").decode(new TextEncoder().encode(await (0,l.symmetricDecrypt)({key:t,data:e})))),r=o.z.array(o.z.string()).safeParse(i);return r.success?r.data:null}let y=e=>{let i="twoFactor";return{id:"backup_code",endpoints:{verifyBackupCode:(0,s.a)("/two-factor/verify-backup-code",{method:"POST",body:o.z.object({code:o.z.string(),disableSession:o.z.boolean({description:"If true, the session cookie will not be set."}).optional(),trustDevice:o.z.boolean({description:"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time."}).optional()}),metadata:{openapi:{description:"Verify a backup code for two-factor authentication",responses:{200:{description:"Backup code verified successfully",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"Unique identifier of the user"},email:{type:"string",format:"email",nullable:!0,description:"User's email address"},emailVerified:{type:"boolean",nullable:!0,description:"Whether the email is verified"},name:{type:"string",nullable:!0,description:"User's name"},image:{type:"string",format:"uri",nullable:!0,description:"User's profile image URL"},twoFactorEnabled:{type:"boolean",description:"Whether two-factor authentication is enabled for the user"},createdAt:{type:"string",format:"date-time",description:"Timestamp when the user was created"},updatedAt:{type:"string",format:"date-time",description:"Timestamp when the user was last updated"}},required:["id","twoFactorEnabled","createdAt","updatedAt"],description:"The authenticated user object with two-factor details"},session:{type:"object",properties:{token:{type:"string",description:"Session token"},userId:{type:"string",description:"ID of the user associated with the session"},createdAt:{type:"string",format:"date-time",description:"Timestamp when the session was created"},expiresAt:{type:"string",format:"date-time",description:"Timestamp when the session expires"}},required:["token","userId","createdAt","expiresAt"],description:"The current session object, included unless disableSession is true"}},required:["user","session"]}}}}}}}},async e=>{let{session:r,valid:o}=await h(e),s=r.user,a=await e.context.adapter.findOne({model:i,where:[{field:"userId",value:s.id}]});if(!a)throw new n.APIError("BAD_REQUEST",{message:t.BACKUP_CODES_NOT_ENABLED});let d=await f({backupCodes:a.backupCodes,code:e.body.code},e.context.secret);if(!d.status)throw new n.APIError("UNAUTHORIZED",{message:t.INVALID_BACKUP_CODE});let c=await (0,l.symmetricEncrypt)({key:e.context.secret,data:JSON.stringify(d.updated)});return(await e.context.adapter.updateMany({model:i,update:{backupCodes:c},where:[{field:"userId",value:s.id}]}),e.body.disableSession)?e.json({token:r.session?.token,user:{id:r.user?.id,email:r.user.email,emailVerified:r.user.emailVerified,name:r.user.name,image:r.user.image,createdAt:r.user.createdAt,updatedAt:r.user.updatedAt}}):o(e)}),generateBackupCodes:(0,s.a)("/two-factor/generate-backup-codes",{method:"POST",body:o.z.object({password:o.z.string()}),use:[s.s],metadata:{openapi:{description:"Generate new backup codes for two-factor authentication",responses:{200:{description:"Backup codes generated successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the backup codes were generated successfully",enum:[!0]},backupCodes:{type:"array",items:{type:"string"},description:"Array of generated backup codes in plain text"}},required:["status","backupCodes"]}}}}}}}},async r=>{let o=r.context.session.user;if(!o.twoFactorEnabled)throw new n.APIError("BAD_REQUEST",{message:t.TWO_FACTOR_NOT_ENABLED});await r.context.password.checkPassword(o.id,r);let s=await m(r.context.secret,e);return await r.context.adapter.update({model:i,update:{backupCodes:s.encryptedBackupCodes},where:[{field:"userId",value:r.context.session.user.id}]}),r.json({status:!0,backupCodes:s.backupCodes})}),viewBackupCodes:(0,s.a)("/two-factor/view-backup-codes",{method:"GET",body:o.z.object({userId:o.z.coerce.string()}),metadata:{SERVER_ONLY:!0}},async e=>{let r=await e.context.adapter.findOne({model:i,where:[{field:"userId",value:e.body.userId}]});if(!r)throw new n.APIError("BAD_REQUEST",{message:"Backup codes aren't enabled"});let o=await A(r.backupCodes,e.context.secret);if(!o)throw new n.APIError("BAD_REQUEST",{message:t.BACKUP_CODES_NOT_ENABLED});return e.json({status:!0,backupCodes:o})})}}},K=e=>{let i={...e,digits:e?.digits||6,period:60*(e?.period||3)*1e3},d="twoFactor";return{id:"otp",endpoints:{sendTwoFactorOTP:(0,s.a)("/two-factor/send-otp",{method:"POST",body:o.z.object({trustDevice:o.z.boolean().optional()}).optional(),metadata:{openapi:{summary:"Send two factor OTP",description:"Send two factor OTP to the user",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async o=>{if(!e||!e.sendOTP)throw o.context.logger.error("send otp isn't configured. Please configure the send otp function on otp options."),new n.APIError("BAD_REQUEST",{message:"otp isn't configured"});let{session:s,key:a}=await h(o);if(!await o.context.adapter.findOne({model:d,where:[{field:"userId",value:s.user.id}]}))throw new n.APIError("BAD_REQUEST",{message:t.OTP_NOT_ENABLED});let l=(0,r.g)(i.digits,"0-9");return await o.context.internalAdapter.createVerificationValue({value:`${l}!0`,identifier:`2fa-otp-${a}`,expiresAt:new Date(Date.now()+i.period)},o),await e.sendOTP({user:s.user,otp:l},o.request),o.json({status:!0})}),verifyTwoFactorOTP:(0,s.a)("/two-factor/verify-otp",{method:"POST",body:o.z.object({code:o.z.string({description:"The otp code to verify"}),trustDevice:o.z.boolean().optional()}),metadata:{openapi:{summary:"Verify two factor OTP",description:"Verify two factor OTP",responses:{200:{description:"Two-factor OTP verified successfully",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"Session token for the authenticated session"},user:{type:"object",properties:{id:{type:"string",description:"Unique identifier of the user"},email:{type:"string",format:"email",nullable:!0,description:"User's email address"},emailVerified:{type:"boolean",nullable:!0,description:"Whether the email is verified"},name:{type:"string",nullable:!0,description:"User's name"},image:{type:"string",format:"uri",nullable:!0,description:"User's profile image URL"},createdAt:{type:"string",format:"date-time",description:"Timestamp when the user was created"},updatedAt:{type:"string",format:"date-time",description:"Timestamp when the user was last updated"}},required:["id","createdAt","updatedAt"],description:"The authenticated user object"}},required:["token","user"]}}}}}}}},async i=>{let{session:r,key:o,valid:l,invalid:c}=await h(i);if(!await i.context.adapter.findOne({model:d,where:[{field:"userId",value:r.user.id}]}))throw new n.APIError("BAD_REQUEST",{message:t.OTP_NOT_ENABLED});let u=await i.context.internalAdapter.findVerificationValue(`2fa-otp-${o}`),[p,m]=u?.value?.split("!")??[];if(!u||u.expiresAt<new Date)throw u&&await i.context.internalAdapter.deleteVerificationValue(u.id),new n.APIError("BAD_REQUEST",{message:t.OTP_HAS_EXPIRED});let f=e?.allowedAttempts||5;if(parseInt(m)>=f)throw await i.context.internalAdapter.deleteVerificationValue(u.id),new n.APIError("BAD_REQUEST",{message:t.TOO_MANY_ATTEMPTS_REQUEST_NEW_CODE});if(p!==i.body.code)return await i.context.internalAdapter.updateVerificationValue(u.id,{value:`${p}!${parseInt(m)+1}`}),c("INVALID_CODE");if(!r.user.twoFactorEnabled){if(!r.session)throw new n.APIError("BAD_REQUEST",{message:s.B.FAILED_TO_CREATE_SESSION});let e=await i.context.internalAdapter.updateUser(r.user.id,{twoFactorEnabled:!0}),t=await i.context.internalAdapter.createSession(r.user.id,i,!1,r.session);return await i.context.internalAdapter.deleteSession(r.session.token),await (0,a.setSessionCookie)(i,{session:t,user:e}),i.json({token:t.token,user:{id:e.id,email:e.email,emailVerified:e.emailVerified,name:e.name,image:e.image,createdAt:e.createdAt,updatedAt:e.updatedAt}})}return l(i)})}}},w=e=>{let i={...e,digits:e?.digits||6,period:e?.period||30},r="twoFactor",d=(0,s.a)("/totp/generate",{method:"POST",body:o.z.object({secret:o.z.string({description:"The secret to generate the TOTP code"})}),metadata:{openapi:{summary:"Generate TOTP code",description:"Use this endpoint to generate a TOTP code",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{code:{type:"string"}}}}}}}},SERVER_ONLY:!0}},async t=>{if(e?.disable)throw t.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"),new n.APIError("BAD_REQUEST",{message:"totp isn't configured"});return{code:await (0,u.createOTP)(t.body.secret,{period:i.period,digits:i.digits}).totp()}});return{id:"totp",endpoints:{generateTOTP:d,getTOTPURI:(0,s.a)("/two-factor/get-totp-uri",{method:"POST",use:[s.s],body:o.z.object({password:o.z.string({description:"User password"})}),metadata:{openapi:{summary:"Get TOTP URI",description:"Use this endpoint to get the TOTP URI",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{totpURI:{type:"string"}}}}}}}}}},async o=>{if(e?.disable)throw o.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"),new n.APIError("BAD_REQUEST",{message:"totp isn't configured"});let s=o.context.session.user,a=await o.context.adapter.findOne({model:r,where:[{field:"userId",value:s.id}]});if(!a||!s.twoFactorEnabled)throw new n.APIError("BAD_REQUEST",{message:t.TOTP_NOT_ENABLED});let d=await (0,l.symmetricDecrypt)({key:o.context.secret,data:a.secret});return await o.context.password.checkPassword(s.id,o),{totpURI:(0,u.createOTP)(d,{digits:i.digits,period:i.period}).url(e?.issuer||o.context.appName,s.email)}}),verifyTOTP:(0,s.a)("/two-factor/verify-totp",{method:"POST",body:o.z.object({code:o.z.string({description:"The otp code to verify"}),trustDevice:o.z.boolean({description:"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time."}).optional()}),metadata:{openapi:{summary:"Verify two factor TOTP",description:"Verify two factor TOTP",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async o=>{if(e?.disable)throw o.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"),new n.APIError("BAD_REQUEST",{message:"totp isn't configured"});let{session:d,valid:c,invalid:p}=await h(o),m=d.user,f=await o.context.adapter.findOne({model:r,where:[{field:"userId",value:m.id}]});if(!f)throw new n.APIError("BAD_REQUEST",{message:t.TOTP_NOT_ENABLED});let A=await (0,l.symmetricDecrypt)({key:o.context.secret,data:f.secret});if(!await (0,u.createOTP)(A,{period:i.period,digits:i.digits}).verify(o.body.code))return p("INVALID_CODE");if(!m.twoFactorEnabled){if(!d.session)throw new n.APIError("BAD_REQUEST",{message:s.B.FAILED_TO_CREATE_SESSION});let e=await o.context.internalAdapter.updateUser(m.id,{twoFactorEnabled:!0},o),t=await o.context.internalAdapter.createSession(m.id,o,!1,d.session).catch(e=>{throw e});await o.context.internalAdapter.deleteSession(d.session.token),await (0,a.setSessionCookie)(o,{session:t,user:e})}return c(o)})}}},v={user:{fields:{twoFactorEnabled:{type:"boolean",required:!1,defaultValue:!1,input:!1}}},twoFactor:{fields:{secret:{type:"string",required:!0,returned:!1},backupCodes:{type:"string",required:!0,returned:!1},userId:{type:"string",required:!0,returned:!1,references:{model:"user",field:"id"}}}}},b=e=>{let h={twoFactorTable:"twoFactor"},f=w(e?.totpOptions),A=y(e?.backupCodeOptions),b=K(e?.otpOptions);return{id:"two-factor",endpoints:{...f.endpoints,...b.endpoints,...A.endpoints,enableTwoFactor:(0,s.a)("/two-factor/enable",{method:"POST",body:o.z.object({password:o.z.string({description:"User password"}),issuer:o.z.string({description:"Custom issuer for the TOTP URI"}).optional()}),use:[s.s],metadata:{openapi:{summary:"Enable two factor authentication",description:"Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{totpURI:{type:"string",description:"TOTP URI"},backupCodes:{type:"array",items:{type:"string"},description:"Backup codes"}}}}}}}}}},async t=>{let i=t.context.session.user,{password:o,issuer:d}=t.body;if(!await (0,p.v)(t,{password:o,userId:i.id}))throw new n.APIError("BAD_REQUEST",{message:s.B.INVALID_PASSWORD});let c=(0,r.g)(32),f=await (0,l.symmetricEncrypt)({key:t.context.secret,data:c}),A=await m(t.context.secret,e?.backupCodeOptions);if(e?.skipVerificationOnEnable){let e=await t.context.internalAdapter.updateUser(i.id,{twoFactorEnabled:!0},t),r=await t.context.internalAdapter.createSession(e.id,t,!1,t.context.session.session);await (0,a.setSessionCookie)(t,{session:r,user:e}),await t.context.internalAdapter.deleteSession(t.context.session.session.token)}await t.context.adapter.deleteMany({model:h.twoFactorTable,where:[{field:"userId",value:i.id}]}),await t.context.adapter.create({model:h.twoFactorTable,data:{secret:f,backupCodes:A.encryptedBackupCodes,userId:i.id}});let g=(0,u.createOTP)(c,{digits:e?.totpOptions?.digits||6,period:e?.totpOptions?.period}).url(d||e?.issuer||t.context.appName,i.email);return t.json({totpURI:g,backupCodes:A.backupCodes})}),disableTwoFactor:(0,s.a)("/two-factor/disable",{method:"POST",body:o.z.object({password:o.z.string({description:"User password"})}),use:[s.s],metadata:{openapi:{summary:"Disable two factor authentication",description:"Use this endpoint to disable two factor authentication.",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let t=e.context.session.user,{password:i}=e.body;if(!await (0,p.v)(e,{password:i,userId:t.id}))throw new n.APIError("BAD_REQUEST",{message:"Invalid password"});let r=await e.context.internalAdapter.updateUser(t.id,{twoFactorEnabled:!1},e);await e.context.adapter.delete({model:h.twoFactorTable,where:[{field:"userId",value:r.id}]});let o=await e.context.internalAdapter.createSession(r.id,e,!1,e.context.session.session);return await (0,a.setSessionCookie)(e,{session:o,user:r}),await e.context.internalAdapter.deleteSession(e.context.session.session.token),e.json({status:!0})})},options:e,hooks:{after:[{matcher:e=>"/sign-in/email"===e.path||"/sign-in/username"===e.path||"/sign-in/phone-number"===e.path,handler:(0,s.c)(async t=>{let o=t.context.newSession;if(!o||!o?.user.twoFactorEnabled)return;let s=t.context.createAuthCookie(g),n=await t.getSignedCookie(s.name,t.context.secret);if(n){let[e,i]=n.split("!");if(e===await (0,c.createHMAC)("SHA-256","base64urlnopad").sign(t.context.secret,`${o.user.id}!${i}`)){let e=await (0,c.createHMAC)("SHA-256","base64urlnopad").sign(t.context.secret,`${o.user.id}!${i}`);await t.setSignedCookie(s.name,`${e}!${o.session.token}`,t.context.secret,s.attributes);return}}(0,a.deleteSessionCookie)(t,!0),await t.context.internalAdapter.deleteSession(o.session.token);let d=e?.otpOptions?.period||300,l=t.context.createAuthCookie(i,{maxAge:d}),u=`2fa-${(0,r.g)(20)}`;return await t.context.internalAdapter.createVerificationValue({value:o.user.id,identifier:u,expiresAt:new Date(Date.now()+1e3*d)},t),await t.setSignedCookie(l.name,u,t.context.secret,l.attributes),t.json({twoFactorRedirect:!0})})}]},schema:(0,d.m)(v,e?.schema),rateLimit:[{pathMatcher:e=>e.startsWith("/two-factor/"),window:10,max:3}],$ERROR_CODES:t}}}},843458:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(382320),e.i(243917),e.i(151176),e.i(311556),e.i(328902),e.i(776569),e.i(105127),e.i(187615),e.i(306192),e.i(169429),e.i(483013),e.i(558692),e.i(74222),e.i(533004),e.i(91997),e.i(211588),e.i(55262),e.i(383120),e.i(4887),e.i(30483),e.i(137942),e.i(561336),e.i(692153),e.i(771884),e.i(692218),e.i(316944),e.i(628146),e.i(968915),e.i(664764),e.i(504506),e.i(896775),e.i(493597)},511127:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({USERNAME_ERROR_CODES:()=>i,username:()=>l}),e.i(243917);var r=e.i(81714),o=e.i(151176),s=e.i(311556),n=e.i(328902),a=e.i(776569);e.i(105127),e.i(187615),e.i(306192),e.i(30483),e.i(137942),e.i(561336),e.i(483013),e.i(692153),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(771884),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506);let t={user:{fields:{username:{type:"string",required:!1,sortable:!0,unique:!0,returned:!0,transform:{input:e=>e?.toString().toLowerCase()}},displayUsername:{type:"string",required:!1}}}},i={INVALID_USERNAME_OR_PASSWORD:"invalid username or password",EMAIL_NOT_VERIFIED:"email not verified",UNEXPECTED_ERROR:"unexpected error",USERNAME_IS_ALREADY_TAKEN:"username is already taken. please try another.",USERNAME_TOO_SHORT:"username is too short",USERNAME_TOO_LONG:"username is too long",INVALID_USERNAME:"username is invalid"};function d(e){return/^[a-zA-Z0-9_.]+$/.test(e)}let l=e=>({id:"username",endpoints:{signInUsername:(0,o.a)("/sign-in/username",{method:"POST",body:r.z.object({username:r.z.string({description:"The username of the user"}),password:r.z.string({description:"The password of the user"}),rememberMe:r.z.boolean({description:"Remember the user session"}).optional()}),metadata:{openapi:{summary:"Sign in with username",description:"Sign in with username",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"Session token for the authenticated session"},user:{$ref:"#/components/schemas/User"}},required:["token","user"]}}}}}}}},async t=>{if(!t.body.username||!t.body.password)throw t.context.logger.error("Username or password not found"),new s.APIError("UNAUTHORIZED",{message:i.INVALID_USERNAME_OR_PASSWORD});let r=e?.minUsernameLength||3,a=e?.maxUsernameLength||30;if(t.body.username.length<r)throw t.context.logger.error("Username too short",{username:t.body.username}),new s.APIError("UNPROCESSABLE_ENTITY",{message:i.USERNAME_TOO_SHORT});if(t.body.username.length>a)throw t.context.logger.error("Username too long",{username:t.body.username}),new s.APIError("UNPROCESSABLE_ENTITY",{message:i.USERNAME_TOO_LONG});if(!(e?.usernameValidator||d)(t.body.username))throw new s.APIError("UNPROCESSABLE_ENTITY",{message:i.INVALID_USERNAME});let c=await t.context.adapter.findOne({model:"user",where:[{field:"username",value:t.body.username.toLowerCase()}]});if(!c)throw await t.context.password.hash(t.body.password),t.context.logger.error("User not found",{username:l}),new s.APIError("UNAUTHORIZED",{message:i.INVALID_USERNAME_OR_PASSWORD});if(!c.emailVerified&&t.context.options.emailAndPassword?.requireEmailVerification)throw await (0,o.d)(t,c),new s.APIError("FORBIDDEN",{message:i.EMAIL_NOT_VERIFIED});let u=await t.context.adapter.findOne({model:"account",where:[{field:"userId",value:c.id},{field:"providerId",value:"credential"}]});if(!u)throw new s.APIError("UNAUTHORIZED",{message:i.INVALID_USERNAME_OR_PASSWORD});let p=u?.password;if(!p)throw t.context.logger.error("Password not found",{username:l}),new s.APIError("UNAUTHORIZED",{message:i.INVALID_USERNAME_OR_PASSWORD});if(!await t.context.password.verify({hash:p,password:t.body.password}))throw t.context.logger.error("Invalid password"),new s.APIError("UNAUTHORIZED",{message:i.INVALID_USERNAME_OR_PASSWORD});let h=await t.context.internalAdapter.createSession(c.id,t,!1===t.body.rememberMe);return h?(await (0,n.setSessionCookie)(t,{session:h,user:c},!1===t.body.rememberMe),t.json({token:h.token,user:{id:c.id,email:c.email,emailVerified:c.emailVerified,username:c.username,name:c.name,image:c.image,createdAt:c.createdAt,updatedAt:c.updatedAt}})):t.json(null,{status:500,body:{message:o.B.FAILED_TO_CREATE_SESSION}})})},schema:(0,a.m)(t,e?.schema),hooks:{before:[{matcher:e=>"/sign-up/email"===e.path||"/update-user"===e.path,handler:(0,o.c)(async t=>{let r=t.body.username;if(void 0!==r&&"string"==typeof r){let o=e?.minUsernameLength||3,n=e?.maxUsernameLength||30;if(r.length<o)throw new s.APIError("UNPROCESSABLE_ENTITY",{message:i.USERNAME_TOO_SHORT});if(r.length>n)throw new s.APIError("UNPROCESSABLE_ENTITY",{message:i.USERNAME_TOO_LONG});let a=e?.usernameValidator||d;if(!await a(r))throw new s.APIError("UNPROCESSABLE_ENTITY",{message:i.INVALID_USERNAME});if(await t.context.adapter.findOne({model:"user",where:[{field:"username",value:r.toLowerCase()}]}))throw new s.APIError("UNPROCESSABLE_ENTITY",{message:i.USERNAME_IS_ALREADY_TAKEN})}})},{matcher:e=>"/sign-up/email"===e.path||"/update-user"===e.path,handler:(0,o.c)(async e=>{!e.body.displayUsername&&e.body.username&&(e.body.displayUsername=e.body.username)})}]},$ERROR_CODES:i})}},493009:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({bearer:()=>t});var r=e.i(311556);e.i(105127),e.i(483013);var o=e.i(558692),s=e.i(328902),n=e.i(151176);e.i(243917),e.i(776569),e.i(187615),e.i(306192),e.i(771884),e.i(692153),e.i(316944),e.i(664764),e.i(30483),e.i(137942),e.i(561336),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(692218),e.i(628146),e.i(968915),e.i(504506);let t=e=>({id:"bearer",hooks:{before:[{matcher:e=>!!(e.request?.headers.get("authorization")||e.headers?.get("authorization")),handler:(0,n.c)(async t=>{let i=t.request?.headers.get("authorization")?.replace("Bearer ","")||t.headers?.get("Authorization")?.replace("Bearer ","");if(!i)return;let s="";if(i.includes("."))s=i.replace("=","");else{if(e?.requireSignature)return;s=(await (0,r.serializeSignedCookie)("",i,t.context.secret)).replace("=","")}try{let e=decodeURIComponent(s);if(!await (0,o.createHMAC)("SHA-256","base64urlnopad").verify(t.context.secret,e.split(".")[0],e.split(".")[1]))return}catch(e){return}let n=t.request?.headers||t.headers,a=new Headers({...Object.fromEntries(n?.entries())});return a.append("cookie",`${t.context.authCookies.sessionToken.name}=${s}`),{context:{headers:a}}})}],after:[{matcher:e=>!0,handler:(0,n.c)(async e=>{let t=e.context.responseHeaders?.get("set-cookie");if(!t)return;let i=(0,s.parseSetCookieHeader)(t),r=e.context.authCookies.sessionToken.name,o=i.get(r);if(!o||!o.value||0===o["max-age"])return;let n=o.value;e.setHeader("set-auth-token",n),e.setHeader("Access-Control-Expose-Headers","set-auth-token")})}]}})}},986279:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({magicLink:()=>t}),e.i(243917);var r=e.i(81714),o=e.i(151176),s=e.i(311556),n=e.i(328902);e.i(74222),e.i(483013),e.i(533004),e.i(91997);var a=e.i(382320);e.i(776569),e.i(105127),e.i(187615),e.i(306192),e.i(30483),e.i(137942),e.i(561336),e.i(692153),e.i(771884),e.i(4887),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506);let t=e=>({id:"magic-link",endpoints:{signInMagicLink:(0,o.a)("/sign-in/magic-link",{method:"POST",requireHeaders:!0,body:r.z.object({email:r.z.string({description:"Email address to send the magic link"}).email(),name:r.z.string({description:"User display name. Only used if the user is registering for the first time."}).optional(),callbackURL:r.z.string({description:"URL to redirect after magic link verification"}).optional()}),metadata:{openapi:{description:"Sign in with magic link",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async t=>{let{email:i}=t.body;if(e.disableSignUp&&!await t.context.internalAdapter.findUserByEmail(i))throw new s.APIError("BAD_REQUEST",{message:o.B.USER_NOT_FOUND});let r=e?.generateToken?await e.generateToken(i):(0,a.g)(32,"a-z","A-Z");await t.context.internalAdapter.createVerificationValue({identifier:r,value:JSON.stringify({email:i,name:t.body.name}),expiresAt:new Date(Date.now()+1e3*(e.expiresIn||300))},t);let n=`${t.context.baseURL}/magic-link/verify?token=${r}&callbackURL=${t.body.callbackURL||"/"}`;return await e.sendMagicLink({email:i,url:n,token:r},t.request),t.json({status:!0})}),magicLinkVerify:(0,o.a)("/magic-link/verify",{method:"GET",query:r.z.object({token:r.z.string({description:"Verification token"}),callbackURL:r.z.string({description:"URL to redirect after magic link verification, if not provided will return session"}).optional()}),use:[(0,o.o)(e=>e.query.callbackURL)],requireHeaders:!0,metadata:{openapi:{description:"Verify magic link",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}}}},async t=>{let{token:i,callbackURL:r}=t.query,o=r?.startsWith("http")?r:r?`${t.context.options.baseURL}${r}`:t.context.options.baseURL,s=await t.context.internalAdapter.findVerificationValue(i);if(!s)throw t.redirect(`${o}?error=INVALID_TOKEN`);if(s.expiresAt<new Date)throw await t.context.internalAdapter.deleteVerificationValue(s.id),t.redirect(`${o}?error=EXPIRED_TOKEN`);await t.context.internalAdapter.deleteVerificationValue(s.id);let{email:a,name:d}=JSON.parse(s.value),l=await t.context.internalAdapter.findUserByEmail(a).then(e=>e?.user);if(!l){if(e.disableSignUp)throw t.redirect(`${o}?error=failed_to_create_user`);else if(!(l=await t.context.internalAdapter.createUser({email:a,emailVerified:!0,name:d||""},t)))throw t.redirect(`${o}?error=failed_to_create_user`)}l.emailVerified||await t.context.internalAdapter.updateUser(l.id,{emailVerified:!0},t);let c=await t.context.internalAdapter.createSession(l.id,t);if(!c)throw t.redirect(`${o}?error=failed_to_create_session`);if(await (0,n.setSessionCookie)(t,{session:c,user:l}),!r)return t.json({token:c.token,user:{id:l.id,email:l.email,emailVerified:l.emailVerified,name:l.name,image:l.image,createdAt:l.createdAt,updatedAt:l.updatedAt}});throw t.redirect(r)})},rateLimit:[{pathMatcher:e=>e.startsWith("/sign-in/magic-link")||e.startsWith("/magic-link/verify"),window:e.rateLimit?.window||60,max:e.rateLimit?.max||5}]})}},592781:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({phoneNumber:()=>i}),e.i(243917);var r=e.i(81714),o=e.i(151176),s=e.i(311556),n=e.i(776569),a=e.i(382320),d=e.i(328902);e.i(105127),e.i(187615),e.i(306192);var l=e.i(692153);e.i(30483),e.i(137942),e.i(561336),e.i(483013),e.i(74222),e.i(533004),e.i(91997),e.i(771884),e.i(4887),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506);let t={INVALID_PHONE_NUMBER:"Invalid phone number",PHONE_NUMBER_EXIST:"Phone number already exist",INVALID_PHONE_NUMBER_OR_PASSWORD:"Invalid phone number or password",UNEXPECTED_ERROR:"Unexpected error",OTP_NOT_FOUND:"OTP not found",OTP_EXPIRED:"OTP expired",INVALID_OTP:"Invalid OTP",PHONE_NUMBER_NOT_VERIFIED:"Phone number not verified"};function c(e){return(0,a.g)(e,"0-9")}let i=e=>{let i={expiresIn:e?.expiresIn||300,otpLength:e?.otpLength||6,...e,phoneNumber:"phoneNumber",phoneNumberVerified:"phoneNumberVerified",code:"code",createdAt:"createdAt"};return{id:"phone-number",endpoints:{signInPhoneNumber:(0,o.a)("/sign-in/phone-number",{method:"POST",body:r.z.object({phoneNumber:r.z.string({description:"Phone number to sign in"}),password:r.z.string({description:"Password to use for sign in"}),rememberMe:r.z.boolean({description:"Remember the session"}).optional()}),metadata:{openapi:{summary:"Sign in with phone number",description:"Use this endpoint to sign in with phone number",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"},session:{$ref:"#/components/schemas/Session"}}}}}},400:{description:"Invalid phone number or password"}}}}},async e=>{let{password:r,phoneNumber:n}=e.body;if(i.phoneNumberValidator&&!await i.phoneNumberValidator(e.body.phoneNumber))throw new s.APIError("BAD_REQUEST",{message:t.INVALID_PHONE_NUMBER});let a=await e.context.adapter.findOne({model:"user",where:[{field:"phoneNumber",value:n}]});if(!a)throw new s.APIError("UNAUTHORIZED",{message:t.INVALID_PHONE_NUMBER_OR_PASSWORD});if(i.requireVerification&&!a.phoneNumberVerified){let r=c(i.otpLength);throw await e.context.internalAdapter.createVerificationValue({value:r,identifier:n,expiresAt:(0,l.g)(i.expiresIn,"sec")},e),await i.sendOTP?.({phoneNumber:n,code:r},e.request),new s.APIError("UNAUTHORIZED",{message:t.PHONE_NUMBER_NOT_VERIFIED})}let u=(await e.context.internalAdapter.findAccountByUserId(a.id)).find(e=>"credential"===e.providerId);if(!u)throw e.context.logger.error("Credential account not found",{phoneNumber:n}),new s.APIError("UNAUTHORIZED",{message:t.INVALID_PHONE_NUMBER_OR_PASSWORD});let p=u?.password;if(!p)throw e.context.logger.error("Password not found",{phoneNumber:n}),new s.APIError("UNAUTHORIZED",{message:t.UNEXPECTED_ERROR});if(!await e.context.password.verify({hash:p,password:r}))throw e.context.logger.error("Invalid password"),new s.APIError("UNAUTHORIZED",{message:t.INVALID_PHONE_NUMBER_OR_PASSWORD});let h=await e.context.internalAdapter.createSession(a.id,e,!1===e.body.rememberMe);if(!h)throw e.context.logger.error("Failed to create session"),new s.APIError("UNAUTHORIZED",{message:o.B.FAILED_TO_CREATE_SESSION});return await (0,d.setSessionCookie)(e,{session:h,user:a},!1===e.body.rememberMe),e.json({token:h.token,user:{id:a.id,email:a.email,emailVerified:a.emailVerified,name:a.name,image:a.image,phoneNumber:a.phoneNumber,phoneNumberVerified:a.phoneNumberVerified,createdAt:a.createdAt,updatedAt:a.updatedAt}})}),sendPhoneNumberOTP:(0,o.a)("/phone-number/send-otp",{method:"POST",body:r.z.object({phoneNumber:r.z.string({description:"Phone number to send OTP"})}),metadata:{openapi:{summary:"Send OTP to phone number",description:"Use this endpoint to send OTP to phone number",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async r=>{if(!e?.sendOTP)throw r.context.logger.warn("sendOTP not implemented"),new s.APIError("NOT_IMPLEMENTED",{message:"sendOTP not implemented"});if(i.phoneNumberValidator&&!await i.phoneNumberValidator(r.body.phoneNumber))throw new s.APIError("BAD_REQUEST",{message:t.INVALID_PHONE_NUMBER});let o=c(i.otpLength);return await r.context.internalAdapter.createVerificationValue({value:`${o}:0`,identifier:r.body.phoneNumber,expiresAt:(0,l.g)(i.expiresIn,"sec")},r),await e.sendOTP({phoneNumber:r.body.phoneNumber,code:o},r.request),r.json({message:"code sent"})}),verifyPhoneNumber:(0,o.a)("/phone-number/verify",{method:"POST",body:r.z.object({phoneNumber:r.z.string({description:"Phone number to verify"}),code:r.z.string({description:"OTP code"}),disableSession:r.z.boolean({description:"Disable session creation after verification"}).optional(),updatePhoneNumber:r.z.boolean({description:"Check if there is a session and update the phone number"}).optional()}),metadata:{openapi:{summary:"Verify phone number",description:"Use this endpoint to verify phone number",responses:{200:{description:"Phone number verified successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the verification was successful",enum:[!0]},token:{type:"string",nullable:!0,description:"Session token if session is created, null if disableSession is true or no session is created"},user:{type:"object",nullable:!0,properties:{id:{type:"string",description:"Unique identifier of the user"},email:{type:"string",format:"email",nullable:!0,description:"User's email address"},emailVerified:{type:"boolean",nullable:!0,description:"Whether the email is verified"},name:{type:"string",nullable:!0,description:"User's name"},image:{type:"string",format:"uri",nullable:!0,description:"User's profile image URL"},phoneNumber:{type:"string",description:"User's phone number"},phoneNumberVerified:{type:"boolean",description:"Whether the phone number is verified"},createdAt:{type:"string",format:"date-time",description:"Timestamp when the user was created"},updatedAt:{type:"string",format:"date-time",description:"Timestamp when the user was last updated"}},required:["id","phoneNumber","phoneNumberVerified","createdAt","updatedAt"],description:"User object with phone number details, null if no user is created or found"}},required:["status"]}}}},400:{description:"Invalid OTP"}}}}},async r=>{let n=await r.context.internalAdapter.findVerificationValue(r.body.phoneNumber);if(!n||n.expiresAt<new Date){if(n&&n.expiresAt<new Date)throw new s.APIError("BAD_REQUEST",{message:"OTP expired"});throw new s.APIError("BAD_REQUEST",{message:t.OTP_NOT_FOUND})}let[a,l]=n.value.split(":"),c=e?.allowedAttempts||3;if(l&&parseInt(l)>=c)throw await r.context.internalAdapter.deleteVerificationValue(n.id),new s.APIError("FORBIDDEN",{message:"Too many attempts"});if(a!==r.body.code)throw await r.context.internalAdapter.updateVerificationValue(n.id,{value:`${a}:${parseInt(l||"0")+1}`}),new s.APIError("BAD_REQUEST",{message:"Invalid OTP"});if(await r.context.internalAdapter.deleteVerificationValue(n.id),r.body.updatePhoneNumber){let e=await (0,o.g)(r);if(!e)throw new s.APIError("UNAUTHORIZED",{message:o.B.USER_NOT_FOUND});if((await r.context.adapter.findMany({model:"user",where:[{field:"phoneNumber",value:r.body.phoneNumber}]})).length)throw r.error("BAD_REQUEST",{message:t.PHONE_NUMBER_EXIST});let n=await r.context.internalAdapter.updateUser(e.user.id,{[i.phoneNumber]:r.body.phoneNumber,[i.phoneNumberVerified]:!0},r);return r.json({status:!0,token:e.session.token,user:{id:n.id,email:n.email,emailVerified:n.emailVerified,name:n.name,image:n.image,phoneNumber:n.phoneNumber,phoneNumberVerified:n.phoneNumberVerified,createdAt:n.createdAt,updatedAt:n.updatedAt}})}let u=await r.context.adapter.findOne({model:"user",where:[{value:r.body.phoneNumber,field:i.phoneNumber}]});if(u)u=await r.context.internalAdapter.updateUser(u.id,{[i.phoneNumberVerified]:!0},r);else if(e?.signUpOnVerification&&!(u=await r.context.internalAdapter.createUser({email:e.signUpOnVerification.getTempEmail(r.body.phoneNumber),name:e.signUpOnVerification.getTempName?e.signUpOnVerification.getTempName(r.body.phoneNumber):r.body.phoneNumber,[i.phoneNumber]:r.body.phoneNumber,[i.phoneNumberVerified]:!0},r)))throw new s.APIError("INTERNAL_SERVER_ERROR",{message:o.B.FAILED_TO_CREATE_USER});if(!u)return r.json(null);if(await e?.callbackOnVerification?.({phoneNumber:r.body.phoneNumber,user:u},r.request),!u)throw new s.APIError("INTERNAL_SERVER_ERROR",{message:o.B.FAILED_TO_UPDATE_USER});if(!r.body.disableSession){let e=await r.context.internalAdapter.createSession(u.id,r);if(!e)throw new s.APIError("INTERNAL_SERVER_ERROR",{message:o.B.FAILED_TO_CREATE_SESSION});return await (0,d.setSessionCookie)(r,{session:e,user:u}),r.json({status:!0,token:e.token,user:{id:u.id,email:u.email,emailVerified:u.emailVerified,name:u.name,image:u.image,phoneNumber:u.phoneNumber,phoneNumberVerified:u.phoneNumberVerified,createdAt:u.createdAt,updatedAt:u.updatedAt}})}return r.json({status:!0,token:null,user:{id:u.id,email:u.email,emailVerified:u.emailVerified,name:u.name,image:u.image,phoneNumber:u.phoneNumber,phoneNumberVerified:u.phoneNumberVerified,createdAt:u.createdAt,updatedAt:u.updatedAt}})}),forgetPasswordPhoneNumber:(0,o.a)("/phone-number/forget-password",{method:"POST",body:r.z.object({phoneNumber:r.z.string()}),metadata:{openapi:{description:"Request OTP for password reset via phone number",responses:{200:{description:"OTP sent successfully for password reset",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the OTP was sent successfully",enum:[!0]}},required:["status"]}}}}}}}},async t=>{if(!await t.context.adapter.findOne({model:"user",where:[{value:t.body.phoneNumber,field:i.phoneNumber}]}))throw new s.APIError("BAD_REQUEST",{message:"phone number isn't registered"});let r=c(i.otpLength);return await t.context.internalAdapter.createVerificationValue({value:`${r}:0`,identifier:`${t.body.phoneNumber}-forget-password`,expiresAt:(0,l.g)(i.expiresIn,"sec")},t),await e?.sendForgetPasswordOTP?.({phoneNumber:t.body.phoneNumber,code:r},t.request),t.json({status:!0})}),resetPasswordPhoneNumber:(0,o.a)("/phone-number/reset-password",{method:"POST",body:r.z.object({otp:r.z.string(),phoneNumber:r.z.string(),newPassword:r.z.string()}),metadata:{openapi:{description:"Reset password using phone number OTP",responses:{200:{description:"Password reset successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the password was reset successfully",enum:[!0]}},required:["status"]}}}}}}}},async i=>{let r=await i.context.internalAdapter.findVerificationValue(`${i.body.phoneNumber}-forget-password`);if(!r)throw new s.APIError("BAD_REQUEST",{message:t.OTP_NOT_FOUND});if(r.expiresAt<new Date)throw new s.APIError("BAD_REQUEST",{message:t.OTP_EXPIRED});let[o,n]=r.value.split(":"),a=e?.allowedAttempts||3;if(n&&parseInt(n)>=a)throw await i.context.internalAdapter.deleteVerificationValue(r.id),new s.APIError("FORBIDDEN",{message:"Too many attempts"});if(i.body.otp!==o)throw await i.context.internalAdapter.updateVerificationValue(r.id,{value:`${o}:${parseInt(n||"0")+1}`}),new s.APIError("BAD_REQUEST",{message:t.INVALID_OTP});let d=await i.context.adapter.findOne({model:"user",where:[{field:"phoneNumber",value:i.body.phoneNumber}]});if(!d)throw new s.APIError("BAD_REQUEST",{message:t.UNEXPECTED_ERROR});let l=await i.context.password.hash(i.body.newPassword);return await i.context.internalAdapter.updatePassword(d.id,l),i.json({status:!0})})},schema:(0,n.m)(u,e?.schema),rateLimit:[{pathMatcher:e=>e.startsWith("/phone-number"),window:6e4,max:10}],$ERROR_CODES:t}},u={user:{fields:{phoneNumber:{type:"string",required:!1,unique:!0,sortable:!0,returned:!0},phoneNumberVerified:{type:"boolean",required:!1,returned:!0,input:!1}}}}}},323238:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({anonymous:()=>i});var r=e.i(311556),o=e.i(151176);e.i(243917);var s=e.i(328902),n=e.i(776569);e.i(105127),e.i(187615),e.i(306192);var a=e.i(664764);e.i(30483),e.i(137942),e.i(561336),e.i(483013),e.i(692153),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(771884),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(504506);let t={user:{fields:{isAnonymous:{type:"boolean",required:!1}}}},i=e=>{let i={FAILED_TO_CREATE_USER:"Failed to create user",COULD_NOT_CREATE_SESSION:"Could not create session",ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY:"Anonymous users cannot sign in again anonymously"};return{id:"anonymous",endpoints:{signInAnonymous:(0,o.a)("/sign-in/anonymous",{method:"POST",metadata:{openapi:{description:"Sign in anonymously",responses:{200:{description:"Sign in anonymously",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"},session:{$ref:"#/components/schemas/Session"}}}}}}}}}},async t=>{let{emailDomainName:r=(0,a.g)(t.context.baseURL)}=e||{},o=t.context.generateId({model:"user"}),n=`temp-${o}@${r}`,d=e?.generateName?.(t)||"Anonymous",l=await t.context.internalAdapter.createUser({email:n,emailVerified:!1,isAnonymous:!0,name:d,createdAt:new Date,updatedAt:new Date},t);if(!l)throw t.error("INTERNAL_SERVER_ERROR",{message:i.FAILED_TO_CREATE_USER});let c=await t.context.internalAdapter.createSession(l.id,t);return c?(await (0,s.setSessionCookie)(t,{session:c,user:l}),t.json({token:c.token,user:{id:l.id,email:l.email,emailVerified:l.emailVerified,name:l.name,createdAt:l.createdAt,updatedAt:l.updatedAt}})):t.json(null,{status:400,body:{message:i.COULD_NOT_CREATE_SESSION}})})},hooks:{after:[{matcher:e=>e.path.startsWith("/sign-in")||e.path.startsWith("/sign-up")||e.path.startsWith("/callback")||e.path.startsWith("/oauth2/callback")||e.path.startsWith("/magic-link/verify")||e.path.startsWith("/email-otp/verify-email"),handler:(0,o.c)(async t=>{let n=t.context.responseHeaders?.get("set-cookie"),a=t.context.authCookies.sessionToken.name;if(!(0,s.parseSetCookieHeader)(n||"").get(a)?.value.split(".")[0])return;let d=await (0,o.g)(t,{disableRefresh:!0});if(!d||!d.user.isAnonymous)return;if("/sign-in/anonymous"===t.path)throw new r.APIError("BAD_REQUEST",{message:i.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY});let l=t.context.newSession;l&&(e?.onLinkAccount&&await e?.onLinkAccount?.({anonymousUser:d,newUser:l}),e?.disableDeleteAnonymousUser||await t.context.internalAdapter.deleteUser(d.user.id))})}]},schema:(0,n.m)(t,e?.schema),$ERROR_CODES:i}}}},82131:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({g:()=>t});var r=e.i(311556);let t=async e=>{let t=e.context.returned;return t?t instanceof Response?200!==t.status?null:await t.clone().json():t instanceof r.APIError?null:t:null}}},39543:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({adminAc:()=>o,defaultAc:()=>i,defaultRoles:()=>n,defaultStatements:()=>t,userAc:()=>s});var r=e.i(152967);e.i(771884);let t={user:["create","list","set-role","ban","impersonate","delete","set-password"],session:["list","revoke","delete"]},i=(0,r.createAccessControl)(t),o=i.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password"],session:["list","revoke","delete"]}),s=i.newRole({user:[],session:[]}),n={admin:o,user:s}}},234901:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({h:()=>t});var r=e.i(39543);let t=e=>{if(e.userId&&e.options?.adminUserIds?.includes(e.userId))return!0;if(!e.permissions&&!e.permission)return!1;let t=(e.role||e.options?.defaultRole||"user").split(","),i=e.options?.roles||r.defaultRoles;for(let r of t){let t=i[r],o=t?.authorize(e.permission??e.permissions);if(o?.success)return!0}return!1}}},587217:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({a:()=>i}),e.i(243917);var r=e.i(81714),o=e.i(311556),s=e.i(151176),n=e.i(328902),a=e.i(776569);e.i(105127),e.i(187615),e.i(306192);var d=e.i(692153),l=e.i(82131),c=e.i(234901);let t={FAILED_TO_CREATE_USER:"Failed to create user",USER_ALREADY_EXISTS:"User already exists",YOU_CANNOT_BAN_YOURSELF:"You cannot ban yourself",YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE:"You are not allowed to change users role",YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS:"You are not allowed to create users",YOU_ARE_NOT_ALLOWED_TO_LIST_USERS:"You are not allowed to list users",YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS:"You are not allowed to list users sessions",YOU_ARE_NOT_ALLOWED_TO_BAN_USERS:"You are not allowed to ban users",YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS:"You are not allowed to impersonate users",YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS:"You are not allowed to revoke users sessions",YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS:"You are not allowed to delete users",YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD:"You are not allowed to set users password",BANNED_USER:"You have been banned from this application"};function u(e){return Array.isArray(e)?e.join(","):e}let i=e=>{let i={defaultRole:e?.defaultRole??"user",adminRoles:e?.adminRoles??["admin"],bannedUserMessage:e?.bannedUserMessage??"You have been banned from this application. Please contact support if you believe this is an error.",...e},h=(0,s.c)(async e=>{let t=await (0,s.g)(e);if(!t)throw new o.APIError("UNAUTHORIZED");return{session:t}});return{id:"admin",init:()=>({options:{databaseHooks:{user:{create:{before:async t=>({data:{role:e?.defaultRole??"user",...t}})}},session:{create:{async before(e,t){if(!t)return;let r=await t.context.internalAdapter.findUserById(e.userId);if(r.banned){if(r.banExpires&&r.banExpires.getTime()<Date.now())return void await t.context.internalAdapter.updateUser(e.userId,{banned:!1,banReason:null,banExpires:null});if(t&&(t.path.startsWith("/callback")||t.path.startsWith("/oauth2/callback"))){let e=t.context.options.onAPIError?.errorURL||`${t.context.baseURL}/error`;throw t.redirect(`${e}?error=banned&error_description=${i.bannedUserMessage}`)}throw new o.APIError("FORBIDDEN",{message:i.bannedUserMessage,code:"BANNED_USER"})}}}}}}}),hooks:{after:[{matcher:e=>"/list-sessions"===e.path,handler:(0,s.c)(async e=>{let t=await (0,l.g)(e);if(!t)return;let i=t.filter(e=>!e.impersonatedBy);return e.json(i)})}]},endpoints:{setRole:(0,s.a)("/admin/set-role",{method:"POST",body:r.z.object({userId:r.z.coerce.string({description:"The user id"}),role:r.z.union([r.z.string({description:"The role to set. `admin` or `user` by default"}),r.z.array(r.z.string({description:"The roles to set. `admin` or `user` by default"}))])}),use:[h],metadata:{openapi:{operationId:"setRole",summary:"Set the role of a user",description:"Set the role of a user",responses:{200:{description:"User role updated",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},async e=>{if(!(0,c.h)({userId:e.context.session.user.id,role:e.context.session.user.role,options:i,permissions:{user:["set-role"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE});let r=await e.context.internalAdapter.updateUser(e.body.userId,{role:u(e.body.role)},e);return e.json({user:r})}),createUser:(0,s.a)("/admin/create-user",{method:"POST",body:r.z.object({email:r.z.string({description:"The email of the user"}),password:r.z.string({description:"The password of the user"}),name:r.z.string({description:"The name of the user"}),role:r.z.union([r.z.string({description:"The role of the user"}),r.z.array(r.z.string({description:"The roles of user"}))]).optional(),data:r.z.optional(r.z.record(r.z.any(),{description:"Extra fields for the user. Including custom additional fields."}))}),metadata:{openapi:{operationId:"createUser",summary:"Create a new user",description:"Create a new user",responses:{200:{description:"User created",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},async r=>{let n=await (0,s.g)(r);if(!n&&(r.request||r.headers))throw r.error("UNAUTHORIZED");if(n&&!(0,c.h)({userId:n.user.id,role:n.user.role,options:i,permissions:{user:["create"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS});if(await r.context.internalAdapter.findUserByEmail(r.body.email))throw new o.APIError("BAD_REQUEST",{message:t.USER_ALREADY_EXISTS});let a=await r.context.internalAdapter.createUser({email:r.body.email,name:r.body.name,role:(r.body.role&&u(r.body.role))??e?.defaultRole??"user",...r.body.data});if(!a)throw new o.APIError("INTERNAL_SERVER_ERROR",{message:t.FAILED_TO_CREATE_USER});let d=await r.context.password.hash(r.body.password);return await r.context.internalAdapter.linkAccount({accountId:a.id,providerId:"credential",password:d,userId:a.id},r),r.json({user:a})}),listUsers:(0,s.a)("/admin/list-users",{method:"GET",use:[h],query:r.z.object({searchValue:r.z.string({description:"The value to search for"}).optional(),searchField:r.z.enum(["email","name"],{description:"The field to search in, defaults to email. Can be `email` or `name`"}).optional(),searchOperator:r.z.enum(["contains","starts_with","ends_with"],{description:"The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`"}).optional(),limit:r.z.string({description:"The number of users to return"}).or(r.z.number()).optional(),offset:r.z.string({description:"The offset to start from"}).or(r.z.number()).optional(),sortBy:r.z.string({description:"The field to sort by"}).optional(),sortDirection:r.z.enum(["asc","desc"],{description:"The direction to sort by"}).optional(),filterField:r.z.string({description:"The field to filter by"}).optional(),filterValue:r.z.string({description:"The value to filter by"}).or(r.z.number()).or(r.z.boolean()).optional(),filterOperator:r.z.enum(["eq","ne","lt","lte","gt","gte"],{description:"The operator to use for the filter"}).optional()}),metadata:{openapi:{operationId:"listUsers",summary:"List users",description:"List users",responses:{200:{description:"List of users",content:{"application/json":{schema:{type:"object",properties:{users:{type:"array",items:{$ref:"#/components/schemas/User"}},total:{type:"number"},limit:{type:"number"},offset:{type:"number"}},required:["users","total"]}}}}}}}},async e=>{let r=e.context.session;if(!(0,c.h)({userId:e.context.session.user.id,role:r.user.role,options:i,permissions:{user:["list"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS});let s=[];e.query?.searchValue&&s.push({field:e.query.searchField||"email",operator:e.query.searchOperator||"contains",value:e.query.searchValue}),e.query?.filterValue&&s.push({field:e.query.filterField||"email",operator:e.query.filterOperator||"eq",value:e.query.filterValue});try{let t=await e.context.internalAdapter.listUsers(Number(e.query?.limit)||void 0,Number(e.query?.offset)||void 0,e.query?.sortBy?{field:e.query.sortBy,direction:e.query.sortDirection||"asc"}:void 0,s.length?s:void 0),i=await e.context.internalAdapter.countTotalUsers(s.length?s:void 0);return e.json({users:t,total:i,limit:Number(e.query?.limit)||void 0,offset:Number(e.query?.offset)||void 0})}catch(t){return e.json({users:[],total:0})}}),listUserSessions:(0,s.a)("/admin/list-user-sessions",{method:"POST",use:[h],body:r.z.object({userId:r.z.coerce.string({description:"The user id"})}),metadata:{openapi:{operationId:"listUserSessions",summary:"List user sessions",description:"List user sessions",responses:{200:{description:"List of user sessions",content:{"application/json":{schema:{type:"object",properties:{sessions:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}}}},async e=>{let r=e.context.session;if(!(0,c.h)({userId:e.context.session.user.id,role:r.user.role,options:i,permissions:{session:["list"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS});return{sessions:await e.context.internalAdapter.listSessions(e.body.userId)}}),unbanUser:(0,s.a)("/admin/unban-user",{method:"POST",body:r.z.object({userId:r.z.coerce.string({description:"The user id"})}),use:[h],metadata:{openapi:{operationId:"unbanUser",summary:"Unban a user",description:"Unban a user",responses:{200:{description:"User unbanned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{let r=e.context.session;if(!(0,c.h)({userId:e.context.session.user.id,role:r.user.role,options:i,permissions:{user:["ban"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS});let s=await e.context.internalAdapter.updateUser(e.body.userId,{banned:!1,banExpires:null,banReason:null,updatedAt:new Date});return e.json({user:s})}),banUser:(0,s.a)("/admin/ban-user",{method:"POST",body:r.z.object({userId:r.z.coerce.string({description:"The user id"}),banReason:r.z.string({description:"The reason for the ban"}).optional(),banExpiresIn:r.z.number({description:"The number of seconds until the ban expires"}).optional()}),use:[h],metadata:{openapi:{operationId:"banUser",summary:"Ban a user",description:"Ban a user",responses:{200:{description:"User banned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async r=>{let s=r.context.session;if(!(0,c.h)({userId:r.context.session.user.id,role:s.user.role,options:i,permissions:{user:["ban"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS});if(r.body.userId===r.context.session.user.id)throw new o.APIError("BAD_REQUEST",{message:t.YOU_CANNOT_BAN_YOURSELF});let n=await r.context.internalAdapter.updateUser(r.body.userId,{banned:!0,banReason:r.body.banReason||e?.defaultBanReason||"No reason",banExpires:r.body.banExpiresIn?(0,d.g)(r.body.banExpiresIn,"sec"):e?.defaultBanExpiresIn?(0,d.g)(e.defaultBanExpiresIn,"sec"):void 0,updatedAt:new Date},r);return await r.context.internalAdapter.deleteSessions(r.body.userId),r.json({user:n})}),impersonateUser:(0,s.a)("/admin/impersonate-user",{method:"POST",body:r.z.object({userId:r.z.coerce.string({description:"The user id"})}),use:[h],metadata:{openapi:{operationId:"impersonateUser",summary:"Impersonate a user",description:"Impersonate a user",responses:{200:{description:"Impersonation session created",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}}}},async r=>{if(!(0,c.h)({userId:r.context.session.user.id,role:r.context.session.user.role,options:i,permissions:{user:["impersonate"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS});let s=await r.context.internalAdapter.findUserById(r.body.userId);if(!s)throw new o.APIError("NOT_FOUND",{message:"User not found"});let a=await r.context.internalAdapter.createSession(s.id,r,!0,{impersonatedBy:r.context.session.user.id,expiresAt:e?.impersonationSessionDuration?(0,d.g)(e.impersonationSessionDuration,"sec"):(0,d.g)(3600,"sec")},!0);if(!a)throw new o.APIError("INTERNAL_SERVER_ERROR",{message:t.FAILED_TO_CREATE_USER});let l=r.context.authCookies;(0,n.deleteSessionCookie)(r);let u=await r.getSignedCookie(r.context.authCookies.dontRememberToken.name,r.context.secret);return await r.setSignedCookie("admin_session",`${r.context.session.session.token}:${u||""}`,r.context.secret,l.sessionToken.options),await (0,n.setSessionCookie)(r,{session:a,user:s},!0),r.json({session:a,user:s})}),stopImpersonating:(0,s.a)("/admin/stop-impersonating",{method:"POST"},async e=>{let t=await (0,s.g)(e);if(!t)throw new o.APIError("UNAUTHORIZED");if(!t.session.impersonatedBy)throw new o.APIError("BAD_REQUEST",{message:"You are not impersonating anyone"});let i=await e.context.internalAdapter.findUserById(t.session.impersonatedBy);if(!i)throw new o.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to find user"});let r=await e.getSignedCookie("admin_session",e.context.secret);if(!r)throw new o.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});let[a,d]=r?.split(":"),l=await e.context.internalAdapter.findSession(a);if(!l||l.session.userId!==i.id)throw new o.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});return await e.context.internalAdapter.deleteSession(t.session.token),await (0,n.setSessionCookie)(e,l,!!d),e.json(l)}),revokeUserSession:(0,s.a)("/admin/revoke-user-session",{method:"POST",body:r.z.object({sessionToken:r.z.string({description:"The session token"})}),use:[h],metadata:{openapi:{operationId:"revokeUserSession",summary:"Revoke a user session",description:"Revoke a user session",responses:{200:{description:"Session revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let r=e.context.session;if(!(0,c.h)({userId:e.context.session.user.id,role:r.user.role,options:i,permissions:{session:["revoke"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS});return await e.context.internalAdapter.deleteSession(e.body.sessionToken),e.json({success:!0})}),revokeUserSessions:(0,s.a)("/admin/revoke-user-sessions",{method:"POST",body:r.z.object({userId:r.z.coerce.string({description:"The user id"})}),use:[h],metadata:{openapi:{operationId:"revokeUserSessions",summary:"Revoke all user sessions",description:"Revoke all user sessions",responses:{200:{description:"Sessions revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let r=e.context.session;if(!(0,c.h)({userId:e.context.session.user.id,role:r.user.role,options:i,permissions:{session:["revoke"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS});return await e.context.internalAdapter.deleteSessions(e.body.userId),e.json({success:!0})}),removeUser:(0,s.a)("/admin/remove-user",{method:"POST",body:r.z.object({userId:r.z.coerce.string({description:"The user id"})}),use:[h],metadata:{openapi:{operationId:"removeUser",summary:"Remove a user",description:"Delete a user and all their sessions and accounts. Cannot be undone.",responses:{200:{description:"User removed",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let r=e.context.session;if(!(0,c.h)({userId:e.context.session.user.id,role:r.user.role,options:i,permissions:{user:["delete"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS});return await e.context.internalAdapter.deleteUser(e.body.userId),e.json({success:!0})}),setUserPassword:(0,s.a)("/admin/set-user-password",{method:"POST",body:r.z.object({newPassword:r.z.string({description:"The new password"}),userId:r.z.coerce.string({description:"The user id"})}),use:[h],metadata:{openapi:{operationId:"setUserPassword",summary:"Set a user's password",description:"Set a user's password",responses:{200:{description:"Password set",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{if(!(0,c.h)({userId:e.context.session.user.id,role:e.context.session.user.role,options:i,permissions:{user:["set-password"]}}))throw new o.APIError("FORBIDDEN",{message:t.YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD});let r=await e.context.password.hash(e.body.newPassword);return await e.context.internalAdapter.updatePassword(e.body.userId,r),e.json({status:!0})}),userHasPermission:(0,s.a)("/admin/has-permission",{method:"POST",body:r.z.object({userId:r.z.coerce.string().optional(),role:r.z.string().optional()}).and(r.z.union([r.z.object({permission:r.z.record(r.z.string(),r.z.array(r.z.string())),permissions:r.z.undefined()}),r.z.object({permission:r.z.undefined(),permissions:r.z.record(r.z.string(),r.z.array(r.z.string()))})])),metadata:{openapi:{description:"Check if the user has permission",requestBody:{content:{"application/json":{schema:{type:"object",properties:{permission:{type:"object",description:"The permission to check",deprecated:!0},permissions:{type:"object",description:"The permission to check"}},required:["permissions"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{error:{type:"string"},success:{type:"boolean"}},required:["success"]}}}}}},$Infer:{body:{}}}},async t=>{if(!t.body?.permission&&!t.body?.permissions)throw new o.APIError("BAD_REQUEST",{message:"invalid permission check. no permission(s) were passed."});let i=await (0,s.g)(t);if(!i&&(t.request||t.headers)&&!t.body.userId&&!t.body.role)throw new o.APIError("UNAUTHORIZED");let r=i?.user||await t.context.internalAdapter.findUserById(t.body.userId)||(t.body.role?{id:"",role:t.body.role}:null);if(!r)throw new o.APIError("BAD_REQUEST",{message:"user not found"});let n=(0,c.h)({userId:r.id,role:r.role,options:e,permissions:t.body.permissions??t.body.permission});return t.json({error:null,success:n})})},$ERROR_CODES:t,schema:(0,a.m)(p,i.schema)}},p={user:{fields:{role:{type:"string",required:!1,input:!1},banned:{type:"boolean",defaultValue:!1,required:!1,input:!1},banReason:{type:"string",required:!1,input:!1},banExpires:{type:"date",required:!1,input:!1}}},session:{fields:{impersonatedBy:{type:"string",required:!1}}}}}},871487:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({genericOAuth:()=>t});var r=e.i(137942),o=e.i(311556),s=e.i(553871);e.i(243917);var n=e.i(81714),a=e.i(151176),d=e.i(328902);e.i(776569),e.i(105127),e.i(187615),e.i(306192);var l=e.i(561336);e.i(74222),e.i(483013);var c=e.i(692218);async function u(e,t){if(e.idToken){let t=(0,s.decodeJwt)(e.idToken);if(t&&t.sub&&t.email)return{id:t.sub,emailVerified:t.email_verified,image:t.picture,...t}}if(!t)return null;let i=await (0,r.betterFetch)(t,{method:"GET",headers:{Authorization:`Bearer ${e.accessToken}`}});return{id:i.data?.sub,emailVerified:i.data?.email_verified,email:i.data?.email,image:i.data?.picture,name:i.data?.name,...i.data}}e.i(30483),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(771884),e.i(316944),e.i(692153),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506);let t=e=>{let t={INVALID_OAUTH_CONFIGURATION:"Invalid OAuth configuration"};return{id:"generic-oauth",init:t=>({context:{socialProviders:e.config.map(e=>{let i=e.userInfoUrl;return{id:e.providerId,name:e.providerId,createAuthorizationURL:i=>(0,l.c)({id:e.providerId,options:{clientId:e.clientId,clientSecret:e.clientSecret,redirectURI:e.redirectURI},authorizationEndpoint:e.authorizationUrl,state:i.state,codeVerifier:e.pkce?i.codeVerifier:void 0,scopes:e.scopes||[],redirectURI:`${t.baseURL}/oauth2/callback/${e.providerId}`}),async validateAuthorizationCode(t){let s=e.tokenUrl;if(e.discoveryUrl){let t=await (0,r.betterFetch)(e.discoveryUrl,{method:"GET",headers:e.discoveryHeaders});t.data&&(s=t.data.token_endpoint,i=t.data.userinfo_endpoint)}if(!s)throw new o.APIError("BAD_REQUEST",{message:"Invalid OAuth configuration. Token URL not found."});return(0,l.v)({headers:e.authorizationHeaders,code:t.code,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI,options:{clientId:e.clientId,clientSecret:e.clientSecret,redirectURI:e.redirectURI},tokenEndpoint:s})},async refreshAccessToken(t){let i=e.tokenUrl;if(e.discoveryUrl){let t=await (0,r.betterFetch)(e.discoveryUrl,{method:"GET",headers:e.discoveryHeaders});t.data&&(i=t.data.token_endpoint)}if(!i)throw new o.APIError("BAD_REQUEST",{message:"Invalid OAuth configuration. Token URL not found."});return(0,l.r)({refreshToken:t,options:{clientId:e.clientId,clientSecret:e.clientSecret},authentication:e.authentication,tokenEndpoint:i})},async getUserInfo(t){let r=e.getUserInfo?await e.getUserInfo(t):await u(t,i);return r?{user:{id:r?.id,email:r?.email,emailVerified:r?.emailVerified,image:r?.image,name:r?.name,...e.mapProfileToUser?.(r)},data:r}:null}}}).concat(t.socialProviders)}}),endpoints:{signInWithOAuth2:(0,a.a)("/sign-in/oauth2",{method:"POST",body:n.z.object({providerId:n.z.string({description:"The provider ID for the OAuth provider"}),callbackURL:n.z.string({description:"The URL to redirect to after sign in"}).optional(),errorCallbackURL:n.z.string({description:"The URL to redirect to if an error occurs"}).optional(),newUserCallbackURL:n.z.string({description:"The URL to redirect to after login if the user is new"}).optional(),disableRedirect:n.z.boolean({description:"Disable redirect"}).optional(),scopes:n.z.array(n.z.string(),{message:"Scopes to be passed to the provider authorization request."}).optional(),requestSignUp:n.z.boolean({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional()}),metadata:{openapi:{description:"Sign in with OAuth2",responses:{200:{description:"Sign in with OAuth2",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string"},redirect:{type:"boolean"}}}}}}}}}},async i=>{let{providerId:s}=i.body,n=e.config.find(e=>e.providerId===s);if(!n)throw new o.APIError("BAD_REQUEST",{message:`No config found for provider ${s}`});let{discoveryUrl:a,authorizationUrl:d,tokenUrl:u,clientId:p,clientSecret:h,scopes:m,redirectURI:f,responseType:A,pkce:g,prompt:y,accessType:K,authorizationUrlParams:w,responseMode:v,authentication:b}=n,_=d,N=u;if(a){let e=await (0,r.betterFetch)(a,{method:"GET",headers:n.discoveryHeaders,onError(e){i.context.logger.error(e.error.message,e.error,{discoveryUrl:a})}});e.data&&(_=e.data.authorization_endpoint,N=e.data.token_endpoint)}if(!_||!N)throw new o.APIError("BAD_REQUEST",{message:t.INVALID_OAUTH_CONFIGURATION});if(w){let e=new URL(_);for(let[t,i]of Object.entries(w))e.searchParams.set(t,i);_=e.toString()}let{state:I,codeVerifier:E}=await (0,c.g)(i),T=await (0,l.c)({id:s,options:{clientId:p,redirectURI:f},authorizationEndpoint:_,state:I,codeVerifier:g?E:void 0,scopes:i.body.scopes?[...i.body.scopes,...m||[]]:m||[],redirectURI:`${i.context.baseURL}/oauth2/callback/${s}`,prompt:y,accessType:K,responseType:A,responseMode:v,additionalParams:w});return i.json({url:T.toString(),redirect:!i.body.disableRedirect})}),oAuth2Callback:(0,a.a)("/oauth2/callback/:providerId",{method:"GET",query:n.z.object({code:n.z.string({description:"The OAuth2 code"}).optional(),error:n.z.string({description:"The error message, if any"}).optional(),error_description:n.z.string({description:"The error description, if any"}).optional(),state:n.z.string({description:"The state parameter from the OAuth2 request"}).optional()}),metadata:{openapi:{description:"OAuth2 callback",responses:{200:{description:"OAuth2 callback",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string"}}}}}}}}}},async t=>{let i,s,n=t.context.options.onAPIError?.errorURL||`${t.context.baseURL}/error`;if(t.query.error||!t.query.code)throw t.redirect(`${n}?error=${t.query.error||"oAuth_code_missing"}&error_description=${t.query.error_description}`);let p=e.config.find(e=>e.providerId===t.params.providerId);if(!p)throw new o.APIError("BAD_REQUEST",{message:`No config found for provider ${t.params.providerId}`});let{callbackURL:h,codeVerifier:m,errorURL:f,requestSignUp:A,newUserURL:g,link:y}=await (0,c.p)(t),K=t.query.code;function w(e){let i=t.context.options.onAPIError?.errorURL||`${t.context.baseURL}/error`;throw t.redirect(`${f||i}?error=${e}`)}let v=p.tokenUrl,b=p.userInfoUrl;if(p.discoveryUrl){let e=await (0,r.betterFetch)(p.discoveryUrl,{method:"GET",headers:p.discoveryHeaders});e.data&&(v=e.data.token_endpoint,b=e.data.userinfo_endpoint)}try{if(!v)throw new o.APIError("BAD_REQUEST",{message:"Invalid OAuth configuration."});s=await (0,l.v)({headers:p.authorizationHeaders,code:K,codeVerifier:p.pkce?m:void 0,redirectURI:`${t.context.baseURL}/oauth2/callback/${p.providerId}`,options:{clientId:p.clientId,clientSecret:p.clientSecret,redirectURI:p.redirectURI},tokenEndpoint:v,authentication:p.authentication})}catch(e){throw t.context.logger.error(e&&"object"==typeof e&&"name"in e?e.name:"",e),w("oauth_code_verification_failed")}if(!s)throw new o.APIError("BAD_REQUEST",{message:"Invalid OAuth configuration."});let _=p.getUserInfo?await p.getUserInfo(s):await u(s,b);if(!_)throw w("user_info_is_missing");let N=p.mapProfileToUser?await p.mapProfileToUser(_):_;if(!N?.email)throw t.context.logger.error("Unable to get user info",_),w("email_is_missing");if(y){let e;if(t.context.options.account?.accountLinking?.allowDifferentEmails!==!0&&y.email!==N.email.toLowerCase())return w("email_doesn't_match");let i=await t.context.internalAdapter.findAccountByProviderId(_.id,p.providerId);if(i){if(i.userId!==y.userId)return w("account_already_linked_to_different_user");let e=Object.fromEntries(Object.entries({accessToken:s.accessToken,idToken:s.idToken,refreshToken:s.refreshToken,accessTokenExpiresAt:s.accessTokenExpiresAt,refreshTokenExpiresAt:s.refreshTokenExpiresAt,scope:s.scopes?.join(",")}).filter(([e,t])=>void 0!==t));await t.context.internalAdapter.updateAccount(i.id,e)}else if(!await t.context.internalAdapter.createAccount({userId:y.userId,providerId:p.providerId,accountId:_.id,accessToken:s.accessToken,accessTokenExpiresAt:s.accessTokenExpiresAt,refreshTokenExpiresAt:s.refreshTokenExpiresAt,scope:s.scopes?.join(","),refreshToken:s.refreshToken,idToken:s.idToken}))return w("unable_to_link_account");try{e=h.toString()}catch{e=h}throw t.redirect(e)}let I=await (0,a.h)(t,{userInfo:{..._,...N},account:{providerId:p.providerId,accountId:_.id,...s,scope:s.scopes?.join(",")},disableSignUp:p.disableImplicitSignUp&&!A||p.disableSignUp,overrideUserInfo:p.overrideUserInfo});if(I.error)return w(I.error.split(" ").join("_"));let{session:E,user:T}=I.data;await (0,d.setSessionCookie)(t,{session:E,user:T});try{i=(I.isRegister&&g||h).toString()}catch{i=I.isRegister&&g||h}throw t.redirect(i)}),oAuth2LinkAccount:(0,a.a)("/oauth2/link",{method:"POST",body:n.z.object({providerId:n.z.string(),callbackURL:n.z.string()}),use:[a.s],metadata:{openapi:{description:"Link an OAuth2 account to the current user session",responses:{200:{description:"Authorization URL generated successfully for linking an OAuth2 account",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",format:"uri",description:"The authorization URL to redirect the user to for linking the OAuth2 account"},redirect:{type:"boolean",description:"Indicates that the client should redirect to the provided URL",enum:[!0]}},required:["url","redirect"]}}}}}}}},async i=>{let s=i.context.session,n=e.config.find(e=>e.providerId===i.body.providerId);if(!n)throw new o.APIError("NOT_FOUND",{message:a.B.PROVIDER_NOT_FOUND});let{providerId:d,clientId:u,clientSecret:p,redirectURI:h,authorizationUrl:m,discoveryUrl:f,pkce:A,scopes:g,prompt:y,accessType:K,authorizationUrlParams:w}=n,v=m;if(!v){if(!f)throw new o.APIError("BAD_REQUEST",{message:t.INVALID_OAUTH_CONFIGURATION});let e=await (0,r.betterFetch)(f,{method:"GET",headers:n.discoveryHeaders,onError(e){i.context.logger.error(e.error.message,e.error,{discoveryUrl:f})}});e.data&&(v=e.data.authorization_endpoint)}if(!v)throw new o.APIError("BAD_REQUEST",{message:t.INVALID_OAUTH_CONFIGURATION});let b=await (0,c.g)(i,{userId:s.user.id,email:s.user.email}),_=await (0,l.c)({id:d,options:{clientId:u,redirectURI:h||`${i.context.baseURL}/oauth2/callback/${d}`},authorizationEndpoint:v,state:b.state,codeVerifier:A?b.codeVerifier:void 0,scopes:g||[],redirectURI:`${i.context.baseURL}/oauth2/callback/${d}`,prompt:y,accessType:K,additionalParams:w});return i.json({url:_.toString(),redirect:!0})})},$ERROR_CODES:t}}}},634882:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({s:()=>t}),e.i(243917);var r=e.i(81714);let t={jwks:{fields:{publicKey:{type:"string",required:!0},privateKey:{type:"string",required:!0},createdAt:{type:"date",required:!0}}}};r.z.object({id:r.z.string(),publicKey:r.z.string(),privateKey:r.z.string(),createdAt:r.z.date()})}},951779:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({default:()=>r.randomFillSync});var r=e.i(591032)},408960:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({generateKeyPair:()=>d,generateSecret:()=>a});var r=e.i(591032),o=e.i(936121),s=e.i(951779),n=e.i(83602);let t=(0,o.promisify)(r.generateKeyPair);async function a(e,t){let i;switch(e){case"HS256":case"HS384":case"HS512":case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":i=parseInt(e.slice(-3),10);break;case"A128KW":case"A192KW":case"A256KW":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":i=parseInt(e.slice(1,4),10);break;default:throw new n.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return(0,r.createSecretKey)((0,s.default)(new Uint8Array(i>>3)))}async function d(e,i){switch(e){case"RS256":case"RS384":case"RS512":case"PS256":case"PS384":case"PS512":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":case"RSA1_5":{let e=i?.modulusLength??2048;if("number"!=typeof e||e<2048)throw new n.JOSENotSupported("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return await t("rsa",{modulusLength:e,publicExponent:65537})}case"ES256":return t("ec",{namedCurve:"P-256"});case"ES256K":return t("ec",{namedCurve:"secp256k1"});case"ES384":return t("ec",{namedCurve:"P-384"});case"ES512":return t("ec",{namedCurve:"P-521"});case"Ed25519":return t("ed25519");case"EdDSA":switch(i?.crv){case void 0:case"Ed25519":return t("ed25519");case"Ed448":return t("ed448");default:throw new n.JOSENotSupported("Invalid or unsupported crv option provided, supported values are Ed25519 and Ed448")}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e=i?.crv??"P-256";switch(e){case void 0:case"P-256":case"P-384":case"P-521":return t("ec",{namedCurve:e});case"X25519":return t("x25519");case"X448":return t("x448");default:throw new n.JOSENotSupported("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}}default:throw new n.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}}}},272801:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({generateKeyPair:()=>o});var r=e.i(408960);async function o(e,t){return(0,r.generateKeyPair)(e,t)}},783957:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(591032),o=e.i(827210),s=e.i(83602),n=e.i(118533),a=e.i(1148),d=e.i(143048),l=e.i(23149);let t=e=>{let t;if((0,n.isCryptoKey)(e)){if(!e.extractable)throw TypeError("CryptoKey is not extractable");t=r.KeyObject.from(e)}else if((0,a.default)(e))t=e;else if(e instanceof Uint8Array)return{kty:"oct",k:(0,o.encode)(e)};else throw TypeError((0,d.default)(e,...l.types,"Uint8Array"));if("secret"!==t.type&&!["rsa","ec","ed25519","x25519","ed448","x448"].includes(t.asymmetricKeyType))throw new s.JOSENotSupported("Unsupported key asymmetricKeyType");return t.export({format:"jwk"})}}},572441:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({exportJWK:()=>a,exportPKCS8:()=>n,exportSPKI:()=>s});var r=e.i(434193),o=e.i(783957);async function s(e){return(0,r.toSPKI)(e)}async function n(e){return(0,r.toPKCS8)(e)}async function a(e){return(0,o.default)(e)}},170735:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({getJwtToken:()=>p,jwt:()=>i});var r=e.i(634882),o=e.i(272801),s=e.i(572441),n=e.i(719878),a=e.i(456787);e.i(311556);var d=e.i(151176);e.i(243917);var l=e.i(771884);e.i(105127),e.i(483013),e.i(558692);var c=e.i(776569);e.i(187615),e.i(306192),e.i(169429);var u=e.i(526962);e.i(328902),e.i(692153),e.i(316944),e.i(664764),e.i(30483),e.i(137942),e.i(561336),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(692218),e.i(628146),e.i(968915),e.i(504506),e.i(896775);let t=e=>({getAllKeys:async()=>await e.findMany({model:"jwks"}),getLatestKey:async()=>(await e.findMany({model:"jwks",sortBy:{field:"createdAt",direction:"desc"},limit:1}))[0],createJwk:async t=>await e.create({model:"jwks",data:{...t,createdAt:new Date}})});async function p(e,i){let r=t(e.context.adapter),d=await r.getLatestKey(),c=!i?.jwks?.disablePrivateKeyEncryption;if(void 0===d){let{publicKey:t,privateKey:n}=await (0,o.generateKeyPair)(i?.jwks?.keyPairConfig?.alg??"EdDSA",i?.jwks?.keyPairConfig??{crv:"Ed25519",extractable:!0}),a=await (0,s.exportJWK)(t),l=JSON.stringify(await (0,s.exportJWK)(n)),p={publicKey:JSON.stringify(a),privateKey:c?JSON.stringify(await (0,u.symmetricEncrypt)({key:e.context.secret,data:l})):l,createdAt:new Date};d=await r.createJwk(p)}let p=c?await (0,u.symmetricDecrypt)({key:e.context.secret,data:JSON.parse(d.privateKey)}).catch(()=>{throw new l.B("Failed to decrypt private private key. Make sure the secret currently in use is the same as the one used to encrypt the private key. If you are using a different secret, either cleanup your jwks or disable private key encryption.")}):d.privateKey,h=await (0,n.importJWK)(JSON.parse(p),i?.jwks?.keyPairConfig?.alg??"EdDSA"),m=i?.jwt?.definePayload?await i?.jwt.definePayload(e.context.session):e.context.session.user;return await new a.SignJWT(m).setProtectedHeader({alg:i?.jwks?.keyPairConfig?.alg??"EdDSA",kid:d.id}).setIssuedAt().setIssuer(i?.jwt?.issuer??e.context.options.baseURL).setAudience(i?.jwt?.audience??e.context.options.baseURL).setExpirationTime(i?.jwt?.expirationTime??"15m").setSubject(await i?.jwt?.getSubject?.(e.context.session)??e.context.session.user.id).sign(h)}let i=e=>({id:"jwt",endpoints:{getJwks:(0,d.a)("/jwks",{method:"GET",metadata:{openapi:{description:"Get the JSON Web Key Set",responses:{200:{description:"JSON Web Key Set retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{keys:{type:"array",description:"Array of public JSON Web Keys",items:{type:"object",properties:{kid:{type:"string",description:"Key ID uniquely identifying the key, corresponds to the 'id' from the stored Jwk"},kty:{type:"string",description:"Key type (e.g., 'RSA', 'EC', 'OKP')"},alg:{type:"string",description:"Algorithm intended for use with the key (e.g., 'EdDSA', 'RS256')"},use:{type:"string",description:"Intended use of the public key (e.g., 'sig' for signature)",enum:["sig"],nullable:!0},n:{type:"string",description:"Modulus for RSA keys (base64url-encoded)",nullable:!0},e:{type:"string",description:"Exponent for RSA keys (base64url-encoded)",nullable:!0},crv:{type:"string",description:"Curve name for elliptic curve keys (e.g., 'Ed25519', 'P-256')",nullable:!0},x:{type:"string",description:"X coordinate for elliptic curve keys (base64url-encoded)",nullable:!0},y:{type:"string",description:"Y coordinate for elliptic curve keys (base64url-encoded)",nullable:!0}},required:["kid","kty","alg"]}}},required:["keys"]}}}}}}}},async i=>{let r=t(i.context.adapter),n=await r.getAllKeys();if(0===n.length){let t=e?.jwks?.keyPairConfig?.alg??"EdDSA",{publicKey:n,privateKey:a}=await (0,o.generateKeyPair)(t,e?.jwks?.keyPairConfig??{crv:"Ed25519",extractable:!0}),d=await (0,s.exportJWK)(n),l=JSON.stringify(await (0,s.exportJWK)(a)),c=!e?.jwks?.disablePrivateKeyEncryption,p={publicKey:JSON.stringify({alg:t,...d}),privateKey:c?JSON.stringify(await (0,u.symmetricEncrypt)({key:i.context.secret,data:l})):l,createdAt:new Date};return await r.createJwk(p),i.json({keys:[{...d,alg:t,kid:p.id}]})}return i.json({keys:n.map(e=>({...JSON.parse(e.publicKey),kid:e.id}))})}),getToken:(0,d.a)("/token",{method:"GET",requireHeaders:!0,use:[d.s],metadata:{openapi:{description:"Get a JWT token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async t=>{let i=await p(t,e);return t.json({token:i})})},hooks:{after:[{matcher:e=>"/get-session"===e.path,handler:(0,d.c)(async t=>{let i=t.context.session||t.context.newSession;if(i&&i.session){let i=await p(t,e);t.setHeader("set-auth-jwt",i),t.setHeader("Access-Control-Expose-Headers","set-auth-jwt")}})}]},schema:(0,c.m)(r.s,e?.schema)})}},115605:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({multiSession:()=>t}),e.i(243917);var r=e.i(81714),o=e.i(311556),s=e.i(151176),n=e.i(328902);e.i(776569),e.i(105127),e.i(187615),e.i(306192),e.i(30483),e.i(137942),e.i(561336),e.i(483013),e.i(692153),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(771884),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506);let t=e=>{let t={maximumSessions:5,...e},i=e=>e.includes("_multi-"),a={INVALID_SESSION_TOKEN:"Invalid session token"};return{id:"multi-session",endpoints:{listDeviceSessions:(0,s.a)("/multi-session/list-device-sessions",{method:"GET",requireHeaders:!0},async e=>{let t=e.headers?.get("cookie");if(!t)return e.json([]);let r=Object.fromEntries((0,n.parseCookies)(t)),o=(await Promise.all(Object.entries(r).filter(([e])=>i(e)).map(async([t])=>await e.getSignedCookie(t,e.context.secret)))).filter(e=>null!==e);if(!o.length)return e.json([]);let s=(await e.context.internalAdapter.findSessions(o)).filter(e=>e&&e.session.expiresAt>new Date).reduce((e,t)=>(e.find(e=>e.user.id===t.user.id)||e.push(t),e),[]);return e.json(s)}),setActiveSession:(0,s.a)("/multi-session/set-active",{method:"POST",body:r.z.object({sessionToken:r.z.string({description:"The session token to set as active"})}),requireHeaders:!0,use:[s.s],metadata:{openapi:{description:"Set the active session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"}}}}}}}}}},async e=>{let t=e.body.sessionToken,i=`${e.context.authCookies.sessionToken.name}_multi-${t.toLowerCase()}`;if(!await e.getSignedCookie(i,e.context.secret))throw new o.APIError("UNAUTHORIZED",{message:a.INVALID_SESSION_TOKEN});let r=await e.context.internalAdapter.findSession(t);if(!r||r.session.expiresAt<new Date)throw e.setCookie(i,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),new o.APIError("UNAUTHORIZED",{message:a.INVALID_SESSION_TOKEN});return await (0,n.setSessionCookie)(e,r),e.json(r)}),revokeDeviceSession:(0,s.a)("/multi-session/revoke",{method:"POST",body:r.z.object({sessionToken:r.z.string({description:"The session token to revoke"})}),requireHeaders:!0,use:[s.s],metadata:{openapi:{description:"Revoke a device session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let t=e.body.sessionToken,r=`${e.context.authCookies.sessionToken.name}_multi-${t.toLowerCase()}`;if(!await e.getSignedCookie(r,e.context.secret))throw new o.APIError("UNAUTHORIZED",{message:a.INVALID_SESSION_TOKEN});if(await e.context.internalAdapter.deleteSession(t),e.setCookie(r,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.context.session?.session.token!==t)return e.json({status:!0});let s=e.headers?.get("cookie");if(s){let t=Object.fromEntries((0,n.parseCookies)(s)),r=(await Promise.all(Object.entries(t).filter(([e])=>i(e)).map(async([t])=>await e.getSignedCookie(t,e.context.secret)))).filter(e=>void 0!==e),o=e.context.internalAdapter;if(r.length>0){let t=(await o.findSessions(r)).filter(e=>e&&e.session.expiresAt>new Date);if(t.length>0){let i=t[0];await (0,n.setSessionCookie)(e,i)}else(0,n.deleteSessionCookie)(e)}else(0,n.deleteSessionCookie)(e)}else(0,n.deleteSessionCookie)(e);return e.json({status:!0})})},hooks:{after:[{matcher:()=>!0,handler:(0,s.c)(async e=>{let r=e.context.responseHeaders?.get("set-cookie");if(!r)return;let o=(0,n.parseSetCookieHeader)(r),s=e.context.authCookies.sessionToken,a=e.context.newSession?.session.token;if(!a)return;let d=(0,n.parseCookies)(e.headers?.get("cookie")||""),l=`${s.name}_multi-${a.toLowerCase()}`;!(o.get(l)||d.get(l))&&(Object.keys(Object.fromEntries(d)).filter(i).length+ +!!r.includes("session_token")>=t.maximumSessions||await e.setSignedCookie(l,a,e.context.secret,s.options))})},{matcher:e=>"/sign-out"===e.path,handler:(0,s.c)(async e=>{let t=e.headers?.get("cookie");if(!t)return;let r=Object.fromEntries((0,n.parseCookies)(t)),o=Object.keys(r).map(t=>i(t)?(e.setCookie(t.toLowerCase(),"",{...e.context.authCookies.sessionToken.options,maxAge:0}),r[t].split(".")[0]):null).filter(e=>null!==e);await e.context.internalAdapter.deleteSessions(o)})}]},$ERROR_CODES:a}}}},694896:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({emailOTP:()=>i}),e.i(243917);var r=e.i(81714),o=e.i(311556),s=e.i(151176),n=e.i(328902);e.i(776569),e.i(105127),e.i(187615),e.i(306192),e.i(74222),e.i(483013),e.i(533004),e.i(91997);var a=e.i(382320),d=e.i(692153),l=e.i(82131);e.i(30483),e.i(137942),e.i(561336),e.i(771884),e.i(4887),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506);let t=["email-verification","sign-in","forget-password"],i=e=>{let i={expiresIn:300,generateOTP:()=>(0,a.g)(e.otpLength??6,"0-9"),...e},c={OTP_EXPIRED:"otp expired",INVALID_OTP:"Invalid OTP",INVALID_EMAIL:"Invalid email",USER_NOT_FOUND:"User not found",TOO_MANY_ATTEMPTS:"Too many attempts"};return{id:"email-otp",endpoints:{sendVerificationOTP:(0,s.a)("/email-otp/send-verification-otp",{method:"POST",body:r.z.object({email:r.z.string({description:"Email address to send the OTP"}),type:r.z.enum(t,{description:"Type of the OTP"})}),metadata:{openapi:{description:"Send verification OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async t=>{if(!e?.sendVerificationOTP)throw t.context.logger.error("send email verification is not implemented"),new o.APIError("BAD_REQUEST",{message:"send email verification is not implemented"});let r=t.body.email;if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r))throw t.error("BAD_REQUEST",{message:c.INVALID_EMAIL});if(("forget-password"===t.body.type||i.disableSignUp)&&!await t.context.internalAdapter.findUserByEmail(r))return t.json({success:!0});let s=i.generateOTP({email:r,type:t.body.type},t.request);return await t.context.internalAdapter.createVerificationValue({value:`${s}:0`,identifier:`${t.body.type}-otp-${r}`,expiresAt:(0,d.g)(i.expiresIn,"sec")},t).catch(async e=>{await t.context.internalAdapter.deleteVerificationByIdentifier(`${t.body.type}-otp-${r}`),await t.context.internalAdapter.createVerificationValue({value:`${s}:0`,identifier:`${t.body.type}-otp-${r}`,expiresAt:(0,d.g)(i.expiresIn,"sec")},t)}),await e.sendVerificationOTP({email:r,otp:s,type:t.body.type},t.request),t.json({success:!0})}),createVerificationOTP:(0,s.a)("/email-otp/create-verification-otp",{method:"POST",body:r.z.object({email:r.z.string({description:"Email address to send the OTP"}),type:r.z.enum(t,{description:"Type of the OTP"})}),metadata:{SERVER_ONLY:!0,openapi:{description:"Create verification OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"string"}}}}}}}},async e=>{let t=e.body.email,r=i.generateOTP({email:t,type:e.body.type},e.request);return await e.context.internalAdapter.createVerificationValue({value:`${r}:0`,identifier:`${e.body.type}-otp-${t}`,expiresAt:(0,d.g)(i.expiresIn,"sec")},e),r}),getVerificationOTP:(0,s.a)("/email-otp/get-verification-otp",{method:"GET",query:r.z.object({email:r.z.string({description:"Email address to get the OTP"}),type:r.z.enum(t)}),metadata:{SERVER_ONLY:!0,openapi:{description:"Get verification OTP",responses:{200:{description:"OTP retrieved successfully or not found/expired",content:{"application/json":{schema:{type:"object",properties:{otp:{type:"string",nullable:!0,description:"The stored OTP, or null if not found or expired"}},required:["otp"]}}}}}}}},async e=>{let t=e.query.email,i=await e.context.internalAdapter.findVerificationValue(`${e.query.type}-otp-${t}`);return!i||i.expiresAt<new Date?e.json({otp:null}):e.json({otp:i.value})}),verifyEmailOTP:(0,s.a)("/email-otp/verify-email",{method:"POST",body:r.z.object({email:r.z.string({description:"Email address to verify"}),otp:r.z.string({description:"OTP to verify"})}),metadata:{openapi:{description:"Verify email OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the verification was successful",enum:[!0]},token:{type:"string",nullable:!0,description:"Session token if autoSignInAfterVerification is enabled, otherwise null"},user:{$ref:"#/components/schemas/User"},required:["status","token","user"]}}}}}}}}},async t=>{let i=t.body.email;if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(i))throw new o.APIError("BAD_REQUEST",{message:c.INVALID_EMAIL});let r=await t.context.internalAdapter.findVerificationValue(`email-verification-otp-${i}`);if(!r)throw new o.APIError("BAD_REQUEST",{message:c.INVALID_OTP});if(r.expiresAt<new Date)throw new o.APIError("BAD_REQUEST",{message:c.OTP_EXPIRED});let[s,a]=r.value.split(":"),d=e?.allowedAttempts||3;if(a&&parseInt(a)>=d)throw await t.context.internalAdapter.deleteVerificationValue(r.id),new o.APIError("FORBIDDEN",{message:c.TOO_MANY_ATTEMPTS});if(t.body.otp!==s)throw await t.context.internalAdapter.updateVerificationValue(r.id,{value:`${s}:${parseInt(a||"0")+1}`}),new o.APIError("BAD_REQUEST",{message:c.INVALID_OTP});await t.context.internalAdapter.deleteVerificationValue(r.id);let l=await t.context.internalAdapter.findUserByEmail(i);if(!l)throw new o.APIError("BAD_REQUEST",{message:c.USER_NOT_FOUND});let u=await t.context.internalAdapter.updateUser(l.user.id,{email:i,emailVerified:!0},t);if(t.context.options.emailVerification?.autoSignInAfterVerification){let e=await t.context.internalAdapter.createSession(u.id,t);return await (0,n.setSessionCookie)(t,{session:e,user:u}),t.json({status:!0,token:e.token,user:{id:u.id,email:u.email,emailVerified:u.emailVerified,name:u.name,image:u.image,createdAt:u.createdAt,updatedAt:u.updatedAt}})}return t.json({status:!0,token:null,user:{id:u.id,email:u.email,emailVerified:u.emailVerified,name:u.name,image:u.image,createdAt:u.createdAt,updatedAt:u.updatedAt}})}),signInEmailOTP:(0,s.a)("/sign-in/email-otp",{method:"POST",body:r.z.object({email:r.z.string({description:"Email address to sign in"}),otp:r.z.string({description:"OTP sent to the email"})}),metadata:{openapi:{description:"Sign in with email OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"Session token for the authenticated session"},user:{$ref:"#/components/schemas/User"}},required:["token","user"]}}}}}}}},async t=>{let r=t.body.email,s=await t.context.internalAdapter.findVerificationValue(`sign-in-otp-${r}`);if(!s)throw new o.APIError("BAD_REQUEST",{message:c.INVALID_OTP});if(s.expiresAt<new Date)throw new o.APIError("BAD_REQUEST",{message:c.OTP_EXPIRED});let[a,d]=s.value.split(":"),l=e?.allowedAttempts||3;if(d&&parseInt(d)>=l)throw await t.context.internalAdapter.deleteVerificationValue(s.id),new o.APIError("FORBIDDEN",{message:c.TOO_MANY_ATTEMPTS});if(t.body.otp!==a)throw await t.context.internalAdapter.updateVerificationValue(s.id,{value:`${a}:${parseInt(d||"0")+1}`}),new o.APIError("BAD_REQUEST",{message:c.INVALID_OTP});await t.context.internalAdapter.deleteVerificationValue(s.id);let u=await t.context.internalAdapter.findUserByEmail(r);if(!u){if(i.disableSignUp)throw new o.APIError("BAD_REQUEST",{message:c.USER_NOT_FOUND});let e=await t.context.internalAdapter.createUser({email:r,emailVerified:!0,name:""},t),s=await t.context.internalAdapter.createSession(e.id,t);return await (0,n.setSessionCookie)(t,{session:s,user:e}),t.json({token:s.token,user:{id:e.id,email:e.email,emailVerified:e.emailVerified,name:e.name,image:e.image,createdAt:e.createdAt,updatedAt:e.updatedAt}})}u.user.emailVerified||await t.context.internalAdapter.updateUser(u.user.id,{emailVerified:!0},t);let p=await t.context.internalAdapter.createSession(u.user.id,t);return await (0,n.setSessionCookie)(t,{session:p,user:u.user}),t.json({token:p.token,user:{id:u.user.id,email:u.user.email,emailVerified:u.user.emailVerified,name:u.user.name,image:u.user.image,createdAt:u.user.createdAt,updatedAt:u.user.updatedAt}})}),forgetPasswordEmailOTP:(0,s.a)("/forget-password/email-otp",{method:"POST",body:r.z.object({email:r.z.string({description:"Email address to send the OTP"})}),metadata:{openapi:{description:"Forget password with email OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the OTP was sent successfully"}}}}}}}}}},async t=>{let r=t.body.email;if(!await t.context.internalAdapter.findUserByEmail(r))throw new o.APIError("BAD_REQUEST",{message:c.USER_NOT_FOUND});let s=i.generateOTP({email:r,type:"forget-password"},t.request);return await t.context.internalAdapter.createVerificationValue({value:`${s}:0`,identifier:`forget-password-otp-${r}`,expiresAt:(0,d.g)(i.expiresIn,"sec")},t),await e.sendVerificationOTP({email:r,otp:s,type:"forget-password"},t.request),t.json({success:!0})}),resetPasswordEmailOTP:(0,s.a)("/email-otp/reset-password",{method:"POST",body:r.z.object({email:r.z.string({description:"Email address to reset the password"}),otp:r.z.string({description:"OTP sent to the email"}),password:r.z.string({description:"New password"})}),metadata:{openapi:{description:"Reset password with email OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async t=>{let i=t.body.email,r=await t.context.internalAdapter.findUserByEmail(i,{includeAccounts:!0});if(!r)throw new o.APIError("BAD_REQUEST",{message:c.USER_NOT_FOUND});let s=await t.context.internalAdapter.findVerificationValue(`forget-password-otp-${i}`);if(!s)throw new o.APIError("BAD_REQUEST",{message:c.INVALID_OTP});if(s.expiresAt<new Date)throw await t.context.internalAdapter.deleteVerificationValue(s.id),new o.APIError("BAD_REQUEST",{message:c.OTP_EXPIRED});let[n,a]=s.value.split(":"),d=e?.allowedAttempts||3;if(a&&parseInt(a)>=d)throw await t.context.internalAdapter.deleteVerificationValue(s.id),new o.APIError("FORBIDDEN",{message:c.TOO_MANY_ATTEMPTS});if(t.body.otp!==n)throw await t.context.internalAdapter.updateVerificationValue(s.id,{value:`${n}:${parseInt(a||"0")+1}`}),new o.APIError("BAD_REQUEST",{message:c.INVALID_OTP});await t.context.internalAdapter.deleteVerificationValue(s.id);let l=await t.context.password.hash(t.body.password);return r.accounts.find(e=>"credential"===e.providerId)?await t.context.internalAdapter.updatePassword(r.user.id,l,t):await t.context.internalAdapter.createAccount({userId:r.user.id,providerId:"credential",accountId:r.user.id,password:l},t),t.json({success:!0})})},hooks:{after:[{matcher:e=>!!(e.path?.startsWith("/sign-up")&&i.sendVerificationOnSignUp),handler:(0,s.c)(async t=>{let r=await (0,l.g)(t),o=r?.user.email;if(o){let r=i.generateOTP({email:o,type:t.body.type},t.request);await t.context.internalAdapter.createVerificationValue({value:`${r}:0`,identifier:`email-verification-otp-${o}`,expiresAt:(0,d.g)(i.expiresIn,"sec")},t),await e.sendVerificationOTP({email:o,otp:r,type:"email-verification"},t.request)}})}]},$ERROR_CODES:c,rateLimit:[{pathMatcher:e=>"/email-otp/send-verification-otp"===e,window:60,max:3},{pathMatcher:e=>"/email-otp/verify-email"===e,window:60,max:3},{pathMatcher:e=>"/sign-in/email-otp"===e,window:60,max:3}]}}}},395484:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({oneTap:()=>t}),e.i(243917);var r=e.i(81714),o=e.i(311556),s=e.i(151176),n=e.i(328902);e.i(776569),e.i(105127),e.i(187615),e.i(306192);var a=e.i(398928),d=e.i(108111);e.i(30483),e.i(137942),e.i(561336),e.i(483013),e.i(692153),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(771884),e.i(692218),e.i(316944),e.i(628146),e.i(558692),e.i(968915),e.i(664764),e.i(504506);let t=e=>({id:"one-tap",endpoints:{oneTapCallback:(0,s.a)("/one-tap/callback",{method:"POST",body:r.z.object({idToken:r.z.string({description:"Google ID token, which the client obtains from the One Tap API"})}),metadata:{openapi:{summary:"One tap callback",description:"Use this endpoint to authenticate with Google One Tap",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}},400:{description:"Invalid token"}}}}},async t=>{let i,{idToken:r}=t.body;try{let o=(0,a.createRemoteJWKSet)(new URL("https://www.googleapis.com/oauth2/v3/certs")),{payload:s}=await (0,d.jwtVerify)(r,o,{issuer:["https://accounts.google.com","accounts.google.com"],audience:e?.clientId||t.context.options.socialProviders?.google?.clientId});i=s}catch(e){throw new o.APIError("BAD_REQUEST",{message:"invalid id token"})}let{email:s,email_verified:l,name:c,picture:u,sub:p}=i;if(!s)return t.json({error:"Email not available in token"});let h=await t.context.internalAdapter.findUserByEmail(s);if(!h){if(e?.disableSignup)throw new o.APIError("BAD_GATEWAY",{message:"User not found"});let i=await t.context.internalAdapter.createOAuthUser({email:s,emailVerified:"boolean"==typeof l?l:function(e){return"true"===e||!0===e}(l),name:c,image:u},{providerId:"google",accountId:p},t);if(!i)throw new o.APIError("INTERNAL_SERVER_ERROR",{message:"Could not create user"});let r=await t.context.internalAdapter.createSession(i.user.id,t);return await (0,n.setSessionCookie)(t,{user:i.user,session:r}),t.json({token:r.token,user:{id:i.user.id,email:i.user.email,emailVerified:i.user.emailVerified,name:i.user.name,image:i.user.image,createdAt:i.user.createdAt,updatedAt:i.user.updatedAt}})}if(!await t.context.internalAdapter.findAccount(p)){let e=t.context.options.account?.accountLinking;if(e?.enabled&&(e.trustedProviders?.includes("google")||l))await t.context.internalAdapter.linkAccount({userId:h.user.id,providerId:"google",accountId:p,scope:"openid,profile,email",idToken:r});else throw new o.APIError("UNAUTHORIZED",{message:"Google sub doesn't match"})}let m=await t.context.internalAdapter.createSession(h.user.id,t);return await (0,n.setSessionCookie)(t,{user:h.user,session:m}),t.json({token:m.token,user:{id:h.user.id,email:h.user.email,emailVerified:h.user.emailVerified,name:h.user.name,image:h.user.image,createdAt:h.user.createdAt,updatedAt:h.user.updatedAt}})})}})}},757404:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({oAuthProxy:()=>t}),e.i(243917);var r=e.i(81714);e.i(311556);var o=e.i(151176),s=e.i(105127);e.i(483013),e.i(558692);var n=e.i(664764);e.i(776569),e.i(187615),e.i(306192),e.i(169429);var a=e.i(526962);e.i(328902),e.i(771884),e.i(692153),e.i(316944),e.i(30483),e.i(137942),e.i(561336),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(692218),e.i(628146),e.i(968915),e.i(504506),e.i(896775);let t=e=>({id:"oauth-proxy",endpoints:{oAuthProxy:(0,o.a)("/oauth-proxy-callback",{method:"GET",query:r.z.object({callbackURL:r.z.string({description:"The URL to redirect to after the proxy"}),cookies:r.z.string({description:"The cookies to set after the proxy"})}),use:[(0,o.o)(e=>e.query.callbackURL)],metadata:{openapi:{description:"OAuth Proxy Callback",parameters:[{in:"query",name:"callbackURL",required:!0,description:"The URL to redirect to after the proxy"},{in:"query",name:"cookies",required:!0,description:"The cookies to set after the proxy"}],responses:{302:{description:"Redirect",headers:{Location:{description:"The URL to redirect to",schema:{type:"string"}}}}}}}},async e=>{let t=e.query.cookies,i=await (0,a.symmetricDecrypt)({key:e.context.secret,data:t});throw e.setHeader("set-cookie",i),e.redirect(e.query.callbackURL)})},hooks:{after:[{matcher:e=>e.path?.startsWith("/callback")||e.path?.startsWith("/oauth2/callback"),handler:(0,o.c)(async e=>{let t=e.context.responseHeaders,i=t?.get("location");if(i?.includes("/oauth-proxy-callback?callbackURL")){if(!i.startsWith("http"))return;let r=new URL(i);if(r.origin===(0,n.g)(e.context.baseURL)){let t=r.searchParams.get("callbackURL");if(!t)return;e.setHeader("location",t);return}let o=t?.get("set-cookie");if(!o)return;let s=await (0,a.symmetricEncrypt)({key:e.context.secret,data:o}),d=`${i}&cookies=${encodeURIComponent(s)}`;e.setHeader("location",d)}})}],before:[{matcher:e=>e.path?.startsWith("/sign-in/social")||e.path?.startsWith("/sign-in/oauth2"),handler:(0,o.c)(async t=>{let i=new URL(e?.currentURL||t.request?.url||function(){let e=s.e.VERCEL_URL,t=s.e.NETLIFY_URL,i=s.e.RENDER_URL,r=s.e.AWS_LAMBDA_FUNCTION_NAME,o=s.e.GOOGLE_CLOUD_FUNCTION_NAME,n=s.e.AZURE_FUNCTION_NAME;return e||t||i||r||o||n}()||t.context.baseURL);if((e?.productionURL||s.e.BETTER_AUTH_URL)!==t.context.options.baseURL)return t.body.callbackURL=`${i.origin}${t.context.options.basePath||"/api/auth"}/oauth-proxy-callback?callbackURL=${encodeURIComponent(t.body.callbackURL||t.context.baseURL)}`,{context:t}})}]}})}},592337:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({customSession:()=>t}),e.i(243917);var r=e.i(81714);e.i(311556);var o=e.i(151176);e.i(105127),e.i(483013),e.i(558692),e.i(776569),e.i(187615),e.i(306192),e.i(328902),e.i(771884),e.i(692153),e.i(316944),e.i(664764),e.i(30483),e.i(137942),e.i(561336),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(692218),e.i(628146),e.i(968915),e.i(504506);let t=(e,t)=>({id:"custom-session",endpoints:{getSession:(0,o.a)("/get-session",{method:"GET",query:r.z.optional(r.z.object({disableCookieCache:r.z.boolean({description:"Disable cookie cache and fetch session from database"}).or(r.z.string().transform(e=>"true"===e)).optional(),disableRefresh:r.z.boolean({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),metadata:{CUSTOM_SESSION:!0,openapi:{description:"Get custom session data",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",nullable:!0,items:{$ref:"#/components/schemas/Session"}}}}}}}},requireHeaders:!0},async t=>{let i=await (0,o.b)()({...t,asResponse:!1,headers:t.headers,returnHeaders:!0}).catch(e=>null);if(!i?.response)return t.json(null);let r=await e(i.response,t);return i.headers.forEach((e,i)=>{t.setHeader(i,e)}),t.json(r)})}})}},623832:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({openAPI:()=>f}),e.i(243917);var r=e.i(208348);e.i(277337);var o=e.i(41997);e.i(776569),e.i(105127),e.i(4887);var s=e.i(311556);e.i(74222),e.i(483013),e.i(533004),e.i(91997),e.i(382320),e.i(187615);var n=e.i(955759),a=e.i(151176);e.i(558692),e.i(306192),e.i(328902),e.i(771884),e.i(692153),e.i(316944),e.i(664764),e.i(654520),e.i(30483),e.i(137942),e.i(561336),e.i(692218),e.i(628146),e.i(968915),e.i(504506);let t={};function d(e){switch(e.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function l(e){let t=[];return e.metadata?.openapi?.parameters?t.push(...e.metadata.openapi.parameters):e.query instanceof r.ZodObject&&Object.entries(e.query.shape).forEach(([e,i])=>{i instanceof r.ZodSchema&&t.push({name:e,in:"query",schema:{type:d(i),..."minLength"in i&&i.minLength?{minLength:i.minLength}:{},description:i.description}})}),t}function c(e){if(e.metadata?.openapi?.requestBody)return e.metadata.openapi.requestBody;if(e.body&&(e.body instanceof r.ZodObject||e.body instanceof r.ZodOptional)){let t=e.body.shape;if(!t)return;let i={},o=[];return Object.entries(t).forEach(([e,t])=>{t instanceof r.ZodSchema&&(i[e]={type:d(t),description:t.description},t instanceof r.ZodOptional||o.push(e))}),{required:!(e.body instanceof r.ZodOptional)&&!!e.body,content:{"application/json":{schema:{type:"object",properties:i,required:o}}}}}}function u(e){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...e}}function p(e){return e.split("/").map(e=>e.startsWith(":")?`{${e.slice(1)}}`:e).join("/")}async function h(e,i){let r=(0,o.getEndpoints)(e,{...i,plugins:[]}),s={schemas:{...Object.entries((0,n.g)(i)).reduce((e,[t,i])=>(e[t.charAt(0).toUpperCase()+t.slice(1)]={type:"object",properties:Object.entries(i.fields).reduce((e,[t,i])=>(e[t]={type:i.type},e),{id:{type:"string"}})},e),{})}};for(let s of(Object.entries(r.api).forEach(([i,r])=>{if(e.options.disabledPaths?.includes(r.path))return;let o=r.options;if(o.metadata?.SERVER_ONLY)return;let s=p(r.path);if("GET"===o.method&&(t[s]={get:{tags:["Default",...o.metadata?.openapi?.tags||[]],description:o.metadata?.openapi?.description,operationId:o.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:l(o),responses:u(o.metadata?.openapi?.responses)}}),"POST"===o.method){let e=c(o);t[s]={post:{tags:["Default",...o.metadata?.openapi?.tags||[]],description:o.metadata?.openapi?.description,operationId:o.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:l(o),...e?{requestBody:e}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:u(o.metadata?.openapi?.responses)}}}}),i.plugins||[])){if("open-api"===s.id)continue;let n=(0,o.getEndpoints)(e,{...i,plugins:[s]});Object.entries(Object.keys(n.api).map(e=>void 0===r.api[e]?n.api[e]:null).filter(e=>null!==e)).forEach(([i,r])=>{if(e.options.disabledPaths?.includes(r.path))return;let o=r.options;if(o.metadata?.SERVER_ONLY)return;let n=p(r.path);"GET"===o.method&&(t[n]={get:{tags:o.metadata?.openapi?.tags||[s.id.charAt(0).toUpperCase()+s.id.slice(1)],description:o.metadata?.openapi?.description,operationId:o.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:l(o),responses:u(o.metadata?.openapi?.responses)}}),"POST"===o.method&&(t[n]={post:{tags:o.metadata?.openapi?.tags||[s.id.charAt(0).toUpperCase()+s.id.slice(1)],description:o.metadata?.openapi?.description,operationId:o.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:l(o),requestBody:c(o),responses:u(o.metadata?.openapi?.responses)}})})}return{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{...s,securitySchemes:{apiKeyCookie:{type:"apiKey",in:"cookie",name:"apiKeyCookie",description:"API Key authentication via cookie"},bearerAuth:{type:"http",scheme:"bearer",description:"Bearer token authentication"}}},security:[{apiKeyCookie:[],bearerAuth:[]}],servers:[{url:e.baseURL}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:t}}let i=`<svg width="75" height="75" viewBox="0 0 75 75" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="75" height="75" fill="url(#pattern0_21_12)"/>
<defs>
<pattern id="pattern0_21_12" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_21_12" transform="scale(0.00094697)"/>
</pattern>
<image id="image0_21_12" width="1056" height="1056" xlink:href="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBARXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAEIKADAAQAAAABAAAEIAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/+ICKElDQ19QUk9GSUxFAAEBAAACGGFwcGwEAAAAbW50clJHQiBYWVogB+YAAQABAAAAAAAAYWNzcEFQUEwAAAAAQVBQTAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1hcHBs7P2jjjiFR8NttL1PetoYLwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZGVzYwAAAPwAAAAwY3BydAAAASwAAABQd3RwdAAAAXwAAAAUclhZWgAAAZAAAAAUZ1hZWgAAAaQAAAAUYlhZWgAAAbgAAAAUclRSQwAAAcwAAAAgY2hhZAAAAewAAAAsYlRSQwAAAcwAAAAgZ1RSQwAAAcwAAAAgbWx1YwAAAAAAAAABAAAADGVuVVMAAAAUAAAAHABEAGkAcwBwAGwAYQB5ACAAUAAzbWx1YwAAAAAAAAABAAAADGVuVVMAAAA0AAAAHABDAG8AcAB5AHIAaQBnAGgAdAAgAEEAcABwAGwAZQAgAEkAbgBjAC4ALAAgADIAMAAyADJYWVogAAAAAAAA9tUAAQAAAADTLFhZWiAAAAAAAACD3wAAPb////+7WFlaIAAAAAAAAEq/AACxNwAACrlYWVogAAAAAAAAKDgAABELAADIuXBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbc2YzMgAAAAAAAQxCAAAF3v//8yYAAAeTAAD9kP//+6L///2jAAAD3AAAwG7/wAARCAQgBCADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9sAQwACAgICAgIDAgIDBAMDAwQFBAQEBAUHBQUFBQUHCAcHBwcHBwgICAgICAgICgoKCgoKCwsLCwsNDQ0NDQ0NDQ0N/9sAQwECAgIDAwMGAwMGDQkHCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/90ABABC/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Ln/gq38a/in8Dvgp4T8R/CfxFdeG9SvvFMdlcXFoELyW5srqQxnzEcY3op4Gciv1Gr8Z/+C2X/JvXgj/sc4v/AE33lAH4z/8ADwv9tD/oq2tf9823/wAZo/4eF/tof9FW1r/vm2/+M18Z0UAfZn/Dwv8AbQ/6KtrX/fNt/wDGaP8Ah4X+2h/0VbWv++bb/wCM18Z0UAfZn/Dwv9tD/oq2tf8AfNt/8Zo/4eF/tof9FW1r/vm2/wDjNfGdFAH2Z/w8L/bQ/wCira1/3zbf/GaP+Hhf7aH/AEVbWv8Avm2/+M18Z0UAfZn/AA8L/bQ/6KtrX/fNt/8AGaP+Hhf7aH/RVta/75tv/jNfGdFAH2Z/w8L/AG0P+ira1/3zbf8Axmj/AIeF/tof9FW1r/vm2/8AjNfGdFAH63/sVftq/tTfEb9qb4deCfG3xF1TVtD1bVGgvbKdYBHPGIJW2ttiVsblB4I6V/UbX8Z//BPT/k9D4U/9hpv/AEmmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+M/wD4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAPsz/h4X+2h/0VbWv++bb/4zR/w8L/bQ/wCira1/3zbf/Ga+M6KAPsz/AIeF/tof9FW1r/vm2/8AjNH/AA8L/bQ/6KtrX/fNt/8AGa+M6KAPsz/h4X+2h/0VbWv++bb/AOM0f8PC/wBtD/oq2tf9823/AMZr4zooA+zP+Hhf7aH/AEVbWv8Avm2/+M0f8PC/20P+ira1/wB823/xmvjOigD7M/4eF/tof9FW1r/vm2/+M0f8PC/20P8Aoq2tf9823/xmvjOigD7M/wCHhf7aH/RVta/75tv/AIzR/wAPC/20P+ira1/3zbf/ABmvjOigD7M/4eF/tof9FW1r/vm2/wDjNH/Dwv8AbQ/6KtrX/fNt/wDGa+M6KAPsz/h4X+2h/wBFW1r/AL5tv/jNH/Dwv9tD/oq2tf8AfNt/8Zr4zooA+zP+Hhf7aH/RVta/75tv/jNH/Dwv9tD/AKKtrX/fNt/8Zr4zooA+zP8Ah4X+2h/0VbWv++bb/wCM0f8ADwv9tD/oq2tf9823/wAZr4zooA+zP+Hhf7aH/RVta/75tv8A4zR/w8L/AG0P+ira1/3zbf8AxmvjOigD7M/4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAP6tv+CUnxr+Kfxx+CnizxH8WPEV14k1Kx8UyWVvcXYQPHbiytZBGPLRBje7HkZya/Uavxn/AOCJv/JvXjf/ALHOX/032dfsxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfwq/BT4r638Dvin4d+LHhy0tb7UvDd0bu3t70ObeRzG0eJBGyPjDnowOa/Ub/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH9MlFfzN/8Psv2hf+hI8Gf9+tQ/8Ak2j/AIfZftC/9CR4M/79ah/8m0Af0yUV/M3/AMPsv2hf+hI8Gf8AfrUP/k2j/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH4z0V/TJ/w5N/Z6/6Hfxn/wB/dP8A/kKj/hyb+z1/0O/jP/v7p/8A8hUAfzN0V/TJ/wAOTf2ev+h38Z/9/dP/APkKj/hyb+z1/wBDv4z/AO/un/8AyFQB/M3RX9Mn/Dk39nr/AKHfxn/390//AOQqP+HJv7PX/Q7+M/8Av7p//wAhUAfzN0V/TJ/w5N/Z6/6Hfxn/AN/dP/8AkKj/AIcm/s9f9Dv4z/7+6f8A/IVAH8zdFf0yf8OTf2ev+h38Z/8Af3T/AP5Co/4cm/s9f9Dv4z/7+6f/APIVAH8zdFf0yf8ADk39nr/od/Gf/f3T/wD5Co/4cm/s9f8AQ7+M/wDv7p//AMhUAfzN0V/TJ/w5N/Z6/wCh38Z/9/dP/wDkKvwV/ag+FGifA74++M/hP4cu7q+03w3fi0t7i9KG4kQxRyZkMaomcueigYoA8FooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/AOxzl/8ATfZ1+zFfjP8A8ETf+TevG/8A2Ocv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD1L4KfCjW/jj8U/Dvwn8OXdrY6l4kujaW9xelxbxuI2kzIY1d8YQ9FJzX6jf8OTf2hf8Aod/Bn/f3UP8A5Cr4z/4J6f8AJ6Hwp/7DTf8ApNNX9mFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH8zf8Aw5N/aF/6HfwZ/wB/dQ/+QqP+HJv7Qv8A0O/gz/v7qH/yFX9MlFAH8zf/AA5N/aF/6HfwZ/391D/5Co/4cm/tC/8AQ7+DP+/uof8AyFX9MlFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH4z/8AD7L9nr/oSPGf/frT/wD5No/4fZfs9f8AQkeM/wDv1p//AMm1/M3RQB/TJ/w+y/Z6/wChI8Z/9+tP/wDk2j/h9l+z1/0JHjP/AL9af/8AJtfzN0UAf0yf8Psv2ev+hI8Z/wDfrT//AJNo/wCH2X7PX/QkeM/+/Wn/APybX8zdFAH9Mn/D7L9nr/oSPGf/AH60/wD+TaP+H2X7PX/QkeM/+/Wn/wDybX8zdFAH9Mn/AA+y/Z6/6Ejxn/360/8A+TaP+H2X7PX/AEJHjP8A79af/wDJtfzN0UAf0yf8Psv2ev8AoSPGf/frT/8A5No/4fZfs9f9CR4z/wC/Wn//ACbX8zdFAH9Mn/D7L9nr/oSPGf8A360//wCTa/BX9qD4r6J8cfj74z+LHhy0urHTfEl+Lu3t70ILiNBFHHiQRs6Zyh6MRivBaKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/ACb143/7HOX/ANN9nX7MV+M//BE3/k3rxv8A9jnL/wCm+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+XP/BVv4KfFP44/BTwn4c+E/h268SalY+KY724t7QoHjtxZXUZkPmOgxvdRwc5NAH8pNFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAfGdFfZn/DvT9tD/AKJTrX/fVt/8eo/4d6ftof8ARKda/wC+rb/49QB8Z0V9mf8ADvT9tD/olOtf99W3/wAeo/4d6ftof9Ep1r/vq2/+PUAfGdFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAH/BPT/k9D4U/wDYab/0mmr+zCv5cv2Kv2Kv2pvhz+1N8OvG3jb4dappOh6TqjT3t7O0BjgjMEq7m2ys2NzAcA9a/qNoAKKKKACiiigAooooAKKKKACiiigAooooA/gDor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD9mP+CJv/JvXjf8A7HOX/wBN9nX7MV+XP/BKT4KfFP4HfBTxZ4c+LHh268N6lfeKZL23t7soXktzZWsYkHlu4xvRhyc5FfqNQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9f9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/2Q=="/>
</defs>
</svg>
`,m=e=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(e)}
    </script>
	 <script>
      var configuration = {
	  	favicon: "data:image/svg+xml;utf8,${encodeURIComponent(i)}",
	   	theme: "saturn",
        metaData: {
			title: "Better Auth API",
			description: "API Reference for your Better Auth Instance",
		}
      }

      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`,f=e=>{let t=e?.path??"/reference";return{id:"open-api",endpoints:{generateOpenAPISchema:(0,a.a)("/open-api/generate-schema",{method:"GET"},async e=>{let t=await h(e.context,e.context.options);return e.json(t)}),openAPIReference:(0,a.a)(t,{method:"GET",metadata:{isAction:!1}},async t=>{if(e?.disableDefaultReference)throw new s.APIError("NOT_FOUND");return new Response(m(await h(t.context,t.context.options)),{headers:{"Content-Type":"text/html"}})})}}}}},318752:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({oidcProvider:()=>m});var r=e.i(456787);e.i(243917);var o=e.i(81714),s=e.i(311556),n=e.i(151176);e.i(105127);var a=e.i(483013);e.i(558692);var d=e.i(328902);e.i(776569),e.i(187615),e.i(306192);var l=e.i(74222);e.i(533004);var c=e.i(404300);e.i(91997);var u=e.i(382320);e.i(30483),e.i(137942),e.i(561336),e.i(692153),e.i(771884),e.i(4887),e.i(692218),e.i(316944),e.i(628146),e.i(968915),e.i(664764),e.i(504506);let t={oauthApplication:{modelName:"oauthApplication",fields:{name:{type:"string"},icon:{type:"string",required:!1},metadata:{type:"string",required:!1},clientId:{type:"string",unique:!0},clientSecret:{type:"string"},redirectURLs:{type:"string"},type:{type:"string"},disabled:{type:"boolean",required:!1,defaultValue:!1},userId:{type:"string",required:!1},createdAt:{type:"date"},updatedAt:{type:"date"}}},oauthAccessToken:{modelName:"oauthAccessToken",fields:{accessToken:{type:"string",unique:!0},refreshToken:{type:"string",unique:!0},accessTokenExpiresAt:{type:"date"},refreshTokenExpiresAt:{type:"date"},clientId:{type:"string"},userId:{type:"string",required:!1},scopes:{type:"string"},createdAt:{type:"date"},updatedAt:{type:"date"}}},oauthConsent:{modelName:"oauthConsent",fields:{clientId:{type:"string"},userId:{type:"string"},scopes:{type:"string"},createdAt:{type:"date"},updatedAt:{type:"date"},consentGiven:{type:"boolean"}}}};function p(e,t,i){return`${e.includes("?")?"&":"?"}error=${t}&error_description=${i}`}async function h(e,t){let i={codeExpiresIn:600,defaultScope:"openid",...t,scopes:["openid","profile","email","offline_access",...t?.scopes||[]]};if(!e.request)throw new s.APIError("UNAUTHORIZED",{error_description:"request not found",error:"invalid_request"});let r=await (0,n.g)(e);if(!r){await e.setSignedCookie("oidc_login_prompt",JSON.stringify(e.query),e.context.secret,{maxAge:600,path:"/",sameSite:"lax"});let i=e.request.url?.split("?")[1];throw e.redirect(`${t.loginPage}?${i}`)}let o=e.query;if(!o.client_id)throw e.redirect(`${e.context.baseURL}/error?error=invalid_client`);if(!o.response_type)throw e.redirect(p(`${e.context.baseURL}/error`,"invalid_request","response_type is required"));let a=await e.context.adapter.findOne({model:"oauthApplication",where:[{field:"clientId",value:e.query.client_id}]}).then(e=>e?{...e,redirectURLs:e.redirectURLs.split(","),metadata:e.metadata?JSON.parse(e.metadata):{}}:null);if(!a)throw e.redirect(`${e.context.baseURL}/error?error=invalid_client`);let d=a.redirectURLs.find(t=>t===e.query.redirect_uri);if(!d||!o.redirect_uri)throw new s.APIError("BAD_REQUEST",{message:"Invalid redirect URI"});if(a.disabled)throw e.redirect(`${e.context.baseURL}/error?error=client_disabled`);if("code"!==o.response_type)throw e.redirect(`${e.context.baseURL}/error?error=unsupported_response_type`);let l=o.scope?.split(" ").filter(e=>e)||i.defaultScope.split(" "),c=l.filter(e=>!i.scopes.includes(e)||"offline_access"===e&&"consent"!==o.prompt);if(c.length)throw e.redirect(p(o.redirect_uri,"invalid_scope",`The following scopes are invalid: ${c.join(", ")}`));if((!o.code_challenge||!o.code_challenge_method)&&t.requirePKCE)throw e.redirect(p(o.redirect_uri,"invalid_request","pkce is required"));if(o.code_challenge_method||(o.code_challenge_method="plain"),!["s256",t.allowPlainCodeChallengeMethod?"plain":"s256"].includes(o.code_challenge_method?.toLowerCase()||""))throw e.redirect(p(o.redirect_uri,"invalid_request","invalid code_challenge method"));let h=(0,u.g)(32,"a-z","A-Z","0-9"),m=1e3*i.codeExpiresIn,f=new Date(Date.now()+m);try{await e.context.internalAdapter.createVerificationValue({value:JSON.stringify({clientId:a.clientId,redirectURI:o.redirect_uri,scope:l,userId:r.user.id,authTime:r.session.createdAt.getTime(),requireConsent:"consent"===o.prompt,state:"consent"===o.prompt?o.state:null,codeChallenge:o.code_challenge,codeChallengeMethod:o.code_challenge_method,nonce:o.nonce}),identifier:h,expiresAt:f},e)}catch(t){throw e.redirect(p(o.redirect_uri,"server_error","An error occurred while processing the request"))}let A=new URL(d);if(A.searchParams.set("code",h),A.searchParams.set("state",e.query.state),"consent"!==o.prompt||await e.context.adapter.findOne({model:"oauthConsent",where:[{field:"clientId",value:a.clientId},{field:"userId",value:r.user.id}]}).then(e=>!!e?.consentGiven))throw e.redirect(A.toString());if(t?.consentPage){await e.setSignedCookie("oidc_consent_prompt",h,e.context.secret,{maxAge:600,path:"/",sameSite:"lax"});let i=`${t.consentPage}?client_id=${a.clientId}&scope=${l.join(" ")}`;throw e.redirect(i)}let g=t?.getConsentHTML;if(!g)throw new s.APIError("INTERNAL_SERVER_ERROR",{message:"No consent page provided"});return new Response(g({scopes:l,clientMetadata:a.metadata,clientIcon:a?.icon,clientId:a.clientId,clientName:a.name,code:h}),{headers:{"content-type":"text/html"}})}let i=(e,t)=>{let i=e.context.options.baseURL,r=e.context.baseURL;return{issuer:i,authorization_endpoint:`${r}/oauth2/authorize`,token_endpoint:`${r}/oauth2/token`,userinfo_endpoint:`${r}/oauth2/userinfo`,jwks_uri:`${r}/jwks`,registration_endpoint:`${r}/oauth2/register`,scopes_supported:["openid","profile","email","offline_access"],response_types_supported:["code"],response_modes_supported:["query"],grant_types_supported:["authorization_code"],acr_values_supported:["urn:mace:incommon:iap:silver","urn:mace:incommon:iap:bronze"],subject_types_supported:["public"],id_token_signing_alg_values_supported:["RS256","none"],token_endpoint_auth_methods_supported:["client_secret_basic","client_secret_post"],claims_supported:["sub","iss","aud","exp","nbf","iat","jti","email","email_verified","name"],...t?.metadata}},m=e=>{let p={oauthClient:"oauthApplication",oauthAccessToken:"oauthAccessToken",oauthConsent:"oauthConsent"},m={codeExpiresIn:600,defaultScope:"openid",accessTokenExpiresIn:3600,refreshTokenExpiresIn:604800,allowPlainCodeChallengeMethod:!0,...e,scopes:["openid","profile","email","offline_access",...e?.scopes||[]]};return{id:"oidc",hooks:{after:[{matcher:()=>!0,handler:(0,n.c)(async e=>{let t=await e.getSignedCookie("oidc_login_prompt",e.context.secret),i=e.context.authCookies.sessionToken.name,r=(0,d.parseSetCookieHeader)(e.context.responseHeaders?.get("set-cookie")||""),o=r.has(i);if(!t||!o)return;e.setCookie("oidc_login_prompt","",{maxAge:0});let s=r.get(i)?.value,n=s?.split(".")[0];if(!n)return;let a=await e.context.internalAdapter.findSession(n);if(a)return e.query=JSON.parse(t),e.query.prompt="consent",e.context.session=a,await h(e,m)})}]},endpoints:{getOpenIdConfig:(0,n.a)("/.well-known/openid-configuration",{method:"GET",metadata:{isAction:!1}},async t=>{let r=i(t,e);return t.json(r)}),oAuth2authorize:(0,n.a)("/oauth2/authorize",{method:"GET",query:o.z.record(o.z.string(),o.z.any()),metadata:{openapi:{description:"Authorize an OAuth2 request",responses:{200:{description:"Authorization response generated successfully",content:{"application/json":{schema:{type:"object",additionalProperties:!0,description:"Authorization response, contents depend on the authorize function implementation"}}}}}}}},async e=>h(e,m)),oAuthConsent:(0,n.a)("/oauth2/consent",{method:"POST",body:o.z.object({accept:o.z.boolean()}),use:[n.s],metadata:{openapi:{description:"Handle OAuth2 consent",responses:{200:{description:"Consent processed successfully",content:{"application/json":{schema:{type:"object",properties:{redirectURI:{type:"string",format:"uri",description:"The URI to redirect to, either with an authorization code or an error"}},required:["redirectURI"]}}}}}}}},async e=>{let t=await e.getSignedCookie("oidc_consent_prompt",e.context.secret);if(!t)throw new s.APIError("UNAUTHORIZED",{error_description:"No consent prompt found",error:"invalid_request"});let i=await e.context.internalAdapter.findVerificationValue(t);if(!i)throw new s.APIError("UNAUTHORIZED",{error_description:"Invalid code",error:"invalid_request"});if(i.expiresAt<new Date)throw new s.APIError("UNAUTHORIZED",{error_description:"Code expired",error:"invalid_request"});let r=JSON.parse(i.value);if(!r.requireConsent||!r.state)throw new s.APIError("UNAUTHORIZED",{error_description:"Consent not required",error:"invalid_request"});if(!e.body.accept)return await e.context.internalAdapter.deleteVerificationValue(i.id),e.json({redirectURI:`${r.redirectURI}?error=access_denied&error_description=User denied access`});let o=(0,u.g)(32,"a-z","A-Z","0-9"),n=1e3*m.codeExpiresIn,a=new Date(Date.now()+n);await e.context.internalAdapter.updateVerificationValue(i.id,{value:JSON.stringify({...r,requireConsent:!1}),identifier:o,expiresAt:a}),await e.context.adapter.create({model:p.oauthConsent,data:{clientId:r.clientId,userId:r.userId,scopes:r.scope.join(" "),consentGiven:!0,createdAt:new Date,updatedAt:new Date}});let d=new URL(r.redirectURI);return d.searchParams.set("code",o),d.searchParams.set("state",r.state),e.json({redirectURI:d.toString()})}),oAuth2token:(0,n.a)("/oauth2/token",{method:"POST",body:o.z.record(o.z.any()),metadata:{isAction:!1}},async t=>{let{body:i}=t;if(!i)throw new s.APIError("BAD_REQUEST",{error_description:"request body not found",error:"invalid_request"});if(i instanceof FormData&&(i=Object.fromEntries(i.entries())),!(i instanceof Object))throw new s.APIError("BAD_REQUEST",{error_description:"request body is not an object",error:"invalid_request"});let{client_id:o,client_secret:n}=i,d=t.request?.headers.get("authorization")||null;if(d&&!o&&!n&&d.startsWith("Basic "))try{let e=d.replace("Basic ",""),t=new TextDecoder().decode(a.base64.decode(e));if(!t.includes(":"))throw new s.APIError("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"});let[i,r]=t.split(":");if(!i||!r)throw new s.APIError("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"});o=i,n=r}catch(e){throw new s.APIError("UNAUTHORIZED",{error_description:"invalid authorization header format",error:"invalid_client"})}let{grant_type:h,code:f,redirect_uri:A,refresh_token:g,code_verifier:y}=i;if("refresh_token"===h){if(!g)throw new s.APIError("BAD_REQUEST",{error_description:"refresh_token is required",error:"invalid_request"});let e=await t.context.adapter.findOne({model:p.oauthAccessToken,where:[{field:"refreshToken",value:g.toString()}]});if(!e)throw new s.APIError("UNAUTHORIZED",{error_description:"invalid refresh token",error:"invalid_grant"});if(e.clientId!==o?.toString())throw new s.APIError("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(e.refreshTokenExpiresAt<new Date)throw new s.APIError("UNAUTHORIZED",{error_description:"refresh token expired",error:"invalid_grant"});let i=(0,u.g)(32,"a-z","A-Z"),r=(0,u.g)(32,"a-z","A-Z"),n=new Date(Date.now()+1e3*m.accessTokenExpiresIn),a=new Date(Date.now()+1e3*m.refreshTokenExpiresIn);return await t.context.adapter.create({model:p.oauthAccessToken,data:{accessToken:i,refreshToken:r,accessTokenExpiresAt:n,refreshTokenExpiresAt:a,clientId:o.toString(),userId:e.userId,scopes:e.scopes,createdAt:new Date,updatedAt:new Date}}),t.json({access_token:i,token_type:"bearer",expires_in:m.accessTokenExpiresIn,refresh_token:r,scope:e.scopes})}if(!f)throw new s.APIError("BAD_REQUEST",{error_description:"code is required",error:"invalid_request"});if(e.requirePKCE&&!y)throw new s.APIError("BAD_REQUEST",{error_description:"code verifier is missing",error:"invalid_request"});let K=await t.context.internalAdapter.findVerificationValue(f.toString());if(!K)throw new s.APIError("UNAUTHORIZED",{error_description:"invalid code",error:"invalid_grant"});if(K.expiresAt<new Date)throw new s.APIError("UNAUTHORIZED",{error_description:"code expired",error:"invalid_grant"});if(await t.context.internalAdapter.deleteVerificationValue(K.id),!o||!n)throw new s.APIError("UNAUTHORIZED",{error_description:"client_id and client_secret are required",error:"invalid_client"});if(!h)throw new s.APIError("BAD_REQUEST",{error_description:"grant_type is required",error:"invalid_request"});if("authorization_code"!==h)throw new s.APIError("BAD_REQUEST",{error_description:"grant_type must be 'authorization_code'",error:"unsupported_grant_type"});if(!A)throw new s.APIError("BAD_REQUEST",{error_description:"redirect_uri is required",error:"invalid_request"});let w=await t.context.adapter.findOne({model:p.oauthClient,where:[{field:"clientId",value:o.toString()}]}).then(e=>e?{...e,redirectURLs:e.redirectURLs.split(","),metadata:e.metadata?JSON.parse(e.metadata):{}}:null);if(!w)throw new s.APIError("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(w.disabled)throw new s.APIError("UNAUTHORIZED",{error_description:"client is disabled",error:"invalid_client"});if(w.clientSecret!==n.toString())throw new s.APIError("UNAUTHORIZED",{error_description:"invalid client_secret",error:"invalid_client"});let v=JSON.parse(K.value);if(v.clientId!==o.toString())throw new s.APIError("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(v.redirectURI!==A.toString())throw new s.APIError("UNAUTHORIZED",{error_description:"invalid redirect_uri",error:"invalid_client"});if(v.codeChallenge&&!y)throw new s.APIError("BAD_REQUEST",{error_description:"code verifier is missing",error:"invalid_request"});if(("plain"===v.codeChallengeMethod?y:await (0,l.createHash)("SHA-256","base64urlnopad").digest(y))!==v.codeChallenge)throw new s.APIError("UNAUTHORIZED",{error_description:"code verification failed",error:"invalid_request"});let b=v.scope;await t.context.internalAdapter.deleteVerificationValue(K.id);let _=(0,u.g)(32,"a-z","A-Z"),N=(0,u.g)(32,"A-Z","a-z"),I=new Date(Date.now()+1e3*m.accessTokenExpiresIn),E=new Date(Date.now()+1e3*m.refreshTokenExpiresIn);await t.context.adapter.create({model:p.oauthAccessToken,data:{accessToken:_,refreshToken:N,accessTokenExpiresAt:I,refreshTokenExpiresAt:E,clientId:o.toString(),userId:v.userId,scopes:b.join(" "),createdAt:new Date,updatedAt:new Date}});let T=await t.context.internalAdapter.findUserById(v.userId);if(!T)throw new s.APIError("UNAUTHORIZED",{error_description:"user not found",error:"invalid_grant"});let C={alg:"HS256",key:await c.subtle.generateKey({name:"HMAC",hash:"SHA-256"},!0,["sign","verify"])},x={given_name:T.name.split(" ")[0],family_name:T.name.split(" ")[1],name:T.name,profile:T.image,updated_at:T.updatedAt.toISOString()},O={email:T.email,email_verified:T.emailVerified},S={...b.includes("profile")?x:{},...b.includes("email")?O:{}},k=e.getAdditionalUserInfoClaim?e.getAdditionalUserInfoClaim(T,b):{},R=await new r.SignJWT({sub:T.id,aud:o.toString(),iat:Date.now(),auth_time:t.context.session?.session.createdAt.getTime(),nonce:v.nonce,acr:"urn:mace:incommon:iap:silver",...S,...k}).setProtectedHeader({alg:C.alg}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+m.accessTokenExpiresIn).sign(C.key);return t.json({access_token:_,token_type:"Bearer",expires_in:m.accessTokenExpiresIn,refresh_token:b.includes("offline_access")?N:void 0,scope:b.join(" "),id_token:b.includes("openid")?R:void 0},{headers:{"Cache-Control":"no-store",Pragma:"no-cache"}})}),oAuth2userInfo:(0,n.a)("/oauth2/userinfo",{method:"GET",metadata:{isAction:!1,openapi:{description:"Get OAuth2 user information",responses:{200:{description:"User information retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{sub:{type:"string",description:"Subject identifier (user ID)"},email:{type:"string",format:"email",nullable:!0,description:"User's email address, included if 'email' scope is granted"},name:{type:"string",nullable:!0,description:"User's full name, included if 'profile' scope is granted"},picture:{type:"string",format:"uri",nullable:!0,description:"User's profile picture URL, included if 'profile' scope is granted"},given_name:{type:"string",nullable:!0,description:"User's given name, included if 'profile' scope is granted"},family_name:{type:"string",nullable:!0,description:"User's family name, included if 'profile' scope is granted"},email_verified:{type:"boolean",nullable:!0,description:"Whether the email is verified, included if 'email' scope is granted"}},required:["sub"]}}}}}}}},async t=>{if(!t.request)throw new s.APIError("UNAUTHORIZED",{error_description:"request not found",error:"invalid_request"});let i=t.request.headers.get("authorization");if(!i)throw new s.APIError("UNAUTHORIZED",{error_description:"authorization header not found",error:"invalid_request"});let r=i.replace("Bearer ",""),o=await t.context.adapter.findOne({model:p.oauthAccessToken,where:[{field:"accessToken",value:r}]});if(!o)throw new s.APIError("UNAUTHORIZED",{error_description:"invalid access token",error:"invalid_token"});if(o.accessTokenExpiresAt<new Date)throw new s.APIError("UNAUTHORIZED",{error_description:"The Access Token expired",error:"invalid_token"});let n=await t.context.internalAdapter.findUserById(o.userId);if(!n)throw new s.APIError("UNAUTHORIZED",{error_description:"user not found",error:"invalid_token"});let a=o.scopes.split(" "),d={sub:n.id,email:a.includes("email")?n.email:void 0,name:a.includes("profile")?n.name:void 0,picture:a.includes("profile")?n.image:void 0,given_name:a.includes("profile")?n.name.split(" ")[0]:void 0,family_name:a.includes("profile")?n.name.split(" ")[1]:void 0,email_verified:a.includes("email")?n.emailVerified:void 0},l=e.getAdditionalUserInfoClaim?e.getAdditionalUserInfoClaim(n,a):d;return t.json({...d,...l})}),registerOAuthApplication:(0,n.a)("/oauth2/register",{method:"POST",body:o.z.object({redirect_uris:o.z.array(o.z.string()),token_endpoint_auth_method:o.z.enum(["none","client_secret_basic","client_secret_post"]).default("client_secret_basic").optional(),grant_types:o.z.array(o.z.enum(["authorization_code","implicit","password","client_credentials","refresh_token","urn:ietf:params:oauth:grant-type:jwt-bearer","urn:ietf:params:oauth:grant-type:saml2-bearer"])).default(["authorization_code"]).optional(),response_types:o.z.array(o.z.enum(["code","token"])).default(["code"]).optional(),client_name:o.z.string().optional(),client_uri:o.z.string().optional(),logo_uri:o.z.string().optional(),scope:o.z.string().optional(),contacts:o.z.array(o.z.string()).optional(),tos_uri:o.z.string().optional(),policy_uri:o.z.string().optional(),jwks_uri:o.z.string().optional(),jwks:o.z.record(o.z.any()).optional(),metadata:o.z.record(o.z.any()).optional(),software_id:o.z.string().optional(),software_version:o.z.string().optional(),software_statement:o.z.string().optional()}),metadata:{openapi:{description:"Register an OAuth2 application",responses:{200:{description:"OAuth2 application registered successfully",content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"Name of the OAuth2 application"},icon:{type:"string",nullable:!0,description:"Icon URL for the application"},metadata:{type:"object",additionalProperties:!0,nullable:!0,description:"Additional metadata for the application"},clientId:{type:"string",description:"Unique identifier for the client"},clientSecret:{type:"string",description:"Secret key for the client"},redirectURLs:{type:"array",items:{type:"string",format:"uri"},description:"List of allowed redirect URLs"},type:{type:"string",description:"Type of the client",enum:["web"]},authenticationScheme:{type:"string",description:"Authentication scheme used by the client",enum:["client_secret"]},disabled:{type:"boolean",description:"Whether the client is disabled",enum:[!1]},userId:{type:"string",nullable:!0,description:"ID of the user who registered the client, null if registered anonymously"},createdAt:{type:"string",format:"date-time",description:"Creation timestamp"},updatedAt:{type:"string",format:"date-time",description:"Last update timestamp"}},required:["name","clientId","clientSecret","redirectURLs","type","authenticationScheme","disabled","createdAt","updatedAt"]}}}}}}}},async t=>{let i=t.body,r=await (0,n.g)(t);if(!r&&!e.allowDynamicClientRegistration)throw new s.APIError("UNAUTHORIZED",{error:"invalid_token",error_description:"Authentication required for client registration"});if((!i.grant_types||i.grant_types.includes("authorization_code")||i.grant_types.includes("implicit"))&&(!i.redirect_uris||0===i.redirect_uris.length))throw new s.APIError("BAD_REQUEST",{error:"invalid_redirect_uri",error_description:"Redirect URIs are required for authorization_code and implicit grant types"});if(i.grant_types&&i.response_types){if(i.grant_types.includes("authorization_code")&&!i.response_types.includes("code"))throw new s.APIError("BAD_REQUEST",{error:"invalid_client_metadata",error_description:"When 'authorization_code' grant type is used, 'code' response type must be included"});if(i.grant_types.includes("implicit")&&!i.response_types.includes("token"))throw new s.APIError("BAD_REQUEST",{error:"invalid_client_metadata",error_description:"When 'implicit' grant type is used, 'token' response type must be included"})}let o=e.generateClientId?.()||(0,u.g)(32,"a-z","A-Z"),a=e.generateClientSecret?.()||(0,u.g)(32,"a-z","A-Z");return await t.context.adapter.create({model:p.oauthClient,data:{name:i.client_name,icon:i.logo_uri,metadata:i.metadata?JSON.stringify(i.metadata):null,clientId:o,clientSecret:a,redirectURLs:i.redirect_uris.join(","),type:"web",authenticationScheme:i.token_endpoint_auth_method||"client_secret_basic",disabled:!1,userId:r?.session.userId,createdAt:new Date,updatedAt:new Date}}),t.json({client_id:o,client_secret:a,client_id_issued_at:Math.floor(Date.now()/1e3),client_secret_expires_at:0,redirect_uris:i.redirect_uris,token_endpoint_auth_method:i.token_endpoint_auth_method||"client_secret_basic",grant_types:i.grant_types||["authorization_code"],response_types:i.response_types||["code"],client_name:i.client_name,client_uri:i.client_uri,logo_uri:i.logo_uri,scope:i.scope,contacts:i.contacts,tos_uri:i.tos_uri,policy_uri:i.policy_uri,jwks_uri:i.jwks_uri,jwks:i.jwks,software_id:i.software_id,software_version:i.software_version,software_statement:i.software_statement,metadata:i.metadata},{status:201,headers:{"Cache-Control":"no-store",Pragma:"no-cache"}})}),getOAuthClient:(0,n.a)("/oauth2/client/:id",{method:"GET",use:[n.s],metadata:{openapi:{description:"Get OAuth2 client details",responses:{200:{description:"OAuth2 client retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{clientId:{type:"string",description:"Unique identifier for the client"},name:{type:"string",description:"Name of the OAuth2 application"},icon:{type:"string",nullable:!0,description:"Icon URL for the application"}},required:["clientId","name"]}}}}}}}},async e=>{let t=await e.context.adapter.findOne({model:p.oauthClient,where:[{field:"clientId",value:e.params.id}]});if(!t)throw new s.APIError("NOT_FOUND",{error_description:"client not found",error:"not_found"});return e.json({clientId:t.clientId,name:t.name,icon:t.icon})})},schema:t}}}},942738:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({captcha:()=>h});var r=e.i(137942);let t=["/sign-up/email","/sign-in/email","/forget-password"],i={CLOUDFLARE_TURNSTILE:"cloudflare-turnstile",GOOGLE_RECAPTCHA:"google-recaptcha",HCAPTCHA:"hcaptcha"},o={[i.CLOUDFLARE_TURNSTILE]:"https://challenges.cloudflare.com/turnstile/v0/siteverify",[i.GOOGLE_RECAPTCHA]:"https://www.google.com/recaptcha/api/siteverify",[i.HCAPTCHA]:"https://api.hcaptcha.com/siteverify"},s={VERIFICATION_FAILED:"Captcha verification failed",MISSING_RESPONSE:"Missing CAPTCHA response",UNKNOWN_ERROR:"Something went wrong"},n={MISSING_SECRET_KEY:"Missing secret key",SERVICE_UNAVAILABLE:"CAPTCHA service unavailable"},a=({message:e,status:t})=>({response:new Response(JSON.stringify({message:e}),{status:t})}),d=async({siteVerifyURL:e,captchaResponse:t,secretKey:i,remoteIP:o})=>{let d=await (0,r.betterFetch)(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:i,response:t,...o&&{remoteip:o}})});if(!d.data||d.error)throw Error(n.SERVICE_UNAVAILABLE);if(!d.data.success)return a({message:s.VERIFICATION_FAILED,status:403})},l=e=>{if("object"!=typeof e||null===e||Array.isArray(e))throw Error("Input must be a non-null object.");let t=new URLSearchParams;for(let[i,r]of Object.entries(e))null!=r&&t.append(i,String(r));return t.toString()},c=e=>"score"in e&&"number"==typeof e.score,u=async({siteVerifyURL:e,captchaResponse:t,secretKey:i,minScore:o=.5,remoteIP:d})=>{let u=await (0,r.betterFetch)(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l({secret:i,response:t,...d&&{remoteip:d}})});if(!u.data||u.error)throw Error(n.SERVICE_UNAVAILABLE);if(!u.data.success||c(u.data)&&u.data.score<o)return a({message:s.VERIFICATION_FAILED,status:403})},p=async({siteVerifyURL:e,captchaResponse:t,secretKey:i,siteKey:o,remoteIP:d})=>{let c=await (0,r.betterFetch)(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l({secret:i,response:t,...o&&{sitekey:o},...d&&{remoteip:d}})});if(!c.data||c.error)throw Error(n.SERVICE_UNAVAILABLE);if(!c.data.success)return a({message:s.VERIFICATION_FAILED,status:403})},h=e=>({id:"captcha",onRequest:async(r,l)=>{try{if(!(e.endpoints?.length?e.endpoints:t).some(e=>r.url.includes(e)))return;if(!e.secretKey)throw Error(n.MISSING_SECRET_KEY);let l=r.headers.get("x-captcha-response"),c=r.headers.get("x-captcha-user-remote-ip")??void 0;if(!l)return a({message:s.MISSING_RESPONSE,status:400});let h={siteVerifyURL:e.siteVerifyURLOverride||o[e.provider],captchaResponse:l,secretKey:e.secretKey,remoteIP:c};if(e.provider===i.CLOUDFLARE_TURNSTILE)return await d(h);if(e.provider===i.GOOGLE_RECAPTCHA)return await u({...h,minScore:e.minScore});if(e.provider===i.HCAPTCHA)return await p({...h,siteKey:e.siteKey})}catch(t){let e=t instanceof Error?t.message:void 0;return l.logger.error(e??"Unknown error",{endpoint:r.url,message:t}),a({message:s.UNKNOWN_ERROR,status:500})}}})}},85633:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({haveIBeenPwned:()=>i});var r=e.i(311556);e.i(151176),e.i(243917),e.i(105127),e.i(483013),e.i(558692),e.i(776569),e.i(187615),e.i(306192);var o=e.i(74222),s=e.i(137942);e.i(328902),e.i(771884),e.i(692153),e.i(316944),e.i(664764),e.i(30483),e.i(561336),e.i(533004),e.i(91997),e.i(382320),e.i(4887),e.i(692218),e.i(628146),e.i(968915),e.i(504506);let t={PASSWORD_COMPROMISED:"The password you entered has been compromised. Please choose a different password."};async function n(e,i){if(!e)return;let n=(await (0,o.createHash)("SHA-1","hex").digest(e)).toUpperCase(),a=n.substring(0,5),d=n.substring(5);try{let{data:e,error:o}=await (0,s.betterFetch)(`https://api.pwnedpasswords.com/range/${a}`,{headers:{"Add-Padding":"true","User-Agent":"BetterAuth Password Checker"}});if(o)throw new r.APIError("INTERNAL_SERVER_ERROR",{message:`Failed to check password. Status: ${o.status}`});if(e.split("\n").some(e=>e.split(":")[0].toUpperCase()===d.toUpperCase()))throw new r.APIError("BAD_REQUEST",{message:i||t.PASSWORD_COMPROMISED,code:"PASSWORD_COMPROMISED"})}catch(e){if(e instanceof r.APIError)throw e;throw new r.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to check password. Please try again later."})}}let i=e=>({id:"haveIBeenPwned",init:t=>({context:{password:{...t.password,hash:async i=>(await n(i,e?.customPasswordCompromisedMessage),t.password.hash(i))}}}),$ERROR_CODES:t})}},988051:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({oneTimeToken:()=>t}),e.i(243917);var r=e.i(81714);e.i(311556);var o=e.i(151176);e.i(105127),e.i(483013),e.i(558692),e.i(776569),e.i(793491),e.i(861464);var s=e.i(382320);e.i(187615),e.i(306192),e.i(74222),e.i(533004),e.i(91997),e.i(211588),e.i(39543),e.i(137942),e.i(4887),e.i(634882),e.i(328902),e.i(771884),e.i(692153),e.i(316944),e.i(664764),e.i(30483),e.i(561336),e.i(692218),e.i(628146),e.i(968915),e.i(504506),e.i(706567),e.i(345172),e.i(152967);let t=e=>({id:"one-time-token",endpoints:{generateOneTimeToken:(0,o.a)("/one-time-token/generate",{method:"GET",use:[o.s]},async t=>{if(e?.disableClientRequest&&t.request)throw t.error("BAD_REQUEST",{message:"Client requests are disabled"});let i=t.context.session,r=e?.generateToken?await e.generateToken(i,t):(0,s.g)(32),o=new Date(Date.now()+(e?.expiresIn??3)*6e4);return await t.context.internalAdapter.createVerificationValue({value:i.session.token,identifier:`one-time-token:${r}`,expiresAt:o}),t.json({token:r})}),verifyOneTimeToken:(0,o.a)("/one-time-token/verify",{method:"POST",body:r.z.object({token:r.z.string()})},async e=>{let{token:t}=e.body,i=await e.context.internalAdapter.findVerificationValue(`one-time-token:${t}`);if(!i)throw e.error("BAD_REQUEST",{message:"Invalid token"});if(i.expiresAt<new Date)throw await e.context.internalAdapter.deleteVerificationValue(i.id),e.error("BAD_REQUEST",{message:"Token expired"});await e.context.internalAdapter.deleteVerificationValue(i.id);let r=await e.context.internalAdapter.findSession(i.value);if(!r)throw e.error("BAD_REQUEST",{message:"Session not found"});return e.json(r)})}})}},141780:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({API_KEY_TABLE_NAME:()=>f,ERROR_CODES:()=>m,apiKey:()=>A,defaultKeyHasher:()=>i}),e.i(793491),e.i(843458),e.i(511127),e.i(493009);var r=e.i(151176);e.i(986279),e.i(592781),e.i(323238),e.i(587217),e.i(871487),e.i(170735),e.i(115605),e.i(694896),e.i(395484),e.i(757404),e.i(592337),e.i(623832),e.i(318752),e.i(942738);var o=e.i(311556);e.i(243917);var s=e.i(81714),n=e.i(692153);e.i(105127);var a=e.i(483013);e.i(558692);var d=e.i(776569);e.i(187615);var l=e.i(654520);e.i(306192),e.i(4887);var c=e.i(74222);e.i(533004),e.i(91997),e.i(382320);var u=e.i(706567),p=e.i(316944),h=e.i(152967);e.i(85633),e.i(988051),e.i(383120),e.i(771884),e.i(345172),e.i(861464),e.i(328902),e.i(664764),e.i(628146),e.i(169429),e.i(896775),e.i(968915),e.i(211588),e.i(55262),e.i(30483),e.i(137942),e.i(561336),e.i(692218),e.i(504506),e.i(82131),e.i(234901),e.i(39543),e.i(634882),e.i(277337),e.i(955759);let t=({timeWindow:e,rateLimitMax:t})=>({apikey:{fields:{name:{type:"string",required:!1,input:!1},start:{type:"string",required:!1,input:!1},prefix:{type:"string",required:!1,input:!1},key:{type:"string",required:!0,input:!1},userId:{type:"string",references:{model:"user",field:"id"},required:!0,input:!1},refillInterval:{type:"number",required:!1,input:!1},refillAmount:{type:"number",required:!1,input:!1},lastRefillAt:{type:"date",required:!1,input:!1},enabled:{type:"boolean",required:!1,input:!1,defaultValue:!0},rateLimitEnabled:{type:"boolean",required:!1,input:!1,defaultValue:!0},rateLimitTimeWindow:{type:"number",required:!1,input:!1,defaultValue:e},rateLimitMax:{type:"number",required:!1,input:!1,defaultValue:t},requestCount:{type:"number",required:!1,input:!1,defaultValue:0},remaining:{type:"number",required:!1,input:!1},lastRequest:{type:"date",required:!1,input:!1},expiresAt:{type:"date",required:!1,input:!1},createdAt:{type:"date",required:!0,input:!1},updatedAt:{type:"date",required:!0,input:!1},permissions:{type:"string",required:!1,input:!1},metadata:{type:"string",required:!1,input:!0,transform:{input:e=>JSON.stringify(e),output:e=>e?(0,u.p)(e):null}}}}}),i=async e=>{let t=await (0,c.createHash)("SHA-256").digest(new TextEncoder().encode(e));return a.base64Url.encode(new Uint8Array(t),{padding:!1})},m={INVALID_METADATA_TYPE:"metadata must be an object or undefined",REFILL_AMOUNT_AND_INTERVAL_REQUIRED:"refillAmount is required when refillInterval is provided",REFILL_INTERVAL_AND_AMOUNT_REQUIRED:"refillInterval is required when refillAmount is provided",USER_BANNED:"User is banned",UNAUTHORIZED_SESSION:"Unauthorized or invalid session",KEY_NOT_FOUND:"API Key not found",KEY_DISABLED:"API Key is disabled",KEY_EXPIRED:"API Key has expired",USAGE_EXCEEDED:"API Key has reached its usage limit",KEY_NOT_RECOVERABLE:"API Key is not recoverable",EXPIRES_IN_IS_TOO_SMALL:"The expiresIn is smaller than the predefined minimum value.",EXPIRES_IN_IS_TOO_LARGE:"The expiresIn is larger than the predefined maximum value.",INVALID_REMAINING:"The remaining count is either too large or too small.",INVALID_PREFIX_LENGTH:"The prefix length is either too large or too small.",INVALID_NAME_LENGTH:"The name length is either too large or too small.",METADATA_DISABLED:"Metadata is disabled.",RATE_LIMIT_EXCEEDED:"Rate limit exceeded.",NO_VALUES_TO_UPDATE:"No values to update.",KEY_DISABLED_EXPIRATION:"Custom key expiration values are disabled.",INVALID_API_KEY:"Invalid API key.",INVALID_USER_ID_FROM_API_KEY:"The user id from the API key is invalid.",INVALID_API_KEY_GETTER_RETURN_TYPE:"API Key getter returned an invalid key type. Expected string.",SERVER_ONLY_PROPERTY:"The property you're trying to set can only be set from the server auth instance only."},f="apikey",A=e=>{let a={...e,apiKeyHeaders:e?.apiKeyHeaders??"x-api-key",defaultKeyLength:e?.defaultKeyLength||64,maximumPrefixLength:e?.maximumPrefixLength??32,minimumPrefixLength:e?.minimumPrefixLength??1,maximumNameLength:e?.maximumNameLength??32,minimumNameLength:e?.minimumNameLength??1,enableMetadata:e?.enableMetadata??!1,disableKeyHashing:e?.disableKeyHashing??!1,rateLimit:{enabled:e?.rateLimit?.enabled===void 0||e?.rateLimit?.enabled,timeWindow:e?.rateLimit?.timeWindow??864e5,maxRequests:e?.rateLimit?.maxRequests??10},keyExpiration:{defaultExpiresIn:e?.keyExpiration?.defaultExpiresIn??null,disableCustomExpiresTime:e?.keyExpiration?.disableCustomExpiresTime??!1,maxExpiresIn:e?.keyExpiration?.maxExpiresIn??365,minExpiresIn:e?.keyExpiration?.minExpiresIn??1},startingCharactersConfig:{shouldStore:e?.startingCharactersConfig?.shouldStore??!0,charactersLength:e?.startingCharactersConfig?.charactersLength??6},disableSessionForAPIKeys:e?.disableSessionForAPIKeys??!1},c=(0,d.m)(t({rateLimitMax:a.rateLimit.maxRequests,timeWindow:a.rateLimit.timeWindow}),a.schema),u=a.customAPIKeyGetter||(e=>{if(!Array.isArray(a.apiKeyHeaders))return e.headers?.get(a.apiKeyHeaders);for(let t of a.apiKeyHeaders){let i=e.headers?.get(t);if(i)return i}}),A=function({keyGenerator:e,opts:t,schema:a}){let d=null;function l(e,t=!1){if(!(d&&!t&&new Date().getTime()-d.getTime()<1e4)){d=new Date;try{return e.adapter.deleteMany({model:f,where:[{field:"expiresAt",operator:"lt",value:new Date}]})}catch(t){e.logger.error("Failed to delete expired API keys:",t)}}}return{createApiKey:function({keyGenerator:e,opts:t,schema:a,deleteAllExpiredApiKeys:d}){return(0,r.a)("/api-key/create",{method:"POST",body:s.z.object({name:s.z.string({description:"Name of the Api Key"}).optional(),expiresIn:s.z.number({description:"Expiration time of the Api Key in seconds"}).min(1).optional().nullable().default(null),userId:s.z.coerce.string({description:"User Id of the user that the Api Key belongs to. Useful for server-side only."}).optional(),prefix:s.z.string({description:"Prefix of the Api Key"}).regex(/^[a-zA-Z0-9_-]+$/,{message:"Invalid prefix format, must be alphanumeric and contain only underscores and hyphens."}).optional(),remaining:s.z.number({description:"Remaining number of requests. Server side only"}).min(0).optional().nullable().default(null),metadata:s.z.any({description:"Metadata of the Api Key"}).optional(),refillAmount:s.z.number({description:"Amount to refill the remaining count of the Api Key. Server Only Property"}).min(1).optional(),refillInterval:s.z.number({description:"Interval to refill the Api Key in milliseconds. Server Only Property."}).optional(),rateLimitTimeWindow:s.z.number({description:"The duration in milliseconds where each request is counted. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. Server Only Property."}).optional(),rateLimitMax:s.z.number({description:"Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. Server Only Property."}).optional(),rateLimitEnabled:s.z.boolean({description:"Whether the key has rate limiting enabled. Server Only Property."}).optional(),permissions:s.z.record(s.z.string(),s.z.array(s.z.string())).optional()}),metadata:{openapi:{description:"Create a new API key for a user",responses:{200:{description:"API key created successfully",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string",description:"Unique identifier of the API key"},createdAt:{type:"string",format:"date-time",description:"Creation timestamp"},updatedAt:{type:"string",format:"date-time",description:"Last update timestamp"},name:{type:"string",nullable:!0,description:"Name of the API key"},prefix:{type:"string",nullable:!0,description:"Prefix of the API key"},start:{type:"string",nullable:!0,description:"Starting characters of the key (if configured)"},key:{type:"string",description:"The full API key (only returned on creation)"},enabled:{type:"boolean",description:"Whether the key is enabled"},expiresAt:{type:"string",format:"date-time",nullable:!0,description:"Expiration timestamp"},userId:{type:"string",description:"ID of the user owning the key"},lastRefillAt:{type:"string",format:"date-time",nullable:!0,description:"Last refill timestamp"},lastRequest:{type:"string",format:"date-time",nullable:!0,description:"Last request timestamp"},metadata:{type:"object",nullable:!0,additionalProperties:!0,description:"Metadata associated with the key"},rateLimitMax:{type:"number",nullable:!0,description:"Maximum requests in time window"},rateLimitTimeWindow:{type:"number",nullable:!0,description:"Rate limit time window in milliseconds"},remaining:{type:"number",nullable:!0,description:"Remaining requests"},refillAmount:{type:"number",nullable:!0,description:"Amount to refill"},refillInterval:{type:"number",nullable:!0,description:"Refill interval in milliseconds"},rateLimitEnabled:{type:"boolean",description:"Whether rate limiting is enabled"},requestCount:{type:"number",description:"Current request count in window"},permissions:{type:"object",nullable:!0,additionalProperties:{type:"array",items:{type:"string"}},description:"Permissions associated with the key"}},required:["id","createdAt","updatedAt","key","enabled","userId","rateLimitEnabled","requestCount"]}}}}}}}},async s=>{let{name:l,expiresIn:c,prefix:u,remaining:h,metadata:A,refillAmount:g,refillInterval:y,permissions:K,rateLimitMax:w,rateLimitTimeWindow:v,rateLimitEnabled:b}=s.body,_=await (0,r.g)(s),N=(s.request||s.headers)&&!s.body.userId,I=_?.user??(N?null:{id:s.body.userId});if(!I?.id)throw new o.APIError("UNAUTHORIZED",{message:m.UNAUTHORIZED_SESSION});if(N&&(void 0!==g||void 0!==y||void 0!==w||void 0!==v||void 0!==b||void 0!==K||null!==h))throw new o.APIError("BAD_REQUEST",{message:m.SERVER_ONLY_PROPERTY});if(A){if(!1===t.enableMetadata)throw new o.APIError("BAD_REQUEST",{message:m.METADATA_DISABLED});if("object"!=typeof A)throw new o.APIError("BAD_REQUEST",{message:m.INVALID_METADATA_TYPE})}if(g&&!y)throw new o.APIError("BAD_REQUEST",{message:m.REFILL_AMOUNT_AND_INTERVAL_REQUIRED});if(y&&!g)throw new o.APIError("BAD_REQUEST",{message:m.REFILL_INTERVAL_AND_AMOUNT_REQUIRED});if(c){if(!0===t.keyExpiration.disableCustomExpiresTime)throw new o.APIError("BAD_REQUEST",{message:m.KEY_DISABLED_EXPIRATION});let e=c/86400;if(t.keyExpiration.minExpiresIn>e)throw new o.APIError("BAD_REQUEST",{message:m.EXPIRES_IN_IS_TOO_SMALL});if(t.keyExpiration.maxExpiresIn<e)throw new o.APIError("BAD_REQUEST",{message:m.EXPIRES_IN_IS_TOO_LARGE})}if(u&&(u.length<t.minimumPrefixLength||u.length>t.maximumPrefixLength))throw new o.APIError("BAD_REQUEST",{message:m.INVALID_PREFIX_LENGTH});if(l&&(l.length<t.minimumNameLength||l.length>t.maximumNameLength))throw new o.APIError("BAD_REQUEST",{message:m.INVALID_NAME_LENGTH});d(s.context);let E=await e({length:t.defaultKeyLength,prefix:u||t.defaultPrefix}),T=t.disableKeyHashing?E:await i(E),C=null;t.startingCharactersConfig.shouldStore&&(C=E.substring(0,t.startingCharactersConfig.charactersLength));let x=t.permissions?.defaultPermissions?"function"==typeof t.permissions.defaultPermissions?await t.permissions.defaultPermissions(I.id,s):t.permissions.defaultPermissions:void 0,O=K?JSON.stringify(K):x?JSON.stringify(x):void 0,S={createdAt:new Date,updatedAt:new Date,name:l??null,prefix:u??t.defaultPrefix??null,start:C,key:T,enabled:!0,expiresAt:c?(0,n.g)(c,"sec"):t.keyExpiration.defaultExpiresIn?(0,n.g)(t.keyExpiration.defaultExpiresIn,"sec"):null,userId:I.id,lastRefillAt:null,lastRequest:null,metadata:null,rateLimitMax:w??t.rateLimit.maxRequests??null,rateLimitTimeWindow:v??t.rateLimit.timeWindow??null,remaining:h||g||null,refillAmount:g??null,refillInterval:y??null,rateLimitEnabled:void 0===b?t.rateLimit.enabled??!0:b,requestCount:0,permissions:O};A&&(S.metadata=a.apikey.fields.metadata.transform.input(A));let k=await s.context.adapter.create({model:f,data:S});return s.json({...k,key:E,metadata:A??null,permissions:k.permissions?(0,p.s)(k.permissions):null})})}({keyGenerator:e,opts:t,schema:a,deleteAllExpiredApiKeys:l}),verifyApiKey:function({opts:e,schema:t,deleteAllExpiredApiKeys:o}){return(0,r.a)("/api-key/verify",{method:"POST",body:s.z.object({key:s.z.string({description:"The key to verify"}),permissions:s.z.record(s.z.string(),s.z.array(s.z.string())).optional()}),metadata:{SERVER_ONLY:!0}},async r=>{let{key:s}=r.body;if(s.length<e.defaultKeyLength||e.customAPIKeyValidator&&!e.customAPIKeyValidator({ctx:r,key:s}))return r.json({valid:!1,error:{message:m.INVALID_API_KEY,code:"KEY_NOT_FOUND"},key:null});let n=e.disableKeyHashing?s:await i(s),a=await r.context.adapter.findOne({model:f,where:[{field:"key",value:n}]});if(!a)return r.json({valid:!1,error:{message:m.KEY_NOT_FOUND,code:"KEY_NOT_FOUND"},key:null});if(!1===a.enabled)return r.json({valid:!1,error:{message:m.USAGE_EXCEEDED,code:"KEY_DISABLED"},key:null});if(a.expiresAt&&new Date().getTime()>a.expiresAt.getTime()){try{r.context.adapter.delete({model:f,where:[{field:"id",value:a.id}]})}catch(e){r.context.logger.error("Failed to delete expired API keys:",e)}return r.json({valid:!1,error:{message:m.KEY_EXPIRED,code:"KEY_EXPIRED"},key:null})}let d=r.body.permissions,l=a.permissions?(0,p.s)(a.permissions):null;if(d&&(!l||!(0,h.role)(l).authorize(d).success))return r.json({valid:!1,error:{message:m.KEY_NOT_FOUND,code:"KEY_NOT_FOUND"},key:null});let c=a.remaining,u=a.lastRefillAt;if(0===a.remaining&&null===a.refillAmount){try{r.context.adapter.delete({model:f,where:[{field:"id",value:a.id}]})}catch(e){r.context.logger.error("Failed to delete expired API keys:",e)}return r.json({valid:!1,error:{message:m.USAGE_EXCEEDED,code:"USAGE_EXCEEDED"},key:null})}if(null!==c){let e=new Date().getTime(),t=a.refillInterval,i=a.refillAmount,o=(u??a.createdAt).getTime();if(t&&i&&(e-o)/864e5>t&&(c=i,u=new Date),0===c)return r.json({valid:!1,error:{message:m.USAGE_EXCEEDED,code:"USAGE_EXCEEDED"},key:null});c--}let{message:A,success:g,update:y,tryAgainIn:K}=function(e,t){let i=new Date,r=e.lastRequest,o=e.rateLimitTimeWindow,s=e.rateLimitMax,n=e.requestCount;if(!1===t.rateLimit.enabled||!1===e.rateLimitEnabled)return{success:!0,message:null,update:{lastRequest:i},tryAgainIn:null};if(null===o||null===s)return{success:!0,message:null,update:null,tryAgainIn:null};if(null===r)return{success:!0,message:null,update:{lastRequest:i,requestCount:1},tryAgainIn:null};let a=i.getTime()-r.getTime();return a>o?{success:!0,message:null,update:{lastRequest:i,requestCount:1},tryAgainIn:null}:n>=s?{success:!1,message:m.RATE_LIMIT_EXCEEDED,update:null,tryAgainIn:Math.ceil(o-a)}:{success:!0,message:null,tryAgainIn:null,update:{lastRequest:i,requestCount:++n}}}(a,e),w=await r.context.adapter.update({model:f,where:[{field:"id",value:a.id}],update:{...y,remaining:c,lastRefillAt:u}});if(!1===g)return r.json({valid:!1,error:{message:A,code:"RATE_LIMITED",details:{tryAgainIn:K}},key:null});o(r.context);let{key:v,...b}=w??{key:1,permissions:void 0};return"metadata"in b&&(b.metadata=t.apikey.fields.metadata.transform.output(b.metadata)),b.permissions=b.permissions?(0,p.s)(b.permissions):null,r.json({valid:!0,error:null,key:null===w?null:b})})}({opts:t,schema:a,deleteAllExpiredApiKeys:l}),getApiKey:function({opts:e,schema:t,deleteAllExpiredApiKeys:i}){return(0,r.a)("/api-key/get",{method:"GET",query:s.z.object({id:s.z.string({description:"The id of the Api Key"})}),use:[r.s],metadata:{openapi:{description:"Retrieve an existing API key by ID",responses:{200:{description:"API key retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string",description:"ID"},name:{type:"string",nullable:!0,description:"The name of the key"},start:{type:"string",nullable:!0,description:"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key."},prefix:{type:"string",nullable:!0,description:"The API Key prefix. Stored as plain text."},userId:{type:"string",description:"The owner of the user id"},refillInterval:{type:"number",nullable:!0,description:"The interval in which the `remaining` count is refilled by day. Example: 1 // every day"},refillAmount:{type:"number",nullable:!0,description:"The amount to refill"},lastRefillAt:{type:"string",format:"date-time",nullable:!0,description:"The last refill date"},enabled:{type:"boolean",description:"Sets if key is enabled or disabled",default:!0},rateLimitEnabled:{type:"boolean",description:"Whether the key has rate limiting enabled"},rateLimitTimeWindow:{type:"number",nullable:!0,description:"The duration in milliseconds"},rateLimitMax:{type:"number",nullable:!0,description:"Maximum amount of requests allowed within a window"},requestCount:{type:"number",description:"The number of requests made within the rate limit time window"},remaining:{type:"number",nullable:!0,description:"Remaining requests (every time api key is used this should updated and should be updated on refill as well)"},lastRequest:{type:"string",format:"date-time",nullable:!0,description:"When last request occurred"},expiresAt:{type:"string",format:"date-time",nullable:!0,description:"Expiry date of a key"},createdAt:{type:"string",format:"date-time",description:"created at"},updatedAt:{type:"string",format:"date-time",description:"updated at"},metadata:{type:"object",nullable:!0,additionalProperties:!0,description:"Extra metadata about the apiKey"},permissions:{type:"string",nullable:!0,description:"Permissions for the api key (stored as JSON string)"}},required:["id","userId","enabled","rateLimitEnabled","requestCount","createdAt","updatedAt"]}}}}}}}},async e=>{let{id:r}=e.query,s=e.context.session,n=await e.context.adapter.findOne({model:f,where:[{field:"id",value:r},{field:"userId",value:s.user.id}]});if(!n)throw new o.APIError("NOT_FOUND",{message:m.KEY_NOT_FOUND});i(e.context),n.metadata=t.apikey.fields.metadata.transform.output(n.metadata);let{key:a,...d}=n;return e.json({...d,permissions:d.permissions?(0,p.s)(d.permissions):null})})}({opts:t,schema:a,deleteAllExpiredApiKeys:l}),updateApiKey:function({opts:e,schema:t,deleteAllExpiredApiKeys:i}){return(0,r.a)("/api-key/update",{method:"POST",body:s.z.object({keyId:s.z.string({description:"The id of the Api Key"}),userId:s.z.coerce.string().optional(),name:s.z.string({description:"The name of the key"}).optional(),enabled:s.z.boolean({description:"Whether the Api Key is enabled or not"}).optional(),remaining:s.z.number({description:"The number of remaining requests"}).min(1).optional(),refillAmount:s.z.number({description:"The refill amount"}).optional(),refillInterval:s.z.number({description:"The refill interval"}).optional(),metadata:s.z.any({description:"The metadata of the Api Key"}).optional(),expiresIn:s.z.number({description:"Expiration time of the Api Key in seconds"}).min(1).optional().nullable(),rateLimitEnabled:s.z.boolean({description:"Whether the key has rate limiting enabled."}).optional(),rateLimitTimeWindow:s.z.number({description:"The duration in milliseconds where each request is counted."}).optional(),rateLimitMax:s.z.number({description:"Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset."}).optional(),permissions:s.z.record(s.z.string(),s.z.array(s.z.string())).optional().nullable()}),metadata:{openapi:{description:"Retrieve an existing API key by ID",responses:{200:{description:"API key retrieved successfully",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string",description:"ID"},name:{type:"string",nullable:!0,description:"The name of the key"},start:{type:"string",nullable:!0,description:"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key."},prefix:{type:"string",nullable:!0,description:"The API Key prefix. Stored as plain text."},userId:{type:"string",description:"The owner of the user id"},refillInterval:{type:"number",nullable:!0,description:"The interval in which the `remaining` count is refilled by day. Example: 1 // every day"},refillAmount:{type:"number",nullable:!0,description:"The amount to refill"},lastRefillAt:{type:"string",format:"date-time",nullable:!0,description:"The last refill date"},enabled:{type:"boolean",description:"Sets if key is enabled or disabled",default:!0},rateLimitEnabled:{type:"boolean",description:"Whether the key has rate limiting enabled"},rateLimitTimeWindow:{type:"number",nullable:!0,description:"The duration in milliseconds"},rateLimitMax:{type:"number",nullable:!0,description:"Maximum amount of requests allowed within a window"},requestCount:{type:"number",description:"The number of requests made within the rate limit time window"},remaining:{type:"number",nullable:!0,description:"Remaining requests (every time api key is used this should updated and should be updated on refill as well)"},lastRequest:{type:"string",format:"date-time",nullable:!0,description:"When last request occurred"},expiresAt:{type:"string",format:"date-time",nullable:!0,description:"Expiry date of a key"},createdAt:{type:"string",format:"date-time",description:"created at"},updatedAt:{type:"string",format:"date-time",description:"updated at"},metadata:{type:"object",nullable:!0,additionalProperties:!0,description:"Extra metadata about the apiKey"},permissions:{type:"string",nullable:!0,description:"Permissions for the api key (stored as JSON string)"}},required:["id","userId","enabled","rateLimitEnabled","requestCount","createdAt","updatedAt"]}}}}}}}},async s=>{let{keyId:a,expiresIn:d,enabled:l,metadata:c,refillAmount:u,refillInterval:h,remaining:A,name:g,permissions:y,rateLimitEnabled:K,rateLimitTimeWindow:w,rateLimitMax:v}=s.body,b=await (0,r.g)(s),_=(s.request||s.headers)&&!s.body.userId,N=b?.user??(_?null:{id:s.body.userId});if(!N?.id)throw new o.APIError("UNAUTHORIZED",{message:m.UNAUTHORIZED_SESSION});if(_&&(void 0!==u||void 0!==h||void 0!==v||void 0!==w||void 0!==K||void 0!==A||void 0!==y))throw new o.APIError("BAD_REQUEST",{message:m.SERVER_ONLY_PROPERTY});let I=await s.context.adapter.findOne({model:f,where:[{field:"id",value:a},{field:"userId",value:N.id}]});if(!I)throw new o.APIError("NOT_FOUND",{message:m.KEY_NOT_FOUND});let E={};if(void 0!==g){if(g.length<e.minimumNameLength||g.length>e.maximumNameLength)throw new o.APIError("BAD_REQUEST",{message:m.INVALID_NAME_LENGTH});E.name=g}if(void 0!==l&&(E.enabled=l),void 0!==d){if(!0===e.keyExpiration.disableCustomExpiresTime)throw new o.APIError("BAD_REQUEST",{message:m.KEY_DISABLED_EXPIRATION});if(null!==d){let t=d/86400;if(t<e.keyExpiration.minExpiresIn)throw new o.APIError("BAD_REQUEST",{message:m.EXPIRES_IN_IS_TOO_SMALL});if(t>e.keyExpiration.maxExpiresIn)throw new o.APIError("BAD_REQUEST",{message:m.EXPIRES_IN_IS_TOO_LARGE})}E.expiresAt=d?(0,n.g)(d,"sec"):null}if(void 0!==c){if("object"!=typeof c)throw new o.APIError("BAD_REQUEST",{message:m.INVALID_METADATA_TYPE});E.metadata=t.apikey.fields.metadata.transform.input(c)}if(void 0!==A&&(E.remaining=A),void 0!==u||void 0!==h){if(void 0!==u&&void 0===h)throw new o.APIError("BAD_REQUEST",{message:m.REFILL_AMOUNT_AND_INTERVAL_REQUIRED});if(void 0!==h&&void 0===u)throw new o.APIError("BAD_REQUEST",{message:m.REFILL_INTERVAL_AND_AMOUNT_REQUIRED});E.refillAmount=u,E.refillInterval=h}if(void 0!==K&&(E.rateLimitEnabled=K),void 0!==w&&(E.rateLimitTimeWindow=w),void 0!==v&&(E.rateLimitMax=v),void 0!==y&&(E.permissions=JSON.stringify(y)),0===Object.keys(E).length)throw new o.APIError("BAD_REQUEST",{message:m.NO_VALUES_TO_UPDATE});let T=I;try{let e=await s.context.adapter.update({model:f,where:[{field:"id",value:I.id},{field:"userId",value:N.id}],update:{lastRequest:new Date,remaining:null===I.remaining?null:I.remaining-1,...E}});e&&(T=e)}catch(e){throw new o.APIError("INTERNAL_SERVER_ERROR",{message:e?.message})}i(s.context),T.metadata=t.apikey.fields.metadata.transform.output(T.metadata);let{key:C,...x}=T;return s.json({...x,permissions:x.permissions?(0,p.s)(x.permissions):null})})}({opts:t,schema:a,deleteAllExpiredApiKeys:l}),deleteApiKey:function({opts:e,schema:t,deleteAllExpiredApiKeys:i}){return(0,r.a)("/api-key/delete",{method:"POST",body:s.z.object({keyId:s.z.string({description:"The id of the Api Key"})}),use:[r.s],metadata:{openapi:{description:"Delete an existing API key",requestBody:{content:{"application/json":{schema:{type:"object",properties:{keyId:{type:"string",description:"The id of the API key to delete"}},required:["keyId"]}}}},responses:{200:{description:"API key deleted successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the API key was successfully deleted"}},required:["success"]}}}}}}}},async e=>{let{keyId:t}=e.body,r=e.context.session;if(!0===r.user.banned)throw new o.APIError("UNAUTHORIZED",{message:m.USER_BANNED});let s=await e.context.adapter.findOne({model:f,where:[{field:"id",value:t}]});if(!s||s.userId!==r.user.id)throw new o.APIError("NOT_FOUND",{message:m.KEY_NOT_FOUND});try{await e.context.adapter.delete({model:f,where:[{field:"id",value:s.id}]})}catch(e){throw new o.APIError("INTERNAL_SERVER_ERROR",{message:e?.message})}return i(e.context),e.json({success:!0})})}({opts:t,schema:a,deleteAllExpiredApiKeys:l}),listApiKeys:function({opts:e,schema:t,deleteAllExpiredApiKeys:i}){return(0,r.a)("/api-key/list",{method:"GET",use:[r.s],metadata:{openapi:{description:"List all API keys for the authenticated user",responses:{200:{description:"API keys retrieved successfully",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string",description:"ID"},name:{type:"string",nullable:!0,description:"The name of the key"},start:{type:"string",nullable:!0,description:"Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key."},prefix:{type:"string",nullable:!0,description:"The API Key prefix. Stored as plain text."},userId:{type:"string",description:"The owner of the user id"},refillInterval:{type:"number",nullable:!0,description:"The interval in which the `remaining` count is refilled by day. Example: 1 // every day"},refillAmount:{type:"number",nullable:!0,description:"The amount to refill"},lastRefillAt:{type:"string",format:"date-time",nullable:!0,description:"The last refill date"},enabled:{type:"boolean",description:"Sets if key is enabled or disabled",default:!0},rateLimitEnabled:{type:"boolean",description:"Whether the key has rate limiting enabled"},rateLimitTimeWindow:{type:"number",nullable:!0,description:"The duration in milliseconds"},rateLimitMax:{type:"number",nullable:!0,description:"Maximum amount of requests allowed within a window"},requestCount:{type:"number",description:"The number of requests made within the rate limit time window"},remaining:{type:"number",nullable:!0,description:"Remaining requests (every time api key is used this should updated and should be updated on refill as well)"},lastRequest:{type:"string",format:"date-time",nullable:!0,description:"When last request occurred"},expiresAt:{type:"string",format:"date-time",nullable:!0,description:"Expiry date of a key"},createdAt:{type:"string",format:"date-time",description:"created at"},updatedAt:{type:"string",format:"date-time",description:"updated at"},metadata:{type:"object",nullable:!0,additionalProperties:!0,description:"Extra metadata about the apiKey"},permissions:{type:"string",nullable:!0,description:"Permissions for the api key (stored as JSON string)"}},required:["id","userId","enabled","rateLimitEnabled","requestCount","createdAt","updatedAt"]}}}}}}}}},async e=>{let r=e.context.session,o=await e.context.adapter.findMany({model:f,where:[{field:"userId",value:r.user.id}]});i(e.context);let s=(o=o.map(e=>({...e,metadata:t.apikey.fields.metadata.transform.output(e.metadata)}))).map(e=>{let{key:t,...i}=e;return{...i,permissions:i.permissions?(0,p.s)(i.permissions):null}});return e.json(s)})}({opts:t,schema:a,deleteAllExpiredApiKeys:l}),deleteAllExpiredApiKeys:function({deleteAllExpiredApiKeys:e}){return(0,r.a)("/api-key/delete-all-expired-api-keys",{method:"POST",metadata:{SERVER_ONLY:!0}},async t=>{try{await e(t.context,!0)}catch(e){return t.context.logger.error("[API KEY PLUGIN] Failed to delete expired API keys:",e),t.json({success:!1,error:e})}return t.json({success:!0,error:null})})}({deleteAllExpiredApiKeys:l})}}({keyGenerator:a.customKeyGenerator||(async e=>{let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",i=`${e.prefix||""}`;for(let r=0;r<e.length;r++){let e=Math.floor(Math.random()*t.length);i+=t[e]}return i}),opts:a,schema:c});return{id:"api-key",$ERROR_CODES:m,hooks:{before:[{matcher:e=>!!u(e)&&!1===a.disableSessionForAPIKeys,handler:(0,r.c)(async e=>{let t,r=u(e);if("string"!=typeof r)throw new o.APIError("BAD_REQUEST",{message:m.INVALID_API_KEY_GETTER_RETURN_TYPE});if(r.length<a.defaultKeyLength||a.customAPIKeyValidator&&!a.customAPIKeyValidator({ctx:e,key:r}))throw new o.APIError("FORBIDDEN",{message:m.INVALID_API_KEY});let s=a.disableKeyHashing?r:await i(r),d=await e.context.adapter.findOne({model:f,where:[{field:"key",value:s}]});if(!d)throw new o.APIError("UNAUTHORIZED",{message:m.INVALID_API_KEY});try{let i=await e.context.internalAdapter.findUserById(d.userId);if(!i)throw new o.APIError("UNAUTHORIZED",{message:m.INVALID_USER_ID_FROM_API_KEY});t=i}catch(e){throw e}let c={user:t,session:{id:d.id,token:r,userId:t.id,userAgent:e.request?.headers.get("user-agent")??null,ipAddress:e.request?(0,l.g)(e.request,e.context.options):null,createdAt:new Date,updatedAt:new Date,expiresAt:d.expiresAt||(0,n.g)(e.context.options.session?.expiresIn||604800,"ms")}};return(e.context.session=c,"/get-session"===e.path)?c:{context:e}})}]},endpoints:{createApiKey:A.createApiKey,verifyApiKey:A.verifyApiKey,getApiKey:A.getApiKey,updateApiKey:A.updateApiKey,deleteApiKey:A.deleteApiKey,listApiKeys:A.listApiKeys},schema:c}}}},50139:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(793491),e.i(843458),e.i(511127),e.i(493009),e.i(151176),e.i(986279),e.i(592781),e.i(323238),e.i(587217),e.i(871487),e.i(170735),e.i(115605),e.i(694896),e.i(395484),e.i(757404),e.i(592337),e.i(623832),e.i(318752),e.i(942738),e.i(311556),e.i(243917),e.i(692153),e.i(105127),e.i(483013),e.i(558692),e.i(776569),e.i(187615),e.i(654520),e.i(306192),e.i(4887),e.i(74222),e.i(533004),e.i(91997),e.i(382320),e.i(706567),e.i(316944),e.i(152967),e.i(85633),e.i(988051),e.i(383120),e.i(771884),e.i(345172),e.i(861464),e.i(328902),e.i(664764),e.i(628146),e.i(169429),e.i(896775),e.i(968915),e.i(211588),e.i(55262),e.i(30483),e.i(137942),e.i(561336),e.i(692218),e.i(504506),e.i(82131),e.i(234901),e.i(39543),e.i(634882),e.i(277337),e.i(955759),e.i(141780)},796854:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createAuthEndpoint:()=>r.a});var r=e.i(151176)},395909:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createAuthMiddleware:()=>r.c});var r=e.i(151176)},230457:e=>{"use strict";var t,i,{g:r,__dirname:o}=e;{e.s({ZodParsedType:()=>r,getParsedType:()=>o,objectUtil:()=>i,util:()=>t}),function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let i of e)t[i]=i;return t},e.getValidEnumValues=t=>{let i=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),r={};for(let e of i)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t},e.find=(e,t)=>{for(let i of e)if(t(i))return i},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(t||(t={})),(i||(i={})).mergeShapes=(e,t)=>({...e,...t});let r=t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),o=e=>{switch(typeof e){case"undefined":return r.undefined;case"string":return r.string;case"number":return Number.isNaN(e)?r.nan:r.number;case"boolean":return r.boolean;case"function":return r.function;case"bigint":return r.bigint;case"symbol":return r.symbol;case"object":if(Array.isArray(e))return r.array;if(null===e)return r.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return r.promise;if("undefined"!=typeof Map&&e instanceof Map)return r.map;if("undefined"!=typeof Set&&e instanceof Set)return r.set;if("undefined"!=typeof Date&&e instanceof Date)return r.date;return r.object;default:return r.unknown}}}},719065:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({ZodError:()=>o,ZodIssueCode:()=>t,quotelessJson:()=>i});var r=e.i(230457);let t=r.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),i=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class o extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},i={_errors:[]},r=e=>{for(let o of e.issues)if("invalid_union"===o.code)o.unionErrors.map(r);else if("invalid_return_type"===o.code)r(o.returnTypeError);else if("invalid_arguments"===o.code)r(o.argumentsError);else if(0===o.path.length)i._errors.push(t(o));else{let e=i,r=0;for(;r<o.path.length;){let i=o.path[r];r===o.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(t(o))):e[i]=e[i]||{_errors:[]},e=e[i],r++}}};return r(this),i}static assert(e){if(!(e instanceof o))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,r.util.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},i=[];for(let r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):i.push(e(r));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}o.create=e=>new o(e)}},515052:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t});var r=e.i(719065),o=e.i(230457);let t=(e,t)=>{let i;switch(e.code){case r.ZodIssueCode.invalid_type:i=e.received===o.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case r.ZodIssueCode.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,o.util.jsonStringifyReplacer)}`;break;case r.ZodIssueCode.unrecognized_keys:i=`Unrecognized key(s) in object: ${o.util.joinValues(e.keys,", ")}`;break;case r.ZodIssueCode.invalid_union:i="Invalid input";break;case r.ZodIssueCode.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${o.util.joinValues(e.options)}`;break;case r.ZodIssueCode.invalid_enum_value:i=`Invalid enum value. Expected ${o.util.joinValues(e.options)}, received '${e.received}'`;break;case r.ZodIssueCode.invalid_arguments:i="Invalid function arguments";break;case r.ZodIssueCode.invalid_return_type:i="Invalid function return type";break;case r.ZodIssueCode.invalid_date:i="Invalid date";break;case r.ZodIssueCode.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:o.util.assertNever(e.validation):i="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case r.ZodIssueCode.too_small:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case r.ZodIssueCode.too_big:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case r.ZodIssueCode.custom:i="Invalid input";break;case r.ZodIssueCode.invalid_intersection_types:i="Intersection results could not be merged";break;case r.ZodIssueCode.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case r.ZodIssueCode.not_finite:i="Number must be finite";break;default:i=t.defaultError,o.util.assertNever(e)}return{message:i}}}},851246:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({getErrorMap:()=>o,setErrorMap:()=>r});let t=e.i(515052).default;function r(e){t=e}function o(){return t}}},830416:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(515052),e.i(851246)},326114:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({DIRTY:()=>d,EMPTY_PATH:()=>i,INVALID:()=>a,OK:()=>l,ParseStatus:()=>n,addIssueToContext:()=>s,isAborted:()=>c,isAsync:()=>h,isDirty:()=>u,isValid:()=>p,makeIssue:()=>t}),e.i(830416);var r=e.i(851246),o=e.i(515052);let t=e=>{let{data:t,path:i,errorMaps:r,issueData:o}=e,s=[...i,...o.path||[]],n={...o,path:s};if(void 0!==o.message)return{...o,path:s,message:o.message};let a="";for(let e of r.filter(e=>!!e).slice().reverse())a=e(n,{data:t,defaultError:a}).message;return{...o,path:s,message:a}},i=[];function s(e,i){let s=(0,r.getErrorMap)(),n=t({issueData:i,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===o.default?void 0:o.default].filter(e=>!!e)});e.common.issues.push(n)}class n{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let i=[];for(let r of t){if("aborted"===r.status)return a;"dirty"===r.status&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){let i=[];for(let e of t){let t=await e.key,r=await e.value;i.push({key:t,value:r})}return n.mergeObjectSync(e,i)}static mergeObjectSync(e,t){let i={};for(let r of t){let{key:t,value:o}=r;if("aborted"===t.status||"aborted"===o.status)return a;"dirty"===t.status&&e.dirty(),"dirty"===o.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==o.value||r.alwaysSet)&&(i[t.value]=o.value)}return{status:e.value,value:i}}}let a=Object.freeze({status:"aborted"}),d=e=>({status:"dirty",value:e}),l=e=>({status:"valid",value:e}),c=e=>"aborted"===e.status,u=e=>"dirty"===e.status,p=e=>"valid"===e.status,h=e=>"undefined"!=typeof Promise&&e instanceof Promise}},50516:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({})},354129:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({defaultErrorMap:()=>r.default});var r=e.i(515052)},929289:e=>{"use strict";var t,{g:i,__dirname:r}=e;e.s({errorUtil:()=>t}),function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(t||(t={}))},291129:e=>{"use strict";var{g:t,__dirname:i}=e;{let t;e.s({BRAND:()=>ey,NEVER:()=>e8,Schema:()=>v,ZodAny:()=>F,ZodArray:()=>J,ZodBigInt:()=>j,ZodBoolean:()=>q,ZodBranded:()=>eK,ZodCatch:()=>eA,ZodDate:()=>Z,ZodDefault:()=>ef,ZodDiscriminatedUnion:()=>ee,ZodEffects:()=>ep,ZodEnum:()=>el,ZodFirstPartyTypeKind:()=>s,ZodFunction:()=>en,ZodIntersection:()=>et,ZodLazy:()=>ea,ZodLiteral:()=>ed,ZodMap:()=>eo,ZodNaN:()=>eg,ZodNativeEnum:()=>ec,ZodNever:()=>H,ZodNull:()=>W,ZodNullable:()=>em,ZodNumber:()=>B,ZodObject:()=>G,ZodOptional:()=>eh,ZodPipeline:()=>ew,ZodPromise:()=>eu,ZodReadonly:()=>ev,ZodRecord:()=>er,ZodSchema:()=>v,ZodSet:()=>es,ZodString:()=>z,ZodSymbol:()=>M,ZodTransformer:()=>ep,ZodTuple:()=>ei,ZodType:()=>v,ZodUndefined:()=>V,ZodUnion:()=>Y,ZodUnknown:()=>$,ZodVoid:()=>Q,any:()=>eR,array:()=>eL,bigint:()=>eT,boolean:()=>eC,coerce:()=>e9,custom:()=>K,date:()=>ex,datetimeRegex:()=>A,discriminatedUnion:()=>eq,effect:()=>eX,enum:()=>eJ,function:()=>e$,instanceof:()=>e_,intersection:()=>eZ,late:()=>eb,lazy:()=>eH,literal:()=>eQ,map:()=>eW,nan:()=>eE,nativeEnum:()=>eG,never:()=>eU,null:()=>ek,nullable:()=>e1,number:()=>eI,object:()=>ez,oboolean:()=>e6,onumber:()=>e3,optional:()=>e0,ostring:()=>e4,pipeline:()=>e5,preprocess:()=>e2,promise:()=>eY,record:()=>eV,set:()=>eF,strictObject:()=>eB,string:()=>eN,symbol:()=>eO,transformer:()=>eX,tuple:()=>eM,undefined:()=>eS,union:()=>ej,unknown:()=>eP,void:()=>eD});var r,o,s,n=e.i(719065);e.i(830416);var a=e.i(354129),d=e.i(851246),l=e.i(929289),c=e.i(326114),u=e.i(230457),p=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},h=this&&this.__classPrivateFieldSet||function(e,t,i,r,o){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,i):o?o.value=i:t.set(e,i),i};class i{constructor(e,t,i,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let w=(e,t)=>{if((0,c.isValid)(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new n.ZodError(e.common.issues);return this._error=t,this._error}}};function m(e){if(!e)return{};let{errorMap:t,invalid_type_error:i,required_error:r,description:o}=e;if(t&&(i||r))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:o}:{errorMap:(t,o)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??o.defaultError}:void 0===o.data?{message:s??r??o.defaultError}:"invalid_type"!==t.code?{message:o.defaultError}:{message:s??i??o.defaultError}},description:o}}class v{get description(){return this._def.description}_getType(e){return(0,u.getParsedType)(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:(0,u.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new c.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:(0,u.getParsedType)(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if((0,c.isAsync)(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){let i={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)},r=this._parseSync({data:e,path:i.path,parent:i});return w(i,r)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:t});return(0,c.isValid)(i)?{value:i.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>(0,c.isValid)(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){let i={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:(0,u.getParsedType)(e)},r=this._parse({data:e,path:i.path,parent:i});return w(i,await ((0,c.isAsync)(r)?r:Promise.resolve(r)))}refine(e,t){let i=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{let o=e(t),s=()=>r.addIssue({code:n.ZodIssueCode.custom,...i(t)});return"undefined"!=typeof Promise&&o instanceof Promise?o.then(e=>!!e||(s(),!1)):!!o||(s(),!1)})}refinement(e,t){return this._refinement((i,r)=>!!e(i)||(r.addIssue("function"==typeof t?t(i,r):t),!1))}_refinement(e){return new ep({schema:this,typeName:s.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return eh.create(this,this._def)}nullable(){return em.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return J.create(this)}promise(){return eu.create(this,this._def)}or(e){return Y.create([this,e],this._def)}and(e){return et.create(this,e,this._def)}transform(e){return new ep({...m(this._def),schema:this,typeName:s.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ef({...m(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:s.ZodDefault})}brand(){return new eK({typeName:s.ZodBranded,type:this,...m(this._def)})}catch(e){return new eA({...m(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:s.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ew.create(this,e)}readonly(){return ev.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let b=/^c[^\s-]{8,}$/i,_=/^[0-9a-z]+$/,N=/^[0-9A-HJKMNP-TV-Z]{26}$/i,I=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,E=/^[a-z0-9_-]{21}$/i,T=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,C=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,x=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,O=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,S=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,k=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,R=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,P=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,U=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,D="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",L=RegExp(`^${D}$`);function f(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let i=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${i}`}function A(e){let t=`${D}T${f(e)}`,i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,RegExp(`^${t}$`)}class z extends v{_parse(e){var i,r,o,s;let a;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==u.ZodParsedType.string){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.string,received:t.parsedType}),c.INVALID}let d=new c.ParseStatus;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),d.dirty());else if("max"===l.kind)e.data.length>l.value&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),d.dirty());else if("length"===l.kind){let t=e.data.length>l.value,i=e.data.length<l.value;(t||i)&&(a=this._getOrReturnCtx(e,a),t?(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),d.dirty())}else if("email"===l.kind)x.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"email",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("emoji"===l.kind)t||(t=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),t.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"emoji",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("uuid"===l.kind)I.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"uuid",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("nanoid"===l.kind)E.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"nanoid",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("cuid"===l.kind)b.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"cuid",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("cuid2"===l.kind)_.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"cuid2",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("ulid"===l.kind)N.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"ulid",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"url",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"regex",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),d.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:{startsWith:l.value},message:l.message}),d.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:{endsWith:l.value},message:l.message}),d.dirty()):"datetime"===l.kind?A(l).test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:"datetime",message:l.message}),d.dirty()):"date"===l.kind?L.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:"date",message:l.message}),d.dirty()):"time"===l.kind?RegExp(`^${f(l)}$`).test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{code:n.ZodIssueCode.invalid_string,validation:"time",message:l.message}),d.dirty()):"duration"===l.kind?C.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"duration",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()):"ip"===l.kind?(i=e.data,!(("v4"===(r=l.version)||!r)&&O.test(i)||("v6"===r||!r)&&k.test(i))&&1&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"ip",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty())):"jwt"===l.kind?!function(e,t){if(!T.test(e))return!1;try{let[i]=e.split("."),r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),o=JSON.parse(atob(r));if("object"!=typeof o||null===o||"typ"in o&&o?.typ!=="JWT"||!o.alg||t&&o.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"jwt",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()):"cidr"===l.kind?(o=e.data,!(("v4"===(s=l.version)||!s)&&S.test(o)||("v6"===s||!s)&&R.test(o))&&1&&(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"cidr",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty())):"base64"===l.kind?P.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"base64",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()):"base64url"===l.kind?U.test(e.data)||(a=this._getOrReturnCtx(e,a),(0,c.addIssueToContext)(a,{validation:"base64url",code:n.ZodIssueCode.invalid_string,message:l.message}),d.dirty()):u.util.assertNever(l);return{status:d.value,value:e.data}}_regex(e,t,i){return this.refinement(t=>e.test(t),{validation:t,code:n.ZodIssueCode.invalid_string,...l.errorUtil.errToObj(i)})}_addCheck(e){return new z({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...l.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...l.errorUtil.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...l.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...l.errorUtil.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...l.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...l.errorUtil.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...l.errorUtil.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...l.errorUtil.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...l.errorUtil.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...l.errorUtil.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...l.errorUtil.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...l.errorUtil.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...l.errorUtil.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...l.errorUtil.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...l.errorUtil.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...l.errorUtil.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...l.errorUtil.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...l.errorUtil.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...l.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...l.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...l.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...l.errorUtil.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...l.errorUtil.errToObj(t)})}nonempty(e){return this.min(1,l.errorUtil.errToObj(e))}trim(){return new z({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new z({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new z({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}z.create=e=>new z({checks:[],typeName:s.ZodString,coerce:e?.coerce??!1,...m(e)});class B extends v{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==u.ZodParsedType.number){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.number,received:t.parsedType}),c.INVALID}let i=new c.ParseStatus;for(let r of this._def.checks)"int"===r.kind?u.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:r.message}),i.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):"multipleOf"===r.kind?0!==function(e,t){let i=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=i>r?i:r;return Number.parseInt(e.toFixed(o).replace(".",""))%Number.parseInt(t.toFixed(o).replace(".",""))/10**o}(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.not_finite,message:r.message}),i.dirty()):u.util.assertNever(r);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,l.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,l.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,l.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,l.errorUtil.toString(t))}setLimit(e,t,i,r){return new B({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:l.errorUtil.toString(r)}]})}_addCheck(e){return new B({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:l.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:l.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:l.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:l.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:l.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:l.errorUtil.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:l.errorUtil.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:l.errorUtil.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:l.errorUtil.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&u.util.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let i of this._def.checks)if("finite"===i.kind||"int"===i.kind||"multipleOf"===i.kind)return!0;else"min"===i.kind?(null===t||i.value>t)&&(t=i.value):"max"===i.kind&&(null===e||i.value<e)&&(e=i.value);return Number.isFinite(t)&&Number.isFinite(e)}}B.create=e=>new B({checks:[],typeName:s.ZodNumber,coerce:e?.coerce||!1,...m(e)});class j extends v{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==u.ZodParsedType.bigint)return this._getInvalidInput(e);let i=new c.ParseStatus;for(let r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),i.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):u.util.assertNever(r);return{status:i.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.bigint,received:t.parsedType}),c.INVALID}gte(e,t){return this.setLimit("min",e,!0,l.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,l.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,l.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,l.errorUtil.toString(t))}setLimit(e,t,i,r){return new j({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:l.errorUtil.toString(r)}]})}_addCheck(e){return new j({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:l.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:l.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:l.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:l.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:l.errorUtil.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}j.create=e=>new j({checks:[],typeName:s.ZodBigInt,coerce:e?.coerce??!1,...m(e)});class q extends v{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==u.ZodParsedType.boolean){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.boolean,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}q.create=e=>new q({typeName:s.ZodBoolean,coerce:e?.coerce||!1,...m(e)});class Z extends v{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==u.ZodParsedType.date){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.date,received:t.parsedType}),c.INVALID}if(Number.isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_date}),c.INVALID}let i=new c.ParseStatus;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),i.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(t=this._getOrReturnCtx(e,t),(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),i.dirty()):u.util.assertNever(r);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Z({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:l.errorUtil.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:l.errorUtil.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Z.create=e=>new Z({checks:[],coerce:e?.coerce||!1,typeName:s.ZodDate,...m(e)});class M extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.symbol){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.symbol,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}M.create=e=>new M({typeName:s.ZodSymbol,...m(e)});class V extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.undefined,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}V.create=e=>new V({typeName:s.ZodUndefined,...m(e)});class W extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.null){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.null,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}W.create=e=>new W({typeName:s.ZodNull,...m(e)});class F extends v{constructor(){super(...arguments),this._any=!0}_parse(e){return(0,c.OK)(e.data)}}F.create=e=>new F({typeName:s.ZodAny,...m(e)});class $ extends v{constructor(){super(...arguments),this._unknown=!0}_parse(e){return(0,c.OK)(e.data)}}$.create=e=>new $({typeName:s.ZodUnknown,...m(e)});class H extends v{_parse(e){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.never,received:t.parsedType}),c.INVALID}}H.create=e=>new H({typeName:s.ZodNever,...m(e)});class Q extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.undefined){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.void,received:t.parsedType}),c.INVALID}return(0,c.OK)(e.data)}}Q.create=e=>new Q({typeName:s.ZodVoid,...m(e)});class J extends v{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),o=this._def;if(t.parsedType!==u.ZodParsedType.array)return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.array,received:t.parsedType}),c.INVALID;if(null!==o.exactLength){let e=t.data.length>o.exactLength.value,i=t.data.length<o.exactLength.value;(e||i)&&((0,c.addIssueToContext)(t,{code:e?n.ZodIssueCode.too_big:n.ZodIssueCode.too_small,minimum:i?o.exactLength.value:void 0,maximum:e?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),r.dirty())}if(null!==o.minLength&&t.data.length<o.minLength.value&&((0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),r.dirty()),null!==o.maxLength&&t.data.length>o.maxLength.value&&((0,c.addIssueToContext)(t,{code:n.ZodIssueCode.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>o.type._parseAsync(new i(t,e,t.path,r)))).then(e=>c.ParseStatus.mergeArray(r,e));let s=[...t.data].map((e,r)=>o.type._parseSync(new i(t,e,t.path,r)));return c.ParseStatus.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new J({...this._def,minLength:{value:e,message:l.errorUtil.toString(t)}})}max(e,t){return new J({...this._def,maxLength:{value:e,message:l.errorUtil.toString(t)}})}length(e,t){return new J({...this._def,exactLength:{value:e,message:l.errorUtil.toString(t)}})}nonempty(e){return this.min(1,e)}}J.create=(e,t)=>new J({type:e,minLength:null,maxLength:null,exactLength:null,typeName:s.ZodArray,...m(t)});class G extends v{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=u.util.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==u.ZodParsedType.object){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:t.parsedType}),c.INVALID}let{status:t,ctx:r}=this._processInputParams(e),{shape:o,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof H&&"strip"===this._def.unknownKeys))for(let e in r.data)s.includes(e)||a.push(e);let d=[];for(let e of s){let t=o[e],s=r.data[e];d.push({key:{status:"valid",value:e},value:t._parse(new i(r,s,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof H){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)d.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)a.length>0&&((0,c.addIssueToContext)(r,{code:n.ZodIssueCode.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let o=r.data[t];d.push({key:{status:"valid",value:t},value:e._parse(new i(r,o,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of d){let i=await t.key,r=await t.value;e.push({key:i,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>c.ParseStatus.mergeObjectSync(t,e)):c.ParseStatus.mergeObjectSync(t,d)}get shape(){return this._def.shape()}strict(e){return l.errorUtil.errToObj,new G({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,i)=>{let r=this._def.errorMap?.(t,i).message??i.defaultError;return"unrecognized_keys"===t.code?{message:l.errorUtil.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new G({...this._def,unknownKeys:"strip"})}passthrough(){return new G({...this._def,unknownKeys:"passthrough"})}extend(e){return new G({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new G({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:s.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new G({...this._def,catchall:e})}pick(e){let t={};for(let i of u.util.objectKeys(e))e[i]&&this.shape[i]&&(t[i]=this.shape[i]);return new G({...this._def,shape:()=>t})}omit(e){let t={};for(let i of u.util.objectKeys(this.shape))e[i]||(t[i]=this.shape[i]);return new G({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof G){let i={};for(let r in t.shape){let o=t.shape[r];i[r]=eh.create(e(o))}return new G({...t._def,shape:()=>i})}if(t instanceof J)return new J({...t._def,type:e(t.element)});if(t instanceof eh)return eh.create(e(t.unwrap()));if(t instanceof em)return em.create(e(t.unwrap()));if(t instanceof ei)return ei.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let i of u.util.objectKeys(this.shape)){let r=this.shape[i];e&&!e[i]?t[i]=r:t[i]=r.optional()}return new G({...this._def,shape:()=>t})}required(e){let t={};for(let i of u.util.objectKeys(this.shape))if(e&&!e[i])t[i]=this.shape[i];else{let e=this.shape[i];for(;e instanceof eh;)e=e._def.innerType;t[i]=e}return new G({...this._def,shape:()=>t})}keyof(){return g(u.util.objectKeys(this.shape))}}G.create=(e,t)=>new G({shape:()=>e,unknownKeys:"strip",catchall:H.create(),typeName:s.ZodObject,...m(t)}),G.strictCreate=(e,t)=>new G({shape:()=>e,unknownKeys:"strict",catchall:H.create(),typeName:s.ZodObject,...m(t)}),G.lazycreate=(e,t)=>new G({shape:e,unknownKeys:"strip",catchall:H.create(),typeName:s.ZodObject,...m(t)});class Y extends v{_parse(e){let{ctx:t}=this._processInputParams(e),i=this._def.options;if(t.common.async)return Promise.all(i.map(async e=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let i of e)if("dirty"===i.result.status)return t.common.issues.push(...i.ctx.common.issues),i.result;let i=e.map(e=>new n.ZodError(e.ctx.common.issues));return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_union,unionErrors:i}),c.INVALID});{let e,r=[];for(let o of i){let i={...t,common:{...t.common,issues:[]},parent:null},s=o._parseSync({data:t.data,path:t.path,parent:i});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:i}),i.common.issues.length&&r.push(i.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let o=r.map(e=>new n.ZodError(e));return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_union,unionErrors:o}),c.INVALID}}get options(){return this._def.options}}Y.create=(e,t)=>new Y({options:e,typeName:s.ZodUnion,...m(t)});let X=e=>{if(e instanceof ea)return X(e.schema);if(e instanceof ep)return X(e.innerType());if(e instanceof ed)return[e.value];if(e instanceof el)return e.options;if(e instanceof ec)return u.util.objectValues(e.enum);else if(e instanceof ef)return X(e._def.innerType);else if(e instanceof V)return[void 0];else if(e instanceof W)return[null];else if(e instanceof eh)return[void 0,...X(e.unwrap())];else if(e instanceof em)return[null,...X(e.unwrap())];else if(e instanceof eK)return X(e.unwrap());else if(e instanceof ev)return X(e.unwrap());else if(e instanceof eA)return X(e._def.innerType);else return[]};class ee extends v{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.object)return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:t.parsedType}),c.INVALID;let i=this.discriminator,r=t.data[i],o=this.optionsMap.get(r);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):((0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),c.INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,i){let r=new Map;for(let i of t){let t=X(i.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of t){if(r.has(o))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);r.set(o,i)}}return new ee({typeName:s.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...m(i)})}}class et extends v{_parse(e){let{status:t,ctx:i}=this._processInputParams(e),r=(e,r)=>{if((0,c.isAborted)(e)||(0,c.isAborted)(r))return c.INVALID;let o=function e(t,i){let r=(0,u.getParsedType)(t),o=(0,u.getParsedType)(i);if(t===i)return{valid:!0,data:t};if(r===u.ZodParsedType.object&&o===u.ZodParsedType.object){let r=u.util.objectKeys(i),o=u.util.objectKeys(t).filter(e=>-1!==r.indexOf(e)),s={...t,...i};for(let r of o){let o=e(t[r],i[r]);if(!o.valid)return{valid:!1};s[r]=o.data}return{valid:!0,data:s}}if(r===u.ZodParsedType.array&&o===u.ZodParsedType.array){if(t.length!==i.length)return{valid:!1};let r=[];for(let o=0;o<t.length;o++){let s=e(t[o],i[o]);if(!s.valid)return{valid:!1};r.push(s.data)}return{valid:!0,data:r}}if(r===u.ZodParsedType.date&&o===u.ZodParsedType.date&&+t==+i)return{valid:!0,data:t};return{valid:!1}}(e.value,r.value);return o.valid?(((0,c.isDirty)(e)||(0,c.isDirty)(r))&&t.dirty(),{status:t.value,value:o.data}):((0,c.addIssueToContext)(i,{code:n.ZodIssueCode.invalid_intersection_types}),c.INVALID)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}et.create=(e,t,i)=>new et({left:e,right:t,typeName:s.ZodIntersection,...m(i)});class ei extends v{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.array)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.array,received:r.parsedType}),c.INVALID;if(r.data.length<this._def.items.length)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),c.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&((0,c.addIssueToContext)(r,{code:n.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let o=[...r.data].map((e,t)=>{let o=this._def.items[t]||this._def.rest;return o?o._parse(new i(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(o).then(e=>c.ParseStatus.mergeArray(t,e)):c.ParseStatus.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new ei({...this._def,rest:e})}}ei.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ei({items:e,typeName:s.ZodTuple,rest:null,...m(t)})};class er extends v{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.object)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.object,received:r.parsedType}),c.INVALID;let o=[],s=this._def.keyType,a=this._def.valueType;for(let e in r.data)o.push({key:s._parse(new i(r,e,r.path,e)),value:a._parse(new i(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?c.ParseStatus.mergeObjectAsync(t,o):c.ParseStatus.mergeObjectSync(t,o)}get element(){return this._def.valueType}static create(e,t,i){return new er(t instanceof v?{keyType:e,valueType:t,typeName:s.ZodRecord,...m(i)}:{keyType:z.create(),valueType:e,typeName:s.ZodRecord,...m(t)})}}class eo extends v{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.map)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.map,received:r.parsedType}),c.INVALID;let o=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([e,t],n)=>({key:o._parse(new i(r,e,r.path,[n,"key"])),value:s._parse(new i(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let i of a){let r=await i.key,o=await i.value;if("aborted"===r.status||"aborted"===o.status)return c.INVALID;("dirty"===r.status||"dirty"===o.status)&&t.dirty(),e.set(r.value,o.value)}return{status:t.value,value:e}})}{let e=new Map;for(let i of a){let r=i.key,o=i.value;if("aborted"===r.status||"aborted"===o.status)return c.INVALID;("dirty"===r.status||"dirty"===o.status)&&t.dirty(),e.set(r.value,o.value)}return{status:t.value,value:e}}}}eo.create=(e,t,i)=>new eo({valueType:t,keyType:e,typeName:s.ZodMap,...m(i)});class es extends v{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.ZodParsedType.set)return(0,c.addIssueToContext)(r,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.set,received:r.parsedType}),c.INVALID;let o=this._def;null!==o.minSize&&r.data.size<o.minSize.value&&((0,c.addIssueToContext)(r,{code:n.ZodIssueCode.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),t.dirty()),null!==o.maxSize&&r.data.size>o.maxSize.value&&((0,c.addIssueToContext)(r,{code:n.ZodIssueCode.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),t.dirty());let s=this._def.valueType;function a(e){let i=new Set;for(let r of e){if("aborted"===r.status)return c.INVALID;"dirty"===r.status&&t.dirty(),i.add(r.value)}return{status:t.value,value:i}}let d=[...r.data.values()].map((e,t)=>s._parse(new i(r,e,r.path,t)));return r.common.async?Promise.all(d).then(e=>a(e)):a(d)}min(e,t){return new es({...this._def,minSize:{value:e,message:l.errorUtil.toString(t)}})}max(e,t){return new es({...this._def,maxSize:{value:e,message:l.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}es.create=(e,t)=>new es({valueType:e,minSize:null,maxSize:null,typeName:s.ZodSet,...m(t)});class en extends v{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.function)return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.function,received:t.parsedType}),c.INVALID;function i(e,i){return(0,c.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,d.getErrorMap)(),a.defaultErrorMap].filter(e=>!!e),issueData:{code:n.ZodIssueCode.invalid_arguments,argumentsError:i}})}function r(e,i){return(0,c.makeIssue)({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,(0,d.getErrorMap)(),a.defaultErrorMap].filter(e=>!!e),issueData:{code:n.ZodIssueCode.invalid_return_type,returnTypeError:i}})}let o={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof eu){let e=this;return(0,c.OK)(async function(...t){let a=new n.ZodError([]),d=await e._def.args.parseAsync(t,o).catch(e=>{throw a.addIssue(i(t,e)),a}),l=await Reflect.apply(s,this,d);return await e._def.returns._def.type.parseAsync(l,o).catch(e=>{throw a.addIssue(r(l,e)),a})})}{let e=this;return(0,c.OK)(function(...t){let a=e._def.args.safeParse(t,o);if(!a.success)throw new n.ZodError([i(t,a.error)]);let d=Reflect.apply(s,this,a.data),l=e._def.returns.safeParse(d,o);if(!l.success)throw new n.ZodError([r(d,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new en({...this._def,args:ei.create(e).rest($.create())})}returns(e){return new en({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,i){return new en({args:e||ei.create([]).rest($.create()),returns:t||$.create(),typeName:s.ZodFunction,...m(i)})}}class ea extends v{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ea.create=(e,t)=>new ea({getter:e,typeName:s.ZodLazy,...m(t)});class ed extends v{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{received:t.data,code:n.ZodIssueCode.invalid_literal,expected:this._def.value}),c.INVALID}return{status:"valid",value:e.data}}get value(){return this._def.value}}function g(e,t){return new el({values:e,typeName:s.ZodEnum,...m(t)})}ed.create=(e,t)=>new ed({value:e,typeName:s.ZodLiteral,...m(t)});class el extends v{constructor(){super(...arguments),r.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),i=this._def.values;return(0,c.addIssueToContext)(t,{expected:u.util.joinValues(i),received:t.parsedType,code:n.ZodIssueCode.invalid_type}),c.INVALID}if(p(this,r,"f")||h(this,r,new Set(this._def.values),"f"),!p(this,r,"f").has(e.data)){let t=this._getOrReturnCtx(e),i=this._def.values;return(0,c.addIssueToContext)(t,{received:t.data,code:n.ZodIssueCode.invalid_enum_value,options:i}),c.INVALID}return(0,c.OK)(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return el.create(e,{...this._def,...t})}exclude(e,t=this._def){return el.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}r=new WeakMap,el.create=g;class ec extends v{constructor(){super(...arguments),o.set(this,void 0)}_parse(e){let t=u.util.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==u.ZodParsedType.string&&i.parsedType!==u.ZodParsedType.number){let e=u.util.objectValues(t);return(0,c.addIssueToContext)(i,{expected:u.util.joinValues(e),received:i.parsedType,code:n.ZodIssueCode.invalid_type}),c.INVALID}if(p(this,o,"f")||h(this,o,new Set(u.util.getValidEnumValues(this._def.values)),"f"),!p(this,o,"f").has(e.data)){let e=u.util.objectValues(t);return(0,c.addIssueToContext)(i,{received:i.data,code:n.ZodIssueCode.invalid_enum_value,options:e}),c.INVALID}return(0,c.OK)(e.data)}get enum(){return this._def.values}}o=new WeakMap,ec.create=(e,t)=>new ec({values:e,typeName:s.ZodNativeEnum,...m(t)});class eu extends v{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.ZodParsedType.promise&&!1===t.common.async)return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.promise,received:t.parsedType}),c.INVALID;let i=t.parsedType===u.ZodParsedType.promise?t.data:Promise.resolve(t.data);return(0,c.OK)(i.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eu.create=(e,t)=>new eu({type:e,typeName:s.ZodPromise,...m(t)});class ep extends v{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===s.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:i}=this._processInputParams(e),r=this._def.effect||null,o={addIssue:e=>{(0,c.addIssueToContext)(i,e),e.fatal?t.abort():t.dirty()},get path(){return i.path}};if(o.addIssue=o.addIssue.bind(o),"preprocess"===r.type){let e=r.transform(i.data,o);if(i.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return c.INVALID;let r=await this._def.schema._parseAsync({data:e,path:i.path,parent:i});return"aborted"===r.status?c.INVALID:"dirty"===r.status||"dirty"===t.value?(0,c.DIRTY)(r.value):r});{if("aborted"===t.value)return c.INVALID;let r=this._def.schema._parseSync({data:e,path:i.path,parent:i});return"aborted"===r.status?c.INVALID:"dirty"===r.status||"dirty"===t.value?(0,c.DIRTY)(r.value):r}}if("refinement"===r.type){let e=e=>{let t=r.refinement(e,o);if(i.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==i.common.async)return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(i=>"aborted"===i.status?c.INVALID:("dirty"===i.status&&t.dirty(),e(i.value).then(()=>({status:t.value,value:i.value}))));{let r=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===r.status?c.INVALID:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}}if("transform"===r.type)if(!1!==i.common.async)return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(e=>(0,c.isValid)(e)?Promise.resolve(r.transform(e.value,o)).then(e=>({status:t.value,value:e})):e);else{let e=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!(0,c.isValid)(e))return e;let s=r.transform(e.value,o);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}u.util.assertNever(r)}}ep.create=(e,t,i)=>new ep({schema:e,typeName:s.ZodEffects,effect:t,...m(i)}),ep.createWithPreprocess=(e,t,i)=>new ep({schema:t,effect:{type:"preprocess",transform:e},typeName:s.ZodEffects,...m(i)});class eh extends v{_parse(e){return this._getType(e)===u.ZodParsedType.undefined?(0,c.OK)(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eh.create=(e,t)=>new eh({innerType:e,typeName:s.ZodOptional,...m(t)});class em extends v{_parse(e){return this._getType(e)===u.ZodParsedType.null?(0,c.OK)(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}em.create=(e,t)=>new em({innerType:e,typeName:s.ZodNullable,...m(t)});class ef extends v{_parse(e){let{ctx:t}=this._processInputParams(e),i=t.data;return t.parsedType===u.ZodParsedType.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ef.create=(e,t)=>new ef({innerType:e,typeName:s.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...m(t)});class eA extends v{_parse(e){let{ctx:t}=this._processInputParams(e),i={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return(0,c.isAsync)(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new n.ZodError(i.common.issues)},input:i.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new n.ZodError(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}eA.create=(e,t)=>new eA({innerType:e,typeName:s.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...m(t)});class eg extends v{_parse(e){if(this._getType(e)!==u.ZodParsedType.nan){let t=this._getOrReturnCtx(e);return(0,c.addIssueToContext)(t,{code:n.ZodIssueCode.invalid_type,expected:u.ZodParsedType.nan,received:t.parsedType}),c.INVALID}return{status:"valid",value:e.data}}}eg.create=e=>new eg({typeName:s.ZodNaN,...m(e)});let ey=Symbol("zod_brand");class eK extends v{_parse(e){let{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class ew extends v{_parse(e){let{status:t,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?c.INVALID:"dirty"===e.status?(t.dirty(),(0,c.DIRTY)(e.value)):this._def.out._parseAsync({data:e.value,path:i.path,parent:i})})();{let e=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?c.INVALID:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:i.path,parent:i})}}static create(e,t){return new ew({in:e,out:t,typeName:s.ZodPipeline})}}class ev extends v{_parse(e){let t=this._def.innerType._parse(e),i=e=>((0,c.isValid)(e)&&(e.value=Object.freeze(e.value)),e);return(0,c.isAsync)(t)?t.then(e=>i(e)):i(t)}unwrap(){return this._def.innerType}}function y(e,t){let i="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof i?{message:i}:i}function K(e,t={},i){return e?F.create().superRefine((r,o)=>{let s=e(r);if(s instanceof Promise)return s.then(e=>{if(!e){let e=y(t,r),s=e.fatal??i??!0;o.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=y(t,r),s=e.fatal??i??!0;o.addIssue({code:"custom",...e,fatal:s})}}):F.create()}ev.create=(e,t)=>new ev({innerType:e,typeName:s.ZodReadonly,...m(t)});let eb={object:G.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(s||(s={}));let e_=(e,t={message:`Input not instance of ${e.name}`})=>K(t=>t instanceof e,t),eN=z.create,eI=B.create,eE=eg.create,eT=j.create,eC=q.create,ex=Z.create,eO=M.create,eS=V.create,ek=W.create,eR=F.create,eP=$.create,eU=H.create,eD=Q.create,eL=J.create,ez=G.create,eB=G.strictCreate,ej=Y.create,eq=ee.create,eZ=et.create,eM=ei.create,eV=er.create,eW=eo.create,eF=es.create,e$=en.create,eH=ea.create,eQ=ed.create,eJ=el.create,eG=ec.create,eY=eu.create,eX=ep.create,e0=eh.create,e1=em.create,e2=ep.createWithPreprocess,e5=ew.create,e4=()=>eN().optional(),e3=()=>eI().optional(),e6=()=>eC().optional(),e9={string:e=>z.create({...e,coerce:!0}),number:e=>B.create({...e,coerce:!0}),boolean:e=>q.create({...e,coerce:!0}),bigint:e=>j.create({...e,coerce:!0}),date:e=>Z.create({...e,coerce:!0})},e8=c.INVALID}},110724:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(830416),e.i(326114),e.i(50516),e.i(230457),e.i(291129),e.i(719065)},864911:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(830416),e.i(326114),e.i(50516),e.i(230457),e.i(291129),e.i(719065),e.i(110724)},950007:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({defaultErrorMap:()=>r.default,getErrorMap:()=>o.getErrorMap,setErrorMap:()=>o.setErrorMap});var r=e.i(515052),o=e.i(851246)},965483:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({defaultErrorMap:()=>r.defaultErrorMap,getErrorMap:()=>r.getErrorMap,setErrorMap:()=>r.setErrorMap}),e.i(830416);var r=e.i(950007)},750983:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({BRAND:()=>n.BRAND,DIRTY:()=>o.DIRTY,EMPTY_PATH:()=>o.EMPTY_PATH,INVALID:()=>o.INVALID,NEVER:()=>n.NEVER,OK:()=>o.OK,ParseStatus:()=>o.ParseStatus,Schema:()=>n.Schema,ZodAny:()=>n.ZodAny,ZodArray:()=>n.ZodArray,ZodBigInt:()=>n.ZodBigInt,ZodBoolean:()=>n.ZodBoolean,ZodBranded:()=>n.ZodBranded,ZodCatch:()=>n.ZodCatch,ZodDate:()=>n.ZodDate,ZodDefault:()=>n.ZodDefault,ZodDiscriminatedUnion:()=>n.ZodDiscriminatedUnion,ZodEffects:()=>n.ZodEffects,ZodEnum:()=>n.ZodEnum,ZodError:()=>a.ZodError,ZodFirstPartyTypeKind:()=>n.ZodFirstPartyTypeKind,ZodFunction:()=>n.ZodFunction,ZodIntersection:()=>n.ZodIntersection,ZodIssueCode:()=>a.ZodIssueCode,ZodLazy:()=>n.ZodLazy,ZodLiteral:()=>n.ZodLiteral,ZodMap:()=>n.ZodMap,ZodNaN:()=>n.ZodNaN,ZodNativeEnum:()=>n.ZodNativeEnum,ZodNever:()=>n.ZodNever,ZodNull:()=>n.ZodNull,ZodNullable:()=>n.ZodNullable,ZodNumber:()=>n.ZodNumber,ZodObject:()=>n.ZodObject,ZodOptional:()=>n.ZodOptional,ZodParsedType:()=>s.ZodParsedType,ZodPipeline:()=>n.ZodPipeline,ZodPromise:()=>n.ZodPromise,ZodReadonly:()=>n.ZodReadonly,ZodRecord:()=>n.ZodRecord,ZodSchema:()=>n.ZodSchema,ZodSet:()=>n.ZodSet,ZodString:()=>n.ZodString,ZodSymbol:()=>n.ZodSymbol,ZodTransformer:()=>n.ZodTransformer,ZodTuple:()=>n.ZodTuple,ZodType:()=>n.ZodType,ZodUndefined:()=>n.ZodUndefined,ZodUnion:()=>n.ZodUnion,ZodUnknown:()=>n.ZodUnknown,ZodVoid:()=>n.ZodVoid,addIssueToContext:()=>o.addIssueToContext,any:()=>n.any,array:()=>n.array,bigint:()=>n.bigint,boolean:()=>n.boolean,coerce:()=>n.coerce,custom:()=>n.custom,date:()=>n.date,datetimeRegex:()=>n.datetimeRegex,defaultErrorMap:()=>r.defaultErrorMap,discriminatedUnion:()=>n.discriminatedUnion,effect:()=>n.effect,enum:()=>n.enum,function:()=>n.function,getErrorMap:()=>r.getErrorMap,getParsedType:()=>s.getParsedType,instanceof:()=>n.instanceof,intersection:()=>n.intersection,isAborted:()=>o.isAborted,isAsync:()=>o.isAsync,isDirty:()=>o.isDirty,isValid:()=>o.isValid,late:()=>n.late,lazy:()=>n.lazy,literal:()=>n.literal,makeIssue:()=>o.makeIssue,map:()=>n.map,nan:()=>n.nan,nativeEnum:()=>n.nativeEnum,never:()=>n.never,null:()=>n.null,nullable:()=>n.nullable,number:()=>n.number,object:()=>n.object,objectUtil:()=>s.objectUtil,oboolean:()=>n.oboolean,onumber:()=>n.onumber,optional:()=>n.optional,ostring:()=>n.ostring,pipeline:()=>n.pipeline,preprocess:()=>n.preprocess,promise:()=>n.promise,quotelessJson:()=>a.quotelessJson,record:()=>n.record,set:()=>n.set,setErrorMap:()=>r.setErrorMap,strictObject:()=>n.strictObject,string:()=>n.string,symbol:()=>n.symbol,transformer:()=>n.transformer,tuple:()=>n.tuple,undefined:()=>n.undefined,union:()=>n.union,unknown:()=>n.unknown,util:()=>s.util,void:()=>n.void});var r=e.i(965483),o=e.i(326114);e.i(50516);var s=e.i(230457),n=e.i(291129),a=e.i(719065);e.i(110724)},55321:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({BRAND:()=>r.BRAND,DIRTY:()=>r.DIRTY,EMPTY_PATH:()=>r.EMPTY_PATH,INVALID:()=>r.INVALID,NEVER:()=>r.NEVER,OK:()=>r.OK,ParseStatus:()=>r.ParseStatus,Schema:()=>r.Schema,ZodAny:()=>r.ZodAny,ZodArray:()=>r.ZodArray,ZodBigInt:()=>r.ZodBigInt,ZodBoolean:()=>r.ZodBoolean,ZodBranded:()=>r.ZodBranded,ZodCatch:()=>r.ZodCatch,ZodDate:()=>r.ZodDate,ZodDefault:()=>r.ZodDefault,ZodDiscriminatedUnion:()=>r.ZodDiscriminatedUnion,ZodEffects:()=>r.ZodEffects,ZodEnum:()=>r.ZodEnum,ZodError:()=>r.ZodError,ZodFirstPartyTypeKind:()=>r.ZodFirstPartyTypeKind,ZodFunction:()=>r.ZodFunction,ZodIntersection:()=>r.ZodIntersection,ZodIssueCode:()=>r.ZodIssueCode,ZodLazy:()=>r.ZodLazy,ZodLiteral:()=>r.ZodLiteral,ZodMap:()=>r.ZodMap,ZodNaN:()=>r.ZodNaN,ZodNativeEnum:()=>r.ZodNativeEnum,ZodNever:()=>r.ZodNever,ZodNull:()=>r.ZodNull,ZodNullable:()=>r.ZodNullable,ZodNumber:()=>r.ZodNumber,ZodObject:()=>r.ZodObject,ZodOptional:()=>r.ZodOptional,ZodParsedType:()=>r.ZodParsedType,ZodPipeline:()=>r.ZodPipeline,ZodPromise:()=>r.ZodPromise,ZodReadonly:()=>r.ZodReadonly,ZodRecord:()=>r.ZodRecord,ZodSchema:()=>r.ZodSchema,ZodSet:()=>r.ZodSet,ZodString:()=>r.ZodString,ZodSymbol:()=>r.ZodSymbol,ZodTransformer:()=>r.ZodTransformer,ZodTuple:()=>r.ZodTuple,ZodType:()=>r.ZodType,ZodUndefined:()=>r.ZodUndefined,ZodUnion:()=>r.ZodUnion,ZodUnknown:()=>r.ZodUnknown,ZodVoid:()=>r.ZodVoid,addIssueToContext:()=>r.addIssueToContext,any:()=>r.any,array:()=>r.array,bigint:()=>r.bigint,boolean:()=>r.boolean,coerce:()=>r.coerce,custom:()=>r.custom,date:()=>r.date,datetimeRegex:()=>r.datetimeRegex,defaultErrorMap:()=>r.defaultErrorMap,discriminatedUnion:()=>r.discriminatedUnion,effect:()=>r.effect,enum:()=>r.enum,function:()=>r.function,getErrorMap:()=>r.getErrorMap,getParsedType:()=>r.getParsedType,instanceof:()=>r.instanceof,intersection:()=>r.intersection,isAborted:()=>r.isAborted,isAsync:()=>r.isAsync,isDirty:()=>r.isDirty,isValid:()=>r.isValid,late:()=>r.late,lazy:()=>r.lazy,literal:()=>r.literal,makeIssue:()=>r.makeIssue,map:()=>r.map,nan:()=>r.nan,nativeEnum:()=>r.nativeEnum,never:()=>r.never,null:()=>r.null,nullable:()=>r.nullable,number:()=>r.number,object:()=>r.object,objectUtil:()=>r.objectUtil,oboolean:()=>r.oboolean,onumber:()=>r.onumber,optional:()=>r.optional,ostring:()=>r.ostring,pipeline:()=>r.pipeline,preprocess:()=>r.preprocess,promise:()=>r.promise,quotelessJson:()=>r.quotelessJson,record:()=>r.record,set:()=>r.set,setErrorMap:()=>r.setErrorMap,strictObject:()=>r.strictObject,string:()=>r.string,symbol:()=>r.symbol,transformer:()=>r.transformer,tuple:()=>r.tuple,undefined:()=>r.undefined,union:()=>r.union,unknown:()=>r.unknown,util:()=>r.util,void:()=>r.void}),e.i(864911);var r=e.i(750983)},340993:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t}),e.i(864911);let t=e.i(55321)}},344278:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(864911),e.i(340993)},422992:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({default:()=>t}),e.i(344278);let t=e.i(340993).default}},548444:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(344278),e.i(422992)},935509:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({z:()=>r});var r=e.i(55321)},14502:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({originCheck:()=>r.o});var r=e.i(151176)},537298:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({getSessionFromCtx:()=>r.g});var r=e.i(151176)},729792:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({sessionMiddleware:()=>r.s});var r=e.i(151176)},555166:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({generateRandomString:()=>r.g});var r=e.i(382320)},60108:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({createFieldAttribute:()=>t,toZodSchema:()=>o}),e.i(677172),e.i(955759),e.i(243917);var r=e.i(81714);e.i(776569),e.i(692153),e.i(654520),e.i(105127),e.i(316944),e.i(628146),e.i(4887),e.i(311556),e.i(74222),e.i(483013),e.i(533004),e.i(91997),e.i(382320),e.i(187615),e.i(771884),e.i(480954),e.i(805494),e.i(64041),e.i(392187);let t=(e,t)=>({type:e,...t});function o(e){return r.z.object({...Object.keys(e).reduce((t,i)=>{let o=e[i];if(!o)return t;if("string[]"===o.type||"number[]"===o.type)return{...t,[i]:r.z.array("string[]"===o.type?r.z.string():r.z.number())};if(Array.isArray(o.type))return{...t,[i]:r.z.any()};let s=r.z[o.type]();return(o?.required===!1&&(s=s.optional()),o?.returned===!1)?t:{...t,[i]:s}},{})})}}},346833:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({}),e.i(677172),e.i(955759),e.i(243917),e.i(776569),e.i(692153),e.i(654520),e.i(105127),e.i(316944),e.i(628146),e.i(4887),e.i(311556),e.i(74222),e.i(483013),e.i(533004),e.i(91997),e.i(382320),e.i(187615),e.i(771884),e.i(480954),e.i(805494),e.i(64041),e.i(392187),e.i(60108)},494986:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({mergeSchema:()=>r.m});var r=e.i(776569)},388890:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({stripe:()=>b}),e.i(701454);var r=e.i(217884);e.i(50139);var o=e.i(796854),s=e.i(395909);e.i(548444);var n=e.i(935509);e.i(277337);var a=e.i(14502),d=e.i(537298),l=e.i(729792),c=e.i(311556);e.i(169429);var u=e.i(555166);e.i(346833);var p=e.i(494986);async function h(e){return"function"==typeof e?.subscription?.plans?await e.subscription?.plans():e.subscription?.plans}async function m(e,t){return await h(e).then(e=>e?.find(e=>e.priceId===t||e.annualDiscountPriceId===t))}async function f(e,t){return await h(e).then(e=>e?.find(e=>e.name.toLowerCase()===t.toLowerCase()))}async function A(e,t,i){try{let r=t.stripeClient,o=i.data.object;if("setup"===o.mode||!t.subscription?.enabled)return;let s=await r.subscriptions.retrieve(o.subscription),n=s.items.data[0]?.price.id,a=await m(t,n);if(a){let r=o?.client_reference_id||o?.metadata?.referenceId,n=o?.metadata?.subscriptionId,d=s.items.data[0].quantity;if(r&&n){let r=s.trial_start&&s.trial_end?{trialStart:new Date(1e3*s.trial_start),trialEnd:new Date(1e3*s.trial_end)}:{},l=await e.context.adapter.update({model:"subscription",update:{plan:a.name.toLowerCase(),status:s.status,updatedAt:new Date,periodStart:new Date(1e3*s.items.data[0].current_period_start),periodEnd:new Date(1e3*s.items.data[0].current_period_end),stripeSubscriptionId:o.subscription,seats:d,...r},where:[{field:"id",value:n}]});r.trialStart&&a.freeTrial?.onTrialStart&&await a.freeTrial.onTrialStart(l),l||(l=await e.context.adapter.findOne({model:"subscription",where:[{field:"id",value:n}]})),await t.subscription?.onSubscriptionComplete?.({event:i,subscription:l,stripeSubscription:s,plan:a});return}}}catch(e){r.logger.error(`Stripe webhook failed. Error: ${e.message}`)}}async function g(e,t,i){try{if(!t.subscription?.enabled)return;let o=i.data.object,s=o.items.data[0].price.id,n=await m(t,s),a=o.metadata?.subscriptionId,d=o.customer?.toString(),l=await e.context.adapter.findOne({model:"subscription",where:a?[{field:"id",value:a}]:[{field:"stripeSubscriptionId",value:o.id}]});if(!l){let t=await e.context.adapter.findMany({model:"subscription",where:[{field:"stripeCustomerId",value:d}]});if(t.length>1){let e=t.find(e=>"active"===e.status||"trialing"===e.status);if(!e)return void r.logger.warn(`Stripe webhook error: Multiple subscriptions found for customerId: ${d} and no active subscription is found`);l=e}else l=t[0]}let c=o.items.data[0].quantity;await e.context.adapter.update({model:"subscription",update:{...n?{plan:n.name.toLowerCase(),limits:n.limits}:{},updatedAt:new Date,status:o.status,periodStart:new Date(1e3*o.items.data[0].current_period_start),periodEnd:new Date(1e3*o.items.data[0].current_period_end),cancelAtPeriodEnd:o.cancel_at_period_end,seats:c,stripeSubscriptionId:o.id},where:[{field:"id",value:l.id}]}),"active"===o.status&&o.cancel_at_period_end&&!l.cancelAtPeriodEnd&&await t.subscription.onSubscriptionCancel?.({subscription:l,cancellationDetails:o.cancellation_details||void 0,stripeSubscription:o,event:i}),await t.subscription.onSubscriptionUpdate?.({event:i,subscription:l}),n&&("active"===o.status&&"trialing"===l.status&&n.freeTrial?.onTrialEnd&&await n.freeTrial.onTrialEnd({subscription:l},e.request),"incomplete_expired"===o.status&&"trialing"===l.status&&n.freeTrial?.onTrialExpired&&await n.freeTrial.onTrialExpired(l,e.request))}catch(e){r.logger.error(`Stripe webhook failed. Error: ${e}`)}}async function y(e,t,i){if(t.subscription?.enabled)try{let o=i.data.object,s=o.id,n=await e.context.adapter.findOne({model:"subscription",where:[{field:"stripeSubscriptionId",value:s}]});n?(await e.context.adapter.update({model:"subscription",where:[{field:"id",value:n.id}],update:{status:"canceled",updatedAt:new Date}}),await t.subscription.onSubscriptionDeleted?.({event:i,stripeSubscription:o,subscription:n})):r.logger.warn(`Stripe webhook error: Subscription not found for subscriptionId: ${s}`)}catch(e){r.logger.error(`Stripe webhook failed. Error: ${e}`)}}let t={subscription:{fields:{plan:{type:"string",required:!0},referenceId:{type:"string",required:!0},stripeCustomerId:{type:"string",required:!1},stripeSubscriptionId:{type:"string",required:!1},status:{type:"string",defaultValue:"incomplete"},periodStart:{type:"date",required:!1},periodEnd:{type:"date",required:!1},cancelAtPeriodEnd:{type:"boolean",required:!1,defaultValue:!1},seats:{type:"number",required:!1}}}},i={user:{fields:{stripeCustomerId:{type:"string",required:!1}}}},K=e=>(e.schema&&!e.subscription?.enabled&&"subscription"in e.schema&&(e.schema.subscription=void 0),(0,p.mergeSchema)({...e.subscription?.enabled?t:{},...i},e.schema)),w={SUBSCRIPTION_NOT_FOUND:"Subscription not found",SUBSCRIPTION_PLAN_NOT_FOUND:"Subscription plan not found",ALREADY_SUBSCRIBED_PLAN:"You're already subscribed to this plan",UNABLE_TO_CREATE_CUSTOMER:"Unable to create customer",EMAIL_VERIFICATION_REQUIRED:"Email verification is required before you can subscribe to a plan",SUBSCRIPTION_NOT_ACTIVE:"Subscription is not active",SUBSCRIPTION_NOT_SCHEDULED_FOR_CANCELLATION:"Subscription is not scheduled for cancellation"},v=(e,t)=>t.startsWith("http")?t:`${e.context.options.baseURL}${t.startsWith("/")?t:`/${t}`}`,b=e=>{let t=e.stripeClient,i=t=>(0,s.createAuthMiddleware)(async i=>{let o=i.context.session;if(!o)throw new c.APIError("UNAUTHORIZED");let s=i.body?.referenceId||i.query?.referenceId||o.user.id;if(i.body?.referenceId&&!e.subscription?.authorizeReference)throw r.logger.error("Passing referenceId into a subscription action isn't allowed if subscription.authorizeReference isn't defined in your stripe plugin config."),new c.APIError("BAD_REQUEST",{message:"Reference id is not allowed. Read server logs for more details."});if(!(!i.body?.referenceId||await e.subscription?.authorizeReference?.({user:o.user,session:o.session,referenceId:s,action:t})))throw new c.APIError("UNAUTHORIZED",{message:"Unauthorized"})}),p={upgradeSubscription:(0,o.createAuthEndpoint)("/subscription/upgrade",{method:"POST",body:n.z.object({plan:n.z.string({description:"The name of the plan to upgrade to"}),annual:n.z.boolean({description:"Whether to upgrade to an annual plan"}).optional(),referenceId:n.z.string({description:"Reference id of the subscription to upgrade"}).optional(),subscriptionId:n.z.string({description:"The id of the subscription to upgrade"}).optional(),metadata:n.z.record(n.z.string(),n.z.any()).optional(),seats:n.z.number({description:"Number of seats to upgrade to (if applicable)"}).optional(),successUrl:n.z.string({description:"Callback URL to redirect back after successful subscription"}).default("/"),cancelUrl:n.z.string({description:"Callback URL to redirect back after successful subscription"}).default("/"),returnUrl:n.z.string().optional(),disableRedirect:n.z.boolean().default(!1)}),use:[l.sessionMiddleware,(0,a.originCheck)(e=>[e.body.successURL,e.body.cancelURL]),i("upgrade-subscription")]},async i=>{let{user:r,session:o}=i.context.session;if(!r.emailVerified&&e.subscription?.requireEmailVerification)throw new c.APIError("BAD_REQUEST",{message:w.EMAIL_VERIFICATION_REQUIRED});let s=i.body.referenceId||r.id,n=await f(e,i.body.plan);if(!n)throw new c.APIError("BAD_REQUEST",{message:w.SUBSCRIPTION_PLAN_NOT_FOUND});let a=i.body.subscriptionId?await i.context.adapter.findOne({model:"subscription",where:[{field:"id",value:i.body.subscriptionId}]}):null;if(i.body.subscriptionId&&!a)throw new c.APIError("BAD_REQUEST",{message:w.SUBSCRIPTION_NOT_FOUND});let d=a?.stripeCustomerId||r.stripeCustomerId;if(!d)try{let e=await t.customers.create({email:r.email,name:r.name,metadata:{...i.body.metadata,userId:r.id}},{idempotencyKey:(0,u.generateRandomString)(32,"a-z","0-9")});await i.context.adapter.update({model:"user",update:{stripeCustomerId:e.id},where:[{field:"id",value:r.id}]}),d=e.id}catch(e){throw i.context.logger.error(e),new c.APIError("BAD_REQUEST",{message:w.UNABLE_TO_CREATE_CUSTOMER})}let l=d?await t.subscriptions.list({customer:d,status:"active"}).then(e=>e.data.find(e=>e.id===i.body.subscriptionId)).catch(e=>null):null,p=(a?[a]:await i.context.adapter.findMany({model:"subscription",where:[{field:"referenceId",value:i.body.referenceId||r.id}]})).find(e=>"active"===e.status||"trialing"===e.status);if(p&&"active"===p.status&&p.plan===i.body.plan)throw new c.APIError("BAD_REQUEST",{message:w.ALREADY_SUBSCRIBED_PLAN});if(l&&d){let{url:e}=await t.billingPortal.sessions.create({customer:d,return_url:v(i,i.body.returnUrl||"/"),flow_data:{type:"subscription_update_confirm",subscription_update_confirm:{subscription:l.id,items:[{id:l.items.data[0]?.id,quantity:1,price:i.body.annual?n.annualDiscountPriceId:n.priceId}]}}}).catch(async e=>{throw i.error("BAD_REQUEST",{message:e.message,code:e.code})});return i.json({url:e,redirect:!0})}let h=p;if(h||(h=await i.context.adapter.create({model:"subscription",data:{plan:n.name.toLowerCase(),stripeCustomerId:d,status:"incomplete",referenceId:s,seats:i.body.seats||1}})),!h)throw i.context.logger.error("Subscription ID not found"),new c.APIError("INTERNAL_SERVER_ERROR");let m=await e.subscription?.getCheckoutSessionParams?.({user:r,session:o,plan:n,subscription:h},i.request),A=n.freeTrial?{trial_period_days:n.freeTrial.days}:void 0,g=await t.checkout.sessions.create({...d?{customer:d,customer_update:{name:"auto",address:"auto"}}:{customer_email:o.user.email},success_url:v(i,`${i.context.baseURL}/subscription/success?callbackURL=${encodeURIComponent(i.body.successUrl)}&subscriptionId=${encodeURIComponent(h.id)}`),cancel_url:v(i,i.body.cancelUrl),line_items:[{price:i.body.annual?n.annualDiscountPriceId:n.priceId,quantity:i.body.seats||1}],subscription_data:{...A},mode:"subscription",client_reference_id:s,...m?.params,metadata:{userId:r.id,subscriptionId:h.id,referenceId:s,...m?.params?.metadata}},m?.options).catch(async e=>{throw i.error("BAD_REQUEST",{message:e.message,code:e.code})});return i.json({...g,redirect:!i.body.disableRedirect})}),cancelSubscriptionCallback:(0,o.createAuthEndpoint)("/subscription/cancel/callback",{method:"GET",query:n.z.record(n.z.string(),n.z.any()).optional(),use:[(0,a.originCheck)(e=>e.query.callbackURL)]},async i=>{if(!i.query||!i.query.callbackURL||!i.query.subscriptionId)throw i.redirect(v(i,i.query?.callbackURL||"/"));let r=await (0,d.getSessionFromCtx)(i);if(!r)throw i.redirect(v(i,i.query?.callbackURL||"/"));let{user:o}=r,{callbackURL:s,subscriptionId:n}=i.query;if(o?.stripeCustomerId)try{let r=await i.context.adapter.findOne({model:"subscription",where:[{field:"id",value:n}]});if(!r||r.cancelAtPeriodEnd||"canceled"===r.status)throw i.redirect(v(i,s));let a=(await t.subscriptions.list({customer:o.stripeCustomerId,status:"active"})).data.find(e=>e.id===r.stripeSubscriptionId);a?.cancel_at_period_end===!0&&(await i.context.adapter.update({model:"subscription",update:{status:a?.status,cancelAtPeriodEnd:!0},where:[{field:"id",value:r.id}]}),await e.subscription?.onSubscriptionCancel?.({subscription:r,cancellationDetails:a.cancellation_details,stripeSubscription:a,event:void 0}))}catch(e){i.context.logger.error("Error checking subscription status from Stripe",e)}throw i.redirect(v(i,s))}),cancelSubscription:(0,o.createAuthEndpoint)("/subscription/cancel",{method:"POST",body:n.z.object({referenceId:n.z.string().optional(),subscriptionId:n.z.string().optional(),returnUrl:n.z.string()}),use:[l.sessionMiddleware,(0,a.originCheck)(e=>e.body.returnUrl),i("cancel-subscription")]},async e=>{let i=e.body?.referenceId||e.context.session.user.id,r=e.body.subscriptionId?await e.context.adapter.findOne({model:"subscription",where:[{field:"id",value:e.body.subscriptionId}]}):await e.context.adapter.findMany({model:"subscription",where:[{field:"referenceId",value:i}]}).then(e=>e.find(e=>"active"===e.status||"trialing"===e.status));if(!r||!r.stripeCustomerId)throw e.error("BAD_REQUEST",{message:w.SUBSCRIPTION_NOT_FOUND});let o=await t.subscriptions.list({customer:r.stripeCustomerId}).then(e=>e.data.filter(e=>"active"===e.status||"trialing"===e.status));if(!o.length)throw await e.context.adapter.deleteMany({model:"subscription",where:[{field:"referenceId",value:i}]}),e.error("BAD_REQUEST",{message:w.SUBSCRIPTION_NOT_FOUND});let s=o.find(e=>e.id===r.stripeSubscriptionId);if(!s)throw e.error("BAD_REQUEST",{message:w.SUBSCRIPTION_NOT_FOUND});let{url:n}=await t.billingPortal.sessions.create({customer:r.stripeCustomerId,return_url:v(e,`${e.context.baseURL}/subscription/cancel/callback?callbackURL=${encodeURIComponent(e.body?.returnUrl||"/")}&subscriptionId=${encodeURIComponent(r.id)}`),flow_data:{type:"subscription_cancel",subscription_cancel:{subscription:s.id}}}).catch(async t=>{throw t.message.includes("already set to be cancel")&&!r.cancelAtPeriodEnd&&await e.context.adapter.update({model:"subscription",update:{cancelAtPeriodEnd:!0},where:[{field:"referenceId",value:i}]}),e.error("BAD_REQUEST",{message:t.message,code:t.code})});return{url:n,redirect:!0}}),restoreSubscription:(0,o.createAuthEndpoint)("/subscription/restore",{method:"POST",body:n.z.object({referenceId:n.z.string().optional(),subscriptionId:n.z.string().optional()}),use:[l.sessionMiddleware,i("restore-subscription")]},async e=>{let i=e.body?.referenceId||e.context.session.user.id,r=e.body.subscriptionId?await e.context.adapter.findOne({model:"subscription",where:[{field:"id",value:e.body.subscriptionId}]}):await e.context.adapter.findMany({model:"subscription",where:[{field:"referenceId",value:i}]}).then(e=>e.find(e=>"active"===e.status||"trialing"===e.status));if(!r||!r.stripeCustomerId)throw e.error("BAD_REQUEST",{message:w.SUBSCRIPTION_NOT_FOUND});if("active"!=r.status&&"trialing"!=r.status)throw e.error("BAD_REQUEST",{message:w.SUBSCRIPTION_NOT_ACTIVE});if(!r.cancelAtPeriodEnd)throw e.error("BAD_REQUEST",{message:w.SUBSCRIPTION_NOT_SCHEDULED_FOR_CANCELLATION});let o=await t.subscriptions.list({customer:r.stripeCustomerId}).then(e=>e.data.filter(e=>"active"===e.status||"trialing"===e.status)[0]);if(!o)throw e.error("BAD_REQUEST",{message:w.SUBSCRIPTION_NOT_FOUND});try{let i=await t.subscriptions.update(o.id,{cancel_at_period_end:!1});return await e.context.adapter.update({model:"subscription",update:{cancelAtPeriodEnd:!1,updatedAt:new Date},where:[{field:"id",value:r.id}]}),e.json(i)}catch(t){throw e.context.logger.error("Error restoring subscription",t),new c.APIError("BAD_REQUEST",{message:w.UNABLE_TO_CREATE_CUSTOMER})}}),listActiveSubscriptions:(0,o.createAuthEndpoint)("/subscription/list",{method:"GET",query:n.z.optional(n.z.object({referenceId:n.z.string().optional()})),use:[l.sessionMiddleware,i("list-subscription")]},async t=>{let i=await t.context.adapter.findMany({model:"subscription",where:[{field:"referenceId",value:t.query?.referenceId||t.context.session.user.id}]});if(!i.length)return[];let r=await h(e);if(!r)return[];let o=i.map(e=>{let t=r.find(t=>t.name.toLowerCase()===e.plan.toLowerCase());return{...e,limits:t?.limits,priceId:t?.priceId}}).filter(e=>"active"===e.status||"trialing"===e.status);return t.json(o)}),subscriptionSuccess:(0,o.createAuthEndpoint)("/subscription/success",{method:"GET",query:n.z.record(n.z.string(),n.z.any()).optional(),use:[(0,a.originCheck)(e=>e.query.callbackURL)]},async i=>{if(!i.query||!i.query.callbackURL||!i.query.subscriptionId)throw i.redirect(v(i,i.query?.callbackURL||"/"));let r=await (0,d.getSessionFromCtx)(i);if(!r)throw i.redirect(v(i,i.query?.callbackURL||"/"));let{user:o}=r,{callbackURL:s,subscriptionId:n}=i.query,a=await i.context.adapter.findOne({model:"subscription",where:[{field:"id",value:n}]});if(a?.status==="active"||a?.status==="trialing")return i.redirect(v(i,s));let l=a?.stripeCustomerId||o.stripeCustomerId;if(l)try{let r=await t.subscriptions.list({customer:l,status:"active"}).then(e=>e.data[0]);if(r){let t=await m(e,r.items.data[0]?.plan.id);t&&a&&await i.context.adapter.update({model:"subscription",update:{status:r.status,seats:r.items.data[0]?.quantity||1,plan:t.name.toLowerCase(),periodEnd:new Date(r.items.data[0]?.current_period_end*1e3),periodStart:new Date(r.items.data[0]?.current_period_start*1e3),stripeSubscriptionId:r.id,...r.trial_start&&r.trial_end?{trialStart:new Date(1e3*r.trial_start),trialEnd:new Date(1e3*r.trial_end)}:{}},where:[{field:"id",value:a.id}]})}}catch(e){i.context.logger.error("Error fetching subscription from Stripe",e)}throw i.redirect(v(i,s))})};return{id:"stripe",endpoints:{stripeWebhook:(0,o.createAuthEndpoint)("/stripe/webhook",{method:"POST",metadata:{isAction:!1},cloneRequest:!0},async i=>{let r;if(!i.request?.body)throw new c.APIError("INTERNAL_SERVER_ERROR");let o=await i.request.text(),s=i.request.headers.get("stripe-signature"),n=e.stripeWebhookSecret;try{if(!s||!n)throw new c.APIError("BAD_REQUEST",{message:"Stripe webhook secret not found"});r=await t.webhooks.constructEventAsync(o,s,n)}catch(e){throw i.context.logger.error(`${e.message}`),new c.APIError("BAD_REQUEST",{message:`Webhook Error: ${e.message}`})}try{switch(r.type){case"checkout.session.completed":await A(i,e,r),await e.onEvent?.(r);break;case"customer.subscription.updated":await g(i,e,r),await e.onEvent?.(r);break;case"customer.subscription.deleted":await y(i,e,r),await e.onEvent?.(r);break;default:await e.onEvent?.(r)}}catch(e){throw i.context.logger.error(`Stripe webhook failed. Error: ${e.message}`),new c.APIError("BAD_REQUEST",{message:"Webhook error: See server logs for more information."})}return i.json({success:!0})}),...e.subscription?.enabled?p:{}},init:i=>({options:{databaseHooks:{user:{create:{async after(i,o){if(o&&e.createCustomerOnSignUp){let s=await t.customers.create({email:i.email,name:i.name,metadata:{userId:i.id}}),n=await o.context.adapter.update({model:"user",update:{stripeCustomerId:s.id},where:[{field:"id",value:i.id}]});n?await e.onCustomerCreate?.({customer:n,stripeCustomer:s,user:i}):r.logger.error("#BETTER_AUTH: Failed to create  customer")}}}}}}}),schema:K(e)}}}},436024:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({admin:()=>r.a});var r=e.i(587217)},395909:e=>{"use strict";var{g:t,__dirname:i}=e;e.s({createAuthMiddleware:()=>r.c});var r=e.i(151176)},402168:e=>{"use strict";var{g:t,__dirname:i}=e;{e.s({auth:()=>g}),e.i(701454);var r=e.i(838172),o=e.i(557440),s=e.i(43007),n=e.i(388890);e.i(50139);var a=e.i(436024),d=e.i(141780),l=e.i(757404),c=e.i(986279);e.i(277337);var u=e.i(395909),p=e.i(176825),h=e.i(74048);e.i(468686);var m=e.i(436754),f=e.i(318812),A=e.i(955013);let t=new h.default(process.env.STRIPE_SECRET_KEY),i=new A.Resend(process.env.RESEND_API_KEY),g=(0,r.betterAuth)({baseURL:process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:process.env.VERCEL_BRANCH_URL?`https://${process.env.VERCEL_BRANCH_URL}`:"https://inbound.new",trustedOrigins:["https://inbound.new",process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:"",process.env.VERCEL_BRANCH_URL?`https://${process.env.VERCEL_BRANCH_URL}`:"",process.env.VERCEL_PROJECT_PRODUCTION_URL?`https://${process.env.VERCEL_PROJECT_PRODUCTION_URL}`:""].filter(Boolean),database:(0,s.drizzleAdapter)(o.db,{provider:"pg",schema:m}),socialProviders:{github:{clientId:process.env.GITHUB_CLIENT_ID,clientSecret:process.env.GITHUB_CLIENT_SECRET,redirectURI:"https://inbound.new/api/auth/callback/github"},google:{prompt:"select_account",clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,redirectURI:"https://inbound.new/api/auth/callback/google"}},session:{updateAge:86400,expiresIn:604800},user:{additionalFields:{featureFlags:{type:"string",required:!1,defaultValue:null}}},plugins:[(0,l.oAuthProxy)({productionURL:process.env.BETTER_AUTH_URL||"https://inbound.new",currentURL:process.env.VERCEL_URL?`https://${process.env.VERCEL_URL}`:process.env.VERCEL_BRANCH_URL?`https://${process.env.VERCEL_BRANCH_URL}`:void 0}),(0,d.apiKey)({rateLimit:{enabled:!1}}),(0,a.admin)(),(0,c.magicLink)({expiresIn:300,disableSignUp:!1,sendMagicLink:async({email:e,url:t,token:r},o)=>{console.log(` Sending magic link to ${e}`);try{let{data:r,error:o}=await i.emails.send({from:"noreply@inbound.new",to:e,subject:"Sign in to Inbound",html:`
                            <div style="max-width: 600px; margin: 0 auto; font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f8fafc, #f1f5f9); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                                <div style="background: white; margin: 8px; border-radius: 12px; padding: 48px 32px;">
                                    <div style="text-align: center; margin-bottom: 16px;">
                                        <div style="display: inline-block; background: #2563eb; color: white; width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <h1 style="color: #111827; margin: 0 0 8px 0; font-size: 28px; font-weight: 600; text-align: center; letter-spacing: -0.025em;">Welcome to Inbound</h1>
                                    <p style="color: #6b7280; font-size: 16px; margin: 0 0 32px 0; text-align: center; line-height: 1.5;">
                                        Click the button below to securely sign in to your account and start managing your email infrastructure.
                                    </p>
                                    <div style="text-align: center; margin-bottom: 32px;">
                                        <a href="${t}" 
                                           style="display: inline-block; background: #2563eb; color: white; padding: 14px 32px; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 16px; transition: background-color 0.2s;">
                                            Sign in to Inbound
                                        </a>
                                    </div>
                                    <div style="text-align: center; padding-top: 24px; border-top: 1px solid #e5e7eb;">
                                        <p style="color: #9ca3af; font-size: 14px; margin: 0; line-height: 1.4;">
                                            This secure link will expire in 5 minutes for your security.<br/>
                                            If you didn't request this, you can safely ignore this email.
                                        </p>
                                    </div>
                                    
                                </div>
                                <div style="text-align: center; padding: 24px; color: #64748b; font-size: 12px;">
                                    <p style="margin: 0;">
                                        \xa9 ${new Date().getFullYear()} Inbound. Email infrastructure, redefined.
                                    </p>
                                </div>
                            </div>
                        `,text:`Sign in to Inbound

Click this link to sign in: ${t}

This link will expire in 5 minutes.`});if(o)throw console.error(" Failed to send magic link email:",o),Error(`Failed to send email: ${o.message}`);console.log(" Magic link email sent successfully:",r?.id)}catch(e){throw console.error(" Error sending magic link:",e),e}}}),(0,n.stripe)({stripeClient:t,stripeWebhookSecret:process.env.STRIPE_WEBHOOK_SECRET,createCustomerOnSignUp:!0})],hooks:{after:(0,u.createAuthMiddleware)(async e=>{if(e.path.startsWith("/sign-up")||e.path.startsWith("/sign-in")&&e.context.newSession){let t=e.context.newSession;if(t?.user){let e=t.user;console.log(` New user detected: ${e.email} (${e.id})`);try{let t=await o.db.select().from(m.userOnboarding).where((0,p.eq)(m.userOnboarding.userId,e.id)).limit(1);if(0===t.length){console.log(` Creating onboarding record for user ${e.id}`);let t=(0,f.nanoid)();await o.db.insert(m.userOnboarding).values({id:t,userId:e.id,isCompleted:!1,defaultEndpointCreated:!1,createdAt:new Date,updatedAt:new Date}),console.log(` Onboarding record created for user ${e.id}. User will create endpoints manually.`)}else console.log(` Onboarding record already exists for user ${e.id}`)}catch(t){console.error(` Error creating onboarding data for user ${e.id}:`,t)}}}})}})}}};

//# sourceMappingURL=%5Broot-of-the-server%5D__9edd19d9._.js.map