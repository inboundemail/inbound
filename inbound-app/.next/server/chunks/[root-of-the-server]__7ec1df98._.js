module.exports={929549:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},983943:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},86103:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},945935:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},348629:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("@opentelemetry/api",()=>require("@opentelemetry/api"))},76569:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("node:events",()=>require("node:events"))},804713:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("util",()=>require("util"))},87485:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("child_process",()=>require("child_process"))},420467:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("events",()=>require("events"))},936121:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("node:util",()=>require("node:util"))},681635:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("node:http",()=>require("node:http"))},866098:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("node:https",()=>require("node:https"))},580767:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("node:buffer",()=>require("node:buffer"))},329295:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("crypto",()=>require("crypto"))},62445:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("http",()=>require("http"))},348388:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("https",()=>require("https"))},591032:function(e){var{g:s,__dirname:r,m:i,e:t}=e;i.exports=e.x("node:crypto",()=>require("node:crypto"))},909834:e=>{"use strict";var{g:s,__dirname:r}=e;e.s({DELIVERY_STATUS:()=>t.DELIVERY_STATUS,DELIVERY_TYPES:()=>t.DELIVERY_TYPES,DOMAIN_STATUS:()=>t.DOMAIN_STATUS,EMAIL_STATUS:()=>t.EMAIL_STATUS,ENDPOINT_TYPES:()=>t.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>t.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>t.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>t.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>t.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>t.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>t.WEBHOOK_STATUS,account:()=>i.account,apikey:()=>i.apikey,blockedEmails:()=>t.blockedEmails,domainDnsRecords:()=>t.domainDnsRecords,emailAddresses:()=>t.emailAddresses,emailDomains:()=>t.emailDomains,emailGroups:()=>t.emailGroups,endpointDeliveries:()=>t.endpointDeliveries,endpoints:()=>t.endpoints,parsedEmails:()=>t.parsedEmails,receivedEmails:()=>t.receivedEmails,sentEmails:()=>t.sentEmails,sesEvents:()=>t.sesEvents,session:()=>i.session,structuredEmails:()=>t.structuredEmails,subscriptions:()=>t.subscriptions,user:()=>i.user,userAccounts:()=>t.userAccounts,userOnboarding:()=>t.userOnboarding,verification:()=>i.verification,vipAllowedSenders:()=>t.vipAllowedSenders,vipConfigs:()=>t.vipConfigs,vipEmailAttempts:()=>t.vipEmailAttempts,vipPaymentSessions:()=>t.vipPaymentSessions,webhookDeliveries:()=>t.webhookDeliveries,webhooks:()=>t.webhooks});var i=e.i(594120),t=e.i(55379)},436754:e=>{"use strict";var{g:s,__dirname:r}=e;e.s({DELIVERY_STATUS:()=>i.DELIVERY_STATUS,DELIVERY_TYPES:()=>i.DELIVERY_TYPES,DOMAIN_STATUS:()=>i.DOMAIN_STATUS,EMAIL_STATUS:()=>i.EMAIL_STATUS,ENDPOINT_TYPES:()=>i.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>i.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>i.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>i.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>i.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>i.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>i.WEBHOOK_STATUS,account:()=>i.account,apikey:()=>i.apikey,blockedEmails:()=>i.blockedEmails,domainDnsRecords:()=>i.domainDnsRecords,emailAddresses:()=>i.emailAddresses,emailDomains:()=>i.emailDomains,emailGroups:()=>i.emailGroups,endpointDeliveries:()=>i.endpointDeliveries,endpoints:()=>i.endpoints,parsedEmails:()=>i.parsedEmails,receivedEmails:()=>i.receivedEmails,sentEmails:()=>i.sentEmails,sesEvents:()=>i.sesEvents,session:()=>i.session,structuredEmails:()=>i.structuredEmails,subscriptions:()=>i.subscriptions,user:()=>i.user,userAccounts:()=>i.userAccounts,userOnboarding:()=>i.userOnboarding,verification:()=>i.verification,vipAllowedSenders:()=>i.vipAllowedSenders,vipConfigs:()=>i.vipConfigs,vipEmailAttempts:()=>i.vipEmailAttempts,vipPaymentSessions:()=>i.vipPaymentSessions,webhookDeliveries:()=>i.webhookDeliveries,webhooks:()=>i.webhooks}),e.i(468686);var i=e.i(909834)},496669:e=>{"use strict";var{g:s,__dirname:r}=e;e.s({createApiKeyMiddleware:()=>n,validateApiKey:()=>t});var i=e.i(402168);async function t(e){try{let s,r=e.headers.get("Authorization");if(!r)return{valid:!1,error:"Missing Authorization header"};if(s=r.startsWith("Bearer ")?r.substring(7):r,console.log("API KEY: "+s),!s)return{valid:!1,error:"Invalid Authorization header format"};let{valid:t,error:n,key:a}=await i.auth.api.verifyApiKey({body:{key:s}});if(console.log("VALID: "+t),console.log("ERROR: "+n),console.log("KEY: "+a?.userId),!t||n||!a)return{valid:!1,error:n?.message||"Invalid API key"};if(!a.enabled)return{valid:!1,error:"API key is disabled"};if(a.expiresAt&&new Date(a.expiresAt)<new Date)return{valid:!1,error:"API key has expired"};return{valid:!0,user:{id:a.userId,email:a.userId,name:null}}}catch(e){return console.error("API key validation error:",e),{valid:!1,error:"Internal server error during API key validation"}}}function n(){return async e=>{let s=await t(e);return s.valid?{user:s.user}:{error:s.error,status:401}}}},936033:function(e){var{g:s,__dirname:r,m:i,e:t}=e},197962:e=>{"use strict";var{g:s,__dirname:r}=e;e.s({GET:()=>p,POST:()=>m});var i=e.i(125427),t=e.i(496669),n=e.i(557440);e.i(468686);var a=e.i(55379),o=e.i(176825),d=e.i(460009),l=e.i(91890),u=e.i(318812),c=e.i(807204);async function p(e){try{console.log("ðŸ“‹ GET /api/v1.1/email-addresses - Fetching user email addresses");let s=await (0,t.validateApiKey)(e);if("error"in s)return i.NextResponse.json({error:s.error},{status:401});let r=s.user?.id;if(!r)return i.NextResponse.json({error:"User not found"},{status:401});let{searchParams:u}=new URL(e.url),c=u.get("domainId"),p=u.get("active"),m=Math.min(parseInt(u.get("limit")||"50"),100),v=parseInt(u.get("offset")||"0"),A=[(0,o.eq)(a.emailAddresses.userId,r)];c&&A.push((0,o.eq)(a.emailAddresses.domainId,c)),null!==p&&A.push((0,o.eq)(a.emailAddresses.isActive,"true"===p));let E=A.length>1?(0,o.and)(...A):A[0],S=n.db.select({id:a.emailAddresses.id,address:a.emailAddresses.address,domainId:a.emailAddresses.domainId,webhookId:a.emailAddresses.webhookId,endpointId:a.emailAddresses.endpointId,isActive:a.emailAddresses.isActive,isReceiptRuleConfigured:a.emailAddresses.isReceiptRuleConfigured,receiptRuleName:a.emailAddresses.receiptRuleName,createdAt:a.emailAddresses.createdAt,updatedAt:a.emailAddresses.updatedAt,domainName:a.emailDomains.domain,domainStatus:a.emailDomains.status,endpointName:a.endpoints.name,endpointType:a.endpoints.type,endpointIsActive:a.endpoints.isActive,webhookName:a.webhooks.name,webhookUrl:a.webhooks.url,webhookIsActive:a.webhooks.isActive}).from(a.emailAddresses).leftJoin(a.emailDomains,(0,o.eq)(a.emailAddresses.domainId,a.emailDomains.id)).leftJoin(a.endpoints,(0,o.eq)(a.emailAddresses.endpointId,a.endpoints.id)).leftJoin(a.webhooks,(0,o.eq)(a.emailAddresses.webhookId,a.webhooks.id)).where(E),f=await S.orderBy((0,d.desc)(a.emailAddresses.createdAt)).limit(m).offset(v),g=await n.db.select({count:(0,l.count)()}).from(a.emailAddresses).where(E),_=g[0]?.count||0,h=f.map(e=>({id:e.id,address:e.address,isActive:e.isActive,isReceiptRuleConfigured:e.isReceiptRuleConfigured,receiptRuleName:e.receiptRuleName,createdAt:e.createdAt,updatedAt:e.updatedAt,domain:{id:e.domainId,name:e.domainName,status:e.domainStatus},routing:e.endpointId?{type:"endpoint",id:e.endpointId,name:e.endpointName,endpointType:e.endpointType,isActive:e.endpointIsActive}:e.webhookId?{type:"webhook",id:e.webhookId,name:e.webhookName,url:e.webhookUrl,isActive:e.webhookIsActive}:{type:"none",id:null,name:null,isActive:!1}}));return console.log(`âœ… GET /api/v1.1/email-addresses - Retrieved ${f.length} email addresses for user ${r}`),i.NextResponse.json({success:!0,data:h,pagination:{limit:m,offset:v,total:_,hasMore:v+m<_},meta:{totalCount:_,activeCount:h.filter(e=>e.isActive).length,routingBreakdown:{endpoint:h.filter(e=>"endpoint"===e.routing.type).length,webhook:h.filter(e=>"webhook"===e.routing.type).length,none:h.filter(e=>"none"===e.routing.type).length}}})}catch(e){return console.error("âŒ GET /api/v1.1/email-addresses - Error:",e),i.NextResponse.json({success:!1,error:"Failed to fetch email addresses",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function m(e){try{console.log("ðŸ“ POST /api/v1.1/email-addresses - Creating new email address");let s=await (0,t.validateApiKey)(e);if("error"in s)return i.NextResponse.json({error:s.error},{status:401});let r=s.user?.id;if(!r)return i.NextResponse.json({error:"User not found"},{status:401});let d=await e.json();if(!d.address||!d.domainId)return i.NextResponse.json({success:!1,error:"Missing required fields",required:["address","domainId"]},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.address))return i.NextResponse.json({success:!1,error:"Invalid email address format"},{status:400});let l=await n.db.select().from(a.emailDomains).where((0,o.and)((0,o.eq)(a.emailDomains.id,d.domainId),(0,o.eq)(a.emailDomains.userId,r))).limit(1);if(!l[0])return i.NextResponse.json({success:!1,error:"Domain not found or access denied"},{status:404});if((await n.db.select().from(a.emailAddresses).where((0,o.eq)(a.emailAddresses.address,d.address)).limit(1))[0])return i.NextResponse.json({success:!1,error:"Email address already exists"},{status:409});let p=null,m=null;if(d.endpointId){if(!(await n.db.select().from(a.endpoints).where((0,o.and)((0,o.eq)(a.endpoints.id,d.endpointId),(0,o.eq)(a.endpoints.userId,r))).limit(1))[0])return i.NextResponse.json({success:!1,error:"Endpoint not found or access denied"},{status:404});p=d.endpointId}else if(d.webhookId){if(!(await n.db.select().from(a.webhooks).where((0,o.and)((0,o.eq)(a.webhooks.id,d.webhookId),(0,o.eq)(a.webhooks.userId,r))).limit(1))[0])return i.NextResponse.json({success:!1,error:"Webhook not found or access denied"},{status:404});m=d.webhookId}let v={id:(0,u.nanoid)(),address:d.address,domainId:d.domainId,endpointId:p,webhookId:m,isActive:void 0===d.isActive||d.isActive,isReceiptRuleConfigured:!1,receiptRuleName:null,userId:r,createdAt:new Date,updatedAt:new Date},[A]=await n.db.insert(a.emailAddresses).values(v).returning(),E=!1,S=null,f=null;try{let e=new c.AWSSESReceiptRuleManager,s=process.env.AWS_REGION||"us-east-2",r=process.env.LAMBDA_FUNCTION_NAME||"email-processor",i=process.env.S3_BUCKET_NAME,t=process.env.AWS_ACCOUNT_ID;if(i&&t){console.log(`ðŸ”§ POST /api/v1.1/email-addresses - Configuring AWS SES receipt rules for ${d.address}`);let u=c.AWSSESReceiptRuleManager.getLambdaFunctionArn(r,t,s),p=await e.configureEmailReceiving({domain:l[0].domain,emailAddresses:[d.address],lambdaFunctionArn:u,s3BucketName:i});"created"===p.status||"updated"===p.status?(await n.db.update(a.emailAddresses).set({isReceiptRuleConfigured:!0,receiptRuleName:p.ruleName,updatedAt:new Date}).where((0,o.eq)(a.emailAddresses.id,A.id)),E=!0,S=p.ruleName,console.log(`âœ… POST /api/v1.1/email-addresses - AWS SES configured successfully for ${d.address}`)):(f=`SES configuration failed: ${p.error}`,console.warn(`âš ï¸ POST /api/v1.1/email-addresses - ${f}`))}else f="AWS configuration incomplete. Missing S3_BUCKET_NAME or AWS_ACCOUNT_ID",console.warn(`âš ï¸ POST /api/v1.1/email-addresses - ${f}`)}catch(e){f=`SES configuration error: ${e instanceof Error?e.message:"Unknown error"}`,console.error(`âŒ POST /api/v1.1/email-addresses - AWS SES configuration failed:`,e)}let g={...A,isReceiptRuleConfigured:E,receiptRuleName:S,domain:{id:l[0].id,name:l[0].domain,status:l[0].status},routing:p?{type:"endpoint",id:p,name:null,endpointType:null,isActive:!0}:m?{type:"webhook",id:m,name:null,url:null,isActive:!0}:{type:"none",id:null,name:null,isActive:!1},...f&&{warning:f}};return console.log(`âœ… POST /api/v1.1/email-addresses - Successfully created email address ${A.id}`),i.NextResponse.json({success:!0,data:g,message:E?"Email address created and AWS SES configured successfully":"Email address created successfully (AWS SES configuration pending)"},{status:201})}catch(e){return console.error("âŒ POST /api/v1.1/email-addresses - Error:",e),i.NextResponse.json({success:!1,error:"Failed to create email address",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}},174874:e=>{"use strict";var{g:s,__dirname:r}=e;{e.s({patchFetch:()=>o,routeModule:()=>s,serverHooks:()=>l,workAsyncStorage:()=>r,workUnitAsyncStorage:()=>d});var i=e.i(854885),t=e.i(814689),n=e.i(25402),a=e.i(197962);let s=new i.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/v1.1/email-addresses/route",pathname:"/api/v1.1/email-addresses",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/v1.1/email-addresses/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:r,workUnitAsyncStorage:d,serverHooks:l}=s;function o(){return(0,n.patchFetch)({workAsyncStorage:r,workUnitAsyncStorage:d})}}},993477:e=>{var{g:s,__dirname:r}=e;e.v(s=>Promise.all(["server/chunks/[root-of-the-server]__53e7de1a._.js","server/chunks/node_modules_10ae7a2d._.js"].map(s=>e.l(s))).then(()=>s(611487)))},73518:e=>{var{g:s,__dirname:r}=e;e.v(s=>Promise.all(["server/chunks/[externals]_url_a7f1d978._.js","server/chunks/9f50b_@smithy_credential-provider-imds_dist-es_d5e4d7ca._.js"].map(s=>e.l(s))).then(()=>s(653223)))},855094:e=>{var{g:s,__dirname:r}=e;e.v(s=>Promise.all(["server/chunks/[externals]_fs_promises_1c68bc94._.js","server/chunks/9f50b_@aws-sdk_credential-provider-http_89f62eca._.js"].map(s=>e.l(s))).then(()=>s(515630)))},520835:e=>{var{g:s,__dirname:r}=e;e.v(s=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-web-identity_54a20676._.js"].map(s=>e.l(s))).then(()=>s(399432)))},404886:e=>{var{g:s,__dirname:r}=e;e.v(s=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-process_dist-es_f8837f08._.js"].map(s=>e.l(s))).then(()=>s(31086)))},800893:e=>{var{g:s,__dirname:r}=e;e.v(s=>Promise.all(["server/chunks/9f50b_c808b9d7._.js"].map(s=>e.l(s))).then(()=>s(387894)))},683391:e=>{var{g:s,__dirname:r}=e;e.v(s=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-sso_e42c1868._.js"].map(s=>e.l(s))).then(()=>s(695705)))},586469:e=>{var{g:s,__dirname:r}=e;e.v(s=>Promise.all(["server/chunks/[externals]_url_a7f1d978._.js","server/chunks/87a6c_@smithy_credential-provider-imds_dist-es_ee44b021._.js"].map(s=>e.l(s))).then(()=>s(488366)))}};

//# sourceMappingURL=%5Broot-of-the-server%5D__7ec1df98._.js.map