module.exports={929549:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},983943:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},86103:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},945935:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},348629:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("@opentelemetry/api",()=>require("@opentelemetry/api"))},76569:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("node:events",()=>require("node:events"))},804713:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("util",()=>require("util"))},87485:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("child_process",()=>require("child_process"))},420467:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("events",()=>require("events"))},936121:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("node:util",()=>require("node:util"))},681635:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("node:http",()=>require("node:http"))},866098:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("node:https",()=>require("node:https"))},580767:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("node:buffer",()=>require("node:buffer"))},329295:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("crypto",()=>require("crypto"))},62445:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("http",()=>require("http"))},348388:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("https",()=>require("https"))},591032:function(e){var{g:t,__dirname:r,m:i,e:s}=e;i.exports=e.x("node:crypto",()=>require("node:crypto"))},909834:e=>{"use strict";var{g:t,__dirname:r}=e;e.s({DELIVERY_STATUS:()=>s.DELIVERY_STATUS,DELIVERY_TYPES:()=>s.DELIVERY_TYPES,DOMAIN_STATUS:()=>s.DOMAIN_STATUS,EMAIL_STATUS:()=>s.EMAIL_STATUS,ENDPOINT_TYPES:()=>s.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>s.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>s.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>s.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>s.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>s.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>s.WEBHOOK_STATUS,account:()=>i.account,apikey:()=>i.apikey,blockedEmails:()=>s.blockedEmails,domainDnsRecords:()=>s.domainDnsRecords,emailAddresses:()=>s.emailAddresses,emailDomains:()=>s.emailDomains,emailGroups:()=>s.emailGroups,endpointDeliveries:()=>s.endpointDeliveries,endpoints:()=>s.endpoints,parsedEmails:()=>s.parsedEmails,receivedEmails:()=>s.receivedEmails,sentEmails:()=>s.sentEmails,sesEvents:()=>s.sesEvents,session:()=>i.session,structuredEmails:()=>s.structuredEmails,subscriptions:()=>s.subscriptions,user:()=>i.user,userAccounts:()=>s.userAccounts,userOnboarding:()=>s.userOnboarding,verification:()=>i.verification,vipAllowedSenders:()=>s.vipAllowedSenders,vipConfigs:()=>s.vipConfigs,vipEmailAttempts:()=>s.vipEmailAttempts,vipPaymentSessions:()=>s.vipPaymentSessions,webhookDeliveries:()=>s.webhookDeliveries,webhooks:()=>s.webhooks});var i=e.i(594120),s=e.i(55379)},436754:e=>{"use strict";var{g:t,__dirname:r}=e;e.s({DELIVERY_STATUS:()=>i.DELIVERY_STATUS,DELIVERY_TYPES:()=>i.DELIVERY_TYPES,DOMAIN_STATUS:()=>i.DOMAIN_STATUS,EMAIL_STATUS:()=>i.EMAIL_STATUS,ENDPOINT_TYPES:()=>i.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>i.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>i.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>i.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>i.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>i.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>i.WEBHOOK_STATUS,account:()=>i.account,apikey:()=>i.apikey,blockedEmails:()=>i.blockedEmails,domainDnsRecords:()=>i.domainDnsRecords,emailAddresses:()=>i.emailAddresses,emailDomains:()=>i.emailDomains,emailGroups:()=>i.emailGroups,endpointDeliveries:()=>i.endpointDeliveries,endpoints:()=>i.endpoints,parsedEmails:()=>i.parsedEmails,receivedEmails:()=>i.receivedEmails,sentEmails:()=>i.sentEmails,sesEvents:()=>i.sesEvents,session:()=>i.session,structuredEmails:()=>i.structuredEmails,subscriptions:()=>i.subscriptions,user:()=>i.user,userAccounts:()=>i.userAccounts,userOnboarding:()=>i.userOnboarding,verification:()=>i.verification,vipAllowedSenders:()=>i.vipAllowedSenders,vipConfigs:()=>i.vipConfigs,vipEmailAttempts:()=>i.vipEmailAttempts,vipPaymentSessions:()=>i.vipPaymentSessions,webhookDeliveries:()=>i.webhookDeliveries,webhooks:()=>i.webhooks}),e.i(468686);var i=e.i(909834)},153364:function(e){var{g:t,__dirname:r,m:i,e:s}=e;"use strict";i.exports=e.r(68043).vendored["react-rsc"].ReactServerDOMTurbopackServerEdge},490264:function(e){var{g:t,__dirname:r,m:i,e:s}=e},271090:e=>{"use strict";var{g:t,__dirname:r}=e;e.s({GET:()=>p,POST:()=>c});var i=e.i(125427),s=e.i(494642),n=e.i(557440);e.i(468686);var o=e.i(55379),a=e.i(176825),l=e.i(460009),d=e.i(91890),u=e.i(318812);async function p(e){console.log("ğŸ”— GET /api/v2/endpoints - Starting request");try{console.log("ğŸ” Validating request authentication");let{userId:t,error:r}=await (0,s.validateRequest)(e);if(!t)return console.log("âŒ Authentication failed:",r),i.NextResponse.json({error:r},{status:401});console.log("âœ… Authentication successful for userId:",t);let{searchParams:u}=new URL(e.url),p=Math.min(parseInt(u.get("limit")||"50"),100),c=parseInt(u.get("offset")||"0"),m=u.get("type"),v=u.get("active");if(console.log("ğŸ“Š Query parameters:",{limit:p,offset:c,type:m,active:v}),p<1||p>100)return console.log("âš ï¸ Invalid limit parameter:",p),i.NextResponse.json({error:"Limit must be between 1 and 100"},{status:400});if(c<0)return console.log("âš ï¸ Invalid offset parameter:",c),i.NextResponse.json({error:"Offset must be non-negative"},{status:400});let g=[(0,a.eq)(o.endpoints.userId,t)];if(m&&["webhook","email","email_group"].includes(m)&&(g.push((0,a.eq)(o.endpoints.type,m)),console.log("ğŸ” Filtering by type:",m)),null!==v){let e="true"===v;g.push((0,a.eq)(o.endpoints.isActive,e)),console.log("ğŸ” Filtering by active status:",e)}let f=g.length>1?(0,a.and)(...g):g[0];console.log("ğŸ” Querying endpoints from database");let E=await n.db.select({id:o.endpoints.id,name:o.endpoints.name,type:o.endpoints.type,config:o.endpoints.config,isActive:o.endpoints.isActive,description:o.endpoints.description,userId:o.endpoints.userId,createdAt:o.endpoints.createdAt,updatedAt:o.endpoints.updatedAt}).from(o.endpoints).where(f).orderBy((0,l.desc)(o.endpoints.createdAt)).limit(p).offset(c);console.log("ğŸ“Š Retrieved endpoints count:",E.length);let S=await n.db.select({count:(0,d.count)()}).from(o.endpoints).where(f),A=S[0]?.count||0;console.log("ğŸ“Š Total endpoints count:",A),console.log("ğŸ”§ Enhancing endpoints with additional data");let T=await Promise.all(E.map(async e=>{let t={...e,config:JSON.parse(e.config),groupEmails:null,deliveryStats:{total:0,successful:0,failed:0,lastDelivery:null}};"email_group"===e.type&&(console.log("ğŸ“§ Loading group emails for endpoint:",e.id),t.groupEmails=(await n.db.select({emailAddress:o.emailGroups.emailAddress}).from(o.emailGroups).where((0,a.eq)(o.emailGroups.endpointId,e.id)).orderBy(o.emailGroups.createdAt)).map(e=>e.emailAddress)),console.log("ğŸ“Š Loading delivery stats for endpoint:",e.id);let r=await n.db.select({total:(0,d.count)(),status:o.endpointDeliveries.status}).from(o.endpointDeliveries).where((0,a.eq)(o.endpointDeliveries.endpointId,e.id)).groupBy(o.endpointDeliveries.status),i=0,s=0,u=0;for(let e of r)i+=e.total,"success"===e.status&&(s+=e.total),"failed"===e.status&&(u+=e.total);let p=await n.db.select({lastDelivery:o.endpointDeliveries.lastAttemptAt}).from(o.endpointDeliveries).where((0,a.eq)(o.endpointDeliveries.endpointId,e.id)).orderBy((0,l.desc)(o.endpointDeliveries.lastAttemptAt)).limit(1),c=p[0]?.lastDelivery||null;return t.deliveryStats={total:i,successful:s,failed:u,lastDelivery:c?new Date(c).toISOString():null},t}));return console.log("âœ… Successfully enhanced all endpoints"),i.NextResponse.json({data:T,pagination:{limit:p,offset:c,total:A,hasMore:c+p<A}})}catch(e){return console.error("ğŸ’¥ Unexpected error in GET /api/v2/endpoints:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e){console.log("â• POST /api/v2/endpoints - Starting create request");try{console.log("ğŸ” Validating request authentication");let{userId:t,error:r}=await (0,s.validateRequest)(e);if(!t)return console.log("âŒ Authentication failed:",r),i.NextResponse.json({error:r},{status:401});console.log("âœ… Authentication successful for userId:",t);let a=await e.json();if(console.log("ğŸ“ Received endpoint data:",{name:a.name,type:a.type,hasConfig:!!a.config,description:a.description}),!a.name||!a.type||!a.config)return console.log("âŒ Missing required fields"),i.NextResponse.json({error:"Missing required fields",required:["name","type","config"]},{status:400});if(!["webhook","email","email_group"].includes(a.type))return console.log("âŒ Invalid endpoint type:",a.type),i.NextResponse.json({error:"Invalid endpoint type",validTypes:["webhook","email","email_group"]},{status:400});console.log("ğŸ” Validating endpoint configuration");let l=function(e,t){try{switch(e){case"webhook":if(!t.url)return{valid:!1,error:"Webhook URL is required"};if("string"!=typeof t.url)return{valid:!1,error:"Webhook URL must be a string"};try{new URL(t.url)}catch{return{valid:!1,error:"Invalid webhook URL format"}}if(t.timeout&&("number"!=typeof t.timeout||t.timeout<1||t.timeout>300))return{valid:!1,error:"Timeout must be a number between 1 and 300 seconds"};if(t.retryAttempts&&("number"!=typeof t.retryAttempts||t.retryAttempts<0||t.retryAttempts>10))return{valid:!1,error:"Retry attempts must be a number between 0 and 10"};break;case"email":if(!t.forwardTo)return{valid:!1,error:"Forward-to email address is required"};if("string"!=typeof t.forwardTo)return{valid:!1,error:"Forward-to email must be a string"};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.forwardTo))return{valid:!1,error:"Invalid forward-to email address format"};break;case"email_group":if(!t.emails||!Array.isArray(t.emails))return{valid:!1,error:"Email group must have an emails array"};if(0===t.emails.length)return{valid:!1,error:"Email group must have at least one email address"};if(t.emails.length>50)return{valid:!1,error:"Email group cannot have more than 50 email addresses"};let r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;for(let e of t.emails)if("string"!=typeof e||!r.test(e))return{valid:!1,error:`Invalid email address in group: ${e}`};if(new Set(t.emails).size!==t.emails.length)return{valid:!1,error:"Email group contains duplicate email addresses"};break;default:return{valid:!1,error:"Unknown endpoint type"}}return{valid:!0}}catch(e){return{valid:!1,error:"Configuration validation failed"}}}(a.type,a.config);if(!l.valid)return console.log("âŒ Invalid configuration:",l.error),i.NextResponse.json({error:"Invalid configuration",details:l.error},{status:400});let d={id:(0,u.nanoid)(),name:a.name,type:a.type,config:JSON.stringify(a.config),description:a.description||null,userId:t,isActive:!0,createdAt:new Date,updatedAt:new Date};console.log("ğŸ’¾ Creating endpoint in database");let[p]=await n.db.insert(o.endpoints).values(d).returning();if("email_group"===a.type&&"emails"in a.config){console.log("ğŸ“§ Creating email group entries, count:",a.config.emails.length);let e=a.config.emails.map(e=>({id:(0,u.nanoid)(),endpointId:p.id,emailAddress:e,createdAt:new Date}));e.length>0&&await n.db.insert(o.emailGroups).values(e)}let c={...p,config:JSON.parse(p.config),groupEmails:"email_group"===a.type&&"emails"in a.config?a.config.emails:null,deliveryStats:{total:0,successful:0,failed:0,lastDelivery:null}};return console.log("âœ… Successfully created endpoint:",p.id),i.NextResponse.json(c,{status:201})}catch(e){return console.error("ğŸ’¥ Unexpected error in POST /api/v2/endpoints:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}},452267:e=>{"use strict";var{g:t,__dirname:r}=e;{e.s({patchFetch:()=>a,routeModule:()=>t,serverHooks:()=>d,workAsyncStorage:()=>r,workUnitAsyncStorage:()=>l});var i=e.i(854885),s=e.i(814689),n=e.i(25402),o=e.i(271090);let t=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/v2/endpoints/route",pathname:"/api/v2/endpoints",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/v2/endpoints/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:r,workUnitAsyncStorage:l,serverHooks:d}=t;function a(){return(0,n.patchFetch)({workAsyncStorage:r,workUnitAsyncStorage:l})}}},993477:e=>{var{g:t,__dirname:r}=e;e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__ba67ab7e._.js","server/chunks/node_modules_10ae7a2d._.js"].map(t=>e.l(t))).then(()=>t(611487)))}};

//# sourceMappingURL=%5Broot-of-the-server%5D__9b564d24._.js.map