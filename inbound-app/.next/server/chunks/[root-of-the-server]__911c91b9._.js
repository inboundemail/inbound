module.exports={929549:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},983943:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},86103:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},945935:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},348629:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("@opentelemetry/api",()=>require("@opentelemetry/api"))},76569:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("node:events",()=>require("node:events"))},804713:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("util",()=>require("util"))},87485:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("child_process",()=>require("child_process"))},420467:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("events",()=>require("events"))},936121:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("node:util",()=>require("node:util"))},681635:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("node:http",()=>require("node:http"))},866098:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("node:https",()=>require("node:https"))},580767:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("node:buffer",()=>require("node:buffer"))},329295:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("crypto",()=>require("crypto"))},62445:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("http",()=>require("http"))},348388:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("https",()=>require("https"))},591032:function(e){var{g:t,__dirname:s,m:r,e:n}=e;r.exports=e.x("node:crypto",()=>require("node:crypto"))},909834:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({DELIVERY_STATUS:()=>n.DELIVERY_STATUS,DELIVERY_TYPES:()=>n.DELIVERY_TYPES,DOMAIN_STATUS:()=>n.DOMAIN_STATUS,EMAIL_STATUS:()=>n.EMAIL_STATUS,ENDPOINT_TYPES:()=>n.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>n.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>n.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>n.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>n.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>n.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>n.WEBHOOK_STATUS,account:()=>r.account,apikey:()=>r.apikey,blockedEmails:()=>n.blockedEmails,domainDnsRecords:()=>n.domainDnsRecords,emailAddresses:()=>n.emailAddresses,emailDomains:()=>n.emailDomains,emailGroups:()=>n.emailGroups,endpointDeliveries:()=>n.endpointDeliveries,endpoints:()=>n.endpoints,parsedEmails:()=>n.parsedEmails,receivedEmails:()=>n.receivedEmails,sentEmails:()=>n.sentEmails,sesEvents:()=>n.sesEvents,session:()=>r.session,structuredEmails:()=>n.structuredEmails,subscriptions:()=>n.subscriptions,user:()=>r.user,userAccounts:()=>n.userAccounts,userOnboarding:()=>n.userOnboarding,verification:()=>r.verification,vipAllowedSenders:()=>n.vipAllowedSenders,vipConfigs:()=>n.vipConfigs,vipEmailAttempts:()=>n.vipEmailAttempts,vipPaymentSessions:()=>n.vipPaymentSessions,webhookDeliveries:()=>n.webhookDeliveries,webhooks:()=>n.webhooks});var r=e.i(594120),n=e.i(55379)},436754:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({DELIVERY_STATUS:()=>r.DELIVERY_STATUS,DELIVERY_TYPES:()=>r.DELIVERY_TYPES,DOMAIN_STATUS:()=>r.DOMAIN_STATUS,EMAIL_STATUS:()=>r.EMAIL_STATUS,ENDPOINT_TYPES:()=>r.ENDPOINT_TYPES,PROVIDER_CONFIDENCE:()=>r.PROVIDER_CONFIDENCE,SENT_EMAIL_STATUS:()=>r.SENT_EMAIL_STATUS,SES_VERIFICATION_STATUS:()=>r.SES_VERIFICATION_STATUS,VIP_PAYMENT_STATUS:()=>r.VIP_PAYMENT_STATUS,WEBHOOK_FORMATS:()=>r.WEBHOOK_FORMATS,WEBHOOK_STATUS:()=>r.WEBHOOK_STATUS,account:()=>r.account,apikey:()=>r.apikey,blockedEmails:()=>r.blockedEmails,domainDnsRecords:()=>r.domainDnsRecords,emailAddresses:()=>r.emailAddresses,emailDomains:()=>r.emailDomains,emailGroups:()=>r.emailGroups,endpointDeliveries:()=>r.endpointDeliveries,endpoints:()=>r.endpoints,parsedEmails:()=>r.parsedEmails,receivedEmails:()=>r.receivedEmails,sentEmails:()=>r.sentEmails,sesEvents:()=>r.sesEvents,session:()=>r.session,structuredEmails:()=>r.structuredEmails,subscriptions:()=>r.subscriptions,user:()=>r.user,userAccounts:()=>r.userAccounts,userOnboarding:()=>r.userOnboarding,verification:()=>r.verification,vipAllowedSenders:()=>r.vipAllowedSenders,vipConfigs:()=>r.vipConfigs,vipEmailAttempts:()=>r.vipEmailAttempts,vipPaymentSessions:()=>r.vipPaymentSessions,webhookDeliveries:()=>r.webhookDeliveries,webhooks:()=>r.webhooks}),e.i(468686);var r=e.i(909834)},153364:function(e){var{g:t,__dirname:s,m:r,e:n}=e;"use strict";r.exports=e.r(68043).vendored["react-rsc"].ReactServerDOMTurbopackServerEdge},459351:e=>{"use strict";var{g:t,__dirname:s}=e;e.s({AppEnv:()=>P,Autumn:()=>k,AutumnError:()=>a,FreeTrialDuration:()=>j,Infinite:()=>U,ProductItemInterval:()=>M,ProductStatus:()=>$,UsageModel:()=>C,fetchPricingTable:()=>q,toContainerResult:()=>N});var r=Object.defineProperty,n=(e,t,s)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,i=(e,t,s)=>n(e,"symbol"!=typeof t?t+"":t,s),a=class extends Error{constructor(e){super(e.message),i(this,"message"),i(this,"code"),this.message=e.message,this.code=e.code}toString(){return`${this.message} (code: ${this.code})`}toJSON(){return{message:this.message,code:this.code}}},o=(e,t,s)=>(t||(t=new k),e({instance:t,...s})),l=e=>({get:(t,s)=>o(c,e,{id:t,params:s}),create:t=>o(u,e,{params:t}),update:(t,s)=>o(p,e,{id:t,params:s}),delete:t=>o(m,e,{id:t}),billingPortal:(t,s)=>o(h,e,{id:t,params:s})}),d=e=>e?`expand=${e.join(",")}`:"",c=async({instance:e,id:t,params:s})=>t?e.get(`/customers/${t}?${d(s?.expand)}`):{data:null,error:new a({message:"Customer ID is required",code:"CUSTOMER_ID_REQUIRED"})},u=async({instance:e,params:t})=>e.post(`/customers?${d(t?.expand)}`,t),p=async({instance:e,id:t,params:s})=>e.post(`/customers/${t}`,s),m=async({instance:e,id:t})=>e.delete(`/customers/${t}`),h=async({instance:e,id:t,params:s})=>e.post(`/customers/${t}/billing_portal`,s),g=e=>({get:(t,s,r)=>o(v,e,{customer_id:t,entity_id:s,params:r}),create:(t,s)=>o(f,e,{customer_id:t,params:s}),delete:(t,s)=>o(E,e,{customer_id:t,entity_id:s})}),S=e=>e?`expand=${e.join(",")}`:"",v=async({instance:e,customer_id:t,entity_id:s,params:r})=>e.get(`/customers/${t}/entities/${s}?${S(r?.expand)}`),f=async({instance:e,customer_id:t,params:s})=>e.post(`/customers/${t}/entities`,s),E=async({instance:e,customer_id:t,entity_id:s})=>e.delete(`/customers/${t}/entities/${s}`),y=async({instance:e,params:t})=>e.post("/attach",t),T=async({instance:e,params:t})=>e.post("/cancel",t),_=async({instance:e,params:t})=>e.post("/entitled",t),A=async({instance:e,params:t})=>e.post("/events",t),x=async({instance:e,params:t})=>e.post("/track",t),b=async({instance:e,params:t})=>e.post("/usage",t),w=async({instance:e,params:t})=>e.post("/check",t),I=e=>({get:t=>o(R,e,{id:t}),create:t=>o(O,e,{params:t}),list:t=>o(D,e,{params:t})}),D=async({instance:e,params:t})=>{let s="/products";if(t){let e=new URLSearchParams;for(let[s,r]of Object.entries(t))void 0!==r&&e.append(s,String(r));let r=e.toString();r&&(s+=`?${r}`)}return e.get(s)},R=async({instance:e,id:t})=>e.get(`/products/${t}`),O=async({instance:e,params:t})=>e.post("/products",t),N=async e=>{if(e.status<200||e.status>=300){let t;try{t=await e.json()}catch(t){return{data:null,error:new a({message:"Failed to parse JSON response from Autumn",code:"internal_error"}),statusCode:e.status}}return{data:null,error:new a({message:t.message,code:t.code}),statusCode:e.status}}try{return{data:await e.json(),error:null,statusCode:e?.status}}catch(t){return{data:null,error:new a({message:"Failed to parse Autumn API response",code:"internal_error"}),statusCode:e?.status}}},k=class{constructor(e){i(this,"secretKey"),i(this,"publishableKey"),i(this,"level"),i(this,"headers"),i(this,"url"),i(this,"customers",l(this)),i(this,"products",I(this)),i(this,"entities",g(this));try{this.secretKey=e?.secretKey||process.env.AUTUMN_SECRET_KEY,this.publishableKey=e?.publishableKey||process.env.AUTUMN_PUBLISHABLE_KEY}catch(e){}if(!this.secretKey&&!this.publishableKey)throw Error("Autumn secret key or publishable key is required");this.headers={Authorization:`Bearer ${this.secretKey||this.publishableKey}`,"Content-Type":"application/json"};let t=e?.version||"1.2";this.headers["x-api-version"]=t,this.url=e?.url||"https://api.useautumn.com/v1",this.level=this.secretKey?"secret":"publishable"}getLevel(){return this.level}async get(e){return N(await fetch(`${this.url}${e}`,{headers:this.headers}))}async post(e,t){return N(await fetch(`${this.url}${e}`,{method:"POST",headers:this.headers,body:JSON.stringify(t)}))}async delete(e){return N(await fetch(`${this.url}${e}`,{method:"DELETE",headers:this.headers}))}async attach(e){return y({instance:this,params:e})}async cancel(e){return T({instance:this,params:e})}async entitled(e){return _({instance:this,params:e})}async check(e){return w({instance:this,params:e})}async event(e){return A({instance:this,params:e})}async track(e){return x({instance:this,params:e})}async usage(e){return b({instance:this,params:e})}};i(k,"customers",l()),i(k,"products",I()),i(k,"entities",g()),i(k,"attach",e=>o(y,void 0,{params:e})),i(k,"usage",e=>o(b,void 0,{params:e})),i(k,"cancel",e=>o(T,void 0,{params:e})),i(k,"entitled",e=>o(_,void 0,{params:e})),i(k,"check",e=>o(w,void 0,{params:e})),i(k,"event",e=>o(A,void 0,{params:e})),i(k,"track",e=>o(x,void 0,{params:e}));var P=(e=>(e.Sandbox="sandbox",e.Live="live",e))(P||{}),$=(e=>(e.Active="active",e.Expired="expired",e.Trialing="trialing",e.Scheduled="scheduled",e))($||{}),U="inf",j=(e=>(e.Day="day",e))(j||{}),C=(e=>(e.Prepaid="prepaid",e.PayPerUse="pay_per_use",e))(C||{}),M=(e=>(e.Minute="minute",e.Hour="hour",e.Day="day",e.Week="week",e.Month="month",e.Quarter="quarter",e.SemiAnnual="semi_annual",e.Year="year",e.Multiple="multiple",e))(M||{}),q=async({instance:e,params:t})=>{let s="/components/pricing_table";if(t){let e=new URLSearchParams;for(let[s,r]of Object.entries(t))"products"!==s&&void 0!==r&&e.append(s,String(r));let r=e.toString();r&&(s+=`?${r}`)}return await e.get(s)}},48597:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({SendRawEmailCommand:()=>t}),e.i(176357);var r=e.i(765519);e.i(74189);var n=e.i(517274);e.i(608477);var i=e.i(677114),a=e.i(477034),o=e.i(62265);class t extends i.Command.classBuilder().ep(a.commonParams).m(function(e,t,s,i){return[(0,n.getSerdePlugin)(s,this.serialize,this.deserialize),(0,r.getEndpointPlugin)(s,e.getEndpointParameterInstructions())]}).s("SimpleEmailService","SendRawEmail",{}).n("SESClient","SendRawEmailCommand").f(void 0,void 0).ser(o.se_SendRawEmailCommand).de(o.de_SendRawEmailCommand).build(){}}},416269:function(e){var{g:t,__dirname:s,m:r,e:n}=e},794385:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({POST:()=>S});var r=e.i(125427),n=e.i(494642),i=e.i(877465),a=e.i(48597),o=e.i(557440);e.i(468686);var l=e.i(55379),d=e.i(176825),c=e.i(459351),u=e.i(318812);function p(e){let t=e.match(/<(.+)>/);return t?t[1]:e.trim()}function m(e){let t=p(e).split("@");return 2===t.length?t[1]:""}function h(e){return e?Array.isArray(e)?e:[e]:[]}function g(e){let t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getUTCDay()],s=e.getUTCDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getUTCMonth()],n=e.getUTCFullYear(),i=e.getUTCHours().toString().padStart(2,"0"),a=e.getUTCMinutes().toString().padStart(2,"0"),o=e.getUTCSeconds().toString().padStart(2,"0");return`${t}, ${s} ${r} ${n} ${i}:${a}:${o} +0000`}let t=process.env.AWS_REGION||"us-east-2",s=process.env.AWS_ACCESS_KEY_ID,v=process.env.AWS_SECRET_ACCESS_KEY,f=null;async function S(e,{params:t}){console.log("üìß POST /api/v2/emails/[id]/reply - Starting request");try{console.log("üîê Validating request authentication");let{userId:s,error:i}=await (0,n.validateRequest)(e);if(!s)return console.log("‚ùå Authentication failed:",i),r.NextResponse.json({error:i},{status:401});console.log("‚úÖ Authentication successful for userId:",s);let{id:S}=await t;if(console.log("üì® Replying to email ID:",S),!S||"string"!=typeof S)return console.log("‚ö†Ô∏è Invalid email ID provided:",S),r.NextResponse.json({error:"Valid email ID is required"},{status:400});let v=e.headers.get("Idempotency-Key");if(v){console.log("üîë Idempotency key provided:",v);let e=await o.db.select().from(l.sentEmails).where((0,d.and)((0,d.eq)(l.sentEmails.userId,s),(0,d.eq)(l.sentEmails.idempotencyKey,v))).limit(1);if(e.length>0)return console.log("‚ôªÔ∏è Idempotent request - returning existing email:",e[0].id),r.NextResponse.json({id:e[0].id})}console.log("üîç Fetching original email");let E=await o.db.select().from(l.structuredEmails).where((0,d.and)((0,d.eq)(l.structuredEmails.id,S),(0,d.eq)(l.structuredEmails.userId,s))).limit(1);if(0===E.length)return console.log("üì≠ Original email not found"),r.NextResponse.json({error:"Email not found"},{status:404});let y=E[0];console.log("‚úÖ Found original email:",y.subject),console.log("üìù Parsing request body");let T=await e.json(),_=null;if(y.fromData)try{_=JSON.parse(y.fromData)}catch(e){console.error("Failed to parse original fromData:",e)}let A=_?.addresses?.[0]?.address;if(!A&&!T.to)return console.log("‚ö†Ô∏è Cannot determine recipient for reply"),r.NextResponse.json({error:"Cannot determine recipient email address"},{status:400});let x=T.to?h(T.to):[_?.text||A],b=T.subject||`Re: ${y.subject||"No Subject"}`,w=!1!==T.include_original;if(!T.from)return console.log("‚ö†Ô∏è Missing required field: from"),r.NextResponse.json({error:"From address is required"},{status:400});if(!T.html&&!T.text)return console.log("‚ö†Ô∏è No email content provided"),r.NextResponse.json({error:"Either html or text content must be provided"},{status:400});let I=p(T.from),D=m(T.from);console.log("üìß Reply details:",{from:T.from,to:x,subject:b,originalMessageId:y.messageId}),console.log("üîç Verifying domain ownership for:",D);let R=await o.db.select().from(l.emailDomains).where((0,d.and)((0,d.eq)(l.emailDomains.userId,s),(0,d.eq)(l.emailDomains.domain,D),(0,d.eq)(l.emailDomains.status,"verified"))).limit(1);if(0===R.length)return console.log("‚ùå User does not own the sender domain:",D),r.NextResponse.json({error:`You don't have permission to send from domain: ${D}`},{status:403});console.log("‚úÖ Domain ownership verified");let O=h(T.cc),N=h(T.bcc),k=h(T.reply_to),P=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;for(let e of[...x,...O,...N]){let t=p(e);if(!P.test(t))return console.log("‚ö†Ô∏è Invalid email format:",e),r.NextResponse.json({error:`Invalid email format: ${e}`},{status:400})}console.log("üîç Checking email sending limits with Autumn");let{data:$,error:U}=await c.Autumn.check({customer_id:s,feature_id:"emails_sent"});if(U)return console.error("‚ùå Autumn email check error:",U),r.NextResponse.json({error:"Failed to check email sending limits"},{status:500});if(!$.allowed)return console.log("‚ùå Email sending limit reached for user:",s),r.NextResponse.json({error:"Email sending limit reached. Please upgrade your plan to send more emails."},{status:429});let j=y.messageId?`<${y.messageId}>`:void 0,C=[];if(y.references)try{let e=JSON.parse(y.references);Array.isArray(e)&&(C=e)}catch(e){console.error("Failed to parse references:",e)}y.messageId&&C.push(`<${y.messageId}>`);let M=T.text||"";w&&T.text&&(M+=function(e,t=!0){if(!t)return"";let s=null;if(e.fromData)try{s=JSON.parse(e.fromData)}catch(e){console.error("Failed to parse fromData:",e)}let r=s?.text||"Unknown Sender",n=e.date?g(new Date(e.date)):"Unknown Date";return`

On ${n}, ${r} wrote:
`+(e.textBody||"").split("\n").map(e=>""===e.trim()?"":e.startsWith(">")?`>${e}`:`> ${e}`).join("\n")}(y,!0));let q=T.html||"";if(w&&T.html&&y.htmlBody){let e=_?.text||"Unknown Sender",t=y.date?g(new Date(y.date)):"Unknown Date";q+=`
                <br><br>
                <div style="border-left: 2px solid #ccc; padding-left: 10px; margin-left: 10px; color: #666; font-size: 13px;">
                    <p style="margin: 0 0 10px 0; font-weight: normal;">On ${t}, ${e} wrote:</p>
                    <div style="margin: 0;">${y.htmlBody}</div>
                </div>
            `}let F=(0,u.nanoid)(),L=`${F}@${D}`;if(T.headers){let e=Object.keys(T.headers).find(e=>"message-id"===e.toLowerCase());e&&T.headers[e]&&(L=T.headers[e].replace(/^<|>$/g,""))}if(console.log("üíæ Creating sent email record:",F),await o.db.insert(l.sentEmails).values({id:F,from:T.from,fromAddress:I,fromDomain:D,to:JSON.stringify(x),cc:O.length>0?JSON.stringify(O):null,bcc:N.length>0?JSON.stringify(N):null,replyTo:k.length>0?JSON.stringify(k):null,subject:b,textBody:M,htmlBody:q,headers:JSON.stringify({...T.headers||{},"In-Reply-To":j,References:C.join(" ")}),attachments:T.attachments?JSON.stringify(T.attachments):null,status:l.SENT_EMAIL_STATUS.PENDING,messageId:L,userId:s,idempotencyKey:v,createdAt:new Date,updatedAt:new Date}).returning(),!f)return console.log("‚ùå AWS SES not configured"),await o.db.update(l.sentEmails).set({status:l.SENT_EMAIL_STATUS.FAILED,failureReason:"AWS SES not configured",updatedAt:new Date}).where((0,d.eq)(l.sentEmails.id,F)),r.NextResponse.json({error:"Email service not configured. Please contact support."},{status:500});try{console.log("üì§ Sending reply email via AWS SES");let e=function(e){let t=`----=_Part_${(0,u.nanoid)()}`,s=e.customHeaders&&Object.keys(e.customHeaders).some(e=>"message-id"===e.toLowerCase()),r=[`From: ${e.from}`,`To: ${e.to.join(", ")}`,e.cc&&e.cc.length>0?`Cc: ${e.cc.join(", ")}`:null,e.replyTo&&e.replyTo.length>0?`Reply-To: ${e.replyTo.join(", ")}`:null,`Subject: ${e.subject}`,!s?`Message-ID: <${e.messageId}@${m(e.from)}>`:null,e.inReplyTo?`In-Reply-To: ${e.inReplyTo}`:null,e.references&&e.references.length>0?`References: ${e.references.join(" ")}`:null,`Date: ${g(e.date)}`,"MIME-Version: 1.0"].filter(Boolean);if(e.customHeaders)for(let[t,s]of Object.entries(e.customHeaders))r.push(`${t}: ${s}`);let n=[];return e.textBody&&e.htmlBody?(r.push(`Content-Type: multipart/alternative; boundary="${t}"`),n.push(""),n.push(`--${t}`),n.push("Content-Type: text/plain; charset=UTF-8"),n.push("Content-Transfer-Encoding: quoted-printable"),n.push(""),n.push(e.textBody),n.push(`--${t}`),n.push("Content-Type: text/html; charset=UTF-8"),n.push("Content-Transfer-Encoding: quoted-printable"),n.push(""),n.push(e.htmlBody),n.push(`--${t}--`)):e.textBody?(r.push("Content-Type: text/plain; charset=UTF-8"),r.push("Content-Transfer-Encoding: quoted-printable"),n.push(""),n.push(e.textBody)):e.htmlBody&&(r.push("Content-Type: text/html; charset=UTF-8"),r.push("Content-Transfer-Encoding: quoted-printable"),n.push(""),n.push(e.htmlBody)),r.join("\r\n")+"\r\n"+n.join("\r\n")}({from:T.from,to:x,cc:O,bcc:N,replyTo:k,subject:b,textBody:M,htmlBody:q,messageId:L,inReplyTo:j,references:C,date:new Date,customHeaders:T.headers}),t=new a.SendRawEmailCommand({RawMessage:{Data:Buffer.from(e)},Source:I,Destinations:[...x,...O,...N].map(p)}),n=await f.send(t),i=n.MessageId;if(console.log("‚úÖ Reply sent successfully via SES:",i),await o.db.update(l.sentEmails).set({status:l.SENT_EMAIL_STATUS.SENT,providerResponse:JSON.stringify(n),sentAt:new Date,updatedAt:new Date}).where((0,d.eq)(l.sentEmails.id,F)),!$.unlimited){console.log("üìä Tracking email usage with Autumn");let{error:e}=await c.Autumn.track({customer_id:s,feature_id:"emails_sent",value:1});e&&console.error("‚ùå Failed to track email usage:",e)}return console.log("‚úÖ Reply processing complete"),r.NextResponse.json({id:F},{status:200})}catch(e){return console.error("‚ùå SES send error:",e),await o.db.update(l.sentEmails).set({status:l.SENT_EMAIL_STATUS.FAILED,failureReason:e instanceof Error?e.message:"Unknown SES error",providerResponse:JSON.stringify(e),updatedAt:new Date}).where((0,d.eq)(l.sentEmails.id,F)),r.NextResponse.json({error:"Failed to send reply. Please try again later."},{status:500})}}catch(e){return console.error("üí• Unexpected error in POST /api/v2/emails/[id]/reply:",e),r.NextResponse.json({error:"Internal server error"},{status:500})}}s&&v?f=new i.SESClient({region:t,credentials:{accessKeyId:s,secretAccessKey:v}}):console.warn("‚ö†Ô∏è AWS credentials not configured. Email sending will not work.")}},38896:e=>{"use strict";var{g:t,__dirname:s}=e;{e.s({patchFetch:()=>o,routeModule:()=>t,serverHooks:()=>d,workAsyncStorage:()=>s,workUnitAsyncStorage:()=>l});var r=e.i(854885),n=e.i(814689),i=e.i(25402),a=e.i(794385);let t=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v2/emails/[id]/reply/route",pathname:"/api/v2/emails/[id]/reply",filename:"route",bundlePath:""},resolvedPagePath:"[project]/app/api/v2/emails/[id]/reply/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:s,workUnitAsyncStorage:l,serverHooks:d}=t;function o(){return(0,i.patchFetch)({workAsyncStorage:s,workUnitAsyncStorage:l})}}},993477:e=>{var{g:t,__dirname:s}=e;e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__859a4a83._.js","server/chunks/node_modules_10ae7a2d._.js"].map(t=>e.l(t))).then(()=>t(611487)))},73518:e=>{var{g:t,__dirname:s}=e;e.v(t=>Promise.all(["server/chunks/[externals]_url_a7f1d978._.js","server/chunks/9f50b_@smithy_credential-provider-imds_dist-es_d5e4d7ca._.js"].map(t=>e.l(t))).then(()=>t(653223)))},855094:e=>{var{g:t,__dirname:s}=e;e.v(t=>Promise.all(["server/chunks/[externals]_fs_promises_1c68bc94._.js","server/chunks/9f50b_@aws-sdk_credential-provider-http_89f62eca._.js"].map(t=>e.l(t))).then(()=>t(515630)))},520835:e=>{var{g:t,__dirname:s}=e;e.v(t=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-web-identity_cdb7c4f6._.js"].map(t=>e.l(t))).then(()=>t(399432)))},404886:e=>{var{g:t,__dirname:s}=e;e.v(t=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-process_dist-es_f8837f08._.js"].map(t=>e.l(t))).then(()=>t(31086)))},800893:e=>{var{g:t,__dirname:s}=e;e.v(t=>Promise.all(["server/chunks/9f50b_ca9f9f23._.js"].map(t=>e.l(t))).then(()=>t(387894)))},683391:e=>{var{g:t,__dirname:s}=e;e.v(t=>Promise.all(["server/chunks/9f50b_@aws-sdk_credential-provider-sso_b48ea3ae._.js"].map(t=>e.l(t))).then(()=>t(695705)))},586469:e=>{var{g:t,__dirname:s}=e;e.v(t=>Promise.all(["server/chunks/[externals]_url_a7f1d978._.js","server/chunks/87a6c_@smithy_credential-provider-imds_dist-es_ee44b021._.js"].map(t=>e.l(t))).then(()=>t(488366)))}};

//# sourceMappingURL=%5Broot-of-the-server%5D__911c91b9._.js.map